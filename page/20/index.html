<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"syxdevcode.github.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="syxdevcode博客">
<meta property="og:url" content="https://syxdevcode.github.com/page/20/index.html">
<meta property="og:site_name" content="syxdevcode博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="syxdevcode">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://syxdevcode.github.com/page/20/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>syxdevcode博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">syxdevcode博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/syxdevcode" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/10/Linux-shell%E4%B8%AD%E7%9A%84%E7%AB%96%E7%BA%BF%EF%BC%88-%EF%BC%89%E2%80%94%E2%80%94%E7%AE%A1%E9%81%93%E7%AC%A6%E5%8F%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/Linux-shell%E4%B8%AD%E7%9A%84%E7%AB%96%E7%BA%BF%EF%BC%88-%EF%BC%89%E2%80%94%E2%80%94%E7%AE%A1%E9%81%93%E7%AC%A6%E5%8F%B7/" class="post-title-link" itemprop="url">Linux shell中的竖线（|）——管道符号</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-10 10:18:29" itemprop="dateCreated datePublished" datetime="2018-05-10T10:18:29+00:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">Linux基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux-shell中的竖线（-）——管道符号"><a href="#Linux-shell中的竖线（-）——管道符号" class="headerlink" title="Linux shell中的竖线（|）——管道符号"></a>Linux shell中的竖线（|）——管道符号</h1><p>在Linux系统中管道线是由竖杠（|）隔开的若干个命令组成的序列，在管道线中，每个命令运行时都有一个独立的进程。前一个命令的输出正是下一个命令的输入。而管道线中有一类命令也称作“过滤器”，过滤器首先读取输入，然后将输入以某种简单方式进行变换（相当于过滤），再将处理结果输出，例如grep、tail、sort和wc等命令就称为过滤器。</p>
<p>一个管道线中可以包括多条命令。</p>
<p>用法: <code>command 1 | command 2</code></p>
<p>他的功能是把第一个命令command 1执行的结果作为command 2的输入传给command 2</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -s|sort -nr</span><br></pre></td></tr></table></figure>

<p>-s 是file size，-n是numeric-sort，-r是reverse，反转</p>
<p>该命令列出当前目录中的文档(含size)，并把输出送给sort命令作为输入，sort命令按数字递减的顺序把ls的输出排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -s|sort -n</span><br></pre></td></tr></table></figure>

<p>按从小到大的顺序输出。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_6d09b5750100vley.html">http://blog.sina.com.cn/s/blog_6d09b5750100vley.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kaosini/article/details/6578115">https://blog.csdn.net/kaosini/article/details/6578115</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/09/Docker%E5%9F%BA%E7%A1%80-%E9%95%9C%E5%83%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/09/Docker%E5%9F%BA%E7%A1%80-%E9%95%9C%E5%83%8F/" class="post-title-link" itemprop="url">Docker基础-镜像</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-09 09:00:50" itemprop="dateCreated datePublished" datetime="2018-05-09T09:00:50+00:00">2018-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>** 三大核心概念 **</p>
<p>镜像，容器，仓库</p>
<p><strong>镜像是 Docker 的三大核心概念之一</strong>。Docker 运行容器前需要本地存在对应的镜像，如果本地没有对应的镜像，Docker 会尝试从默认的镜像仓库下载。当然用户也可以通过配置，使用自定义的镜像仓库。<br>本文将介绍镜像的具体操作，包括使用 pull 命令从 Docker Hub 的镜像仓库中拉取(下载)公共镜像；查看本地已有的镜像信息；使用 search 命令搜索镜像；删除镜像标签和镜像文件；创建用户自定义镜像并上传到 Docker Hub 镜像仓库。<br>与镜像相关的操作都被定义在 <strong>docker image</strong> 子命令中，虽然不带 image 的格式依然被兼容，但带上 image 后会让命令更容易理解，也会有更好的自动补全效果。</p>
<h2 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h2><p>本地镜像是运行容器的前提，所以在运行容器前我们需要使用 docker image pull 命令从网络上的镜像仓库把镜像拉取到本地。该命令的格式为：</p>
<p>** docker image pull [OPTIONS] NAME[:TAG|@DIGEST] **</p>
<p>如果只指定了镜像的名称，默认会选择拉取 latest 标签标记的镜像。比如我们要拉取最新的 ubuntu 镜像：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull ubuntu</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509141612.png" alt="1"></p>
<p>该命令实际拉取的是 ubuntu:latest 镜像。从上图中可以看到，docker 的镜像其实被分成了很多的层，每层保存一些特定的文件。上面的命令实际相当于：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull registry.hub.docker.com/ubuntu:latest</span><br></pre></td></tr></table></figure>

<p>即从默认的数据仓库服务器 registry.hub.docker.com 中拉取 ubuntu 仓库中的最新镜像。如果我们感觉从 Docker Hub 上拉取镜像太慢，可选择从其它的数据仓库服务器上拉取，比如 Docker Hub 在国内部署的服务器：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull registry.docker-cn.com/library/ubuntu:latest</span><br></pre></td></tr></table></figure>

<p>镜像下载到本地后就可运行容器了，比如：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> --rm ubuntu <span class="built_in">echo</span> hello docker</span></span><br></pre></td></tr></table></figure>

<p>–rm :退出时，删除容器</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509163105.png" alt="1"></p>
<h2 id="查看镜像信息"><a href="#查看镜像信息" class="headerlink" title="查看镜像信息"></a>查看镜像信息</h2><p> <code>docker image ls</code> 或 <code>docker images</code> 命令可以列出本地存储的镜像<br><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509163307.png" alt="2"></p>
<p>输出的信息中包含的内容有：</p>
<p>REPOSITORY：说明镜像来自哪个仓库，比如 ubuntu 或 registry.docker-cn.com/library/ubuntu。</p>
<p>TAG：镜像的标签信息，比如 14.04 或 latest。</p>
<p>IMAGE ID：标识镜像的 ID 号。</p>
<p>CREATED：创建镜像的时间。</p>
<p>SIZE：镜像大小。</p>
<p>其中镜像的 ID 信息十分重要，它唯一的标识了镜像。</p>
<p>TAG 信息用来标记来自同一个仓库(比如 ubuntu)的不同镜像。例如 ubuntu 仓库中有多个镜像，可以通过 TAG 信息来区</p>
<p>分它们，TAG 13.04、14.04 和 16.04 都代表了不同的发行版本。</p>
<p>使用 <code>docker image tag</code> 命令为本地的镜像添加新的标签还可以方便我们的使用，比如为 ubuntu:latest 镜像添加下面的标签：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image tag ubuntu:latest oldubuntu</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509163748.png" alt="3"></p>
<p>使用<code>docker image inspect</code>命令可以查看镜像详细信息</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect ubuntu:latest</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509164159.png" alt="4"></p>
<p>它输出的是一个 JSON 格式的信息，一般情况下我们会有的放矢的通过 -f 选项取其中的某一部分。比如只获取镜像的 Architecture 信息：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect -f &#123;&#123;<span class="string">&quot;.Architecture&quot;</span>&#125;&#125; ubuntu:latest</span><br></pre></td></tr></table></figure>

<h2 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h2><p>除了直接在 Docker Hub 的官方网站上搜索镜像资源，还可以通 docker search 命令以命令行的方式进行搜索，比如搜索 mysql 镜像：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure>

<p>这个命令的价值有限，因为我们在选择镜像时还是需要慎重的。往往要在 Docker Hub 的官方网站上查看镜像相关的详细信息，然后才会决定是否使用，而 docker search 命令提供的信息过于有限。</p>
<h2 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h2><p> docker image rm 命令传递镜像的标签或 ID，这两种方式略微有些区别。</p>
<h3 id="使用进行的标签删除镜像"><a href="#使用进行的标签删除镜像" class="headerlink" title="使用进行的标签删除镜像"></a>使用进行的标签删除镜像</h3><p>对于被多个标签引用的镜像 ID，删除标签时只是把那个标签删掉了，并不会真正删除镜像文件。</p>
<h3 id="使用镜像-ID-删除镜像"><a href="#使用镜像-ID-删除镜像" class="headerlink" title="使用镜像 ID 删除镜像"></a>使用镜像 ID 删除镜像</h3><p> docker 检测到该镜像 ID 被引用了多次就机智的报错了，并且终止了删除操作。同样如果由其它的镜像引用了该 ID 的镜像， docker 同样会报错并终止删除操作。所以，只有当一个镜像不被多个标签引用，也没其它镜像引用它时，才可以被通过镜像 ID 删除。</p>
<h2 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h2><p>我们可以通过不同的方式创建镜像，比如基于已有容器进行创建和基于 Dockerfile 文件进行创建。</p>
<p>这里只介绍如何通过 <code>docker container commit</code> 命令基于已有容器创建镜像</p>
<p>我们先启动一个以 ubuntu:latest 为镜像的容器，然后在当前目录下创建一个名为 testfile 的文件:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> -it ubuntu:latest bash</span></span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]<span class="comment"># docker run -it ubuntu:latest bash</span></span><br><span class="line">root@<span class="number">2</span>a45b0b39bf8:/<span class="comment"># touch testfile</span></span><br><span class="line">root@<span class="number">2</span>a45b0b39bf8:/<span class="comment"># ls</span></span><br><span class="line">bin   dev  home  lib64  mnt  proc  <span class="keyword">run</span><span class="bash">   srv  testfile  usr</span></span><br><span class="line">boot  etc  lib   media  opt  root  sbin  sys  tmp       var</span><br><span class="line">root@<span class="number">2</span>a45b0b39bf8:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>在文件创建后退出容器，但要记住该容器的 ID 为： 2a45b0b39bf8 。然后执行下面的命令创建镜像：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container commit -m <span class="string">&quot;add file testfile.&quot;</span> <span class="number">2</span>a45b0b39bf8 testimage</span><br></pre></td></tr></table></figure>

<p>镜像创建成功后，你可以在镜像列表中看到名称为 testimage 的镜像</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p>下面运行一个基于 testimage 的容器，看看 nickfile 是否存在。–rm：退出时自动删除</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> --rm testimage ls</span></span><br></pre></td></tr></table></figure>

<p>在容器中创建的文件 testfile 已经被成功的添加到 testimage 镜像中了。</p>
<h2 id="导入导出镜像"><a href="#导入导出镜像" class="headerlink" title="导入导出镜像"></a>导入导出镜像</h2><p>当碰到没有网络的环境时，如何获取镜像呢？答案是在能够获得镜像的环境中把镜像导出为文件，然后通过 U 盘等设备拷贝到目标环境中，再进行导入。</p>
<h3 id="导出镜像"><a href="#导出镜像" class="headerlink" title="导出镜像"></a>导出镜像</h3><p>通过 <code>docker image save</code> 命令可以把镜像导出为本地文件，比如导出 ubuntu:latest 镜像为 ubuntu1804.tar：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image save -o ubuntu1804.tar ubuntu:latest</span><br></pre></td></tr></table></figure>

<p>一般我们还会再压缩一下，这样最终的文件会小不少：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -czf ubuntu1804.tar.gz ubuntu1804.tar</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509172150.png" alt="4"></p>
<h3 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a>导入镜像</h3><p>把 ubuntu1804.tar.gz 文件拷贝到目标系统上后先要解压出 ubuntu1804.tar 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xf ubuntu1804.tar.gz</span><br></pre></td></tr></table></figure>

<p>然后通过 docker image load 命令执行镜像的导入操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image load -i ubuntu1804.tar</span><br></pre></td></tr></table></figure>

<p>这样就 OK 了，用 docker image ls 命令看看，是不是已经可以看到 ubuntu:latest 镜像了！</p>
<h2 id="上传镜像"><a href="#上传镜像" class="headerlink" title="上传镜像"></a>上传镜像</h2><p>可以使用 <strong><code>docker image push</code></strong> 命令把镜像上传到镜像仓库服务器，默认是上传到 Docker Hub 的镜像仓库，此时事先需要注册用户并进行登录。上传镜像的命令格式为：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image push NAME[:TAG]</span><br></pre></td></tr></table></figure>

<p>在 Docker Hub 注册账号，并通过 docker login 命令完成了登录操作(需要输入用户名和密码进行验证)。接下来就可把本地的镜像上传到镜像仓库服务器了。在上传前需要给镜像打上合法的标签(用户账号/仓库名称:TAG)，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]# docker image tag --help</span><br><span class="line"></span><br><span class="line">Usage: docker image tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br><span class="line"></span><br><span class="line">Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line"></span><br><span class="line">Options:</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image tag azcli:<span class="number">1.0</span> ljfpower/azcli:latest</span><br></pre></td></tr></table></figure>

<p>最后上传这个标签就行了：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image push ljfpower/azcli:latest</span><br></pre></td></tr></table></figure>

<p>上传后你就可以在 Docker Hub 上看到这个镜像了。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sparkdev/p/8901728.html">https://www.cnblogs.com/sparkdev/p/8901728.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/08/CentOS7-Docker-Jenkins-DotNetCore%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/08/CentOS7-Docker-Jenkins-DotNetCore%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">CentOS7 & Docker & Jenkins & DotNetCore项目配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-08 13:54:33" itemprop="dateCreated datePublished" datetime="2018-05-08T13:54:33+00:00">2018-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jenkins/" itemprop="url" rel="index"><span itemprop="name">Jenkins</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CentOS7-amp-Docker-amp-Jenkins-amp-DotNetCore项目配置"><a href="#CentOS7-amp-Docker-amp-Jenkins-amp-DotNetCore项目配置" class="headerlink" title="CentOS7 &amp; Docker &amp; Jenkins &amp; DotNetCore项目配置"></a>CentOS7 &amp; Docker &amp; Jenkins &amp; DotNetCore项目配置</h1><h2 id="GitHub配置"><a href="#GitHub配置" class="headerlink" title="GitHub配置"></a>GitHub配置</h2><h3 id="SercretText"><a href="#SercretText" class="headerlink" title="SercretText"></a>SercretText</h3><p>注：此处需要一个对项目有写权限的账户</p>
<p>进入SGithub –&gt; Setting –&gt; Developer settings –&gt; Personal access tokens</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508141541.png" alt="1"></p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508141948.png" alt="2"></p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508142138.png" alt="3"></p>
<p>自己先保存此token，如果丢失，之后再也无法找到这个token。</p>
<h2 id="配置GitHub-Plugin"><a href="#配置GitHub-Plugin" class="headerlink" title="配置GitHub Plugin"></a>配置GitHub Plugin</h2><p>系统管理 –&gt; 系统设置 –&gt; GitHub –&gt; GitHub Plugin</p>
<p>配置github用户名，邮箱</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508144549.png" alt="4"></p>
<h2 id="配置Jenkins"><a href="#配置Jenkins" class="headerlink" title="配置Jenkins"></a>配置Jenkins</h2><h3 id="新建任务："><a href="#新建任务：" class="headerlink" title="新建任务："></a>新建任务：</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508145651.png" alt="5"></p>
<h3 id="General-通常"><a href="#General-通常" class="headerlink" title="General(通常)"></a>General(通常)</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508145841.png" alt="6"></p>
<h3 id="源码管理"><a href="#源码管理" class="headerlink" title="源码管理"></a>源码管理</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508145941.png" alt="7"></p>
<p>点击Add：</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508150102.png" alt="8"></p>
<h3 id="构建触发器："><a href="#构建触发器：" class="headerlink" title="构建触发器："></a>构建触发器：</h3><p><code>H/2 * * * *</code></p>
<p>具体参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/brave_insist/article/details/78434877">https://blog.csdn.net/brave_insist/article/details/78434877</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">每15分钟构建一次：H&#x2F;15 * * * *   或*&#x2F;5 * * * *</span><br><span class="line"></span><br><span class="line">每天8点构建一次：0 8 * * *</span><br><span class="line"></span><br><span class="line">每天8点~17点，两小时构建一次：0 8-17&#x2F;2 * * *</span><br><span class="line"></span><br><span class="line">周一到周五，8点~17点，两小时构建一次：0 8-17&#x2F;2 * * 1-5</span><br><span class="line"></span><br><span class="line">每月1号、15号各构建一次，除12月：H H 1,15 1-11 *</span><br><span class="line"></span><br><span class="line">*&#x2F;5 * * * * （每5分钟检查一次源码变化）</span><br><span class="line"></span><br><span class="line">0 2 * * * （每天2:00 必须build一次源码）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">每个部分代表的含义以及取值范围</span><br><span class="line"></span><br><span class="line">分钟，取值范围（0~59）：若其他值不做设定，则表示每个设定的分钟都会构建</span><br><span class="line">如：5 * * * * ，表示每个小时的第5分钟都会构建一次</span><br><span class="line"></span><br><span class="line">小时，取值范围（0~23）：若其他值不做设定，则表示每个设定小时的每分钟都会构建</span><br><span class="line">如：* 5 * * * ，表示在每天5点的时候，一小时内每一分钟都会构建一次</span><br><span class="line"></span><br><span class="line">日期，取值范围（1~31）：若其他值不做设定，则表示每个月的那一天每分钟都会构建一次</span><br><span class="line">如：* * 5 * *，表示在每个月5号的时候，0点开始每分钟构建一次</span><br><span class="line"></span><br><span class="line">月份，取值范围（1~12）：若其他值不做设定，则表示每年的那个月每分钟都会构建一次</span><br><span class="line">如：* * * 5 *，表示在每年的5月份，1号0点开始每分钟构建一次</span><br><span class="line"></span><br><span class="line">星期，取值范围（0 ~ 7）：若其他值不做设定，则表示每周的那一天几每分钟都会构建一次</span><br><span class="line">如：* * * * 5，表示每周五0点开始每分钟构建一次</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508150645.png" alt="9"></p>
<h3 id="构建环境"><a href="#构建环境" class="headerlink" title="构建环境"></a>构建环境</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508151257.png" alt="10"></p>
<p>点击Add：</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508152137.png" alt="10"></p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508152518.png" alt="11"></p>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508152609.png" alt="12"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 获取短版本号</span></span><br><span class="line"></span><br><span class="line">GITHASH=`git rev-parse --short HEAD`</span><br><span class="line"><span class="built_in">echo</span> ---------------Remove-Orphans------------------</span><br><span class="line">docker-compose -f ./docker-compose.yml -f ./docker-compose.override.yml  -p dotnetcoreapp1 down --rmi <span class="built_in">local</span> --remove-orphans</span><br><span class="line"><span class="built_in">echo</span> ------------------Config-----------------------</span><br><span class="line">docker-compose -f ./docker-compose.ci.build.yml -p dotnetcoreapp1 config</span><br><span class="line"><span class="built_in">echo</span> ------------------Build------------------------</span><br><span class="line">docker-compose -f ./docker-compose.ci.build.yml -p dotnetcoreapp1 up --build</span><br><span class="line"><span class="built_in">echo</span> ---------------Publishing...------------------</span><br><span class="line">docker-compose -f <span class="string">&quot;./docker-compose.yml&quot;</span> -f <span class="string">&quot;./docker-compose.override.yml&quot;</span>  -p dotnetcoreapp1 up -d --build</span><br><span class="line"><span class="built_in">echo</span> ---------------Clear-Images...------------------</span><br><span class="line">docker rmi -f $(docker images -f <span class="string">&quot;dangling=true&quot;</span> -q)</span><br><span class="line"><span class="built_in">echo</span> ---------------Clear-Containers...------------------</span><br><span class="line">docker rm dotnetcoreapp1_ci-build_1</span><br></pre></td></tr></table></figure>

<p>命令说明：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-f, --file FILE 指定使用的 Compose 模板文件，默认为 docker-compose.yml，可以多次指定。</span><br><span class="line"></span><br><span class="line">-p, --project-name NAME 指定项目名称，默认将使用所在目录名称作为项目名。</span><br></pre></td></tr></table></figure>

<p>修改docker-compose.override.yml文件：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  dotnetcoreapp:</span><br><span class="line">    environment:</span><br><span class="line">      - ASPNETCORE_ENVIRONMENT=Development</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8081:80&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[MvcTest] $ &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;jenkins3923627102865574973.sh</span><br><span class="line">---------------Remove-Orphans------------------</span><br><span class="line"></span><br><span class="line">Removing network dotnetcoreapp1_default</span><br><span class="line">------------------Config-----------------------</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  ci-build:</span><br><span class="line">    command: &#x2F;bin&#x2F;bash -c &quot;dotnet restore .&#x2F;DotNetCoreApp.sln &amp;&amp; dotnet publish .&#x2F;DotNetCoreApp.sln</span><br><span class="line">      -c Release -o .&#x2F;obj&#x2F;Docker&#x2F;publish&quot;</span><br><span class="line">    image: microsoft&#x2F;aspnetcore-build:1.0-2.0</span><br><span class="line">    volumes:</span><br><span class="line">    - &#x2F;var&#x2F;jenkins_home&#x2F;workspace&#x2F;MvcTest:&#x2F;src:rw</span><br><span class="line">    working_dir: &#x2F;src</span><br><span class="line">version: &#39;3.0&#39;</span><br><span class="line"></span><br><span class="line">------------------Build------------------------</span><br><span class="line"></span><br><span class="line">Creating network &quot;dotnetcoreapp1_default&quot; with the default driver</span><br><span class="line"></span><br><span class="line">Creating dotnetcoreapp1_ci-build_1 ... </span><br><span class="line"></span><br><span class="line">[1A[2K</span><br><span class="line">Creating dotnetcoreapp1_ci-build_1 ... [32mdone[0m</span><br><span class="line">[1BAttaching to dotnetcoreapp1_ci-build_1</span><br><span class="line">[36mci-build_1  |[0m   Restoring packages for &#x2F;src&#x2F;DotNetCoreApp&#x2F;DotNetCoreApp.csproj...</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   Generating MSBuild file &#x2F;src&#x2F;DotNetCoreApp&#x2F;obj&#x2F;DotNetCoreApp.csproj.nuget.g.props.</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   Generating MSBuild file &#x2F;src&#x2F;DotNetCoreApp&#x2F;obj&#x2F;DotNetCoreApp.csproj.nuget.g.targets.</span><br><span class="line">[36mci-build_1  |[0m   Restore completed in 30.06 sec for &#x2F;src&#x2F;DotNetCoreApp&#x2F;DotNetCoreApp.csproj.</span><br><span class="line">[36mci-build_1  |[0m   Restoring packages for &#x2F;src&#x2F;DotNetCoreApp&#x2F;DotNetCoreApp.csproj...</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   Restore completed in 2.64 sec for &#x2F;src&#x2F;DotNetCoreApp&#x2F;DotNetCoreApp.csproj.</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m Microsoft (R) Build Engine version 15.6.84.34536 for .NET Core</span><br><span class="line">[36mci-build_1  |[0m Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line">[36mci-build_1  |[0m </span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   Restore completed in 97.25 ms for &#x2F;src&#x2F;DotNetCoreApp&#x2F;DotNetCoreApp.csproj.</span><br><span class="line">[36mci-build_1  |[0m   Restore completed in 24.37 ms for &#x2F;src&#x2F;DotNetCoreApp&#x2F;DotNetCoreApp.csproj.</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   DotNetCoreApp -&gt; &#x2F;src&#x2F;DotNetCoreApp&#x2F;bin&#x2F;Release&#x2F;netcoreapp2.0&#x2F;DotNetCoreApp.dll</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   DotNetCoreApp -&gt; &#x2F;src&#x2F;DotNetCoreApp&#x2F;obj&#x2F;Docker&#x2F;publish&#x2F;</span><br><span class="line"></span><br><span class="line">[36mdotnetcoreapp1_ci-build_1 exited with code 0</span><br><span class="line"></span><br><span class="line">[0m---------------Publishing...------------------</span><br><span class="line"></span><br><span class="line">Building dotnetcoreapp</span><br><span class="line"></span><br><span class="line">Step 1&#x2F;6 : FROM microsoft&#x2F;aspnetcore:2.0</span><br><span class="line"> ---&gt; c4ca78cf9dca</span><br><span class="line">Step 2&#x2F;6 : ARG source</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 5ccef217b449</span><br><span class="line">Step 3&#x2F;6 : WORKDIR &#x2F;app</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 21ca58736a23</span><br><span class="line">Step 4&#x2F;6 : EXPOSE 80</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; fa9898960c84</span><br><span class="line">Step 5&#x2F;6 : COPY $&#123;source:-obj&#x2F;Docker&#x2F;publish&#125; .</span><br><span class="line"></span><br><span class="line"> ---&gt; a7d0c6386eb4</span><br><span class="line">Step 6&#x2F;6 : ENTRYPOINT [&quot;dotnet&quot;, &quot;DotNetCoreApp.dll&quot;]</span><br><span class="line"> ---&gt; Running in dd4cfb6f5cb8</span><br><span class="line"></span><br><span class="line">Removing intermediate container dd4cfb6f5cb8</span><br><span class="line"> ---&gt; d8dea36554b4</span><br><span class="line">Successfully built d8dea36554b4</span><br><span class="line">Successfully tagged dotnetcoreapp:latest</span><br><span class="line">Recreating dotnetcoreapp2_dotnetcoreapp_1 ... </span><br><span class="line"></span><br><span class="line">[1A[2K</span><br><span class="line">Recreating dotnetcoreapp2_dotnetcoreapp_1 ... [32mdone[0m</span><br><span class="line">[1B---------------Clear-Images...------------------</span><br><span class="line"></span><br><span class="line">Deleted: sha256:238c39ae8c13a1d6816361946429024cb46e6911329dad2d714033d2578da618</span><br><span class="line">Deleted: sha256:12dfe61eae3ee68775237340f3e50e19554a653357baec0de52a50d0cff96652</span><br><span class="line">Deleted: sha256:3f6beb8ffd03ee5d3b9fd0e9e5b46074d270cdb707fa07056087194a53be1dd4</span><br><span class="line">---------------Clear-Containers...------------------</span><br><span class="line"></span><br><span class="line">dotnetcoreapp1_ci-build_1</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure>

<p>最后通过浏览器访问<code>http://localhost:8081</code></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/stulzq/p/8627824.html">http://www.cnblogs.com/stulzq/p/8627824.html</a><br><a target="_blank" rel="noopener" href="https://github.com/muyinchen/woker/blob/master/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAJenkins%2BGithub%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83.md">https://github.com/muyinchen/woker/blob/master/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAJenkins%2BGithub%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83.md</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/LongJiangXie/p/7517909.html">http://www.cnblogs.com/LongJiangXie/p/7517909.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/JacZhu/p/6814848.html">http://www.cnblogs.com/JacZhu/p/6814848.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/03/%E5%8D%B8%E8%BD%BDDotNetCore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/03/%E5%8D%B8%E8%BD%BDDotNetCore/" class="post-title-link" itemprop="url">卸载DotNetCore</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-03 16:59:47" itemprop="dateCreated datePublished" datetime="2018-05-03T16:59:47+00:00">2018-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DotNetCore/" itemprop="url" rel="index"><span itemprop="name">DotNetCore</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="卸载DotNetCore"><a href="#卸载DotNetCore" class="headerlink" title="卸载DotNetCore"></a>卸载DotNetCore</h1><p>查找dotnet命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">which dotnet</span><br></pre></td></tr></table></figure>

<p>查找dotnet相关的rpm包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep dotnet</span><br></pre></td></tr></table></figure>

<p>移除相关包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e dotnet-runtime-deps-2.1.0-preview2-26406-04-2.1.0_preview2_26406_04-1.x86_64</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/03/Docker%E5%AE%B9%E5%99%A8%E8%BF%9B%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/03/Docker%E5%AE%B9%E5%99%A8%E8%BF%9B%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">Docker容器进入的方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-03 16:37:21" itemprop="dateCreated datePublished" datetime="2018-05-03T16:37:21+00:00">2018-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker容器进入的方式"><a href="#Docker容器进入的方式" class="headerlink" title="Docker容器进入的方式"></a>Docker容器进入的方式</h1><h2 id="1-使用docker-exec进入Docker容器"><a href="#1-使用docker-exec进入Docker容器" class="headerlink" title="1.使用docker exec进入Docker容器"></a>1.使用docker exec进入Docker容器</h2><p>docker在1.3.X版本之后还提供了一个新的命令exec用于进入容器，这种方式相对更简单一些，下面我们来看一下该命令的使用：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec --help</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost toor]# sudo docker exec --help</span><br><span class="line"></span><br><span class="line">Usage: docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</span><br><span class="line"></span><br><span class="line">Run a command in a running container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -d, --detach               Detached mode: run command in the background</span><br><span class="line">      --detach-keys string   Override the key sequence for detaching a</span><br><span class="line">                             container</span><br><span class="line">  -e, --env list             Set environment variables</span><br><span class="line">  -i, --interactive          Keep STDIN open even if not attached</span><br><span class="line">      --privileged           Give extended privileges to the command</span><br><span class="line">  -t, --tty                  Allocate a pseudo-TTY</span><br><span class="line">  -u, --user string          Username or UID (format:</span><br><span class="line">                             &lt;name|uid&gt;[:&lt;group|gid&gt;])</span><br><span class="line">  -w, --workdir string       Working directory inside the container</span><br><span class="line">[root@localhost toor]#</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost toor]<span class="comment"># docker exec -it a46fa8852e07 /bin/bash</span></span><br><span class="line">root@a46fa8852e07:/<span class="comment"># exit</span></span><br><span class="line">exit</span><br><span class="line">[root@localhost toor]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xhyan/p/6593075.html">https://www.cnblogs.com/xhyan/p/6593075.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/04/28/CentOS7%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/28/CentOS7%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E5%92%8C%E7%94%A8%E6%88%B7%E7%BB%84/" class="post-title-link" itemprop="url">CentOS7添加/删除用户和用户组</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-28 11:43:40" itemprop="dateCreated datePublished" datetime="2018-04-28T11:43:40+00:00">2018-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CentOS7/" itemprop="url" rel="index"><span itemprop="name">CentOS7</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CentOS7添加-删除用户和用户组"><a href="#CentOS7添加-删除用户和用户组" class="headerlink" title="CentOS7添加/删除用户和用户组"></a>CentOS7添加/删除用户和用户组</h1><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><p>注：root下操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adduser testuser #新建testuser 用户</span><br><span class="line">passwd testuser  #设置密码</span><br></pre></td></tr></table></figure>

<h2 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h2><p>新创建的用户并不能使用sudo命令，需要给他添加授权。</p>
<p>sudo命令的授权管理是在sudoers文件里的。可以看看sudoers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]# sudoers</span><br><span class="line">bash: sudoers: 未找到命令...</span><br><span class="line">[root@localhost Desktop]# whereis sudoers</span><br><span class="line">sudoers: &#x2F;etc&#x2F;sudoers &#x2F;etc&#x2F;sudoers.d &#x2F;usr&#x2F;libexec&#x2F;sudoers.so &#x2F;usr&#x2F;share&#x2F;man&#x2F;man5&#x2F;sudoers.5.gz</span><br></pre></td></tr></table></figure>

<p>找到这个文件位置之后再查看权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]# ls -l &#x2F;etc&#x2F;sudoers</span><br><span class="line">-r--r-----. 1 root root 4000 3月   6 2015 &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure>

<p>只有只读的权限，如果想要修改的话，需要先添加w权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]# chmod -v u+w &#x2F;etc&#x2F;sudoers</span><br><span class="line">mode of &quot;&#x2F;etc&#x2F;sudoers&quot; changed from 0440 (r--r-----) to 0640 (rw-r-----)</span><br></pre></td></tr></table></figure>

<p>然后就可以添加内容了，在下面的一行下追加新增的用户：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## Allow root to run any commands anywhere</span><br><span class="line">root    ALL&#x3D;(ALL)       ALL</span><br><span class="line">toor    ALL&#x3D;(ALL)       ALL #新增的用户</span><br></pre></td></tr></table></figure>

<p>wq保存退出，这时候要记得将写权限收回：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]# chmod -v u-w &#x2F;etc&#x2F;sudoers</span><br><span class="line">mode of &quot;&#x2F;etc&#x2F;sudoers&quot; changed from 0640 (rw-r-----) to 0440 (r--r-----)</span><br></pre></td></tr></table></figure>

<p>这时候使用新用户登录，使用sudo</p>
<h2 id="新建工作组"><a href="#新建工作组" class="headerlink" title="新建工作组"></a>新建工作组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd testgroup</span><br></pre></td></tr></table></figure>

<h2 id="新建用户同时增加工作组"><a href="#新建用户同时增加工作组" class="headerlink" title="新建用户同时增加工作组"></a>新建用户同时增加工作组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -g testgroup testuser</span><br></pre></td></tr></table></figure>

<p>注：：-g 所属组</p>
<h2 id="给已有的用户增加工作组"><a href="#给已有的用户增加工作组" class="headerlink" title="给已有的用户增加工作组"></a>给已有的用户增加工作组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -G groupname username</span><br></pre></td></tr></table></figure>

<h2 id="永久删除用户帐号"><a href="#永久删除用户帐号" class="headerlink" title="永久删除用户帐号"></a>永久删除用户帐号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userdel testuser</span><br><span class="line">groupdel testgroup</span><br><span class="line">usermod -G testgroup testuser #强制删除该用户的主目录和主目录下的所有文件和子目录</span><br></pre></td></tr></table></figure>

<p>用户列表文件：<code>/etc/passwd</code><br>用户组列表文件：<code>/etc/group</code></p>
<p>查看系统中有哪些用户：<code>cut -d : -f 1 /etc/passwd</code><br>查看可以登录系统的用户：<code>cat /etc/passwd | grep -v /sbin/nologin | cut -d : -f 1</code><br>查看用户操作：w命令(需要root权限)<br>查看某一用户：w 用户名<br>查看登录用户：<code>who</code><br>查看用户登录历史记录：<code>last</code></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.linuxidc.com/Linux/2016-11/137549.htm">https://www.linuxidc.com/Linux/2016-11/137549.htm</a></p>
<p><a target="_blank" rel="noopener" href="http://www.jb51.net/article/123444.htm">http://www.jb51.net/article/123444.htm</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.51cto.com/risingair/1861641">http://blog.51cto.com/risingair/1861641</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/04/27/Docker-Dockerfile%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/27/Docker-Dockerfile%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Docker Dockerfile详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-27 15:01:22" itemprop="dateCreated datePublished" datetime="2018-04-27T15:01:22+00:00">2018-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker-Dockerfile详解"><a href="#Docker-Dockerfile详解" class="headerlink" title="Docker Dockerfile详解"></a>Docker Dockerfile详解</h1><p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#dockerfile-examples">官网</a></p>
<h2 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h2><p>Docker项目提供了构建在Linux内核功能之上，协同在一起的的高级工具。其目标是帮助开发和运维人员更容易地跨系统跨主机交付应用程序和他们的依赖。Docker通过Docker容器，一个安全的，基于轻量级容器的环境，来实现这个目标。这些容器由镜像创建，而镜像可以通过命令行手工创建或 者通过Dockerfile自动创建。</p>
<h2 id="Dockerfile简介"><a href="#Dockerfile简介" class="headerlink" title="Dockerfile简介"></a>Dockerfile简介</h2><p>Dockerfile是由一系列命令和参数构成的脚本，这些命令应用于基础镜像并最终创建一个新的镜像。它们简化了从头到尾的流程并极大的简化了部署工作。Dockerfile从FROM命令开始，紧接着跟随者各种方法，命令和参数。其产出为一个新的可以用于创建容器的镜像。</p>
<h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><p>一般而言，Dockerfile 的内容分为四个部分：基础镜像信息、维护者信息、镜像操作指令和容器启动时执行指令。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This dockerfile uses the Ubuntu image</span></span><br><span class="line"><span class="comment"># VERSION 2</span></span><br><span class="line"><span class="comment"># Author: docker_user</span></span><br><span class="line"><span class="comment"># Command format: Instruction [arguments / command] …</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一行必须指定基于的容器镜像</span></span><br><span class="line"><span class="attribute">FROM</span> ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 维护者信息</span></span><br><span class="line">MAINTAINER docker_user docker_user<span class="variable">@email</span>.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 镜像的操作指令</span></span><br><span class="line">RUN echo “deb http://archive.ubuntu.com/ubuntu/ raring main universe” &gt;&gt; /etc/apt/sources.list</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y nginx</span><br><span class="line">RUN echo “\ndaemon off;” &gt;&gt; /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器启动时执行指令</span></span><br><span class="line"><span class="attribute">CMD</span> /usr/sbin/nginx</span><br></pre></td></tr></table></figure>

<h2 id="Dockerfile-命令"><a href="#Dockerfile-命令" class="headerlink" title="Dockerfile 命令"></a>Dockerfile 命令</h2><h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h3><p>FROM命令可能是最重要的Dockerfile命令。该命令定义了使用哪个基础镜像启动构建流程。基础镜像可以为任意镜像。如果基础镜像没有被发现，Docker将试图从Docker image index来查找该镜像。FROM命令必须是Dockerfile的首个命令。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: FROM [image name]</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu</span><br></pre></td></tr></table></figure>

<h3 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h3><p>声明作者;这个命令放在Dockerfile的起始部分，虽然理论上它可以放置于Dockerfile的任意位置。这个命令用于声明作者，并应该放在FROM的后面。</p>
<p>注意：MAINTAINER 指令已经被抛弃，建议使用 LABEL 指令。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: MAINTAINER [name]</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> authors_name</span><br></pre></td></tr></table></figure>

<h3 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h3><p>格式为:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br></pre></td></tr></table></figure>

<p>LABEL 指令为镜像添加标签。一个 LABEL 就是一个键值对。</p>
<p>下面是一些例子:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">&quot;com.example.vendor&quot;</span>=<span class="string">&quot;ACME Incorporated&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> com.example.label-with-value=<span class="string">&quot;foo&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> description=<span class="string">&quot;This text illustrates \that label-values can span multiple lines.&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>我们可以给镜像添加多个 LABEL，需要注意的是，每条 LABEL 指令都会生成一个新的层。所以最好是把添加的多个 LABEL 合并为一条命令：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">&quot;value1&quot;</span> multi.label2=<span class="string">&quot;value2&quot;</span> other=<span class="string">&quot;value3&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>也可以写成这样：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">&quot;value1&quot;</span> \</span></span><br><span class="line"><span class="bash">      multi.label2=<span class="string">&quot;value2&quot;</span> \</span></span><br><span class="line"><span class="bash">      other=<span class="string">&quot;value3&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>如果新添加的 LABEL 和已有的 LABEL 同名，则新值会覆盖掉旧值。<br>我们可以使用 docker inspect 命令查看镜像的 LABEL 信息。</p>
<h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">有两种格式，分别为：</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> &lt;<span class="built_in">command</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> [“executable”, “param1”, “param2”]。</span></span><br></pre></td></tr></table></figure>

<p>RUN命令是Dockerfile执行命令的核心部分。它接受命令作为参数并用于创建镜像。不像CMD命令，RUN命令用于创建镜像（在之前commit的层之上形成新的层）。<br>前者将在 shell 终端中运行命令，即 /bin/sh -c，后者则使用 exec 执行。指定使用其他终端可以通过第二种方式实现，例如 RUN  [“/bin/bash”, “-c”, “echo hello”]。<br>每条 RUN 指令将在当前镜像的基础上执行指定命令，并提交为新的镜像。当命令较长时可以使用 \ 来换行。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: RUN [command]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> aptitude install -y riak</span></span><br></pre></td></tr></table></figure>

<h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><p>支持三种格式：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="bash"> [“executable”, “param1”, “param2”] 使用 <span class="built_in">exec</span> 执行，推荐方式。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">command</span> param1 param2 在 /bin/sh 中执行，提供给需要交互的应用。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [“param1”, “param2”] 提供给 ENTRYPOINT 的默认参数。</span></span><br></pre></td></tr></table></figure>

<p>指定启动容器时执行的命令，每个 Dockerfile 只能有一条 CMD 命令。如果指定了多条 CMD 命令，只有最后一条会被执行。如果用户在启动容器时指定了要运行的命令，则会覆盖掉 CMD 指定的命令。</p>
<p>和RUN命令相似，CMD可以用于执行特定的命令。和RUN不同的是，这些命令不是在镜像构建的过程中执行的，而是在用镜像构建容器后被调用。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage 1: CMD application &quot;argument&quot;, &quot;argument&quot;, ..</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="string">&quot;echo&quot;</span> <span class="string">&quot;Hello docker!&quot;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><p>格式为：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;…]</span><br></pre></td></tr></table></figure>

<p>告诉 Docker 服务，容器需要暴露的端口号，供互联系统使用。在启动容器时需要通过 -P 参数让 Docker 主机分配一个端口转发到指定的端口。使用 -p 参数则可以具体指定主机上哪个端口映射过来。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: EXPOSE [port]</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><p>ENV命令用于设置环境变量。这些变量以”key=value”的形式存在，并可以在容器内被脚本或者程序调用。这个机制给在容器中运行应用带来了极大的便利。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: ENV key value</span></span><br><span class="line"><span class="keyword">ENV</span> SERVER_WORKS <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h3 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h3><p>格式为：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> &lt;src&gt; &lt;dest&gt;</span></span><br></pre></td></tr></table></figure>

<p>ADD命令有两个参数，源和目标。它的基本作用是从源系统的文件系统上复制文件到目标容器的文件系统。如果源是一个URL，那该URL的内容将被下载并复制到容器中。其中 <code>&lt;src&gt;</code> 可以是 Dockerfile 所在目录的一个相对路径(文件或目录)；也可以是一个 URL；还可以是一个 tar 文件(自动解压为目录)。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: ADD [source directory or URL] [destination directory]</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> /my_app_folder /my_app_folder</span></span><br></pre></td></tr></table></figure>

<h3 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h3><p>格式：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> &lt;src&gt; &lt;dest&gt;</span></span><br></pre></td></tr></table></figure>

<p>复制本地主机的 <code>&lt;src&gt;</code> (为 Dockerfile 所在目录的相对路径，文件或目录) 为容器中的 <code>&lt;dest&gt;</code>。目标路径不存在时，会自动创建。当使用本地目录为源目录时，推荐使用 COPY。</p>
<h3 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h3><p>有两种格式：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [“executable”, “param1”, “param2”]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">command</span> param1 param2 (shell 中执行)</span></span><br></pre></td></tr></table></figure>

<p>配置容器启动后执行的命令，并且不可被 docker run 提供的参数覆盖。</p>
<p>每个 Dockerfile 中只能有一个 ENTRYPOINT，当指定多个时，只有最后一个起效。</p>
<p>ENTRYPOINT 帮助你配置一个容器使之可执行化，如果你结合CMD命令和ENTRYPOINT命令，你可以从CMD命令中移除“application”而仅仅保留参数，参数将传递给ENTRYPOINT命令。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: ENTRYPOINT application &quot;argument&quot;, &quot;argument&quot;, ..</span></span><br><span class="line"><span class="comment"># Remember: arguments are optional. They can be provided by CMD</span></span><br><span class="line"><span class="comment"># or during the creation of a container.</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">echo</span></span></span><br><span class="line"><span class="comment"># Usage example with CMD:</span></span><br><span class="line"><span class="comment"># Arguments set with CMD can be overridden during *run*</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="string">&quot;Hello docker!&quot;</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">echo</span></span></span><br></pre></td></tr></table></figure>

<h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h3><p>格式为：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/data&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>也可以使用 VOLUME 指令添加多个数据卷：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/data1&quot;</span>, <span class="string">&quot;/data2&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>创建一个可以从本地或其他容器挂载的挂载点，一般用来存放数据库和需要保持的数据等。<br>VOLUME命令用于让你的容器访问宿主机上的目录。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: VOLUME [&quot;/dir_1&quot;, &quot;/dir_2&quot; ..]</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/my_files&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h3 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h3><p>指定运行容器时的用户名或 UID，后续的 RUN 也会使用指定用户。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户，例如：RUN groupadd -r postgres &amp;&amp; useradd -r -g postgres postgres。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: USER [UID]</span></span><br><span class="line"><span class="keyword">USER</span> <span class="number">751</span></span><br></pre></td></tr></table></figure>

<h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h3><p>格式为：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure>

<p>为后续的 RUN、CMD、ENTRYPOINT 指令配置工作目录。可以使用多个 WORKDIR 指令，后续命令如果参数是相对路径，则会基于之前命令指定的路径。例如：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Usage: WORKDIR /path</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> ~/</span></span><br></pre></td></tr></table></figure>

<h3 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h3><p>格式为：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> [INSTRUCTION]</span><br></pre></td></tr></table></figure>

<p>配置当所创建的镜像作为其他新创建镜像的基础镜像时，所执行的操作指令。例如，Dockerfile 使用如下的内容创建了镜像 image-A。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">ADD</span><span class="bash"> . /app/src</span></span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">RUN</span><span class="bash"> /usr/<span class="built_in">local</span>/bin/python-build –dir /app/src</span></span><br></pre></td></tr></table></figure>

<p>如果基于 image-A 创建新的镜像时，新的 Dockerfile 中使用 FROM image-A 指定基础镜像时，会自动执行 ONBUILD 指令内容，等价于在后面添加了两条指令。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> image-A</span><br><span class="line"><span class="comment">#automatically run the following</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> . /app/src</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> /usr/<span class="built_in">local</span>/bin/python-build –dir /app/src</span></span><br></pre></td></tr></table></figure>

<h3 id="如何使用Dockerfiles"><a href="#如何使用Dockerfiles" class="headerlink" title="如何使用Dockerfiles"></a>如何使用Dockerfiles</h3><p>编写完成 Dockerfile 之后，可以通过 docker build 命令来创建镜像。</p>
<p>使用Dockerfiles和手工使用Docker Daemon运行命令一样简单。脚本运行后输出为新的镜像ID。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build an image using the Dockerfile at current location</span></span><br><span class="line"><span class="comment"># Example: sudo docker build -t [name] .</span></span><br><span class="line">sudo docker build -t my_mongodb .</span><br></pre></td></tr></table></figure>

<p>基本的格式为 docker build [选项] 路径，该命令将读取指定路径下(包括子目录)的 Dockerfile ，并将该路径下所有内容发送给 docker 服务端，由服务端来创建镜像。因此一般建议放置 Dockerfile 的目录为空目录。</p>
<p>另外，可以通过 .dockerignore 文件来让 docker 忽略路径下的目录和文件。 要指定镜像的标签信息，可以通过 -t 选项来实现。<br>例如，指定 Dockerfile 所在路径为 /tmp/docker_builder/，并且希望生成镜像标签为 build_repo/first_image，可以使用下面的命令：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker build -t build_repo/first_image /tmp/docker_builder/</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/sparkdev/p/6357614.html">http://www.cnblogs.com/sparkdev/p/6357614.html</a></p>
<p><a target="_blank" rel="noopener" href="https://yeasy.gitbooks.io/docker_practice/content/introduction/what.html">https://yeasy.gitbooks.io/docker_practice/content/introduction/what.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/boshen-hzb/p/6400272.html" title="参考">https://www.cnblogs.com/boshen-hzb/p/6400272.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/04/27/Docker%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/27/Docker%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">Docker安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-27 14:40:52" itemprop="dateCreated datePublished" datetime="2018-04-27T14:40:52+00:00">2018-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h1><p><a target="_blank" rel="noopener" href="https://docs.docker.com/install/linux/docker-ce/centos/#uninstall-old-versions" title="官网">官网</a></p>
<h2 id="安装Docker-CE"><a href="#安装Docker-CE" class="headerlink" title="安装Docker CE"></a>安装Docker CE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br><span class="line"></span><br><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line"></span><br><span class="line">$ sudo yum install docker-ce</span><br></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<p>验证是否成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<h2 id="配置镜像加速"><a href="#配置镜像加速" class="headerlink" title="配置镜像加速"></a>配置镜像加速</h2><h3 id="安装／升级你的Docker客户端"><a href="#安装／升级你的Docker客户端" class="headerlink" title="安装／升级你的Docker客户端"></a>安装／升级你的Docker客户端</h3><p>推荐安装1.10.0以上版本的Docker客户端</p>
<h3 id="如何配置镜像加速器"><a href="#如何配置镜像加速器" class="headerlink" title="如何配置镜像加速器"></a>如何配置镜像加速器</h3><p>针对Docker客户端版本大于1.10.0的用户</p>
<p>您可以通过修改daemon配置文件<code>/etc/docker/daemon.json</code>来使用加速器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p &#x2F;etc&#x2F;docker</span><br><span class="line">sudo tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-&#39;EOF&#39;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;lhao27k5.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>或者使用<code>ttps://registry.docker-cn.com</code></p>
<h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><h3 id="1-卸载Docker包"><a href="#1-卸载Docker包" class="headerlink" title="1.卸载Docker包"></a>1.卸载Docker包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker-ce</span><br></pre></td></tr></table></figure>

<h3 id="2-主机上的mages-containers-volumes或自定义配置文件不会自动删除。-删除所有mages-containers-volumes："><a href="#2-主机上的mages-containers-volumes或自定义配置文件不会自动删除。-删除所有mages-containers-volumes：" class="headerlink" title="2.主机上的mages, containers, volumes或自定义配置文件不会自动删除。 删除所有mages, containers, volumes："></a>2.主机上的mages, containers, volumes或自定义配置文件不会自动删除。 删除所有mages, containers, volumes：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf &#x2F;var&#x2F;lib&#x2F;docker</span><br></pre></td></tr></table></figure>

<p>您必须手动删除任何定义配置文件。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/04/25/Nginx%E4%B8%8A%E4%BD%BF%E7%94%A8Let%E2%80%99s%20Encrypt%E5%8A%A0%E5%AF%86(HTTPS)&%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/25/Nginx%E4%B8%8A%E4%BD%BF%E7%94%A8Let%E2%80%99s%20Encrypt%E5%8A%A0%E5%AF%86(HTTPS)&%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F/" class="post-title-link" itemprop="url">Nginx上使用Let’s Encrypt加密(HTTPS)&自动续期</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-25 15:36:54" itemprop="dateCreated datePublished" datetime="2018-04-25T15:36:54+00:00">2018-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Let%E2%80%99s-Encrypt/" itemprop="url" rel="index"><span itemprop="name">Let’s Encrypt</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Nginx上使用Let’s-Encrypt加密-HTTPS-amp-自动续期"><a href="#Nginx上使用Let’s-Encrypt加密-HTTPS-amp-自动续期" class="headerlink" title="Nginx上使用Let’s Encrypt加密(HTTPS)&amp;自动续期"></a>Nginx上使用Let’s Encrypt加密(HTTPS)&amp;自动续期</h1><p><a target="_blank" rel="noopener" href="https://letsencrypt.org/" title="官网">官网</a></p>
<h2 id="获取证书生成工具-certbot"><a href="#获取证书生成工具-certbot" class="headerlink" title="获取证书生成工具 certbot"></a>获取证书生成工具 certbot</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;dl.eff.org&#x2F;certbot-auto</span><br><span class="line">chmod a+x certbot-auto</span><br></pre></td></tr></table></figure>

<h2 id="获取证书"><a href="#获取证书" class="headerlink" title="获取证书"></a>获取证书</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;certbot-auto certonly -d *.域名 --manual --preferred-challenges dns --server https:&#x2F;&#x2F;acme-v02.api.letsencrypt.org&#x2F;directory</span><br></pre></td></tr></table></figure>

<p>按照提示依次填写邮箱地址，同意服务条款，绑定IP就行了。</p>
<p>面这一步很关键，需要你配置你的域名TXT记录，以校验域名所有权，也就是判断证书申请者是不是该域名的拥有者。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Please deploy a DNS TXT record under the name</span><br><span class="line">_acme-challenge.shiyx.top with the following value:</span><br><span class="line"></span><br><span class="line">l1VX8xfEnhrJ02QB4o-M6ntb9JEsItRISb1YjOEw3KY</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Press Enter to Continue</span><br></pre></td></tr></table></figure>

<p>在添加txt记录到你的域名之前，切勿点击回车键。</p>
<p>登陆域名解析控制台（阿里云），添加一条TXT记录：</p>
<p><img src="/img/aliyun%E8%A7%A3%E6%9E%90.png" alt="添加解析记录"></p>
<p>执行命令：<code>dig -t txt _acme-challenge.shiyx.top</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-172-31-16-20:~$ dig -t txt _acme-challenge.shiyx.top</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; -t txt _acme-challenge.shiyx.top</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 54437</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;_acme-challenge.shiyx.top.     IN      TXT</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">_acme-challenge.shiyx.top. 60   IN      TXT     &quot;l1VX8xfSnwrJ02QB4o-M6ntb9JEsItRISb1YjOEw3YY&quot;</span><br><span class="line"></span><br><span class="line">;; Query time: 2001 msec</span><br><span class="line">;; SERVER: 172.31.0.2#53(172.31.0.2)</span><br><span class="line">;; WHEN: Thu Apr 26 00:50:34 UTC 2018</span><br><span class="line">;; MSG SIZE  rcvd: 110</span><br></pre></td></tr></table></figure>

<p>确认生效后，按回车键继续</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - Congratulations! Your certificate and chain have been saved at:</span><br><span class="line">   &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;shiyx.top&#x2F;fullchain.pem</span><br><span class="line">   Your key file has been saved at:</span><br><span class="line">   &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;shiyx.top&#x2F;privkey.pem</span><br><span class="line">   Your cert will expire on 2018-07-24. To obtain a new or tweaked</span><br><span class="line">   version of this certificate in the future, simply run certbot-auto</span><br><span class="line">   again. To non-interactively renew *all* of your certificates, run</span><br><span class="line">   &quot;certbot-auto renew&quot;</span><br><span class="line"> - If you like Certbot, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">   Donating to ISRG &#x2F; Let&#39;s Encrypt:   https:&#x2F;&#x2F;letsencrypt.org&#x2F;donate</span><br><span class="line">   Donating to EFF:                    https:&#x2F;&#x2F;eff.org&#x2F;donate-le</span><br></pre></td></tr></table></figure>

<p>证书申请完毕！证书和密钥保存在“/etc/letsencrypt/archive/”目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-172-31-16-20:~$ sudo tree &#x2F;etc&#x2F;letsencrypt&#x2F;archive</span><br><span class="line">&#x2F;etc&#x2F;letsencrypt&#x2F;archive</span><br><span class="line">└── shiyx.top</span><br><span class="line">    ├── cert1.pem</span><br><span class="line">    ├── chain1.pem</span><br><span class="line">    ├── fullchain1.pem</span><br><span class="line">    └── privkey1.pem</span><br><span class="line"></span><br><span class="line">1 directory, 4 files</span><br></pre></td></tr></table></figure>

<h2 id="续期HTTPS证书"><a href="#续期HTTPS证书" class="headerlink" title="续期HTTPS证书"></a>续期HTTPS证书</h2><p>官网：</p>
<p><a target="_blank" rel="noopener" href="https://certbot.eff.org/docs/using.html?highlight=renew#renewing-certificates," title="参考官网">https://certbot.eff.org/docs/using.html?highlight=renew#renewing-certificates</a></p>
<h3 id="续期HTTPS证书命令"><a href="#续期HTTPS证书命令" class="headerlink" title="续期HTTPS证书命令"></a>续期HTTPS证书命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure>

<h3 id="自动续签HTTPS证书"><a href="#自动续签HTTPS证书" class="headerlink" title="自动续签HTTPS证书"></a>自动续签HTTPS证书</h3><p>Let’s Encrypt 证书的有效期只有 90 天，因此我们需要定期的对他进行续签，我们使用linux自带的cron来设定计划任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>

<p>注意，如果你是第一次运行 crontab 命令，它会问题使用哪一个编辑器，你可以根据自己的需要进行选择，我选择的是 vim-basic</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e</span><br></pre></td></tr></table></figure>

<p>添加配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 2 * * 1 sudo certbot renew</span><br></pre></td></tr></table></figure>

<p>上面的执行时间为：每周一半夜2点30分执行renew任务。</p>
<p>你可以在命令行执行<code>sudo renew</code>看看是否执行正常。</p>
<h2 id="Nginx配置"><a href="#Nginx配置" class="headerlink" title="Nginx配置"></a>Nginx配置</h2><p>官网：<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/," title="参考官网">http://nginx.org/en/docs/</a></p>
<p>注：aws需要定义安全组，允许https入站规则</p>
<h3 id="Webroot配置模式"><a href="#Webroot配置模式" class="headerlink" title="Webroot配置模式"></a>Webroot配置模式</h3><p>Webroot 的工作插件放置在一个特殊的文件/.well-known目录文档根目录下，它可以打开（通过Web服务器）内由让我们的加密服务进行验证。 根据配置的不同，你可能需要明确允许访问/.well-known目录。</p>
<p>为了确保该目录可供Let’s Encrypt进行验证，让我们快速更改我们的Nginx配置。编辑<code>sudo vim  /etc/nginx/sites-available/default</code>文件，并将下面代码添加进去:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ /.well-known</span> &#123;</span><br><span class="line">    <span class="attribute">allow</span> all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 检查测试配置文件是否正确</span></span><br><span class="line"><span class="attribute">sudo</span> nginx -t -c /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重新加载nginx</span></span><br><span class="line">sudo service nginx reload</span><br></pre></td></tr></table></figure>

<p>Nginx配置：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.shiyx.top;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://www.shiyx.top<span class="variable">$request_uri</span>;</span><br><span class="line">        <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">        <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.shiyx.top;</span><br><span class="line">        <span class="comment">#$host该变量的值等于请求头中Host的值。如果Host无效时，那么就是处理该请求的server的名称。</span></span><br><span class="line">        <span class="comment">#permanent: 永久性重定向。请求日志中的状态码为301</span></span><br><span class="line">        <span class="comment">#nginx 对文档检测比较严格，所以if ( $host != &#x27;www.shiyx.top&#x27; ) 这些代码之间需要有空格隔开，不然会</span></span><br><span class="line">        <span class="comment">#报错：unknown directive “if($host!=”</span></span><br><span class="line">        <span class="attribute">if</span> (<span class="variable">$host</span> != <span class="string">&#x27;www.shiyx.top&#x27;</span> )&#123;</span><br><span class="line">                <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> https://www.shiyx.top/<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/shiyx.top/fullchain.pem;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/shiyx.top/privkey.pem;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击</span></span><br><span class="line">        <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="comment"># 设置ssl/tls会话缓存的类型和大小。如果设置了这个参数一般是shared，buildin可能会参数内存碎片，默认是none，</span></span><br><span class="line">        <span class="comment">#和off差不多，停用缓存。如shared:SSL:10m表示我&gt;所有的nginx工作进程共享ssl会话缓存，</span></span><br><span class="line">        <span class="comment">#网介绍说1M可以存放约4000个sessions。</span></span><br><span class="line">        <span class="attribute">ssl_session_cache</span>    shared:SSL:<span class="number">1m</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。</span></span><br><span class="line">        <span class="attribute">ssl_session_timeout</span>  <span class="number">5m</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">ssl_protocols</span> SSLv3 TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。</span></span><br><span class="line">        <span class="comment"># 这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher &#x27;RC4:HIGH:!aNULL:!MD5&#x27;</span></span><br><span class="line">        <span class="comment">#（后面是你所指定的套件加密算法） 来看所支持算法。</span></span><br><span class="line">        <span class="attribute">ssl_ciphers</span>  HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。</span></span><br><span class="line">        <span class="attribute">ssl_prefer_server_ciphers</span>  <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">                <span class="attribute">root</span>   html;</span><br><span class="line">                <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ /.well-known</span>&#123;</span><br><span class="line">                <span class="attribute">allow</span> all;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>另附https检查网站</p>
<p><a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/analyze.html," title="参考1">hhttps://www.ssllabs.com/ssltest/analyze.html</a></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.lao-wang.com/?p=142," title="参考1">https://www.lao-wang.com/?p=142</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.guorenxi.com/43.html," title="参考1">https://blog.guorenxi.com/43.html</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000005797776," title="参考1">https://segmentfault.com/a/1190000005797776</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/stulzq/p/8628163.html," title="参考2">http://www.cnblogs.com/stulzq/p/8628163.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.appinn.com/use-letsencrypt-with-nginx/," title="参考3">https://www.appinn.com/use-letsencrypt-with-nginx/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lzpong/p/6433189.html," title="参考4">https://www.cnblogs.com/lzpong/p/6433189.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/04/25/AWS-Ubuntu-16-04-4-LTS-%E5%AE%89%E8%A3%85Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/25/AWS-Ubuntu-16-04-4-LTS-%E5%AE%89%E8%A3%85Nginx/" class="post-title-link" itemprop="url">(AWS)Ubuntu 16.04.4 LTS 安装Nginx</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-25 14:53:17" itemprop="dateCreated datePublished" datetime="2018-04-25T14:53:17+00:00">2018-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="AWS-Ubuntu-16-04-4-LTS-安装Nginx"><a href="#AWS-Ubuntu-16-04-4-LTS-安装Nginx" class="headerlink" title="(AWS)Ubuntu 16.04.4 LTS 安装Nginx"></a>(AWS)Ubuntu 16.04.4 LTS 安装Nginx</h1><h2 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h2><p><a target="_blank" rel="noopener" href="http://nginx.org/en/linux_packages.html" title="官网">nginx官网</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Ubuntu安装之后的文件结构大致为：</p>
</blockquote>
<ul>
<li>所有的配置文件都在/etc/nginx下，并且每个虚拟主机已经安排在了/etc/nginx/sites-available下</li>
<li>程序文件在/usr/sbin/nginx</li>
<li>日志放在了/var/log/nginx中</li>
<li>并已经在/etc/init.d/下创建了启动脚本nginx</li>
<li>默认的虚拟主机的目录设置在了/var/www/nginx-default (有的版本 默认的虚拟主机的目录设置在了/var/www, 请参考/etc/nginx/sites-available里的配置)</li>
</ul>
<h2 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;nginx start</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx start</span><br></pre></td></tr></table></figure>

<h2 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginx stop</span><br><span class="line">sudo service nginx restart</span><br></pre></td></tr></table></figure>

<h2 id="检查config配置问题"><a href="#检查config配置问题" class="headerlink" title="检查config配置问题"></a>检查config配置问题</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span> nginx -t -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<p>然后就可以访问了，<code>http://localhost/</code>，默认80端口</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/04/24/aws%E6%90%AD%E5%BB%BAshadowsocks%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/24/aws%E6%90%AD%E5%BB%BAshadowsocks%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">aws搭建shadowsocks服务器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-24 09:12:23" itemprop="dateCreated datePublished" datetime="2018-04-24T09:12:23+00:00">2018-04-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shadowsocks/" itemprop="url" rel="index"><span itemprop="name">shadowsocks</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="aws搭建shadowsocks服务器"><a href="#aws搭建shadowsocks服务器" class="headerlink" title="aws搭建shadowsocks服务器"></a>aws搭建shadowsocks服务器</h1><h2 id="shadowsocks特点："><a href="#shadowsocks特点：" class="headerlink" title="shadowsocks特点："></a>shadowsocks特点：</h2><p>地址：<br><a target="_blank" rel="noopener" href="https://github.com/shadowsocks/shadowsocks" title="链接">https://github.com/shadowsocks/shadowsocks</a></p>
<p>快速（异步I/O和事件驱动程序）</p>
<p>安全（所有的流量都经过加密算法加密，支持自定义算法）</p>
<p>支持移动客户端（专为移动设备和无线网络优化）</p>
<p>跨平台（可运行于包括PC，Mac，手机（Android和iOS）和路由器（OpenWrt）在内的多种平台上）</p>
<h2 id="安装shadowsocks"><a href="#安装shadowsocks" class="headerlink" title="安装shadowsocks"></a>安装shadowsocks</h2><p><a target="_blank" rel="noopener" href="https://github.com/shadowsocks/shadowsocks/wiki/Shadowsocks-%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" title="链接">参考官网命令</a></p>
<p>Debian / Ubuntu:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python-pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure>

<p>CentOS:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install python-setuptools &amp;&amp; easy_install pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure>

<h2 id="配置shadowsocks"><a href="#配置shadowsocks" class="headerlink" title="配置shadowsocks"></a>配置shadowsocks</h2><p>无论是centos系统还是ubuntu系统，shadowsocks配置都是一样的。</p>
<p>shadowsocks安装完毕后，可以查看使用ssserver命令进行查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-172-31-16-20:~$ ssserver -h</span><br><span class="line">usage: ssserver [OPTION]...</span><br><span class="line">A fast tunnel proxy that helps you bypass firewalls.</span><br><span class="line"></span><br><span class="line">You can supply configurations via either config file or command line arguments.</span><br><span class="line"></span><br><span class="line">Proxy options:</span><br><span class="line">  -c CONFIG              path to config file</span><br><span class="line">  -s SERVER_ADDR         server address, default: 0.0.0.0</span><br><span class="line">  -p SERVER_PORT         server port, default: 8388</span><br><span class="line">  -k PASSWORD            password</span><br><span class="line">  -m METHOD              encryption method, default: aes-256-cfb</span><br><span class="line">  -t TIMEOUT             timeout in seconds, default: 300</span><br><span class="line">  --fast-open            use TCP_FASTOPEN, requires Linux 3.7+</span><br><span class="line">  --workers WORKERS      number of workers, available on Unix&#x2F;Linux</span><br><span class="line">  --forbidden-ip IPLIST  comma seperated IP list forbidden to connect</span><br><span class="line">  --manager-address ADDR optional server manager UDP address, see wiki</span><br><span class="line"></span><br><span class="line">General options:</span><br><span class="line">  -h, --help             show this help message and exit</span><br><span class="line">  -d start&#x2F;stop&#x2F;restart  daemon mode</span><br><span class="line">  --pid-file PID_FILE    pid file for daemon mode</span><br><span class="line">  --log-file LOG_FILE    log file for daemon mode</span><br><span class="line">  --user USER            username to run as</span><br><span class="line">  -v, -vv                verbose mode</span><br><span class="line">  -q, -qq                quiet mode, only show warnings&#x2F;errors</span><br><span class="line">  --version              show version information</span><br><span class="line"></span><br><span class="line">Online help: &lt;https:&#x2F;&#x2F;github.com&#x2F;shadowsocks&#x2F;shadowsocks&gt;</span><br></pre></td></tr></table></figure>

<p>which ssserver</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-172-31-16-20:~$ which ssserver</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;ssserver</span><br></pre></td></tr></table></figure>

<h2 id="启动shadowsocks服务"><a href="#启动shadowsocks服务" class="headerlink" title="启动shadowsocks服务"></a>启动shadowsocks服务</h2><h3 id="配置文件启动"><a href="#配置文件启动" class="headerlink" title="配置文件启动"></a>配置文件启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir &#x2F;etc&#x2F;shadowsocks</span><br><span class="line"></span><br><span class="line">sudo vim &#x2F;etc&#x2F;shadowsocks&#x2F;config.json</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">“server”:”0.0.0.0″,</span><br><span class="line"></span><br><span class="line">“server_port”:1194,</span><br><span class="line"></span><br><span class="line">“local_address”:”127.0.0.1″,</span><br><span class="line"></span><br><span class="line">“local_port”:1080,</span><br><span class="line"></span><br><span class="line">“password”:”123qwe$%^″,</span><br><span class="line"></span><br><span class="line">“timeout”:300,</span><br><span class="line"></span><br><span class="line">“method”:”aes-256-cfb”,</span><br><span class="line"></span><br><span class="line">“fast_open”:false,</span><br><span class="line"></span><br><span class="line">“workers”: 1</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ssserver -c &#x2F;etc&#x2F;shadowsocks&#x2F;config.json -d start</span><br><span class="line">netstat -tunlp</span><br><span class="line">netstat -anp  ###显示系统端口使用情况</span><br></pre></td></tr></table></figure>

<p>停止：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ssserver -c &#x2F;etc&#x2F;shadowsocks&#x2F;config.json -d stop</span><br></pre></td></tr></table></figure>

<h3 id="命令启动"><a href="#命令启动" class="headerlink" title="命令启动"></a>命令启动</h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ssserver -p 443 -k password -m rc4-md5</span><br></pre></td></tr></table></figure>

<p> 如果要后台运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ssserver -p 443 -k password -m rc4-md5 --user nobody -d start</span><br></pre></td></tr></table></figure>

<p>如果要停止：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ssserver -d stop</span><br></pre></td></tr></table></figure>

<p>如果要检查日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo less &#x2F;var&#x2F;log&#x2F;shadowsocks.log</span><br></pre></td></tr></table></figure>

<h3 id="Docker启动"><a href="#Docker启动" class="headerlink" title="Docker启动"></a>Docker启动</h3><h4 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h4><p>参考官网链接：<br><a target="_blank" rel="noopener" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" title="链接">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a> </p>
<h4 id="下载shadowsocks镜像"><a href="#下载shadowsocks镜像" class="headerlink" title="下载shadowsocks镜像"></a>下载shadowsocks镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull oddrationale&#x2F;docker-shadowsocks</span><br></pre></td></tr></table></figure>

<h4 id="运行设置shadowsocks"><a href="#运行设置shadowsocks" class="headerlink" title="运行设置shadowsocks"></a>运行设置shadowsocks</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -d -p 8388:8388 oddrationale&#x2F;docker-shadowsocks -s 0.0.0.0 -p 8388 -k &#39;paaassswwword&#39; -m aes-256-cfb</span><br></pre></td></tr></table></figure>

<p>运行： <code>docker ps</code></p>
<p>查看shadowsocks是否运行起来了，没问题的话就可以exit退出vps的登录了</p>
<p>停止容器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop --time&#x3D;20 container_name</span><br></pre></td></tr></table></figure>

<p><code>8388</code> 服务器端的端口号，<code>paaassswwword</code> 是密码， <code>aes-256-cfb</code> 是加密方式</p>
<h3 id="配置aws-ec2安全组规则"><a href="#配置aws-ec2安全组规则" class="headerlink" title="配置aws ec2安全组规则"></a>配置aws ec2安全组规则</h3><p>在aws ec2控制平台添加安全组规则-入站规则</p>
<p>自定义TCP规则，端口，任何位置</p>
<p><img src="/img/aws%E5%85%A5%E7%AB%99%E8%A7%84%E5%88%99.png" alt="aws配置"></p>
<h2 id="连接shadowsocks服务"><a href="#连接shadowsocks服务" class="headerlink" title="连接shadowsocks服务"></a>连接shadowsocks服务</h2><p>shadowsocks服务器搭建完毕后，我们现在来客户端连接shadowsocks服务器。</p>
<p>shadowsocks客户端有Windows版本和Linux版本</p>
<h3 id="Windows版本"><a href="#Windows版本" class="headerlink" title="Windows版本"></a>Windows版本</h3><p>windows版本，我们可以从如下网址进行下载，如下：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/shadowsocks/shadowsocks-windows/releases">https://github.com/shadowsocks/shadowsocks-windows/releases</a></p>
<p>下载完毕后，双击Shadowsocks.exe，在弹出框填入<br>Shadowsocks服务器的IP、Shadowsocks服务器端口，密码。</p>
<p><img src="/img/shadowsocks%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE.png" alt="shadowsocks客户端配置"></p>
<p>参考网址：</p>
<p><a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/43252" title="链接">https://yq.aliyun.com/articles/43252</a> </p>
<p><a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/555577" title="链接">https://yq.aliyun.com/articles/555577</a> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2017/12/04/WinDbg%E5%BF%AB%E9%80%9F%E5%88%86%E6%9E%90%E5%BC%82%E5%B8%B8%E6%83%85%E5%86%B5Dump%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/12/04/WinDbg%E5%BF%AB%E9%80%9F%E5%88%86%E6%9E%90%E5%BC%82%E5%B8%B8%E6%83%85%E5%86%B5Dump%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">WinDbg快速分析异常情况Dump文件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-04 14:26:29" itemprop="dateCreated datePublished" datetime="2017-12-04T14:26:29+00:00">2017-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/WinDbg/" itemprop="url" rel="index"><span itemprop="name">WinDbg</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="WinDbg快速分析异常情况Dump文件"><a href="#WinDbg快速分析异常情况Dump文件" class="headerlink" title="WinDbg快速分析异常情况Dump文件"></a>WinDbg快速分析异常情况Dump文件</h1><p>生产环境偶尔会出现一些异常问题，WinDbg 或 GDB 就是解决此类问题的利器。调试工具 WinDbg 如同医生的听诊器，是系统生病时做问题诊断的逆向分析工具，Dump 文件类似于飞机的黑匣子，记录着生产环境程序运行的状态。<br>本文主要介绍了调试工具 WinDbg 和抓包工具 ProcDump 的使用。</p>
<h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><h3 id="1、WinDbg"><a href="#1、WinDbg" class="headerlink" title="1、WinDbg"></a>1、WinDbg</h3><p>WinDbg 是在 Windows 平台下的、强大的用户态和内核态调试工具。相比较于 Visual Studio，它是一个轻量级的调试工具，所谓轻量级指的是它的安装文件大小较小，但是其调试功能，却比 VS 更为强大。<br>它的另外一个用途是可以用来分析 Dump 数据。WinDbg 是 Microsoft 公司免费调试器调试集合中的 GUI 的调试器，支持 Source 和 Assembly 两种模式的调试。<br>WinDbg 不仅可以调试应用程序，还可以进行 Kernel Debug。结合 Microsoft 的 Symbol Server，可以获取系统符号文件，便于应用程序和内核的调试。<br>WinDbg 支持的平台包括 x86、IA64、AMD64。虽然 WinDbg 也提供图形界面操作，但它最强大的地方还是有着强大的调试命令，一般情况会结合 GUI 和命令行进行操作，常用的视图有：局部变量、全局变量、调用栈、线程、命令、寄存器、白板等。其中“命令”视图是默认打开的。</p>
<h3 id="2、DebugDiag"><a href="#2、DebugDiag" class="headerlink" title="2、DebugDiag"></a>2、DebugDiag</h3><p>DebugDiag 最初是为了帮助分析 IIS 的性能问题而开发的，它同样可以用于任何其他的进程。DebugDiag 工具主要用于帮助解决如挂起、 速度慢、 内存泄漏或内存碎片，和任何用户模式进程崩溃等问题。<br>该工具包括附加调试脚本，侧重于互联网信息服务（IIS）应用程序、 Web 数据访问组件、 COM+ 和相关 Microsoft 技术、SharePoint 和 .NET。它提供可扩展对象模型中的 COM 对象的形式，并具有一个内置的报告框架提供的脚本主机。它由 3 部分组成，包括调试服务、 调试器主机和用户界面。</p>
<h3 id="3、ProcDump"><a href="#3、ProcDump" class="headerlink" title="3、ProcDump"></a>3、ProcDump</h3><p>ProcDump 是 System Internal 提供的一个专门用来监测程序 CPU 高使用率从而生成进程 Dump 文件的工具。ProcDump 可以根据系统的 CPU 使用率或者指定的性能计数器来针对特定进程生成一系列的 Dump 文件，以便调试者对事故原因进行分析。</p>
<h2 id="二，工具下载地址"><a href="#二，工具下载地址" class="headerlink" title="二，工具下载地址"></a>二，工具下载地址</h2><p>1、WinDbg 下载</p>
<p>x86 位版本下载：<a target="_blank" rel="noopener" href="http://download.microsoft.com/download/A/6/A/A6AC035D-DA3F-4F0C-ADA4-37C8E5D34E3D/setup/WinSDKDebuggingTools/dbg_x86.msi">http://download.microsoft.com/download/A/6/A/A6AC035D-DA3F-4F0C-ADA4-37C8E5D34E3D/setup/WinSDKDebuggingTools/dbg_x86.msi</a></p>
<p>x64 位版本下载：<a target="_blank" rel="noopener" href="http://download.microsoft.com/download/A/6/A/A6AC035D-DA3F-4F0C-ADA4-37C8E5D34E3D/setup/WinSDKDebuggingTools_amd64/dbg_amd64.msi">http://download.microsoft.com/download/A/6/A/A6AC035D-DA3F-4F0C-ADA4-37C8E5D34E3D/setup/WinSDKDebuggingTools_amd64/dbg_amd64.msi</a></p>
<p>2、DebugDiag v2 Update 2 下载：<a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/download/details.aspx?id=49924">https://www.microsoft.com/en-us/download/details.aspx?id=49924</a></p>
<p>3、ProcDump v9.0 下载：<a target="_blank" rel="noopener" href="https://download.sysinternals.com/files/Procdump.zip">https://download.sysinternals.com/files/Procdump.zip</a></p>
<h2 id="三、获取异常进程的-Dump-文件"><a href="#三、获取异常进程的-Dump-文件" class="headerlink" title="三、获取异常进程的 Dump 文件"></a>三、获取异常进程的 Dump 文件</h2><p>以下四种方式获取 Dump 文件：</p>
<h3 id="1、通过【任务管理器】获取-Dump-文件，这样获取的是-MinDump"><a href="#1、通过【任务管理器】获取-Dump-文件，这样获取的是-MinDump" class="headerlink" title="1、通过【任务管理器】获取 Dump 文件，这样获取的是 MinDump"></a>1、通过【任务管理器】获取 Dump 文件，这样获取的是 MinDump</h3><p><img src="/img/MinDump.png" alt="通过任务管理器"></p>
<h3 id="2、利用-WinDbg-的-adplus-获取-Dump-文件，这样获取的是-FullDump"><a href="#2、利用-WinDbg-的-adplus-获取-Dump-文件，这样获取的是-FullDump" class="headerlink" title="2、利用 WinDbg 的 adplus 获取 Dump 文件，这样获取的是 FullDump"></a>2、利用 WinDbg 的 adplus 获取 Dump 文件，这样获取的是 FullDump</h3><p>C:\Program Files\Debugging Tools for Windows (x64)&gt;adplus -hang -pn explorer.exe<br> -o D:\dumps</p>
<p><img src="/img/windbg-1.png" alt="WinDbg-1"></p>
<h3 id="3、通过-DebugDiag-创建-NET-异常转储-Dump-文件"><a href="#3、通过-DebugDiag-创建-NET-异常转储-Dump-文件" class="headerlink" title="3、通过 DebugDiag 创建.NET 异常转储 Dump 文件"></a>3、通过 DebugDiag 创建.NET 异常转储 Dump 文件</h3><p><img src="/img/debugdiag-2.png" alt="debugdiag-2"></p>
<h3 id="4、通过-ProcDump-抓取异常线程-Dump-文件。"><a href="#4、通过-ProcDump-抓取异常线程-Dump-文件。" class="headerlink" title="4、通过 ProcDump 抓取异常线程 Dump 文件。"></a>4、通过 ProcDump 抓取异常线程 Dump 文件。</h3><h4 id="4-1、命令行"><a href="#4-1、命令行" class="headerlink" title="4.1、命令行"></a>4.1、命令行</h4><p>进入ProcDump目录，运行命令行：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">procdump [-a] [[-c|-cl CPU usage] [-u] [-s seconds]] [-n exceeds] </span><br><span class="line">[-e [<span class="number">1</span> [-b]] [-f &lt;filter,...&gt;] [-g] [-h] [-l] [-m|-ml commit usage] </span><br><span class="line">[-ma | -mp] [-o] [-p|-pl counter threshold] [-r] [-t] </span><br><span class="line">[-d &lt;callback DLL&gt;] [-<span class="number">64</span>] &lt;[-w] &lt;process name or service name or PID&gt;</span><br><span class="line">[dump file] | -i &lt;dump file&gt; | -u | -x &lt;dump file&gt; &lt;image file&gt; </span><br><span class="line">[arguments] &gt;] [-? [ -e]]</span><br></pre></td></tr></table></figure>

<p>实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">procdump -c 70 -s 5 -ma -n 3 w3wp</span><br><span class="line">  - 当系统 CPU 使用率持续 5 秒超过 70% 时，连续抓 3 个 Full Dump。</span><br><span class="line">procdump outlook -p &quot;\Processor(_Total)\% Processor Time&quot; 80</span><br><span class="line">  - 当系统 CPU 使用率超过 80%，抓取 Outlook 进程的 Mini Dump。</span><br><span class="line">procdump -ma outlook -p &quot;\Process(Outlook)\Handle Count&quot; 10000</span><br><span class="line">  - 当 Outlook 进程 Handle 数超过 10000 时抓取 Full Dump</span><br><span class="line">procdump -ma 4572</span><br><span class="line">  - 直接生成进程号位 4572 的 Full Dump。</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>ProcDump 需要进程已经启动，并且中途不能停止。比如需要抓取 IIS Worker Process 的 High CPU Dump，由于 IIS Worker Process 默认会</li>
</ul>
<p>配置 Idle Timeout = 20 min，即该进程在 20 分钟内没有任何请求的话就会自动结束，这种情况下 ProcDump 也会自动结束。需要重新运行命令。</p>
<p>因此如果目标程序存在这样的配置，需要暂时将该配置取消。</p>
<ul>
<li><p>有些系统管理员希望能够运行该工具后退出用户 session，ProcDump 是做不到的，如果有这种需求可以考虑使用 DebugDiag。</p>
</li>
<li><p>在调试 High CPU 问题的时候经常用到的一个命令是!runaway，但是有些时候!runway 在 ProcDump 抓取 Dump 文件的过程中运行不出来，报错信息如下：</p>
</li>
</ul>
<p>0:000&gt; !runaway ERROR: !runaway: extension exception 0x80004002. “Unable to get thread times - dumps may not have time information”</p>
<p>解决方法是将 Debugging Tools for Windows (WinDbg) 安装目录下的 dbghelp.dll 拷贝到 procdump.exe 所在目录下，然后再运行命令抓取 Dump。</p>
<h2 id="四、WinDbg-使用方法"><a href="#四、WinDbg-使用方法" class="headerlink" title="四、WinDbg 使用方法"></a>四、WinDbg 使用方法</h2><p>操作步骤如下：</p>
<h3 id="1、抓取异常程序的-Dump-文件。"><a href="#1、抓取异常程序的-Dump-文件。" class="headerlink" title="1、抓取异常程序的 Dump 文件。"></a>1、抓取异常程序的 Dump 文件。</h3><h3 id="2、设置符号表"><a href="#2、设置符号表" class="headerlink" title="2、设置符号表"></a>2、设置符号表</h3><p>符号表是 WinDbg 关键的“数据库”，如果没有它，WinDbg 基本上就是个废物，无法分析更多问题。所以使用 WinDbg 设置符号表，是必须要走的一步。</p>
<ul>
<li><p>a、运行 WinDbg 软件，然后按【Ctrl+S】弹出符号表设置窗。</p>
</li>
<li><p>b、将符号表地址：SRV<em>C:\Symbols</em></p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://msdl.microsoft.com/download/symbols">http://msdl.microsoft.com/download/symbols</a> 粘贴在输入框中（不能换行），点击确定即可。点击确定之前，请先确认红色字的文件夹是否已被新建。</p>
<p>注：红色字<code>C:\Symbols</code>表示符号表本地存储路径，建议固定路径，可避免符号表重复下载。</p>
<h3 id="3、学会打开第一个-Dump-文件！"><a href="#3、学会打开第一个-Dump-文件！" class="headerlink" title="3、学会打开第一个 Dump 文件！"></a>3、学会打开第一个 Dump 文件！</h3><p>使用【Ctrl+D】快捷键，或者点击 WinDbg 界面上的【File=&gt;Open Crash Dump…】按钮，来打开一个 Dump 文件。</p>
<p>当你想打开第二个 Dump 文件时，可能因为上一个分析记录未清除，导致无法直接分析 Dump 文件，此时你可以使用快捷键【Shift+F5】来关闭上一个对 Dump 文件的分析记录。</p>
<p>SOS does not support the current target architecture<br>这个错误的原因是用了32位的任务管理器抓的32位的dump文件。<br>需要用64位的任务管理器抓32位的dump文件（C:\Windows\SysWOW64\taskmgr.exe）</p>
<h3 id="4、通过简单的几个命令学会分析-Dump-文件"><a href="#4、通过简单的几个命令学会分析-Dump-文件" class="headerlink" title="4、通过简单的几个命令学会分析 Dump 文件"></a>4、通过简单的几个命令学会分析 Dump 文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.loadby sos clr     &#x2F;&#x2F;首先加载sos</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 或</span><br><span class="line"></span><br><span class="line">.load  C:\Windows\Microsoft.NET\Framework64\v4.0.30319\SOS.dll</span><br><span class="line"></span><br><span class="line">.chain  &#x2F;&#x2F; 显示加载的扩展dll</span><br><span class="line"></span><br><span class="line">!runaway &#x2F;&#x2F; 查看线程运行时间</span><br><span class="line"></span><br><span class="line">~22s &#x2F;&#x2F; 进入线程 22</span><br><span class="line"></span><br><span class="line">!clrstack  &#x2F;&#x2F; 查看当前线程堆栈变量值的信息</span><br><span class="line"></span><br><span class="line">!dso  &#x2F;&#x2F; 把当前栈上所有的变量都显示出来</span><br></pre></td></tr></table></figure>

<h4 id="调试dump步骤"><a href="#调试dump步骤" class="headerlink" title="调试dump步骤"></a>调试dump步骤</h4><p>将dump文件拖入windbg<br>执行.loadby sos clr或.loadby sos mscorwks加载模块<br>执行!analyze -v 进行异常分析</p>
<h4 id="调试exe文件步骤"><a href="#调试exe文件步骤" class="headerlink" title="调试exe文件步骤"></a>调试exe文件步骤</h4><p>Open Executeable..<br>执行 sxe ld:clrjit<br>执行 g<br>执行.loadby sos clr</p>
<h3 id="5、常用命令"><a href="#5、常用命令" class="headerlink" title="5、常用命令"></a>5、常用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">.sympath  &#x2F;&#x2F; 检查sympath是否正确</span><br><span class="line"></span><br><span class="line">.sympath srv*c:\Symbols*http:&#x2F;&#x2F;msdl.microsoft.com&#x2F;download&#x2F;symbols</span><br><span class="line"></span><br><span class="line">也可以在命令行执行</span><br><span class="line">.symfix d:\symbols</span><br><span class="line"></span><br><span class="line">!lmi truecrypt  &#x2F;&#x2F; 查找相应的模块信息</span><br><span class="line"></span><br><span class="line">!sym noisy    &#x2F;&#x2F; 检查符号表加载详细情况</span><br><span class="line"></span><br><span class="line">lm   &#x2F;&#x2F; 列出模块</span><br><span class="line">lmf  &#x2F;&#x2F; 指令列出当前进程中加载的所有DLL文件和对应的路径</span><br><span class="line">lmvm &#x2F;&#x2F; 查看DLL&#x2F;EXE文件信息，参数为某个dll文件名称</span><br><span class="line">.loadby sos mscorwks &#x2F;&#x2F; 指令用于加载.Net 3.5版本及以下模块</span><br><span class="line">.loadby sos clr &#x2F;&#x2F; 指令用于加载.Net 4.0版本及以上模块</span><br><span class="line"></span><br><span class="line">!help sos &#x2F;&#x2F; 指令帮助</span><br><span class="line">!threads &#x2F;&#x2F; 显示所有线程</span><br><span class="line">!address  &#x2F;&#x2F; 内存使用情况</span><br><span class="line">!threadpool(!tp) &#x2F;&#x2F; 显示程序池信息</span><br><span class="line">!ProcInfo  &#x2F;&#x2F; 显示进程信息</span><br><span class="line">!address -summary &#x2F;&#x2F; 内存概况</span><br><span class="line"></span><br><span class="line">!heap  &#x2F;&#x2F; 查看进程堆</span><br><span class="line"></span><br><span class="line">!load wow64exts</span><br><span class="line"></span><br><span class="line">!sw</span><br><span class="line"></span><br><span class="line">.reload  &#x2F;&#x2F; 重新加载</span><br><span class="line"></span><br><span class="line">.loadby sos mscorwks</span><br><span class="line"></span><br><span class="line">.symfix+ c:\symbols  &#x2F;&#x2F;强制下载symbols</span><br><span class="line"></span><br><span class="line">.reload &#x2F;f;  &#x2F;&#x2F; Force reloading symbols 强制加载符号文件</span><br><span class="line"></span><br><span class="line">.cordll -ve -u –l   &#x2F;&#x2F;重新加载调试DLL，这是加载DLL，不是符号</span><br><span class="line">!dumpheap  &#x2F;&#x2F; 显示托管堆的信息</span><br><span class="line">!dumpheap -stat  &#x2F;&#x2F;检查当前所有托管类型的统计信息</span><br><span class="line">!dumpheap -type Person –stat  &#x2F;&#x2F; 在堆中查找指定类型（person）对象，注意大小写敏感</span><br><span class="line">!dumpheap -mt 00007ffdb9386948 -min 200 &#x2F;&#x2F;查看200byte以上的string</span><br><span class="line">!dumpobj(!do)  &#x2F;&#x2F; 显示一个对象的内容</span><br><span class="line">!DumpStackObjects(!dso) &#x2F;&#x2F; 当前线程对象分配过程</span><br><span class="line">!do 0000021bcbaf5158 &#x2F;&#x2F; 使用!do命令查看一个对象的内容</span><br><span class="line">!dumparray(!da) &#x2F;&#x2F; 显示数组</span><br><span class="line">!syncblk  &#x2F;&#x2F; 显示同步块</span><br><span class="line">!runaway  &#x2F;&#x2F; 显示线程cpu时间</span><br><span class="line">!gcroot &#x2F;&#x2F; 跟踪对象内存引用</span><br><span class="line">!gcroot 0000021bcbaf5158 &#x2F;&#x2F;使用!gcroot 查看一个对象的gc根</span><br><span class="line"></span><br><span class="line">!DumpObj &#x2F;d 0000021975972b48  &#x2F;&#x2F;查看第对象</span><br><span class="line"></span><br><span class="line">.cordll -ve -u -l</span><br><span class="line"></span><br><span class="line">.chain  &#x2F;&#x2F; 显示加载的扩展dll</span><br><span class="line"></span><br><span class="line">.unload C:\Windows\Microsoft.NET\Framework64\v4.0.30319\sos  &#x2F;&#x2F; 卸载</span><br><span class="line"></span><br><span class="line">!threads -live  &#x2F;&#x2F;查看托管线程</span><br><span class="line"></span><br><span class="line">!runaway  &#x2F;&#x2F; 查看线程运行时间</span><br><span class="line"></span><br><span class="line">.loadby sos clr</span><br><span class="line"></span><br><span class="line">!eeversion</span><br><span class="line"></span><br><span class="line">!pe &#x2F;&#x2F; 打印异常</span><br><span class="line">!ObjSize  &#x2F;&#x2F; 查看对象大小　ObjSize 用于知道对象地址时，查看该对象的大小。</span><br><span class="line">~#s</span><br><span class="line"></span><br><span class="line">!clrstack &#x2F;&#x2F;显示调用栈,只显示托管代码</span><br><span class="line"></span><br><span class="line">kb &#x2F;&#x2F; 显示当前线程的callstack,只显示非托管代码</span><br><span class="line"></span><br><span class="line">~*e !clrstack &#x2F;&#x2F; 所有线程的调用堆栈</span><br><span class="line">.cls &#x2F;&#x2F; 清屏</span><br><span class="line"></span><br><span class="line">!EEStack -EE</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/57f0ab8702b5">Windbg常用命令</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sheng-jie/p/9503650.html">https://www.cnblogs.com/sheng-jie/p/9503650.html</a></p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s/R6TrIlxqJVgApFP-V2r0GA">http://mp.weixin.qq.com/s/R6TrIlxqJVgApFP-V2r0GA</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/beanjoy/article/details/39203259">http://blog.csdn.net/beanjoy/article/details/39203259</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/softfair/p/The_version_SOS_not_match_version_of_CLR_PDB_symbol_for_clr_dll_not_loaded.html">http://www.cnblogs.com/softfair/p/The_version_SOS_not_match_version_of_CLR_PDB_symbol_for_clr_dll_not_loaded.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/Clingingboy/archive/2013/03/26/2983166.html">http://www.cnblogs.com/Clingingboy/archive/2013/03/26/2983166.html</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/bcbobo21cn/article/details/51683137">http://blog.csdn.net/bcbobo21cn/article/details/51683137</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2017/11/30/CentOS7%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/11/30/CentOS7%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8/" class="post-title-link" itemprop="url">CentOS7查看端口占用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-11-30 08:43:46" itemprop="dateCreated datePublished" datetime="2017-11-30T08:43:46+00:00">2017-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CentOS7/" itemprop="url" rel="index"><span itemprop="name">CentOS7</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CentOS7查看端口占用"><a href="#CentOS7查看端口占用" class="headerlink" title="CentOS7查看端口占用"></a>CentOS7查看端口占用</h1><h2 id="Linux命令"><a href="#Linux命令" class="headerlink" title="Linux命令"></a>Linux命令</h2><p>netstat -nap #会列出所有正在使用的端口及关联的进程/应用</p>
<p>lsof -i :portnumber #portnumber要用具体的端口号代替，可以直接列出该端口听使用进程/应用</p>
<h3 id="查看监听-Listen-的端口"><a href="#查看监听-Listen-的端口" class="headerlink" title="查看监听(Listen)的端口"></a>查看监听(Listen)的端口</h3><p>netstat -lntp</p>
<h3 id="检查端口被哪个进程占用"><a href="#检查端口被哪个进程占用" class="headerlink" title="检查端口被哪个进程占用"></a>检查端口被哪个进程占用</h3><p>netstat -lnp|grep 88   #88请换为你的apache需要的端口，如：80</p>
<h3 id="查看进程的详细信息"><a href="#查看进程的详细信息" class="headerlink" title="查看进程的详细信息"></a>查看进程的详细信息</h3><p>ps 1777</p>
<h3 id="杀掉进程，重新启动"><a href="#杀掉进程，重新启动" class="headerlink" title="杀掉进程，重新启动"></a>杀掉进程，重新启动</h3><p>kill -9 1777        #杀掉编号为1777的进程（请根据实际情况输入）</p>
<p>service httpd start #启动apache</p>
<h3 id="开启远程访问端口"><a href="#开启远程访问端口" class="headerlink" title="开启远程访问端口"></a>开启远程访问端口</h3><blockquote>
<p>开启端口：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;6379&#x2F;tcp --permanent</span><br></pre></td></tr></table></figure>

<p>命令含义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--zone #作用域</span><br><span class="line"></span><br><span class="line">--add-port&#x3D;27017&#x2F;tcp #添加端口，格式为：端口&#x2F;通讯协议</span><br><span class="line"></span><br><span class="line">--permanent #永久生效，没有此参数重启后失效</span><br></pre></td></tr></table></figure>

<blockquote>
<p>重启防火墙</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload  #重启防火墙</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2017/11/30/CentOS7%E4%BF%AE%E6%94%B9%E9%9D%99%E6%80%81IP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/11/30/CentOS7%E4%BF%AE%E6%94%B9%E9%9D%99%E6%80%81IP/" class="post-title-link" itemprop="url">CentOS7修改静态IP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-11-30 08:30:10" itemprop="dateCreated datePublished" datetime="2017-11-30T08:30:10+00:00">2017-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CentOS7/" itemprop="url" rel="index"><span itemprop="name">CentOS7</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CentOS7修改静态IP"><a href="#CentOS7修改静态IP" class="headerlink" title="CentOS7修改静态IP"></a>CentOS7修改静态IP</h1><h2 id="进入终端"><a href="#进入终端" class="headerlink" title="进入终端"></a>进入终端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost toor]# cd &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts</span><br><span class="line">[root@localhost network-scripts]# ls</span><br><span class="line">ifcfg-eno16777736         ifdown-isdn      ifup-eth     ifup-Team</span><br><span class="line">ifcfg-eno16777736-1       ifdown-post      ifup-ib      ifup-TeamPort</span><br><span class="line">ifcfg-eno16777736.6BOP8P  ifdown-ppp       ifup-ippp    ifup-tunnel</span><br><span class="line">ifcfg-lo                  ifdown-routes    ifup-ipv6    ifup-wireless</span><br><span class="line">ifcfg-Wired_connection_1  ifdown-sit       ifup-isdn    init.ipv6-global</span><br><span class="line">ifdown                    ifdown-Team      ifup-plip    network-functions</span><br><span class="line">ifdown-bnep               ifdown-TeamPort  ifup-plusb   network-functions-ipv6</span><br><span class="line">ifdown-eth                ifdown-tunnel    ifup-post    route-eno16777736-1</span><br><span class="line">ifdown-ib                 ifup             ifup-ppp</span><br><span class="line">ifdown-ippp               ifup-aliases     ifup-routes</span><br><span class="line">ifdown-ipv6               ifup-bnep        ifup-sit</span><br><span class="line">[root@localhost network-scripts]# vim ifcfg-eno16777736</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">TYPE&#x3D;Ethernet</span><br><span class="line">BOOTPROTO&#x3D;static #dhcp改为static</span><br><span class="line">DEFROUTE&#x3D;yes</span><br><span class="line">PEERDNS&#x3D;yes</span><br><span class="line">PEERROUTES&#x3D;yes</span><br><span class="line">IPV4_FAILURE_FATAL&#x3D;no</span><br><span class="line">IPV6INIT&#x3D;yes</span><br><span class="line">IPV6_AUTOCONF&#x3D;yes</span><br><span class="line">IPV6_DEFROUTE&#x3D;yes</span><br><span class="line">IPV6_PEERDNS&#x3D;yes</span><br><span class="line">IPV6_PEERROUTES&#x3D;yes</span><br><span class="line">IPV6_FAILURE_FATAL&#x3D;no</span><br><span class="line">NAME&#x3D;eno16777736</span><br><span class="line">UUID&#x3D;7b7f487c-4a01-464b-9587-dae9daca6bc9</span><br><span class="line">DEVICE&#x3D;eno16777736</span><br><span class="line">ONBOOT&#x3D;yes</span><br><span class="line">IPADDR&#x3D;192.168.0.122 #静态IP</span><br><span class="line">GATEWAY&#x3D;192.168.0.1 #默认网关</span><br><span class="line">NETMASK&#x3D;255.255.255.0 #子网掩码</span><br></pre></td></tr></table></figure>

<p>重启网络服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>

<p>若出现重启失败的话，可以试着把ifcfg-eno文件里的DEVICE一行删除试试</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2017/09/15/CentOS7-PostGresqlSql%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/15/CentOS7-PostGresqlSql%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">CentOS7-PostGresqlSql9.6安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-15 14:35:18" itemprop="dateCreated datePublished" datetime="2017-09-15T14:35:18+00:00">2017-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-22 09:35:48" itemprop="dateModified" datetime="2020-10-22T09:35:48+00:00">2020-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PostGresqlSql/" itemprop="url" rel="index"><span itemprop="name">PostGresqlSql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><p><a target="_blank" rel="noopener" href="https://www.postgresql.org/download/linux/redhat/" title="链接">官网文档</a></p>
<p>注: root账户安装</p>
<h3 id="添加RPM"><a href="#添加RPM" class="headerlink" title="添加RPM"></a>添加RPM</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install https:&#x2F;&#x2F;download.postgresql.org&#x2F;pub&#x2F;repos&#x2F;yum&#x2F;9.6&#x2F;redhat&#x2F;rhel-7-x86_64&#x2F;pgdg-centos96-9.6-3.noarch.rpm</span><br></pre></td></tr></table></figure>

<h3 id="安装PostgreSQL"><a href="#安装PostgreSQL" class="headerlink" title="安装PostgreSQL"></a>安装PostgreSQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install postgresql96         ##客户端包##</span><br><span class="line">yum install postgresql96-server  ##服务端包##</span><br></pre></td></tr></table></figure>

<p>安装过程出现问题，可能会导致初始化数据库错误错误，如下：</p>
<p>解决方法：重新执行命令 <code>yum install postgresql96-server</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zeii3e4srrxcoy1gbubz ~]# &#x2F;usr&#x2F;pgsql-9.6&#x2F;bin&#x2F;postgresql96-setup initdb</span><br><span class="line">-bash: &#x2F;usr&#x2F;pgsql-9.6&#x2F;bin&#x2F;postgresql96-setup: No such file or directory</span><br></pre></td></tr></table></figure>

<h3 id="初始化数据库-允许自动启动"><a href="#初始化数据库-允许自动启动" class="headerlink" title="初始化数据库,允许自动启动"></a>初始化数据库,允许自动启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;pgsql-9.6&#x2F;bin&#x2F;postgresql96-setup initdb</span><br><span class="line">systemctl enable postgresql-9.6</span><br><span class="line">systemctl start postgresql-9.6</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>PostgreSQL 安装完成后，会建立一下‘postgres’用户，用于执行PostgreSQL，数据库中也会建立一个’postgres’用户，默认密码为自动生成，需要在系统中改一下。</p>
<h3 id="修改默认密码"><a href="#修改默认密码" class="headerlink" title="修改默认密码"></a>修改默认密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su - postgres  ##切换用户，执行后提示符会变为 &#39;-bash-4.2$&#39;</span><br><span class="line">psql -U postgres ##登录数据库，执行后提示符变为 &#39;postgres&#x3D;#&#39;</span><br><span class="line">ALTER USER postgres WITH PASSWORD &#39;abc123&#39; ## 设置postgres用户密码</span><br><span class="line">\q       ##退出数据库</span><br><span class="line">exit     ##退出</span><br></pre></td></tr></table></figure>

<h3 id="开启远程访问"><a href="#开启远程访问" class="headerlink" title="开启远程访问"></a>开启远程访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;var&#x2F;lib&#x2F;pgsql&#x2F;9.6&#x2F;data&#x2F;postgresql.conf</span><br></pre></td></tr></table></figure>

<p> 修改#listen_addresses = ‘localhost’ 为  listen_addresses=’*’</p>
<p> 当然，此处‘*’也可以改为任何你想开放的服务器IP</p>
<h3 id="信任远程连接"><a href="#信任远程连接" class="headerlink" title="信任远程连接"></a>信任远程连接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;var&#x2F;lib&#x2F;pgsql&#x2F;9.6&#x2F;data&#x2F;pg_hba.conf</span><br></pre></td></tr></table></figure>

<p>修改如下内容，信任指定服务器连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># IPv4 local connections:</span><br><span class="line">host    all       all      127.0.0.1&#x2F;32      trust</span><br><span class="line">host    all       all      10.211.55.6&#x2F;32（需要连接的服务器IP）  trust</span><br></pre></td></tr></table></figure>

<h3 id="打开防火墙"><a href="#打开防火墙" class="headerlink" title="打开防火墙"></a>打开防火墙</h3><p>CentOS 防火墙中内置了PostgreSQL服务，配置文件位置在</p>
<p>/usr/lib/firewalld/services/postgresql.xml，</p>
<p>我们只需以服务方式将PostgreSQL服务开放即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-service&#x3D;postgresql --permanent  开放postgresql服务</span><br><span class="line">firewall-cmd --reload  重载防火墙</span><br></pre></td></tr></table></figure>

<h3 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart postgresql-9.6.service</span><br></pre></td></tr></table></figure>

<h2 id="开发备注"><a href="#开发备注" class="headerlink" title="开发备注"></a>开发备注</h2><p>本地服务器连接数据库出现以下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OperationalError: FATAL: Ident authentication failed for user “dbuser”</span><br></pre></td></tr></table></figure>

<p>出现这个错误的原因还是在于上面pg_hba.conf 文件的设置，Debian系（包括ubuntu）默认的pg_hba.conf 文件对于</p>
<p>localhost本地机器的数据库访问方式是ident，它指的是只有Linux shell用户通过同名的postgreSQL 用户才能访问，</p>
<p>也就是pg超级用户postgres 只能由linux 用户postgres 登录后操作。</p>
<p>“postgres”的问题，有两种解决方法：</p>
<ul>
<li><p>在执行$ python manage.py shell之前先$su postgres 切换为postgres 用户</p>
</li>
<li><p>修改pg_hba.conf 的客户端访问设置，将laocal 的访问由ident 改为trust，如：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># TYPE DATABASE USER CIDR-ADDRESS METHOD</span><br><span class="line">local all all trust</span><br></pre></td></tr></table></figure>

<p>修改完pg_hba.conf设置记得重启pg。安装了pg_ctl 也可以用pg_ctl reload。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.postgresql.org/download/linux/redhat/" title="链接">官网文档</a></p>
<p><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/7e95fd0bc91a" title="链接">http://www.jianshu.com/p/7e95fd0bc91a</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/mchina/archive/2012/06/06/2539003.html" title="链接">http://www.cnblogs.com/mchina/archive/2012/06/06/2539003.html</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/wang1144/article/details/8986479" title="本地连接错误">http://blog.csdn.net/wang1144/article/details/8986479</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">syxdevcode</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">320</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">103</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">135</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/syxdevcode" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;syxdevcode" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">syxdevcode</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
