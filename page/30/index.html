<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"syxdevcode.github.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="syxdevcode的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="syxdevcode博客">
<meta property="og:url" content="https://syxdevcode.github.com/page/30/index.html">
<meta property="og:site_name" content="syxdevcode博客">
<meta property="og:description" content="syxdevcode的个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="syxdevcode">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://syxdevcode.github.com/page/30/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>syxdevcode博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">syxdevcode博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/syxdevcode" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/04/01/%E7%BB%9F%E4%B8%80%E5%BB%BA%E6%A8%A1%E8%AF%AD%E8%A8%80UML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/01/%E7%BB%9F%E4%B8%80%E5%BB%BA%E6%A8%A1%E8%AF%AD%E8%A8%80UML/" class="post-title-link" itemprop="url">统一建模语言UML</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-04-01 09:23:28" itemprop="dateCreated datePublished" datetime="2019-04-01T09:23:28+00:00">2019-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>905</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="统一建模语言UML"><a href="#统一建模语言UML" class="headerlink" title="统一建模语言UML"></a>统一建模语言UML</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>统一建模语言（英语：Unified Modeling Language，缩写 UML）是非专利的第三代建模和规约语言。UML是一种开放的方法，用于说明、可视化、构建和编写一个正在开发的、面向对象的、软件密集系统的制品的开放方法。UML展现了一系列最佳工程实践，这些最佳实践在对大规模，复杂系统进行建模方面，特别是在软件架构层次已经被验证有效。</p>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>在UML系统开发中有三个主要的模型：</p>
<ul>
<li>功能模型：从用户的角度展示系统的功能，包括用例图。</li>
<li>对象模型：采用对象，属性，操作，关联等概念展示系统的结构和基础，包括类别图、对象图。</li>
<li>动态模型：展现系统的内部行为。包括序列图，活动图，状态图。</li>
</ul>
<h2 id="图形"><a href="#图形" class="headerlink" title="图形"></a>图形</h2><h3 id="结构性图形（Structure-diagrams）"><a href="#结构性图形（Structure-diagrams）" class="headerlink" title="结构性图形（Structure diagrams）"></a>结构性图形（Structure diagrams）</h3><p><strong>1,静态图（static diagram</strong></p>
<ul>
<li>类图</li>
<li>对象图</li>
<li>包图</li>
</ul>
<p><strong>2,实现图（implementation diagram）</strong></p>
<ul>
<li>组件图</li>
<li>部署图</li>
</ul>
<h3 id="行为式图形（Behavior-diagrams）"><a href="#行为式图形（Behavior-diagrams）" class="headerlink" title="行为式图形（Behavior diagrams）"></a>行为式图形（Behavior diagrams）</h3><ul>
<li>活动图</li>
<li>状态图</li>
<li>用例图</li>
</ul>
<h3 id="交互性图形（Interaction-diagrams）"><a href="#交互性图形（Interaction-diagrams）" class="headerlink" title="交互性图形（Interaction diagrams）"></a>交互性图形（Interaction diagrams）</h3><ul>
<li>通信图</li>
<li>交互概述图（UML 2.0）</li>
<li>时序图（UML 2.0）</li>
<li>时间图（UML 2.0）</li>
</ul>
<h2 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h2><h3 id="属性和方法"><a href="#属性和方法" class="headerlink" title="属性和方法"></a>属性和方法</h3><p>在UML类图中，类使用包含类名、属性(field) 和方法(method) 且带有分割线的矩形来表示。</p>
<p>UML类图中表示可见性的符号有三种：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ ：表示<span class="keyword">public</span></span><br><span class="line">- ：表示<span class="keyword">private</span></span><br><span class="line"><span class="meta"># ：表示protected（friendly也归入这类）</span></span><br></pre></td></tr></table></figure>

<p>规则：<font color=#ff0000 size=4 face="黑体">可见性  名称 ：类型 [ = 缺省值]</font></p>
<p><img src="/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190401142800.png" alt="微信截图_20190401142800.png"></p>
<h3 id="对象关系"><a href="#对象关系" class="headerlink" title="对象关系"></a>对象关系</h3><h4 id="关联关系"><a href="#关联关系" class="headerlink" title="关联关系"></a>关联关系</h4><p><strong>1，单项关联</strong></p>
<p><font color=#ff0000 size=4 face="黑体">单向关联用一个带箭头的直线表示。</font></p>
<p><img src="/img/617148-20160612224805636-1840590061.jpg" alt="617148-20160612224805636-1840590061.jpg"></p>
<p><strong>2,双向关联</strong></p>
<p><font color=#ff0000 size=4 face="黑体">双向关联就是双方各自持有对方类型的成员变量，双向关联用一个不带箭头的直线表示。</font></p>
<p><img src="/img/617148-20160612225006840-13774319.jpg" alt="617148-20160612225006840-13774319.jpg"></p>
<p><strong>3,自关联</strong></p>
<p><img src="/img/617148-20160612225239636-76459111.jpg" alt="617148-20160612225239636-76459111.jpg"></p>
<h4 id="聚合关系"><a href="#聚合关系" class="headerlink" title="聚合关系"></a>聚合关系</h4><p><font color=#ff0000 size=4 face="黑体">UML中聚合关系用带空心菱形和箭头的直线表示，空心菱形能分离而独立存在。</font></p>
<p><img src="/img/617148-20160612225421496-664373564.jpg" alt="617148-20160612225421496-664373564.jpg"></p>
<h4 id="组合关系"><a href="#组合关系" class="headerlink" title="组合关系"></a>组合关系</h4><p><font color=#ff0000 size=4 face="黑体">UML类图中组合关系用一个带实心菱形和箭头的直线表示。</font></p>
<p><img src="/img/617148-20160612232819824-829657559.jpg" alt="617148-20160612232819824-829657559.jpg"></p>
<h4 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h4><p><font color=#ff0000 size=4 face="黑体">在UML类图中依赖关系用一条带有箭头的虚线表示。</font></p>
<p><img src="/img/617148-20160612232951746-9292157.jpg" alt="617148-20160612232951746-9292157.jpg"></p>
<h4 id="继承父类"><a href="#继承父类" class="headerlink" title="继承父类"></a>继承父类</h4><p><font color=#ff0000 size=4 face="黑体">在UML类图中继承父类用一条带有三角的实线表示。</font></p>
<p><img src="/img/617148-20160612233246199-1404301867.jpg" alt="617148-20160612233246199-1404301867.jpg"></p>
<h4 id="继承接口"><a href="#继承接口" class="headerlink" title="继承接口"></a>继承接口</h4><p><font color=#ff0000 size=4 face="黑体">在UML类图中继承接口用一条带有三角的虚线表示。</font></p>
<p><img src="/img/617148-20160612233430777-736506858.jpg" alt="617148-20160612233430777-736506858.jpg"></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E5%BB%BA%E6%A8%A1%E8%AF%AD%E8%A8%80">统一建模语言</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0cd7df8a7789">一张图读懂UML</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/shindo/p/5579191.html">五分钟读懂UML类图</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/damsoft/archive/2016/10/24/5993602.html">vs2013\2015UML系列之-类图</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/25/ASP-NET-Web-API-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/25/ASP-NET-Web-API-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">ASP.NET Web API 2.0学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-25 08:35:32" itemprop="dateCreated datePublished" datetime="2019-03-25T08:35:32+00:00">2019-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MVC-Web-API/" itemprop="url" rel="index"><span itemprop="name">MVC/Web API</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ASP-NET-Web-API-2-0学习笔记"><a href="#ASP-NET-Web-API-2-0学习笔记" class="headerlink" title="ASP.NET Web API 2.0学习笔记"></a>ASP.NET Web API 2.0学习笔记</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>ASP.NET Web API是一个独立于传输层的抽象消息处理管道，它能根据请求采用 HTTP方法来确定目标 Action方法。<br>IIS 默认拒绝<code>PUT</code>和<code>DELETE</code>请求，原因是默认注册了 <code>WebDAVModule</code>，可以通过配置文件移除<code>HttpModule</code>。</p>
<p>** Web API的宿主方式**<br>1，web host 方式<br>    以 Web Host的 方式寄宿 Web API需 要做的唯——件事情是路 由注册。</p>
<p>2，self host 方式<br>    任意类型的应用程序 (控制台、Windows Forms应 用、WPF应用甚至是 Windows sewioc)作为宿主。<br>    除了必须的路 由注册外,我们还需要完成额外的一件事情,即手工加载定义了HttpController类型的程序集。</p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><h3 id="ASP-NET路由系统"><a href="#ASP-NET路由系统" class="headerlink" title="ASP.NET路由系统"></a>ASP.NET路由系统</h3><p>一个Web 应用具有一个全局的路由表，通过 <code>System.Web.Routing.RouteTable</code>的静态属性<code>Routes</code>表示。</p>
<p> RouteBase</p>
<p>一个<code>Route</code>继承抽象类<code>System.Web.Routing.RouteBase</code>。</p>
<p>  RouteData</p>
<p>VirTalPathData</p>
<p>Route<br><code>System.Web.Routing.Route</code>是抽象类<code>System.Web.Routing.RouteBase</code>唯一的直接子类，基于路由模版模式的路由匹配规则就定义在<code>Route</code>中。</p>
<p>RouteTable</p>
<h3 id="ASP-NET-WEB-API-路由"><a href="#ASP-NET-WEB-API-路由" class="headerlink" title="ASP.NET WEB API 路由"></a>ASP.NET WEB API 路由</h3><p>请求与响应</p>
<p>ASP.NET WEB API通过类型<code>HttpRequestMessage</code>和<code>HttpResponseMessage</code>表示的管道处理的请求和响应的消息，定义在<code>System.Net.Http.dll</code>中。</p>
<p>HttpRequestMessage</p>
<p>HttpResponseMessage</p>
<p>HttpContent</p>
<h4 id="ASP-NET-WEB-API-路由系统"><a href="#ASP-NET-WEB-API-路由系统" class="headerlink" title="ASP.NET WEB API 路由系统"></a>ASP.NET WEB API 路由系统</h4><p>ASP.NET WEB API路由系统中<code>HostedHttpRoute</code>对象通过创建ASP.NET路由系统中的<code>HttpWebRoute</code>对象进行路由解析。<br>针对约束的检查则依然是ASP.NET WEB API路由系统中的<code>HttpRouteConstraint</code>。</p>
<p>Web Host宿主模式采用的route类型为<code>HttpWebRoute</code>,对应的<code>RouteHandler</code>是<code>HttpControllerRouteHandler</code>对象，提供的<code>HttpHandler</code>类型为<code>HttpControllerHandler</code>。</p>
<p>ASP.NET WEB API以Web Host模式部署并注册相应的路由后，这些注册的<code>HttpRoute(HostedHttpRoute)</code>最终会转换成asp.net全局路由表中的<code>Route(HttpWebRoute)</code><br>asp.net路由系统对请求进行拦截，如果匹配某个Route,响应的路由数据<br>被解析出来并保存在<code>RequestContext</code>中，随后asp.net路由系统的实现者<br><code>UrlRoutingModule</code>从匹配的Route中获取<code>RouteHandler</code>,即<code>HttpControllerRouteHandler</code>对象，该对象提供<code>HttpHandler(HttpControllerHandler)</code>被映射到当前请求。<br>一旦映射成功，<code>HttpControllerHandler</code>将最终接管当前请求，它会构建一个<br>消息处理管道来处理这个请求并对请求予以响应。</p>
<p><code>HttpControllerHandler</code>创建<code>HttpRequestMessage</code>，并将ASP.NET路由系统解析得到的<code>RouteData</code>转换成<code>HttpRouteData,</code>并添加到<code>HttpRequestMessage</code>属性的字典中。</p>
<p>HttpRouteData</p>
<p>HttpVirtualPathData</p>
<p>HttpRouteConstraint</p>
<p>HttpRoute</p>
<p>HttpRouteCollection</p>
<dl><dt>HostedHttpRoute</dt><dd>可以看成一个对Route对象的封装。</dd></dl><h2 id="消息处理管道"><a href="#消息处理管道" class="headerlink" title="消息处理管道"></a>消息处理管道</h2><p>ASP.NET WEB API的核心框架是一个消息处理管道，由一组<code>HttpMessageHandler</code>的有序组合。</p>
<p>1, HttpMessageHandler<br>ASP.NET WEB API的核心框架是一个消息处理管道,由一组<code>HttpMessageHandler</code>经过收尾相连而成。</p>
<p>2，DelegatingHandler</p>
<p>管道的串联通过<code>DelegatingHandler</code>来完成。</p>
<p>3，HttpServer</p>
<p>作为<code>HttpMessageHandler</code>链的龙头</p>
<p>4，HttpRoutingDispatcher</p>
<p>消息处理管道最后一个<code>HttpMessageHandler</code>.<br>主要功能：路由(Routing)和消息分发（Dispatching）<br>默认从<code>HttpRoutingDispatcher</code>接管请求的<code>HttpMessageHandler</code>是<code>HttpControllerDispatcher</code>对象。对<code>HttpController</code>的激活和Action方法的执行和响应都是有<code>HttpControllerDispatcher</code>完成的。</p>
<h3 id="Web-Host模式下消息处理管道"><a href="#Web-Host模式下消息处理管道" class="headerlink" title="Web Host模式下消息处理管道"></a>Web Host模式下消息处理管道</h3><p>HttpControllerHandler</p>
<p><code>HttpControllerHandler</code>创建<code>HttpRequestMessage</code>，并将ASP.NET路由系统解析得到的<code>RouteData</code>转换成<code>HttpRouteData,</code>并添加到<code>HttpRequestMessage</code>属性的字典中。</p>
<h3 id="Self-Host模式下消息处理管道"><a href="#Self-Host模式下消息处理管道" class="headerlink" title="Self Host模式下消息处理管道"></a>Self Host模式下消息处理管道</h3><h2 id="HttpController的激活"><a href="#HttpController的激活" class="headerlink" title="HttpController的激活"></a>HttpController的激活</h2><h3 id="HttpController"><a href="#HttpController" class="headerlink" title="HttpController"></a>HttpController</h3><p><code>HttpRoutingDispatcher</code>会利用隶属于它的<code>HttpControllerDispatcher</code>激活目标<code>HttpController</code>对象。</p>
<p>1，HttpControllerContext</p>
<p><code>HttpController</code>对象<code>ExecuteAsync</code>方法得到<code>HttpControllerContext</code>。</p>
<p>2，HttpControllerDescripor</p>
<p><code>HttpControllerDescriptor</code>封装了某个<code>HttpController</code>类型的元数据，即<code>HttpController</code>类型的描述对象。</p>
<p>创建<code>HttpController</code></p>
<h3 id="HttpController如何创建的"><a href="#HttpController如何创建的" class="headerlink" title="HttpController如何创建的"></a>HttpController如何创建的</h3><p><code>HttpControllerDispatcher</code>实现目标<code>HttpController</code>对象的激活与执行，并将代表执行结果的<code>HttpResponseMessage</code>对象返回给<code>HttpRoutingDispatcher</code>对象,后者将<code>HttpResponseMessage</code>回传给消息管道进行相应的处理后最终完成对请求的响应。</p>
<p><code>HttpControllerDispatcher</code>接管请求后，它会获取注册的<code>HttpControllerSelector</code>对象,默认注册的<code>HttpControllerDescriptor</code> 是一个<code>DefaultHttpControllerSelector</code>,后者借助于注册的<code>HttpControllerTypeResolver</code>对象得到所有的<code>HttpController</code>类型，进而创建一个描述这些<code>HttpController</code>的<code>HttpControllerDescriptor</code>对象与<code>HttpController</code>名称之间的映射关系，并调用其<code>SelectController</code>方法 得到描述目标<code>HttpController</code>的<code>HttpControllerDescriptor</code>对象。</p>
<p><code>HttpControllerDispatcher</code>接下来调用这个<code>HttpControllerDescriptor</code>对象的<code>CreateController</code>方法得到激活的<code>HttpController</code>对象。对于这个<code>HttpControllerDescriptor</code>对象来说，当它<code>CreateController</code>方法被调用之后，它会获取注册的<code>HttpControllerActivator</code>对象，并调用其Create方法实现针对目标<code>HttpController</code>对象的激活并将激活的对象返回。</p>
<p>默认注册的<code>DefaultHttpControllerActivator</code>对象会利用注册的<code>DependencyResolver</code>根据<code>HttpController</code>类型去获取代表目标<code>HttpController</code>实例的对象。如果后者返回一个<code>HttpController</code>对象，该对象将直接作为方法的返回值，否则<code>DefaultHttpControllerActivator</code>直接采用反射的形式创建目标<code>HttpController</code>对象并返回。</p>
<p>由于默认注册的<code>DepandencyResolver</code>是一个<code>EmptyResolver</code>对象，由它返回<code>HttpController</code>对象总是null,所以在默认情况下激活<code>HttpController</code>对象总是以反射的形式创建的。所以我们定义<code>HttpController</code>类型必须具有一个默认的构造函数。</p>
<h2 id="Action的选择"><a href="#Action的选择" class="headerlink" title="Action的选择"></a>Action的选择</h2><h3 id="HttpActionDescriptor"><a href="#HttpActionDescriptor" class="headerlink" title="HttpActionDescriptor"></a>HttpActionDescriptor</h3><p><code>HttpActionDescriptor</code>是一个抽象类。</p>
<p>定义在<code>HttpController</code>类型中的每一个Action方法都是通过<code>HttpActionDescriptor</code>对象来描述的。描述Action方法的基本元数据信息均可以在对应的<code>HttpActionDescriptor</code>对象中找到。</p>
<h3 id="ReflectedHttpActionDescriptor"><a href="#ReflectedHttpActionDescriptor" class="headerlink" title="ReflectedHttpActionDescriptor"></a>ReflectedHttpActionDescriptor</h3><p><code>HttpActionDescriptor</code>是一个抽象类,默认实现是<code>ReflectedHttpActionDescriptor</code>对象，通过对目标方法实施反射来获取相关的元数据信息。<br>一个<code>ReflectedHttpActionDescriptor</code>对象是对一个<code>MethodInfo</code>的封装,<br>描述Action方法相关的元数据基本来源于此。</p>
<h3 id="ActionNameAttribute"><a href="#ActionNameAttribute" class="headerlink" title="ActionNameAttribute"></a>ActionNameAttribute</h3><p>应用<code>ActionNameAttribute</code>特性来对Action进行命名。</p>
<h3 id="方法名决定HTTP方法"><a href="#方法名决定HTTP方法" class="headerlink" title="方法名决定HTTP方法"></a>方法名决定HTTP方法</h3><p>如果Action方法具有以下的前缀（不区分大小写），那么对应的HTTP方法将默认支持。不具有，则默认支持POST。</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>PUT</li>
<li>DELETE</li>
<li>HEAD</li>
<li>OPTIONS</li>
<li>PATCH</li>
</ul>
<h3 id="ActionHttpMethodProvider"><a href="#ActionHttpMethodProvider" class="headerlink" title="ActionHttpMethodProvider"></a>ActionHttpMethodProvider</h3><p><code>ActionHttpMethodProvider</code>应用到某个Action方法上，并为其提供它所支持的HTTP方法。</p>
<p>AcceptVerbsAttribute特性</p>
<p>写法：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">AcceptVerbsAttribute(<span class="string">&quot;PUT&quot;</span>,<span class="string">&quot;POST&quot;</span>)</span>]</span><br></pre></td></tr></table></figure>

<p>ASP.NET Web API 定义的7中对应的特性类型：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HttpGetAttribute</span><br><span class="line">HttpPostAttribute</span><br><span class="line">HttpPutAttribute</span><br><span class="line">HttpDeleteAttribute</span><br><span class="line">HttpHeadAttribute</span><br><span class="line">HttpOptionsAttribute</span><br><span class="line">HttpPatchAttribute</span><br></pre></td></tr></table></figure>

<h3 id="HttpParameterDescriptor"><a href="#HttpParameterDescriptor" class="headerlink" title="HttpParameterDescriptor"></a>HttpParameterDescriptor</h3><p>抽象类，用户描述Action方法参数的<code>HttpParameterDescriptor</code>对象。</p>
<h3 id="ReflectedHttpParameterDescriptor"><a href="#ReflectedHttpParameterDescriptor" class="headerlink" title="ReflectedHttpParameterDescriptor"></a>ReflectedHttpParameterDescriptor</h3><h3 id="HttpActionSelector"><a href="#HttpActionSelector" class="headerlink" title="HttpActionSelector"></a>HttpActionSelector</h3><p>使用<code>ApiControllerActionSelector</code>对象作为默认的<code>HttpActionSelector</code>。</p>
<h2 id="特性路由"><a href="#特性路由" class="headerlink" title="特性路由"></a>特性路由</h2><p>参考：</p>
<p>[ASP.NET Web API 2 框架揭秘](ASP.NET Web API 2 框架揭秘)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/21/CSharp%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0-%E5%86%92%E6%B3%A1%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/21/CSharp%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0-%E5%86%92%E6%B3%A1%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">CSharp算法实现-冒泡算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-21 14:01:03" itemprop="dateCreated datePublished" datetime="2019-03-21T14:01:03+00:00">2019-03-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>806</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>CSharp算法实现-冒泡算法的实现</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/03/21/CSharp%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0-%E5%86%92%E6%B3%A1%E7%AE%97%E6%B3%95/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/21/DotNet-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/21/DotNet-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">DotNet 单例模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-21 08:33:10" itemprop="dateCreated datePublished" datetime="2019-03-21T08:33:10+00:00">2019-03-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>单例模式涉及到的基础知识，包括静态构造函数，私有构造函数，锁，延时创建对象, readonly/const 等等。</p>
<p>单例的优点： 1.保证了所有的对象访问的都是同一个实例 2.由于类是由自己类控制实例化的，所以有相应的伸缩性</p>
<p>单例的缺点： 1.额外的系统开销，因为每次使用类的实例的时候，都要检查实例是否存在，可以通过静态实例该解决。 2.无法销毁对象，单例模式的特性决定了只有他自己才能销毁对象实例，但是一般情况下我们都没做这个事情。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/03/21/DotNet-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/19/OpenID-Connect-%E5%8D%8F%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/19/OpenID-Connect-%E5%8D%8F%E8%AE%AE/" class="post-title-link" itemprop="url">OpenID Connect 协议</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-19 10:52:32" itemprop="dateCreated datePublished" datetime="2019-03-19T10:52:32+00:00">2019-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OAuth2-0/" itemprop="url" rel="index"><span itemprop="name">OAuth2.0</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="OpenID-Connect-协议"><a href="#OpenID-Connect-协议" class="headerlink" title="OpenID Connect 协议"></a>OpenID Connect 协议</h1><h2 id="OpenID-Connect简介"><a href="#OpenID-Connect简介" class="headerlink" title="OpenID Connect简介"></a>OpenID Connect简介</h2><p><code>OpenID Connect</code>是由OpenID基金会于2014年发布的一个开放标准，简称OIDC, 它使用OAuth2.0来进行身份认证,<code>OpenID Connect</code>是OpenID的第三代技术。 <code>OpenID Connect</code>直接构建于OAuth2.0的基础之上,添加了一些组件来提供身份认证的能力与其兼容。 通常<code>OpenID Connect</code>是和OAuth2一同部署来使用的。</p>
<p><font color=#ff0000 size=4 face="黑体">OpenID Connect是更高级的协议, 它扩展并替代了OAuth2.0 尽管现在我们经常说我们在使用OAuth2.0来保护API, 其实更准确的说, 大多数情况下, 我们使用的是OpenID Connect.</font></p>
<p>身份认证(Authentication)<br>授权(Authorization)</p>
<h2 id="名词定义"><a href="#名词定义" class="headerlink" title="名词定义"></a>名词定义</h2><ul>
<li><p>EU：End User，用户。</p>
</li>
<li><p>RP：Relying Party ，用来代指OAuth2中的受信任的客户端，身份认证和授权信息的消费方；</p>
</li>
<li><p>OP：OpenID Provider，有能力提供EU身份认证的服务方（比如OAuth2中的授权服务），用来为RP提供EU的身份认证信息；</p>
</li>
<li><p>ID-Token：JWT格式的数据，包含EU身份认证的信息。</p>
</li>
<li><p>UserInfo Endpoint：用户信息接口（受OAuth2保护），当RP使用ID-Token访问时，返回授权用户的信息，此接口必须使用HTTPS。</p>
</li>
</ul>
<h2 id="OIDC基础"><a href="#OIDC基础" class="headerlink" title="OIDC基础"></a>OIDC基础</h2><p>OpenID是 <code>Authentication</code>，即认证，对用户的身份进行认证，判断其身份是否有效，也就是让网站知道“你是你所声称的那个用户”；</p>
<p>OAuth是 <code>Authorization</code>，即授权，在已知用户身份合法的情况下，经用户授权来允许某些操作，也就是让网站知道“你能被允许做那些事情”。</p>
<p>由此可知，授权要在认证之后进行，只有确定用户身份才能授权。<br><font color=#ff0000 size=4 face="黑体">(身份验证)+ OAuth 2.0 = OpenID Connect</font></p>
<p><code>OpenID Connect</code>是“认证”和“授权”的结合，因为其基于OAuth协议，所以<code>OpenID Connect</code>协议中也包含了<code>client_id</code>、<code>client_secret</code>还有<code>redirect_uri</code>等字段标识。这些信息被保存在<code>身份认证服务器</code>，以确保特定的客户端收到的信息只来自于合法的应用平台。这样做是目的是为了防止<code>client_id</code>泄露而造成的恶意网站发起的OIDC流程。</p>
<p>在OAuth中的<code>scope</code>，<code>OpenID Connect</code>也有自己特殊的<code>scope--openid</code> ,它必须在第一次请求“身份鉴别服务器”（Identity Provider,简称IDP）时发送过去。</p>
<h2 id="OIDC流程"><a href="#OIDC流程" class="headerlink" title="OIDC流程"></a>OIDC流程</h2><p>OIDC基于OAuth2，所以OIDC的认证流程主要是由OAuth2的几种授权流程延伸而来的，有以下3种：</p>
<ul>
<li>Authorization Code Flow：使用OAuth2的授权码来换取<code>Id_Token</code>和<code>Access_Token</code>。</li>
<li>Implicit Flow：使用OAuth2的Implicit流程获取<code>Id_Toke</code>n和<code>Access_Token</code>。</li>
<li>Hybrid Flow：混合<code>Authorization Code Flow</code>+<code>Implici Flow</code>。</li>
</ul>
<p>OpenID Connect抽象流程：</p>
<p><img src="/img/986268-20180627101906559-326862209.png" alt="986268-20180627101906559-326862209.png"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 依赖发(RP)发送请求到OpenID提供商(OP, 也就是身份提供商).</span><br><span class="line">2. OpenID提供商验证最终用户的身份, 并获得了用户委派的授权</span><br><span class="line">3. OpenID提供商返回响应, 里面带着ID_Token, 也通常带着Access_Token.</span><br><span class="line">4. 依赖方现在可以使用Access_Token发送请求到用户信息的端点.</span><br><span class="line">5. 用户信息端点返回用户的声明(claims, 相当于是用户的信息).</span><br></pre></td></tr></table></figure>

<p>OpenID Connect身份认证有三个路径(三个流程, flow): <code>Authorization Code</code>, <code>Implicit</code>，<code>Hybrid</code>。</p>
<h3 id="Authorization-Code-授权码"><a href="#Authorization-Code-授权码" class="headerlink" title="Authorization Code(授权码)"></a>Authorization Code(授权码)</h3><p>要求客户端应用可以安全的在它和授权服务器之间维护客户端的<code>secret</code>,也就是说只适合这样的客户端应用。它还适合于长时间的访问(通过refresh token)。</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1，客户端准备身份认证请求, 请求里包含所需的参数</span><br><span class="line">2，客户端发送请求到授权服务器</span><br><span class="line">3，授权服务器对最终用户进行身份认证</span><br><span class="line">4，授权服务器获得最终用户的同意/授权</span><br><span class="line">5，授权服务器把最终用户发送回客户端, 同时带着授权码</span><br><span class="line">6，客户端使用授权码向Token端点请求一个响应</span><br><span class="line">7，客户端接收到响应, 响应的body里面包含着ID_Token 和 Access_Token</span><br><span class="line">8，客户端验证ID_Token, 并获得用户的一些身份信息.</span><br></pre></td></tr></table></figure>

<h3 id="Implicit-简化"><a href="#Implicit-简化" class="headerlink" title="Implicit(简化)"></a>Implicit(简化)</h3><p>不适合于长时间访问。</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1，客户端准备身份认证请求, 请求里包含所需的参数</span><br><span class="line">2，客户端发送请求到授权服务器</span><br><span class="line">3，授权服务器对最终用户进行身份认证</span><br><span class="line">4，授权服务器获得最终用户的同意/授权</span><br><span class="line">5，授权服务器把最终用户发送回客户端, 同时带着ID_Token.</span><br><span class="line">  如果也请求了Access_Token的话, 那么Access_Token也会一同返回.</span><br><span class="line">6，客户端验证ID_Token, 并获得用户的一些身份信息.</span><br></pre></td></tr></table></figure>

<h3 id="Hybrid-Flow-混合"><a href="#Hybrid-Flow-混合" class="headerlink" title="Hybrid Flow(混合)"></a>Hybrid Flow(混合)</h3><p>适合于长时间的访问。</p>
<p>要求客户端应用可以安全的维护<code>secret</code>。</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1，客户端准备身份认证请求, 请求里包含所需的参数</span><br><span class="line">2，客户端发送请求到授权服务器</span><br><span class="line">3，授权服务器对最终用户进行身份认证</span><br><span class="line">4，授权服务器获得最终用户的同意/授权</span><br><span class="line">5，授权服务器把最终用户发送回客户端, 同时带着授权码,</span><br><span class="line">   根据响应类型的不同, 也可能还带着一个或者多个其它的参数.</span><br><span class="line">6，客户端使用授权码向Token端点请求一个响应</span><br><span class="line">7，客户端接收到响应, 响应的body里面包含着ID_Token 和 Access_Token</span><br><span class="line">8，客户端验证ID_Token, 并获得用户的一些身份信息.</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/be7cc032a4e9">OpenID Connect 协议入门指南</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cgzl/p/9231219.html">Identity Server 4 预备知识 – OpenID Connect 简介</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cgzl/p/9221488.html">Identity Server 4 预备知识 – OAuth 2.0 简介</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/linianhui/p/openid-connect-core.html">[认证授权] 4.OIDC（OpenId Connect）身份认证（核心部分）</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/18/RESTful-API-%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/18/RESTful-API-%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">RESTful API 设计与实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-18 13:51:49" itemprop="dateCreated datePublished" datetime="2019-03-18T13:51:49+00:00">2019-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/RESTful/" itemprop="url" rel="index"><span itemprop="name">RESTful</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RESTful-API-设计与实践"><a href="#RESTful-API-设计与实践" class="headerlink" title="RESTful API 设计与实践"></a>RESTful API 设计与实践</h1><h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p>API与用户的通信协议，总是使用HTTPs协议。</p>
<h2 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h2><p>应该尽量将API部署在专用域名之下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.example.com</span><br></pre></td></tr></table></figure>

<p>如果确定API很简单，不会有进一步扩展，可以考虑放在主域名下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://example.org/api/</span><br></pre></td></tr></table></figure>

<h2 id="版本（Versioning）"><a href="#版本（Versioning）" class="headerlink" title="版本（Versioning）"></a>版本（Versioning）</h2><p>应该将API的版本号放入URL。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.example.com/v1/</span><br></pre></td></tr></table></figure>

<p>另一种做法是，将版本号放在HTTP头信息中，但不如放入URL方便和直观。</p>
<h2 id="路径（Endpoint）"><a href="#路径（Endpoint）" class="headerlink" title="路径（Endpoint）"></a>路径（Endpoint）</h2><p>路径又称”终点”（endpoint），表示API的具体网址。</p>
<p>在RESTful架构中，每个网址代表一种资源（resource），所以网址中不能有动词，只能有名词，而且所用的名词往往与数据库的表格名对应。一般来说，数据库中的表都是同种记录的”集合”（collection），所以API中的名词也应该使用复数。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://api.example.com/v1/zoos</span><br><span class="line">https://api.example.com/v1/animals</span><br><span class="line">https://api.example.com/v1/employees</span><br></pre></td></tr></table></figure>

<h2 id="HTTP动词"><a href="#HTTP动词" class="headerlink" title="HTTP动词"></a>HTTP动词</h2><p>对于资源的具体操作类型，由HTTP动词表示。</p>
<p>常用的HTTP动词有下面五个（括号里是对应的SQL命令）。</p>
<p>根据 HTTP 规范，动词一律大写。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET（SELECT）：读取（Read）</span><br><span class="line">POST（CREATE）：新建（Create）</span><br><span class="line">PUT（UPDATE）：更新（Update）</span><br><span class="line">PATCH（UPDATE）：更新（Update），通常是部分更新</span><br><span class="line">DELETE（DELETE）：删除（Delete）</span><br></pre></td></tr></table></figure>

<p>还有两个不常用的HTTP动词。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HEAD：获取资源的元数据。</span><br><span class="line">OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /zoos：列出所有动物园</span><br><span class="line">POST /zoos：新建一个动物园</span><br><span class="line">GET /zoos/ID：获取某个指定动物园的信息</span><br><span class="line">PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息）</span><br><span class="line">PATCH /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）</span><br><span class="line">DELETE /zoos/ID：删除某个动物园</span><br><span class="line">GET /zoos/ID/animals：列出某个指定动物园的所有动物</span><br><span class="line">DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物</span><br></pre></td></tr></table></figure>

<h2 id="URL-设计"><a href="#URL-设计" class="headerlink" title="URL 设计"></a>URL 设计</h2><h3 id="动词-宾语"><a href="#动词-宾语" class="headerlink" title="动词 + 宾语"></a>动词 + 宾语</h3><p>RESTful 的核心思想就是，客户端发出的数据操作指令都是”动词 + 宾语”的结构。比如，<code>GET/articles</code>这个命令，<code>GET</code>是动词，<code>/articles</code>是宾语。</p>
<h3 id="动词的覆盖"><a href="#动词的覆盖" class="headerlink" title="动词的覆盖"></a>动词的覆盖</h3><p>有些客户端只能使用<code>GET</code>和<code>POST</code>这两种方法。服务器必须接受<code>POST</code>模拟其他三个方法（<code>PUT</code>、<code>PATCH</code>、<code>DELETE</code>）。</p>
<p>这时，客户端发出的 HTTP 请求，要加上<code>X-HTTP-Method-Override</code>属性，告诉服务器应该使用哪一个动词，覆盖<code>POST</code>方法。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/Person/4 HTTP/1.1  </span><br><span class="line">X-HTTP-Method-Override: PUT</span><br></pre></td></tr></table></figure>

<p><code>X-HTTP-Method-Override</code>指定本次请求的方法是<code>PUT</code>，而不是<code>POST</code>。</p>
<h3 id="宾语必须是名词"><a href="#宾语必须是名词" class="headerlink" title="宾语必须是名词"></a>宾语必须是名词</h3><p>宾语就是 API 的 URL，是 HTTP 动词作用的对象。它应该是名词，不能是动词。比如，/articles这个 URL 就是正确的。</p>
<p><code>/getAllCars</code> 是错误的。</p>
<h3 id="复数-URL"><a href="#复数-URL" class="headerlink" title="复数 URL"></a>复数 URL</h3><p>建议都使用复数 URL，比如<code>GET/articles/2</code>要好于<code>GET/article/2</code>。</p>
<h3 id="避免多级-URL"><a href="#避免多级-URL" class="headerlink" title="避免多级 URL"></a>避免多级 URL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// URL 不利于扩展，语义也不明确</span><br><span class="line">GET /authors/12/categories/2</span><br><span class="line"></span><br><span class="line">// 更好的写法</span><br><span class="line">GET /authors/12?categories=2</span><br></pre></td></tr></table></figure>

<h2 id="过滤信息（Filtering）"><a href="#过滤信息（Filtering）" class="headerlink" title="过滤信息（Filtering）"></a>过滤信息（Filtering）</h2><p>如果记录数量很多，服务器不可能都将它们返回给用户。API应该提供参数，过滤返回结果。</p>
<p>下面是一些常见的参数：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?limit=10：指定返回记录的数量</span><br><span class="line">?offset=10：指定返回记录的开始位置。</span><br><span class="line">?page=2&amp;per_page=100：指定第几页，以及每页的记录数。</span><br><span class="line">?sortby=name&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序。</span><br><span class="line">?animal_type_id=1：指定筛选条件</span><br></pre></td></tr></table></figure>

<p>参数的设计允许存在冗余，即允许API路径和URL参数偶尔有重复。比如，<code>GET /zoo/ID/animals</code> 与 <code>GET /animals?zoo_id=ID</code> 的含义是相同的。</p>
<h2 id="状态码（Status-Codes）"><a href="#状态码（Status-Codes）" class="headerlink" title="状态码（Status Codes）"></a>状态码（Status Codes）</h2><h3 id="状态码必须精确"><a href="#状态码必须精确" class="headerlink" title="状态码必须精确"></a>状态码必须精确</h3><p>客户端的每一次请求，服务器都必须给出回应。回应包括 HTTP 状态码和数据两部分。</p>
<p>HTTP 状态码就是一个三位数，分成五个类别。API 不需要1xx状态码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1xx：相关信息</span><br><span class="line">2xx：操作成功</span><br><span class="line">3xx：重定向</span><br><span class="line">4xx：客户端错误</span><br><span class="line">5xx：服务器错误</span><br></pre></td></tr></table></figure>

<p>详细请参考：<a target="_blank" rel="noopener" href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">www.w3.org</a></p>
<h3 id="2xx-状态码"><a href="#2xx-状态码" class="headerlink" title="2xx 状态码"></a>2xx 状态码</h3><p>200状态码表示操作成功，但是不同的方法可以返回更精确的状态码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET: 200 OK</span><br><span class="line">POST: 201 Created</span><br><span class="line">PUT: 200 OK</span><br><span class="line">PATCH: 200 OK</span><br><span class="line">DELETE: 204 No Content</span><br></pre></td></tr></table></figure>

<p><code>POST</code>返回201状态码，表示生成了新的资源；<code>DELETE</code>返回204状态码，表示资源已经不存在。</p>
<p><code>202 Accepted</code>状态码表示服务器已经收到请求，但还未进行处理，会在未来再处理，通常用于异步操作。</p>
<h3 id="3xx-状态码"><a href="#3xx-状态码" class="headerlink" title="3xx 状态码"></a>3xx 状态码</h3><p>API 用不到<code>301</code>状态码（永久重定向）和<code>302</code>状态码（暂时重定向，307也是这个含义），因为它们可以由应用级别返回，浏览器会直接跳转，API 级别可以不考虑这两种情况。</p>
<p>API 用到的<code>3xx</code>状态码，主要是<code>303 See Other</code>，表示参考另一个 URL。它与<code>302</code>和<code>307</code>的含义一样，也是”暂时重定向”，区别在于<code>302</code>和<code>307</code>用于<code>GET</code>请求，而<code>303</code>用于<code>POST</code>、<code>PUT</code>和<code>DELETE</code>请求。收到<code>303</code>以后，浏览器不会自动跳转，而会让用户自己决定下一步怎么办。下面是一个例子。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 303 See Other</span><br><span class="line">Location: /api/orders/12345</span><br></pre></td></tr></table></figure>

<h3 id="4xx-状态码"><a href="#4xx-状态码" class="headerlink" title="4xx 状态码"></a>4xx 状态码</h3><p>4xx状态码表示客户端错误，主要有下面几种。</p>
<p><strong>400 Bad Request</strong>：服务器不理解客户端的请求，未做任何处理。</p>
<p><strong>401 Unauthorized</strong>：用户未提供身份验证凭据，或者没有通过身份验证。</p>
<p><strong>403 Forbidden</strong>：用户通过了身份验证，但是不具有访问资源所需的权限。</p>
<p><strong>404 Not Found</strong>：所请求的资源不存在，或不可用。</p>
<p><strong>405 Method Not Allowed</strong>：用户已经通过身份验证，但是所用的 HTTP 方法不在他的权限之内。</p>
<p><strong>410 Gone</strong>：所请求的资源已从这个地址转移，不再可用。</p>
<p><strong>415 Unsupported Media Type</strong>：客户端要求的返回格式不支持。比如，API 只能返回 JSON 格式，但是客户端要求返回 XML 格式。</p>
<p><strong>422 Unprocessable Entity</strong>：客户端上传的附件无法处理，导致请求失败。</p>
<p><strong>429 Too Many Requests</strong>：客户端的请求次数超过限额。</p>
<h3 id="5xx-状态码"><a href="#5xx-状态码" class="headerlink" title="5xx 状态码"></a>5xx 状态码</h3><p>`5xx状态码表示服务端错误。一般来说，API 不会向用户透露服务器的详细信息，所以只要两个状态码就够了。</p>
<p><strong>500 Internal Server Error</strong>：客户端请求有效，服务器处理时发生了意外。</p>
<p><strong>503 Service Unavailable</strong>：服务器无法处理请求，一般用于网站维护状态。</p>
<h2 id="服务器回应"><a href="#服务器回应" class="headerlink" title="服务器回应"></a>服务器回应</h2><h3 id="不要返回纯本文"><a href="#不要返回纯本文" class="headerlink" title="不要返回纯本文"></a>不要返回纯本文</h3><p>API 返回的数据格式，不应该是纯文本，而应该是一个 JSON 对象，因为这样才能返回标准的结构化数据。所以，服务器回应的 HTTP 头的<code>Content-Type</code>属性要设为<code>application/json</code>。</p>
<p>客户端请求时，也要明确告诉服务器，可以接受 JSON 格式，即请求的 HTTP 头的<code>ACCEPT</code>属性也要设成<code>application/json</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /orders/2 HTTP/1.1 </span><br><span class="line">Accept: application/json</span><br></pre></td></tr></table></figure>

<h3 id="错误处理（Error-handling）"><a href="#错误处理（Error-handling）" class="headerlink" title="错误处理（Error handling）"></a>错误处理（Error handling）</h3><p>发生错误时，不要返回 200 状态码，状态码反映发生的错误，具体的错误信息放在数据体里面返回。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 400 Bad Request</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;error&quot;: &quot;Invalid payoad.&quot;,</span><br><span class="line">  &quot;detail&quot;: &#123;</span><br><span class="line">     &quot;surname&quot;: &quot;This field is required.&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h3><p>针对不同操作，服务器向用户返回的结果应该符合以下规范。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /collection：返回资源对象的列表（数组）</span><br><span class="line">GET /collection/resource：返回单个资源对象</span><br><span class="line">POST /collection：返回新生成的资源对象</span><br><span class="line">PUT /collection/resource：返回完整的资源对象</span><br><span class="line">PATCH /collection/resource：返回完整的资源对象</span><br><span class="line">DELETE /collection/resource：返回一个空文档</span><br></pre></td></tr></table></figure>

<h3 id="Hypermedia-API"><a href="#Hypermedia-API" class="headerlink" title="Hypermedia API"></a>Hypermedia API</h3><p>RESTful API最好做到Hypermedia，即返回结果中提供链接，连向其他API方法。</p>
<p>Hypermedia API的设计被称为HATEOAS。</p>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;link&quot;: &#123;</span><br><span class="line">  &quot;rel&quot;:   &quot;collection https://www.example.com/zoos&quot;,</span><br><span class="line">  &quot;href&quot;:  &quot;https://api.example.com/zoos&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;List of zoos&quot;,</span><br><span class="line">  &quot;type&quot;:  &quot;application/vnd.yourformat+json&quot;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/10/restful-api-best-practices.html">RESTful API 最佳实践</a></p>
<p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html">RESTful API 设计指南</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/18/RESTful%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/18/RESTful%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">RESTful架构学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-18 13:40:56" itemprop="dateCreated datePublished" datetime="2019-03-18T13:40:56+00:00">2019-03-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/RESTful/" itemprop="url" rel="index"><span itemprop="name">RESTful</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>834</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RESTful架构学习笔记"><a href="#RESTful架构学习笔记" class="headerlink" title="RESTful架构学习笔记"></a>RESTful架构学习笔记</h1><p>REST架构原则: Representational State Transfer的缩写。翻译是”表现层状态转化”。<br>全称：Resources Representational State Transfer,即资源表现层状态转化。</p>
<p>如果一个架构符合REST原则，就称它为RESTful架构。</p>
<h2 id="资源（Resources）"><a href="#资源（Resources）" class="headerlink" title="资源（Resources）"></a>资源（Resources）</h2><p>所谓”资源”，就是网络上的一个实体，或者说是网络上的一个具体信息。它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的实在。你可以用一个URI（统一资源定位符）指向它，每种资源对应一个特定的URI。要获取这个资源，访问它的URI就可以，因此URI就成了每一个资源的地址或独一无二的识别符。</p>
<h2 id="表现层（Representation）"><a href="#表现层（Representation）" class="headerlink" title="表现层（Representation）"></a>表现层（Representation）</h2><p>“资源”是一种信息实体，它可以有多种外在表现形式。我们把”资源”具体呈现出来的形式，叫做它的”表现层”（Representation）。</p>
<h2 id="状态转化（State-Transfer）"><a href="#状态转化（State-Transfer）" class="headerlink" title="状态转化（State Transfer）"></a>状态转化（State Transfer）</h2><p>访问一个网站，就代表了客户端和服务器的一个互动过程。在这个过程中，势必涉及到数据和状态的变化。</p>
<p>互联网通信协议HTTP协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生”状态转化”（State Transfer）。而这种转化是建立在表现层之上的，所以就是”表现层状态转化”。</p>
<p>客户端用到的手段，只能是HTTP协议。具体来说，就是HTTP协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。它们分别对应四种基本操作：GET用来获取资源，POST用来新建资源（也可以用于更新资源），PUT用来更新资源，DELETE用来删除资源。</p>
<h2 id="RESTful架构"><a href="#RESTful架构" class="headerlink" title="RESTful架构"></a>RESTful架构</h2><p>（1）每一个URI代表一种资源；</p>
<p>（2）客户端和服务器之间，传递这种资源的某种表现层；</p>
<p>（3）客户端通过四个HTTP动词，对服务器端资源进行操作，实现”表现层状态转化”。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2011/09/restful.html">理解RESTful架构</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/17/OAuth-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/17/OAuth-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">OAuth 2.0学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-17 17:31:35" itemprop="dateCreated datePublished" datetime="2019-03-17T17:31:35+00:00">2019-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OAuth2-0/" itemprop="url" rel="index"><span itemprop="name">OAuth2.0</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="OAuth-2-0学习笔记"><a href="#OAuth-2-0学习笔记" class="headerlink" title="OAuth 2.0学习笔记"></a>OAuth 2.0学习笔记</h1><p><font color=#ff0000 size=4 face="黑体">OAuth的作用就是让”客户端”安全可控地获取”用户”的授权，与”服务商提供商”进行互动。</font></p>
<p>OAuth在”客户端”与”服务提供商”之间，设置了一个授权层（authorization layer）。”客户端”不能直接登录”服务提供商”，只能登录授权层，以此将用户与客户端区分开来。”客户端”登录授权层所用的令牌（token），与用户的密码不同。用户可以在登录的时候，指定授权层令牌的权限范围和有效期。</p>
<p>“客户端”登录授权层以后，”服务提供商”根据令牌的权限范围和有效期，向”客户端”开放用户储存的资料。</p>
<p>Authentication: 证明；鉴定<br>Authorization: 授权，认可；批准，委任</p>
<h2 id="名词定义"><a href="#名词定义" class="headerlink" title="名词定义"></a>名词定义</h2><p><strong>client 或 Third-party application</strong> ：第三方应用程序，又称”客户端”（client）。</p>
<p><strong>HTTP service</strong>：HTTP服务提供商，简称”服务提供商”。</p>
<p><strong>Resource Owner</strong>：资源所有者，又称”用户”（user）。</p>
<p><strong>User Agent</strong>：用户代理，本文中就是指浏览器。</p>
<p><strong>Authorization server</strong>：认证服务器，即服务提供商专门用来处理认证的服务器。</p>
<p><strong>Resource server</strong>：资源服务器，即服务提供商存放用户生成的资源的服务器。它与认证服务器，可以是同一台服务器，也可以是不同的服务器。</p>
<h2 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h2><p><img src="/img/bg2014051203.png" alt="bg2014051203.png"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">（A）用户打开客户端以后，客户端要求用户给予授权。</span><br><span class="line"></span><br><span class="line">（B）用户同意给予客户端授权。</span><br><span class="line"></span><br><span class="line">（C）客户端使用上一步获得的授权，向认证服务器申请令牌。</span><br><span class="line"></span><br><span class="line">（D）认证服务器对客户端进行认证以后，确认无误，同意发放令牌。</span><br><span class="line"></span><br><span class="line">（E）客户端使用令牌，向资源服务器申请获取资源。</span><br><span class="line"></span><br><span class="line">（F）资源服务器确认令牌无误，同意向客户端开放资源。</span><br></pre></td></tr></table></figure>

<p>其中，B阶段，对客户端授权是关键。有了这个授权以后，客户端就可以获取令牌，进而凭令牌获取资源。</p>
<h2 id="获取授权的四种模式"><a href="#获取授权的四种模式" class="headerlink" title="获取授权的四种模式"></a>获取授权的四种模式</h2><p>客户端必须得到用户的授权（authorization grant），才能获得令牌（access token）。OAuth 2.0定义了四种授权方式。</p>
<ul>
<li>授权码模式（authorization code）</li>
<li>简化模式（implicit）</li>
<li>密码模式（resource owner password credentials）</li>
<li>客户端模式（client credentials）</li>
</ul>
<h3 id="授权码模式（authorization-code）"><a href="#授权码模式（authorization-code）" class="headerlink" title="授权码模式（authorization code）"></a>授权码模式（authorization code）</h3><p>授权码模式（authorization code）是功能最完整、流程最严密的授权模式。它的特点就是通过客户端的后台服务器，与”服务提供商”的认证服务器进行互动。例如，微信登录。</p>
<p>注：相关参数使用JSON格式发送（Content-Type: application/json）。此外，HTTP头信息中明确指定不得缓存。</p>
<p><img src="/img/bg2014051204.png" alt="bg2014051204.png"></p>
<p>具体步骤：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">（A）用户访问客户端，后者将前者导向认证服务器。</span><br><span class="line"></span><br><span class="line">（B）用户选择是否给予客户端授权。</span><br><span class="line"></span><br><span class="line">（C）假设用户给予授权，认证服务器将用户导向客户端事先指定的&quot;重定向URI&quot;（redirection URI），</span><br><span class="line">同时附上一个授权码。</span><br><span class="line"></span><br><span class="line">（D）客户端收到授权码，附上早先的&quot;重定向URI&quot;，向认证服务器申请令牌。这一步是在客户端的后台</span><br><span class="line">的服务器上完成的，对用户不可见。</span><br><span class="line"></span><br><span class="line">（E）认证服务器核对了授权码和重定向URI，确认无误后，向客户端发送访问令牌（access token）</span><br><span class="line">和更新令牌（refresh token）。</span><br></pre></td></tr></table></figure>

<p>A步骤中，客户端申请认证的URI，包含以下参数：</p>
<ul>
<li>response_type：表示授权类型，必选项，此处的值固定为”code”</li>
<li>client_id：表示客户端的ID，必选项</li>
<li>redirect_uri：表示重定向URI，可选项</li>
<li>scope：表示申请的权限范围，可选项</li>
<li>state：表示客户端的当前状态，可以指定任意值，认证服务器会原封不动地返回这个值。</li>
</ul>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=xyz</span><br><span class="line">        &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br></pre></td></tr></table></figure>

<p>B步骤中，用户动作选择是否给客户端授权，例如微信扫码之后确认登录动作等。</p>
<p>C步骤中，服务器回应客户端的URI，包含以下参数：</p>
<ul>
<li>code：表示授权码，必选项。该码的有效期应该很短，通常设为10分钟，客户端只能使用该码一次，否则会被授权服务器拒绝。该码与客户端ID和重定向URI，是一一对应关系。</li>
<li>state：如果客户端的请求中包含这个参数，认证服务器的回应也必须一模一样包含这个参数。</li>
</ul>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA</span><br><span class="line">          &amp;state=xyz</span><br></pre></td></tr></table></figure>

<p>D步骤中，客户端向认证服务器申请令牌的HTTP请求，包含以下参数：</p>
<ul>
<li>grant_type：表示使用的授权模式，必选项，此处的值固定为”authorization_code”。</li>
<li>code：表示上一步获得的授权码，必选项。</li>
<li>redirect_uri：表示重定向URI，必选项，且必须与A步骤中的该参数值保持一致。</li>
<li>client_id：表示客户端ID，必选项。</li>
</ul>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /token HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=authorization_code&amp;code=SplxlOBeZQQYbYS6WxSbIA</span><br><span class="line">&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb</span><br></pre></td></tr></table></figure>

<p>E步骤中，认证服务器发送的HTTP回复，包含以下参数：</p>
<ul>
<li>access_token：表示访问令牌，必选项。</li>
<li>token_type：表示令牌类型，该值大小写不敏感，必选项，可以是bearer类型或mac类型。</li>
<li>expires_in：表示过期时间，单位为秒。如果省略该参数，必须其他方式设置过期时间。</li>
<li>refresh_token：表示更新令牌，用来获取下一次的访问令牌，可选项。</li>
<li>scope：表示权限范围，如果与客户端申请的范围一致，此项可省略。</li>
</ul>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Cache-Control: no-store</span><br><span class="line">Pragma: no-cache</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;access_token&quot;:&quot;2YotnFZFEjr1zCsicMWpAA&quot;,</span><br><span class="line">  &quot;token_type&quot;:&quot;example&quot;,</span><br><span class="line">  &quot;expires_in&quot;:3600,</span><br><span class="line">  &quot;refresh_token&quot;:&quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;,</span><br><span class="line">  &quot;example_parameter&quot;:&quot;example_value&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="简化模式"><a href="#简化模式" class="headerlink" title="简化模式"></a>简化模式</h3><p>简化模式（implicit grant type）不通过第三方应用程序的服务器，直接在浏览器中向认证服务器申请令牌，跳过了”授权码”这个步骤，因此得名。所有步骤在浏览器中完成，令牌对访问者是可见的，且客户端不需要认证。</p>
<p><img src="/img/bg2014051205.png" alt="bg2014051205.png"></p>
<p>运行流程如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">（A）客户端将用户导向认证服务器。</span><br><span class="line"></span><br><span class="line">（B）用户决定是否给于客户端授权。</span><br><span class="line"></span><br><span class="line">（C）假设用户给予授权，认证服务器将用户导向客户端指定的&quot;重定向URI&quot;，</span><br><span class="line">     并在URI的Hash部分包含了访问令牌。</span><br><span class="line"></span><br><span class="line">（D）浏览器向资源服务器发出请求，其中不包括上一步收到的Hash值。</span><br><span class="line"></span><br><span class="line">（E）资源服务器返回一个网页，其中包含的代码可以获取Hash值中的令牌。</span><br><span class="line"></span><br><span class="line">（F）浏览器执行上一步获得的脚本，提取出令牌。</span><br><span class="line"></span><br><span class="line">（G）浏览器将令牌发给客户端。</span><br></pre></td></tr></table></figure>

<p>A步骤中，客户端发出的HTTP请求，包含以下参数：</p>
<ul>
<li>response_type：表示授权类型，此处的值固定为”token”，必选项。</li>
<li>client_id：表示客户端的ID，必选项。</li>
<li>redirect_uri：表示重定向的URI，可选项。</li>
<li>scope：表示权限范围，可选项。</li>
<li>state：表示客户端的当前状态，可以指定任意值，认证服务器会原封不动地返回这个值。</li>
</ul>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /authorize?response_type=token&amp;client_id=s6BhdRkqt3&amp;state=xyz</span><br><span class="line">    &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br></pre></td></tr></table></figure>

<p>C步骤中，认证服务器回应客户端的URI，包含以下参数：</p>
<ul>
<li>access_token：表示访问令牌，必选项。</li>
<li>token_type：表示令牌类型，该值大小写不敏感，必选项。</li>
<li>expires_in：表示过期时间，单位为秒。如果省略该参数，必须其他方式设置过期时间。</li>
<li>scope：表示权限范围，如果与客户端申请的范围一致，此项可省略。</li>
<li>state：如果客户端的请求中包含这个参数，认证服务器的回应也必须一模一样包含这个参数。</li>
</ul>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Location: http://example.com/cb#access_token=2YotnFZFEjr1zCsicMWpAA</span><br><span class="line">          &amp;state=xyz&amp;token_type=example&amp;expires_in=3600</span><br></pre></td></tr></table></figure>

<p>在上面的例子中，认证服务器用HTTP头信息的Location栏，指定浏览器重定向的网址。注意，在这个网址的Hash部分包含了令牌。</p>
<p>根据上面的D步骤，下一步浏览器会访问Location指定的网址，但是Hash部分不会发送。接下来的E步骤，服务提供商的资源服务器发送过来的代码，会提取出Hash中的令牌。</p>
<h3 id="密码模式"><a href="#密码模式" class="headerlink" title="密码模式"></a>密码模式</h3><p>密码模式（Resource Owner Password Credentials Grant）中，用户向客户端提供自己的用户名和密码。客户端使用这些信息，向”服务商提供商”索要授权。</p>
<p>在这种模式中，用户必须把自己的密码给客户端，但是客户端不得储存密码。这通常用在用户对客户端高度信任的情况下，比如客户端是操作系统的一部分，或者由一个著名公司出品。而认证服务器只有在其他授权模式无法执行的情况下，才能考虑使用这种模式。</p>
<p><img src="/img/bg2014051206.png" alt="bg2014051206.png"></p>
<p>具体步骤：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">（A）用户向客户端提供用户名和密码。</span><br><span class="line"></span><br><span class="line">（B）客户端将用户名和密码发给认证服务器，向后者请求令牌。</span><br><span class="line"></span><br><span class="line">（C）认证服务器确认无误后，向客户端提供访问令牌。</span><br></pre></td></tr></table></figure>

<p>B步骤中，客户端发出的HTTP请求，包含以下参数：</p>
<ul>
<li>grant_type：表示授权类型，此处的值固定为”password”，必选项。</li>
<li>username：表示用户名，必选项。</li>
<li>password：表示用户的密码，必选项。</li>
<li>scope：表示权限范围，可选项。</li>
</ul>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /token HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=password&amp;username=johndoe&amp;password=A3ddj3w</span><br></pre></td></tr></table></figure>

<p>C步骤中，认证服务器向客户端发送访问令牌。如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Cache-Control: no-store</span><br><span class="line">Pragma: no-cache</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;access_token&quot;:&quot;2YotnFZFEjr1zCsicMWpAA&quot;,</span><br><span class="line">  &quot;token_type&quot;:&quot;example&quot;,</span><br><span class="line">  &quot;expires_in&quot;:3600,</span><br><span class="line">  &quot;refresh_token&quot;:&quot;tGzv3JOkF0XG5Qx2TlKWIA&quot;,</span><br><span class="line">  &quot;example_parameter&quot;:&quot;example_value&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>整个过程中，客户端不得保存用户的密码。</p>
<h3 id="客户端模式"><a href="#客户端模式" class="headerlink" title="客户端模式"></a>客户端模式</h3><p>客户端模式（Client Credentials Grant）指客户端以自己的名义，而不是以用户的名义，向”服务提供商”进行认证。严格地说，客户端模式并不属于OAuth框架所要解决的问题。在这种模式中，用户直接向客户端注册，客户端以自己的名义要求”服务提供商”提供服务，其实不存在授权问题。</p>
<p><img src="/img/bg2014051207.png" alt="bg2014051207.png"></p>
<p>具体步骤：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">（A）客户端向认证服务器进行身份认证，并要求一个访问令牌。</span><br><span class="line"></span><br><span class="line">（B）认证服务器确认无误后，向客户端提供访问令牌。</span><br></pre></td></tr></table></figure>

<p>A步骤中，客户端发出的HTTP请求，包含以下参数：</p>
<p>granttype：表示授权类型，此处的值固定为”clientcredentials”，必选项。<br>scope：表示权限范围，可选项。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /token HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=client_credentials</span><br></pre></td></tr></table></figure>

<p>认证服务器必须以某种方式，验证客户端身份。</p>
<p>B步骤中，认证服务器向客户端发送访问令牌，下面是一个例子。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Cache-Control: no-store</span><br><span class="line">Pragma: no-cache</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;access_token&quot;:&quot;2YotnFZFEjr1zCsicMWpAA&quot;,</span><br><span class="line">  &quot;token_type&quot;:&quot;example&quot;,</span><br><span class="line">  &quot;expires_in&quot;:3600,</span><br><span class="line">  &quot;example_parameter&quot;:&quot;example_value&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="更新令牌"><a href="#更新令牌" class="headerlink" title="更新令牌"></a>更新令牌</h2><p>如果用户访问的时候，客户端的”访问令牌”已经过期，则需要使用”更新令牌”申请一个新的访问令牌。</p>
<p>客户端发出更新令牌的HTTP请求，包含以下参数：</p>
<ul>
<li>granttype：表示使用的授权模式，此处的值固定为”refreshtoken”，必选项。</li>
<li>refresh_token：表示早前收到的更新令牌，必选项。</li>
<li>scope：表示申请的授权范围，不可以超出上一次申请的范围，如果省略该参数，则表示与上一次一致。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /token HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=refresh_token&amp;refresh_token=tGzv3JOkF0XG5Qx2TlKWIA</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">理解OAuth 2.0</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/xishuai/p/identityserver4-implement-openid-connect-and-oauth2.html">IdentityServer4 实现 OpenID Connect 和 OAuth 2.0</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/16/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8BGrouping%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/16/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8BGrouping%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">Sql-Server基础之Grouping用法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-16 14:51:00" itemprop="dateCreated datePublished" datetime="2019-03-16T14:51:00+00:00">2019-03-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sql/" itemprop="url" rel="index"><span itemprop="name">Sql</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>919</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Sql-Server基础之Grouping用法"><a href="#Sql-Server基础之Grouping用法" class="headerlink" title="Sql-Server基础之Grouping用法"></a>Sql-Server基础之Grouping用法</h1><p><code>GROUPING</code> 是一个聚合函数，用在含有 <code>CUBE</code> 或 <code>ROLLUP</code> 语句的SQL语句中，当结果集中的数据行是由 <code>CUBE</code> 或 <code>ROLLUP</code> 运算产生的（添加的）则该函数返回1，否则返回0。</p>
<p>语法： <code>GROUPING(column_name)</code></p>
<p>其中 <code>column_name</code> 是用在 <code>CUBE</code> 或 <code>ROLLUP</code> 运算的列 或 <code>group by</code> 后的列。</p>
<p>注意：</p>
<ul>
<li>（1）只有使用了 <code>CUBE</code> 或 <code>ROLLUP</code> 运算符的SQL中才能使用 <code>GROUPING</code></li>
<li>（2）<code>GROUPING</code> 后面的列 名可以是 <code>CUBE</code> 或 <code>ROLLUP</code> 运算符中使用的列名，也可以是 <code>group by</code> 中的列名</li>
</ul>
<p>CUBE 生成的结果集显示了所选列中值的所有组合的聚合。<br>ROLLUP 生成的结果集显示了所选列中值的某一层次结构的聚合。</p>
<p>** CUBE**</p>
<p><code>CUBE</code> 生成的结果集显示了所选列中值的所有组合的聚合。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CourseID,StudentID,<span class="built_in">SUM</span>(Score) <span class="keyword">FROM</span> [dbo].[Score] </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> CourseID,StudentID <span class="keyword">WITH</span> <span class="keyword">CUBE</span></span><br></pre></td></tr></table></figure>

<p>结果：<br><img src="/img/QQ%E6%88%AA%E5%9B%BE20190316155035.png" alt="QQ截图20190316155035.png"></p>
<p>** ROLLUP**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> StudentID,CourseID,<span class="built_in">SUM</span>(Score)  <span class="keyword">FROM</span> [dbo].[Score] </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> StudentID,CourseID <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span></span><br></pre></td></tr></table></figure>

<p>结果：<br><img src="/img/QQ%E6%88%AA%E5%9B%BE20190316160822.png" alt="QQ截图20190316160822.png"></p>
<p>** GROUPING**</p>
<p>获取每个学生成绩的总和。以下示例结果相同</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> StudentID,CourseID,<span class="built_in">SUM</span>(Score),<span class="keyword">grouping</span>(CourseID) <span class="keyword">FROM</span> [dbo].[Score] </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> StudentID,CourseID <span class="keyword">WITH</span> <span class="keyword">CUBE</span> <span class="keyword">HAVING</span> <span class="keyword">grouping</span>(CourseID)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>结果：<br><img src="/img/QQ%E6%88%AA%E5%9B%BE20190316161849.png" alt="QQ截图20190316161849.png"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> StudentID,CourseID,<span class="built_in">SUM</span>(Score),<span class="keyword">grouping</span>(CourseID)  <span class="keyword">FROM</span> [dbo].[Score] </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> StudentID,CourseID <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span> <span class="keyword">HAVING</span> <span class="keyword">grouping</span>(CourseID)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>结果：<br><img src="/img/QQ%E6%88%AA%E5%9B%BE20190316162226.png" alt="QQ截图20190316162226.png"></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shuangnet/archive/2013/03/26/2982144.html">Sql学习第四天——SQL 关于with cube ，with rollup 和 grouping</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dyufei/archive/2009/11/12/2573973.html">GROUPING 用法</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/15/SQL-Server%E8%BF%9E%E6%8E%A5%EF%BC%88%E5%86%85%E8%BF%9E%E6%8E%A5%E3%80%81%E5%A4%96%E8%BF%9E%E6%8E%A5%E3%80%81%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/15/SQL-Server%E8%BF%9E%E6%8E%A5%EF%BC%88%E5%86%85%E8%BF%9E%E6%8E%A5%E3%80%81%E5%A4%96%E8%BF%9E%E6%8E%A5%E3%80%81%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5%EF%BC%89/" class="post-title-link" itemprop="url">SQL Server连接（内连接、外连接、交叉连接）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-15 08:25:19" itemprop="dateCreated datePublished" datetime="2019-03-15T08:25:19+00:00">2019-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sql/" itemprop="url" rel="index"><span itemprop="name">Sql</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>SQL Server连接（内连接、外连接、交叉连接）</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/03/15/SQL-Server%E8%BF%9E%E6%8E%A5%EF%BC%88%E5%86%85%E8%BF%9E%E6%8E%A5%E3%80%81%E5%A4%96%E8%BF%9E%E6%8E%A5%E3%80%81%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5%EF%BC%89/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/14/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%B8%B8%E7%94%A8sql%E5%AE%9E%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/14/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%B8%B8%E7%94%A8sql%E5%AE%9E%E4%BE%8B/" class="post-title-link" itemprop="url">Sql-Server基础之常用sql实例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-14 16:03:28" itemprop="dateCreated datePublished" datetime="2019-03-14T16:03:28+00:00">2019-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sql/" itemprop="url" rel="index"><span itemprop="name">Sql</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Sql-Server常用sql实例总结</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/03/14/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%B8%B8%E7%94%A8sql%E5%AE%9E%E4%BE%8B/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/14/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%88%86%E9%A1%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/14/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%88%86%E9%A1%B5/" class="post-title-link" itemprop="url">Sql-Server基础之分页</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-14 10:41:55" itemprop="dateCreated datePublished" datetime="2019-03-14T10:41:55+00:00">2019-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sql/" itemprop="url" rel="index"><span itemprop="name">Sql</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Sql-Server分页方法总结</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/03/14/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%88%86%E9%A1%B5/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/14/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8BSql%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/14/Sql-Server%E5%9F%BA%E7%A1%80%E4%B9%8BSql%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">Sql Server基础之Sql基础语法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-14 08:45:54" itemprop="dateCreated datePublished" datetime="2019-03-14T08:45:54+00:00">2019-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Sql/" itemprop="url" rel="index"><span itemprop="name">Sql</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><font color=#ff0000 size=4 face="黑体">Sql： Structured Query Language</font></p>
<p><strong>Sql server的组成</strong></p>
<ul>
<li>主要数据库文件：.mdf 特点：有且只有一个</li>
<li>次要数据库文件：.ndf 特点：任意个</li>
<li>日志数据库文件：.ldf 特点：至少一个</li>
</ul>
<p><strong>操作数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">创建数据库：<span class="keyword">create</span> databse 库名</span><br><span class="line">查看所有数据库：<span class="keyword">exec</span> sp_helpdb</span><br><span class="line">查看当前数据库：<span class="keyword">exec</span> sp_helpdb 库名</span><br><span class="line">使用数据库：use 库名</span><br><span class="line">删除数据库：<span class="keyword">drop</span> database 库名 ps:正在使用的数据库无法删除</span><br></pre></td></tr></table></figure>

<h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [Student] (</span><br><span class="line">  [ID] <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY AUTOINCREMENT,</span><br><span class="line">  [Name] NVARCHAR(<span class="number">20</span>),</span><br><span class="line">  [Age] <span class="type">INT</span>,</span><br><span class="line">  [Sex] <span class="type">INT</span>);</span><br></pre></td></tr></table></figure>

<h3 id="查看所有表"><a href="#查看所有表" class="headerlink" title="查看所有表"></a>查看所有表</h3><p><code>exec sp_help</code></p>
<h3 id="查看当前表"><a href="#查看当前表" class="headerlink" title="查看当前表"></a>查看当前表</h3><p><code>exec sp_help 表名</code></p>
<h3 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1,增加一列语法</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> 字段名 数据类型</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2,修改一列语法</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">alter</span> <span class="keyword">column</span> 字段名 数据类型</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3,删除一列语法</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">column</span> 字段名</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4,删除表语法</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 表名 (有日志)</span><br><span class="line"></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名称（没有日志）</span><br></pre></td></tr></table></figure>

<h3 id="操作表数据"><a href="#操作表数据" class="headerlink" title="操作表数据"></a>操作表数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1,完全插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 (字段名<span class="number">1</span>,字段名<span class="number">2.</span>..) <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2.</span>..)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2,省略插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2.</span>..)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3，多行插入</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2.</span>..),(值<span class="number">1</span>,值<span class="number">2.</span>..)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4，查看所有记录</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5，修改记录</span></span><br><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名<span class="operator">=</span>值 [<span class="keyword">where</span>条件]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6，删除一条记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 7，清空表所有记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名</span><br></pre></td></tr></table></figure>

<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><p>and , or ,not</p>
<h2 id="sql-查询"><a href="#sql-查询" class="headerlink" title="sql 查询"></a>sql 查询</h2><ul>
<li><p>1，符合条件语法</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件]</span><br></pre></td></tr></table></figure></li>
<li><p>2，…到…之间</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">and</span> ... <span class="keyword">or</span></span><br><span class="line"><span class="keyword">between</span> ... <span class="keyword">and</span></span><br><span class="line"><span class="comment">--例句：查询23岁到25岁之间的学生</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> age<span class="operator">&gt;=</span><span class="number">23</span> <span class="keyword">and</span> age<span class="operator">&lt;=</span><span class="number">25</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> age <span class="keyword">between</span> <span class="number">23</span> <span class="keyword">and</span> <span class="number">25</span></span><br></pre></td></tr></table></figure></li>
<li><p>3，去重</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段名 <span class="keyword">from</span> 表名</span><br></pre></td></tr></table></figure></li>
<li><p>4,排序</p>
<p>  语法： order by + 字段名 asc升序（默认） desc降序</p>
</li>
<li><p>5，列别名 as</p>
</li>
<li><p>6，模糊查询 like</p>
</li>
<li><p>7, 联合查询 join</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1,交叉查询</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">cross</span> <span class="keyword">join</span> 表<span class="number">2</span> [<span class="keyword">where</span> 条件]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2,内连接查询</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">inner</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 联合条件 [<span class="keyword">where</span> 条件]</span><br><span class="line"></span><br><span class="line"><span class="comment">--外连接</span></span><br><span class="line"><span class="comment">-- 3,左外连接</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">left</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 联合条件 [<span class="keyword">where</span> 条件]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4，右外连接</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">right</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 联合条件 [<span class="keyword">where</span> 条件]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5，全外连接</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">full</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 联合条件 [<span class="keyword">where</span> 条件]</span><br></pre></td></tr></table></figure></li>
<li><p>8,嵌套查询</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">in</span>() 在...范围之内的</span><br><span class="line"><span class="keyword">not</span> <span class="keyword">in</span>() 不在...范围之内的</span><br><span class="line"><span class="keyword">exists</span> 存在</span><br><span class="line"><span class="keyword">not</span> <span class="keyword">exists</span> 不存在</span><br></pre></td></tr></table></figure></li>
<li><p>9,分组 group by</p>
</li>
</ul>
<h2 id="系统函数"><a href="#系统函数" class="headerlink" title="系统函数"></a>系统函数</h2><h3 id="1，统计-聚合-函数"><a href="#1，统计-聚合-函数" class="headerlink" title="1，统计(聚合)函数"></a>1，统计(聚合)函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1,AVG 返回指定组中的平均值，空值被忽略。</span></span><br><span class="line"><span class="keyword">select</span> prd_no,<span class="built_in">avg</span>(qty) <span class="keyword">from</span> sales <span class="keyword">group</span> <span class="keyword">by</span> prd_no</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2,COUNT 返回指定组中项目的数量</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(prd_no) <span class="keyword">from</span> sales</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3, MAX 返回指定数据的最大值。</span></span><br><span class="line"><span class="keyword">select</span> prd_no,<span class="built_in">max</span>(qty) <span class="keyword">from</span> sales <span class="keyword">group</span> <span class="keyword">by</span> prd_no</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4,MIN 返回指定数据的最小值。</span></span><br><span class="line"><span class="keyword">select</span> prd_no,<span class="built_in">min</span>(qty) <span class="keyword">from</span> sales <span class="keyword">group</span> <span class="keyword">by</span> prd_no</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5,SUM 返回指定数据的和，只能用于数字列，空值被忽略。</span></span><br><span class="line"><span class="keyword">select</span> prd_no,<span class="built_in">sum</span>(qty) <span class="keyword">from</span> sales <span class="keyword">group</span> <span class="keyword">by</span> prd_no</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6,COUNT_BIG 返回指定组中的项目数量，</span></span><br><span class="line"><span class="comment">-- 与COUNT函数不同的是COUNT_BIG返回bigint值，而COUNT返回的是int值。</span></span><br><span class="line"><span class="keyword">select</span> count_big(prd_no) <span class="keyword">from</span> sales</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 7,GROUPING 产生一个附加的列，当用CUBE或ROLLUP运算符添加行时，</span></span><br><span class="line"><span class="comment">-- 输出值为1.当所添加的行不是由CUBE或ROLLUP产生时，输出值为0.</span></span><br><span class="line"><span class="keyword">select</span> prd_no,<span class="built_in">sum</span>(qty),<span class="keyword">grouping</span>(prd_no) <span class="keyword">from</span> sales <span class="keyword">group</span> <span class="keyword">by</span> prd_no <span class="keyword">with</span> <span class="keyword">rollup</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 8, BINARY_CHECKSUM 返回对表中的行或表达式列表计算的二进制校验值，用于检测表中行的更改。</span></span><br><span class="line"><span class="keyword">select</span> prd_no,binary_checksum(qty) <span class="keyword">from</span> sales <span class="keyword">group</span> <span class="keyword">by</span> prd_no</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 9,CHECKSUM_AGG 返回指定数据的校验值，空值被忽略。</span></span><br><span class="line"><span class="keyword">select</span> prd_no,checksum_agg(binary_checksum(<span class="operator">*</span>)) <span class="keyword">from</span> sales <span class="keyword">group</span> <span class="keyword">by</span> prd_no</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 10,CHECKSUM 返回在表的行上或在表达式列表上计算的校验值，用于生成哈希索引。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 11,STDEV 返回给定表达式中所有值的统计标准偏差。</span></span><br><span class="line"><span class="keyword">select</span> stdev(prd_no) <span class="keyword">from</span> sales</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 12,STDEVP 返回给定表达式中的所有值的填充统计标准偏差。</span></span><br><span class="line"><span class="keyword">select</span> stdevp(prd_no) <span class="keyword">from</span> sales</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 13, VAR 返回给定表达式中所有值的统计方差。</span></span><br><span class="line"><span class="keyword">select</span> var(prd_no) <span class="keyword">from</span> sales</span><br><span class="line"></span><br><span class="line"><span class="comment">--14,VARP 返回给定表达式中所有值的填充的统计方差。</span></span><br><span class="line"><span class="keyword">select</span> varp(prd_no) <span class="keyword">from</span> sales</span><br></pre></td></tr></table></figure>

<h3 id="2-日期函数"><a href="#2-日期函数" class="headerlink" title="2,日期函数"></a>2,日期函数</h3><ul>
<li><p>1， getDate()：获取当前时间</p>
</li>
<li><p>2，Dateadd()：增加时间</p>
</li>
<li><p>3，datediff(datepart,startdate,enddate)</p>
<p>  参考：<a target="_blank" rel="noopener" href="http://www.w3school.com.cn/sql/func_datediff.asp">SQL Server DATEDIFF() 函数</a></p>
<p>  SELECT DATEDIFF(day,’2008-12-29’,’2008-12-30’) AS DiffDate<br>  输出：1</p>
<p>  startdate 和 enddate 参数是合法的日期表达式。<br>  datepart 参数可以是下列的值：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">date</span> part <span class="operator">|</span>缩写</span><br><span class="line">年:yy, yyyy</span><br><span class="line">季度:qq, q</span><br><span class="line">月:mm, m</span><br><span class="line">年中的日:dy, y</span><br><span class="line">日:dd, d</span><br><span class="line">周:wk, ww</span><br><span class="line">星期:dw, w</span><br><span class="line">小时:hh</span><br><span class="line">分钟:mi, n</span><br><span class="line">秒:ss, s</span><br><span class="line">毫秒:ms</span><br><span class="line">微妙:mcs</span><br><span class="line">纳秒：ns</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3，数学函数"><a href="#3，数学函数" class="headerlink" title="3，数学函数"></a>3，数学函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">abs</span>()：取绝对值</span><br><span class="line">round()：四舍五入</span><br><span class="line"><span class="built_in">floor</span>()：函数返回小于或等于所给数字表达式的最大整数</span><br><span class="line"><span class="built_in">ceiling</span>()：函数返回大于或等于所给数字表达式的最小整数</span><br><span class="line"><span class="built_in">sqrt</span>()：开平方根</span><br></pre></td></tr></table></figure>

<h3 id="4，字符串函数"><a href="#4，字符串函数" class="headerlink" title="4，字符串函数"></a>4，字符串函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">left</span>()：左截串</span><br><span class="line"><span class="keyword">right</span>()：右截串</span><br><span class="line">ltrim()：去左空格</span><br><span class="line">rtrim()：去右空格</span><br><span class="line">replace：(字符串,旧字符串,新字符串) 替换</span><br><span class="line">substring：(字符串,位置,长度) 截字符串 ps:<span class="keyword">sql</span>中字符串下标从<span class="number">1</span>开始</span><br><span class="line">reverse()：反转</span><br><span class="line">len()：长度</span><br><span class="line"><span class="built_in">upper</span>()：转大写</span><br><span class="line"><span class="built_in">lower</span>()：转小写</span><br></pre></td></tr></table></figure>

<h2 id="T-Sql"><a href="#T-Sql" class="headerlink" title="T-Sql"></a>T-Sql</h2><p><strong>声明变量语法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> @变量名 数据类型</span><br><span class="line"><span class="keyword">set</span> @变量名<span class="operator">=</span>值</span><br><span class="line"><span class="keyword">select</span> @变量名<span class="operator">=</span>值</span><br></pre></td></tr></table></figure>

<p><strong>编程语句:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">begin...end</span><br><span class="line">if...else</span><br></pre></td></tr></table></figure>

<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><ul>
<li><p>1.创建视图</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> 视图名称</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">sql</span>中查询语句</span><br></pre></td></tr></table></figure></li>
<li><p>2.使用视图 select * from 视图名</p>
</li>
<li><p>3.查看视图 exec sp_help</p>
</li>
<li><p>4.查看视图内容 exec sp_helptext 视图名</p>
</li>
<li><p>5.修改视图 alter view 视图名 as select * from 表名 [where条件]</p>
</li>
<li><p>6.删除视图 drop view 视图名</p>
</li>
<li><p>7.修改视图 update 视图名 set 字段名=值 [where条件]</p>
</li>
</ul>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> proc <span class="operator">|</span> <span class="keyword">procedure</span> pro_name</span><br><span class="line">    [&#123;@参数数据类型&#125; [<span class="operator">=</span>默认值] [output],</span><br><span class="line">     &#123;@参数数据类型&#125; [<span class="operator">=</span>默认值] [output],</span><br><span class="line">     ....</span><br><span class="line">    ]</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">        <span class="keyword">select</span> .....</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/toutou/p/4733670.html">sql server 基础教程[温故而知新三]</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/anding/p/5281558.html">.NET面试题解析(11)-SQL语言基础及数据库基本原理</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/06/%E5%B9%B6%E8%A1%8C%E5%BC%80%E5%8F%91%E4%B9%8B%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/06/%E5%B9%B6%E8%A1%8C%E5%BC%80%E5%8F%91%E4%B9%8B%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">并行开发之信号量简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-06 11:28:12" itemprop="dateCreated datePublished" datetime="2019-03-06T11:28:12+00:00">2019-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/net%E5%BC%82%E6%AD%A5%E4%B8%8E%E5%B9%B6%E8%A1%8C/" itemprop="url" rel="index"><span itemprop="name">.net异步与并行</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>轻量级信号量：</p>
<p>CountdownEvent，SemaphoreSlim，ManualResetEventSlim</p>
<h2 id="CountdownEvent"><a href="#CountdownEvent" class="headerlink" title="CountdownEvent"></a>CountdownEvent</h2><p>采用信号计数的方式，即定义了最多能够进入关键代码的线程数。并且可以动态改变“信号计数”的大小。</p>
<p>官方示例请参考：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.countdownevent?view=netframework-4.7.2">CountdownEvent</a></p>
<p>示例代码：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp4</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//默认的容纳大小为“硬件线程“数</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> CountdownEvent cde = <span class="keyword">new</span> CountdownEvent(Environment.ProcessorCount);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> userTaskCount = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//重置信号</span></span><br><span class="line">            cde.Reset(userTaskCount);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; userTaskCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Task.Factory.StartNew(LoadUser, i);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//等待所有任务执行完毕</span></span><br><span class="line">            cde.Wait();</span><br><span class="line">            Console.WriteLine(<span class="string">&quot; InitialCount=&#123;0&#125;, CurrentCount=&#123;1&#125;, IsSet=&#123;2&#125;&quot;</span>,</span><br><span class="line">                cde.InitialCount, cde.CurrentCount, cde.IsSet);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;\nUser表数据全部加载完毕！\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//加载product需要8个任务</span></span><br><span class="line">            <span class="keyword">var</span> productTaskCount = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">            cde.Reset(productTaskCount);</span><br><span class="line">            cde.AddCount(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;After Reset(8), AddCount(2): InitialCount=&#123;0&#125;, CurrentCount=&#123;1&#125;, IsSet=&#123;2&#125;&quot;</span>,</span><br><span class="line">                cde.InitialCount, cde.CurrentCount, cde.IsSet);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; cde.CurrentCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Task.Factory.StartNew(LoadProduct, i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//等待所有任务执行完毕</span></span><br><span class="line">            cde.Wait();</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;\nProduct表数据全部加载完毕！\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Now try waiting with cancellation</span></span><br><span class="line">            CancellationTokenSource cts = <span class="keyword">new</span> CancellationTokenSource();</span><br><span class="line">            cts.Cancel(); <span class="comment">// cancels the CancellationTokenSource</span></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                cde.Wait(cts.Token);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (OperationCanceledException)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;cde.Wait(preCanceledToken) threw OCE, as expected&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                cts.Dispose();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// It&#x27;s good to release a CountdownEvent when you&#x27;re done with it.</span></span><br><span class="line">            cde.Dispose();</span><br><span class="line"></span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">LoadUser</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;当前任务:&#123;0&#125;正在加载User部分数据！&quot;</span>, obj);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                cde.Signal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">LoadProduct</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;当前任务:&#123;0&#125;正在加载Product部分数据！&quot;</span>, obj);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                cde.Signal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SemaphoreSlim"><a href="#SemaphoreSlim" class="headerlink" title="SemaphoreSlim"></a>SemaphoreSlim</h2><p>对可同时访问资源或资源池的线程数加以限制</p>
<p>官方示例参考：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.semaphoreslim?view=netframework-4.7.2">SemaphoreSlim</a></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp4</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> SemaphoreSlim semaphore;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// A padding interval to make the output more orderly.</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> padding;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Create the semaphore.</span></span><br><span class="line">            semaphore = <span class="keyword">new</span> SemaphoreSlim(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;&#123;0&#125; tasks can enter the semaphore.&quot;</span>,</span><br><span class="line">                semaphore.CurrentCount);</span><br><span class="line">            Task[] tasks = <span class="keyword">new</span> Task[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create and start five numbered tasks.</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                tasks[i] = Task.Run(() =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Each task begins by requesting the semaphore.</span></span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;Task &#123;0&#125; begins and waits for the semaphore.&quot;</span>,</span><br><span class="line">                        Task.CurrentId);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 信号量： semaphore.Wait()和semaphore.Release()方法范围</span></span><br><span class="line">                    semaphore.Wait();</span><br><span class="line"></span><br><span class="line">                    Interlocked.Add(<span class="keyword">ref</span> padding, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;DateTime:&#123;0&#125;,Task &#123;1&#125; enters the semaphore.&quot;</span>, DateTime.Now, Task.CurrentId);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// The task just sleeps for 1+ seconds.</span></span><br><span class="line">                    Thread.Sleep(<span class="number">1000</span> + padding);</span><br><span class="line">                    <span class="built_in">int</span> id = semaphore.Release();</span><br><span class="line"></span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;Task &#123;0&#125; releases the semaphore; previous count: &#123;1&#125;&quot;</span>,</span><br><span class="line">                        Task.CurrentId, id);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Wait for half a second, to allow all the tasks to start and block.</span></span><br><span class="line">            Thread.Sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Restore the semaphore count to its maximum value.</span></span><br><span class="line">            Console.Write(<span class="string">&quot;Main thread calls Release(3) --&gt; &quot;</span>);</span><br><span class="line">            semaphore.Release(<span class="number">3</span>);<span class="comment">// 释放3次</span></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;&#123;0&#125; tasks can enter the semaphore.&quot;</span>,</span><br><span class="line">                semaphore.CurrentCount);</span><br><span class="line">            <span class="comment">// Main thread waits for the tasks to complete.</span></span><br><span class="line">            Task.WaitAll(tasks);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Main thread exits.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190306162258.png" alt="微信截图_20190306162258.png"></p>
<h2 id="ManualResetEventSlim"><a href="#ManualResetEventSlim" class="headerlink" title="ManualResetEventSlim"></a>ManualResetEventSlim</h2><p>ManualResetEventSlim是ManualReset的轻量级版本，采用的是”自旋等待“+”内核等待“，也就是说先采用”自旋等待的方式“等待，直到另一个任务调用set方法来释放它。如果迟迟等不到释放，那么任务就会进入基于内核的等待，所以说如果我们知道等待的时间比较短，采用轻量级的版本会具有更好的性能。</p>
<p>官方示例请参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.manualreseteventslim?view=netframework-4.7.2">ManualResetEventSlim Class</a></p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp4</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            MRES_SetWaitReset();</span><br><span class="line">            MRES_SpinCountWaitHandle();</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MRES_SetWaitReset</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            ManualResetEventSlim mres1 = <span class="keyword">new</span> ManualResetEventSlim(<span class="literal">false</span>,<span class="number">2000</span>); <span class="comment">// initialize as unsignaled</span></span><br><span class="line"></span><br><span class="line">            Task[] task=<span class="keyword">new</span> Task[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                task[i] = Task.Factory.StartNew(() =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 等待mres1.Set();</span></span><br><span class="line">                    mres1.Wait();</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;当前时间:&#123;0&#125;,任务ID：mres1收到信号开始执行！&quot;</span>, DateTime.Now);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;当前时间:&#123;0&#125; 主线程ID:&#123;1&#125; \n&quot;</span>,</span><br><span class="line">                DateTime.Now,</span><br><span class="line">                Thread.CurrentThread.ManagedThreadId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 等待两秒</span></span><br><span class="line">            Thread.Sleep(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 设置信号，使等待线程开始执行</span></span><br><span class="line">                mres1.Set();</span><br><span class="line">                Task.WaitAll(task);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 释放</span></span><br><span class="line">                mres1.Dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Demonstrates:</span></span><br><span class="line">        <span class="comment">//      ManualResetEventSlim construction w/ SpinCount</span></span><br><span class="line">        <span class="comment">//      ManualResetEventSlim.WaitHandle</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MRES_SpinCountWaitHandle</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Construct a ManualResetEventSlim with a SpinCount of 1000</span></span><br><span class="line">            <span class="comment">// Higher spincount =&gt; longer time the MRES will spin-wait before taking lock</span></span><br><span class="line">            ManualResetEventSlim mres1 = <span class="keyword">new</span> ManualResetEventSlim(<span class="literal">false</span>, <span class="number">1000</span>);</span><br><span class="line">            ManualResetEventSlim mres2 = <span class="keyword">new</span> ManualResetEventSlim(<span class="literal">false</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">            Task bgTask = Task.Factory.StartNew(() =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Just wait a little</span></span><br><span class="line">                Thread.Sleep(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Now signal both MRESes</span></span><br><span class="line">                Console.WriteLine(<span class="string">&quot;Task signalling both MRESes&quot;</span>);</span><br><span class="line">                mres1.Set();</span><br><span class="line">                mres2.Set();</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// A common use of MRES.WaitHandle is to use MRES as a participant in</span></span><br><span class="line">            <span class="comment">// WaitHandle.WaitAll/WaitAny.  Note that accessing MRES.WaitHandle will</span></span><br><span class="line">            <span class="comment">// result in the unconditional inflation of the underlying ManualResetEvent.</span></span><br><span class="line">            WaitHandle.WaitAll(<span class="keyword">new</span> WaitHandle[] &#123; mres1.WaitHandle, mres2.WaitHandle &#125;);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;WaitHandle.WaitAll(mres1.WaitHandle, mres2.WaitHandle) completed.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Clean up</span></span><br><span class="line">            bgTask.Wait();</span><br><span class="line">            mres1.Dispose();</span><br><span class="line">            mres2.Dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/huangxincheng/archive/2012/04/08/2437701.html">8天玩转并行开发——第五天 同步机制（下）</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2019/03/06/%E5%B9%B6%E8%A1%8C%E5%BC%80%E5%8F%91%E4%B9%8B%E8%87%AA%E6%97%8B%E9%94%81-spinLock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="syxdevcode的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/03/06/%E5%B9%B6%E8%A1%8C%E5%BC%80%E5%8F%91%E4%B9%8B%E8%87%AA%E6%97%8B%E9%94%81-spinLock/" class="post-title-link" itemprop="url">并行开发之自旋锁-spinLock</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-06 10:58:13" itemprop="dateCreated datePublished" datetime="2019-03-06T10:58:13+00:00">2019-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-19 12:21:39" itemprop="dateModified" datetime="2022-10-19T12:21:39+00:00">2022-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/net%E5%BC%82%E6%AD%A5%E4%B8%8E%E5%B9%B6%E8%A1%8C/" itemprop="url" rel="index"><span itemprop="name">.net异步与并行</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>933</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>提供一个相互排斥锁基元，在该基元中，尝试获取锁的线程将在重复检查的循环中等待，直至该锁变为可用为止。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2019/03/06/%E5%B9%B6%E8%A1%8C%E5%BC%80%E5%8F%91%E4%B9%8B%E8%87%AA%E6%97%8B%E9%94%81-spinLock/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/29/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/page/31/">31</a><span class="space">&hellip;</span><a class="page-number" href="/page/39/">39</a><a class="extend next" rel="next" href="/page/31/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="syxdevcode"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">syxdevcode</p>
  <div class="site-description" itemprop="description">syxdevcode的个人博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">582</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">143</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">215</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/syxdevcode" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;syxdevcode" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">syxdevcode</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.9m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">28:10</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
