<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"syxdevcode.github.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="syxdevcode博客">
<meta property="og:url" content="https://syxdevcode.github.com/page/26/index.html">
<meta property="og:site_name" content="syxdevcode博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="syxdevcode">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://syxdevcode.github.com/page/26/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>syxdevcode博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">syxdevcode博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/syxdevcode" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/17/Docker-Docker-Compose-Nginx-%E9%83%A8%E7%BD%B2DotNetCore%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/17/Docker-Docker-Compose-Nginx-%E9%83%A8%E7%BD%B2DotNetCore%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">Docker & Docker Compose & Nginx 部署DotNetCore项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-17 08:51:19" itemprop="dateCreated datePublished" datetime="2018-05-17T08:51:19+00:00">2018-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker-Compose/" itemprop="url" rel="index"><span itemprop="name">Docker Compose</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker-amp-Docker-Compose-amp-Nginx-部署DotNetCore项目"><a href="#Docker-amp-Docker-Compose-amp-Nginx-部署DotNetCore项目" class="headerlink" title="Docker &amp; Docker Compose &amp; Nginx 部署DotNetCore项目"></a>Docker &amp; Docker Compose &amp; Nginx 部署DotNetCore项目</h1><h2 id="Docker-Compose简介"><a href="#Docker-Compose简介" class="headerlink" title="Docker Compose简介"></a>Docker Compose简介</h2><p>文档：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></p>
<p><code>Compose</code> 项目是 Docker 官方的开源项目，负责实现对 <code>Docker</code> 容器集群的快速编排。从功能上看，跟 <code>OpenStack</code> 中的 <code>Heat</code> 十分类似。</p>
<p>其代码目前在 <a target="_blank" rel="noopener" href="https://github.com/docker/compose">https://github.com/docker/compose</a> 上开源。</p>
<p><code>Compose</code> 定位是 「定义和运行多个 Docker 容器的应用（Defining and running multi-container Docker applications）」，其前身是开源项目 Fig。</p>
<p>通过第一部分中的介绍，我们知道使用一个 <code>Dockerfile</code> 模板文件，可以让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。</p>
<p><code>Compose</code> 恰好满足了这样的需求。它允许用户通过一个单独的 <code>docker-compose.yml</code> 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p>
<p><code>Compose</code> 中有两个重要的概念：</p>
<p><code>服务 (service)</code>：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</p>
<p><code>项目 (project)</code>：由一组关联的应用容器组成的一个完整业务单元，在 <code>docker-compose.yml</code> 文件中定义。</p>
<p><code>Compose</code> 的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。</p>
<p><code>Compose</code> 项目由 Python 编写，实现上调用了 Docker 服务提供的 API 来对容器进行管理。因此，只要所操作的平台支持 Docker API，就可以在其上利用 Compose 来进行编排管理。</p>
<h2 id="Docker-Compose安装"><a href="#Docker-Compose安装" class="headerlink" title="Docker Compose安装"></a>Docker Compose安装</h2><p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/install/#install-compose">https://docs.docker.com/compose/install/#install-compose</a></p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L https://github.com/docker/compose/releases/download/<span class="number">1.21</span>.<span class="number">2</span>/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose</span><br><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line">docker-compose --version</span><br><span class="line">docker-compose version <span class="number">1.21</span>.<span class="number">2</span>, build a133471</span><br></pre></td></tr></table></figure>

<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="YAML配置命令"><a href="#YAML配置命令" class="headerlink" title="YAML配置命令"></a>YAML配置命令</h3><table>
<thead>
<tr>
<th>配置</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>build</td>
<td>指定 Dockerfile 所在的目录地址，用于构建镜像，并使用此镜像创建容器，比如上面配置的 <code>build: .</code></td>
</tr>
<tr>
<td>command</td>
<td>容器的执行命令</td>
</tr>
<tr>
<td>dns</td>
<td>自定义 dns 服务器</td>
</tr>
<tr>
<td>expose</td>
<td>暴露端口配置，但不映射到宿主机，只被连接的服务访问</td>
</tr>
<tr>
<td>extends</td>
<td>对<code>docker-compose.yml</code>的扩展，配置在服务中</td>
</tr>
<tr>
<td>image</td>
<td>使用的镜像名称或镜像 ID</td>
</tr>
<tr>
<td>links</td>
<td>链接到其它服务中的容器（一般桥接网络模式使用）</td>
</tr>
<tr>
<td>net</td>
<td>设置容器的网络模式（四种：<code>bridge</code>, <code>none</code>, <code>container:[name or id]</code>和<code>host</code>）</td>
</tr>
<tr>
<td>ports</td>
<td>暴露端口信息，主机和容器的端口映射</td>
</tr>
<tr>
<td>volumes</td>
<td>数据卷所挂载路径设置</td>
</tr>
</tbody></table>
<h3 id="Docker-Compose-常用命令"><a href="#Docker-Compose-常用命令" class="headerlink" title="Docker Compose 常用命令"></a>Docker Compose 常用命令</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>docker-compose build</td>
<td>构建项目中的镜像，–force-rm：删除构建过程中的临时容器；–no-cache：不使用缓存构建；–pull：获取最新版本的镜像</td>
</tr>
<tr>
<td>docker-compose up -d</td>
<td>构建镜像、创建服务和启动项目，-d表示后台运行</td>
</tr>
<tr>
<td>docker-compose run ubuntu ls -d</td>
<td>指定服务上运行一个命令，-d表示后台运行</td>
</tr>
<tr>
<td>docker-compose logs</td>
<td>查看服务容器输出日志</td>
</tr>
<tr>
<td>docker-compose ps</td>
<td>列出项目中所有的容器</td>
</tr>
<tr>
<td>docker-compose pause [service_name]</td>
<td>暂停一个服务容器</td>
</tr>
<tr>
<td>docker-compose unpause [service_name]</td>
<td>恢复已暂停的一个服务容器</td>
</tr>
<tr>
<td>docker-compose restart</td>
<td>重启项目中的所有服务容器（也可以指定具体的服务）</td>
</tr>
<tr>
<td>docker-compose stop</td>
<td>停止运行项目中的所有服务容器（也可以指定具体的服务）</td>
</tr>
<tr>
<td>docker-compose start</td>
<td>启动已经停止项目中的所有服务容器（也可以指定具体的服务）</td>
</tr>
<tr>
<td>docker-compose rm</td>
<td>删除项目中的所有服务容器（也可以指定具体的服务），-f：强制删除（包含运行的）</td>
</tr>
<tr>
<td>docker-compose kill</td>
<td>强制停止项目中的所有服务容器（也可以指定具体的服务）</td>
</tr>
</tbody></table>
<h2 id="编写一个docker-compose-yml"><a href="#编写一个docker-compose-yml" class="headerlink" title="编写一个docker-compose.yml"></a>编写一个docker-compose.yml</h2><p><code>dockers-compose.yml</code>文件要定义在我们项目的文件夹下。</p>
<p>整体目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|-- docker.web</span><br><span class="line">  |--Dockerfile</span><br><span class="line">|-- nginx</span><br><span class="line">  |--nginx.conf</span><br><span class="line">  |--Dockerfile</span><br><span class="line">|--docker-compose.yml</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  dockerwebapp:</span><br><span class="line">    container_name:dockerwebapp</span><br><span class="line">    build:</span><br><span class="line">      context: ./docker.web</span><br><span class="line">      dockerfile: Dockerfile</span><br><span class="line">    <span class="keyword">expose</span>:</span><br><span class="line">      - <span class="string">&quot;5000&quot;</span></span><br><span class="line">    ports:</span><br><span class="line">     - <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">  reverse-proxy:</span><br><span class="line">    container_name: reverse-proxy-nginx</span><br><span class="line">    build:</span><br><span class="line">      context: ./nginx</span><br><span class="line">    volumes:</span><br><span class="line">        - /etc/letsencrypt:/etc/letsencrypt/</span><br><span class="line">    ports:</span><br><span class="line">     - <span class="string">&quot;80:80&quot;</span></span><br><span class="line">     - <span class="string">&quot;443:443&quot;</span></span><br></pre></td></tr></table></figure>

<p>** docker.web下Dockerfile:**</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> microsoft/dotnet:latest</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> dotnet restore</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">5000</span></span><br><span class="line"><span class="keyword">ENV</span> ASPNETCORE_URLS http://*:<span class="number">5000</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;dotnet&quot;</span>,<span class="string">&quot;run&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>** nginx下Dockerfile**</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> nginx.conf /etc/nginx/nginx.conf</span></span><br></pre></td></tr></table></figure>

<p>** nginx下nginx.conf配置**</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span>  nginx;</span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">error_log</span>  /var/log/nginx/error.log <span class="literal">warn</span>;</span><br><span class="line"><span class="attribute">pid</span>        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       /etc/nginx/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span>  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.shiyx.top;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://www.shiyx.top$request_uri;</span><br><span class="line">        <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">upstream</span> app_servers &#123;</span><br><span class="line">        <span class="attribute">server</span> dockerwebapp:<span class="number">5000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">        <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.shiyx.top;</span><br><span class="line">        <span class="comment">#$host该变量的值等于请求头中Host的值。如果Host无效时，那么就是处理该请求的server的名称。</span></span><br><span class="line">        <span class="comment">#permanent: 永久性重定向。请求日志中的状态码为301</span></span><br><span class="line">        <span class="comment">#nginx 对文档检测比较严格，所以if ( $host != &#x27;www.csdn.com&#x27; ) 这些代码之间需要有空格隔开，不然会</span></span><br><span class="line">        <span class="comment">#报错：unknown directive “if($host!=”</span></span><br><span class="line">        <span class="attribute">if</span> ($host != <span class="string">&#x27;www.shiyx.top&#x27;</span> )&#123;</span><br><span class="line">                <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> https://www.shiyx.top/<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/shiyx.top/fullchain.pem;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/shiyx.top/privkey.pem;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击</span></span><br><span class="line">        <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="comment"># 设置ssl/tls会话缓存的类型和大小。如果设置了这个参数一般是shared，buildin可能会参数内存碎片，默认是none，</span></span><br><span class="line">        <span class="comment">#和off差不多，停用缓存。如shared:SSL:10m表示我&gt;所有的nginx工作进程共享ssl会话缓存，</span></span><br><span class="line">        <span class="comment">#网介绍说1M可以存放约4000个sessions。</span></span><br><span class="line">        <span class="attribute">ssl_session_cache</span>    shared:SSL:<span class="number">1m</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。</span></span><br><span class="line">        <span class="attribute">ssl_session_timeout</span>  <span class="number">5m</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">ssl_protocols</span> SSLv3 TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。</span></span><br><span class="line">        <span class="comment"># 这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher &#x27;RC4:HIGH:!aNULL:!MD5&#x27;</span></span><br><span class="line">        <span class="comment">#（后面是你所指定的套件加密算法） 来看所支持算法。</span></span><br><span class="line">        <span class="attribute">ssl_ciphers</span>  HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。</span></span><br><span class="line">        <span class="attribute">ssl_prefer_server_ciphers</span>  <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查看代理程序的ip</span></span><br><span class="line">        <span class="comment"># sudo docker inspect --format &#x27;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&#x27; &lt;container-ID&gt;</span></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://app_servers;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   Upgrade $http_upgrade;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   Connection keep-alive;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   Host $http_host;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   X-Real-IP $remote_addr;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   X-Forwarded-Host $server_name;</span><br><span class="line">            <span class="attribute">proxy_cache_bypass</span> $http_upgrade;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ /.well-known</span>&#123;</span><br><span class="line">                <span class="attribute">allow</span> all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中要注意反向代理的配置：<code>server dockerwebapp:5000;</code>，其中ip部分直接指定的是docker-compose.yml中定义的第一个服务的名称dockerwebapp</p>
<h2 id="启动compose"><a href="#启动compose" class="headerlink" title="启动compose"></a>启动compose</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-172-31-16-20:~/dotnet$ docker-compose up -d --build</span><br><span class="line">Creating network <span class="string">&quot;dotnet_default&quot;</span> with the default driver</span><br><span class="line">Building dockerwebapp</span><br><span class="line">Step 1/7 : FROM microsoft/dotnet:latest</span><br><span class="line"> ---&gt; 2ac9a416f201</span><br><span class="line">Step 2/7 : WORKDIR /app</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 9449738bc5a1</span><br><span class="line">Step 3/7 : COPY . /app</span><br><span class="line"> ---&gt; 63468e7420e1</span><br><span class="line">Step 4/7 : RUN dotnet restore</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 24ecd554e076</span><br><span class="line">  Restore completed <span class="keyword">in</span> 75.73 ms <span class="keyword">for</span> /app/docker.web.csproj.</span><br><span class="line">  Restoring packages <span class="keyword">for</span> /app/docker.web.csproj...</span><br><span class="line">  Restore completed <span class="keyword">in</span> 464.93 ms <span class="keyword">for</span> /app/docker.web.csproj.</span><br><span class="line">Removing intermediate container 24ecd554e076</span><br><span class="line"> ---&gt; cdc5f195aa36</span><br><span class="line">Step 5/7 : EXPOSE 5000</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> af5717cc39b8</span><br><span class="line">Removing intermediate container af5717cc39b8</span><br><span class="line"> ---&gt; afe466d24f6d</span><br><span class="line">Step 6/7 : ENV ASPNETCORE_URLS http://*:5000</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> d151cad8058d</span><br><span class="line">Removing intermediate container d151cad8058d</span><br><span class="line"> ---&gt; d4e8dadfe89c</span><br><span class="line">Step 7/7 : ENTRYPOINT [<span class="string">&quot;dotnet&quot;</span>,<span class="string">&quot;run&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> de41a97d97a8</span><br><span class="line">Removing intermediate container de41a97d97a8</span><br><span class="line"> ---&gt; 05c1f1c48653</span><br><span class="line">Successfully built 05c1f1c48653</span><br><span class="line">Successfully tagged dotnet_dockerwebapp:latest</span><br><span class="line">Building reverse-proxy</span><br><span class="line">Step 1/2 : FROM nginx</span><br><span class="line"> ---&gt; ae513a47849c</span><br><span class="line">Step 2/2 : COPY nginx.conf /etc/nginx/nginx.conf</span><br><span class="line"> ---&gt; 458d9128600f</span><br><span class="line">Successfully built 458d9128600f</span><br><span class="line">Successfully tagged dotnet_reverse-proxy:latest</span><br><span class="line">Creating reverse-proxy-nginx ... <span class="keyword">done</span></span><br><span class="line">Creating dockerwebapp        ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>验证启动的服务：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker-compose ps</span><br></pre></td></tr></table></figure>

<p>显示结果：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-<span class="number">172</span>-<span class="number">31</span>-<span class="number">16</span>-<span class="number">20</span>:~/dotnet$ docker-compose ps</span><br><span class="line">       Name                 Command          State              Ports</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">dockerwebapp          dotnet <span class="keyword">run</span><span class="bash">             Up      5000/tcp</span></span><br><span class="line">reverse-proxy-nginx   nginx -g daemon off;   Up      <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">443</span>-&gt;<span class="number">443</span>/tcp,</span><br><span class="line">                                                     <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">80</span>-&gt;<span class="number">80</span>/tcp</span><br></pre></td></tr></table></figure>

<p>** remove-orphans**</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down --rmi local --remove-orphans</span><br></pre></td></tr></table></figure>

<h2 id="删除tag为none镜像"><a href="#删除tag为none镜像" class="headerlink" title="删除tag为none镜像"></a>删除tag为none镜像</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker images -a|grep none|awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>|xargs docker rmi</span><br><span class="line"><span class="comment">## 显示依赖关系</span></span><br><span class="line">docker image inspect --format=<span class="string">&#x27;&#123;&#123;.RepoTags&#125;&#125; &#123;&#123;.Id&#125;&#125; &#123;&#123;.Parent&#125;&#125;&#x27;</span> $(docker image ls -q --filter since=b64089162379)</span><br></pre></td></tr></table></figure>

<p>其中b64089162379为镜像ID。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://yeasy.gitbooks.io/docker_practice/content/compose/introduction.html">https://yeasy.gitbooks.io/docker_practice/content/compose/introduction.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.sep.com/sep-blog/2017/02/27/nginx-reverse-proxy-to-asp-net-core-separate-docker-containers/">https://www.sep.com/sep-blog/2017/02/27/nginx-reverse-proxy-to-asp-net-core-separate-docker-containers/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sheng-jie/p/8116276.html">https://www.cnblogs.com/sheng-jie/p/8116276.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/xishuai/p/docker-compose.html">http://www.cnblogs.com/xishuai/p/docker-compose.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/lsxqw2004/p/6709766.html">http://www.cnblogs.com/lsxqw2004/p/6709766.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/16/%E8%8E%B7%E5%8F%96docker%E5%AE%B9%E5%99%A8%EF%BC%88container%EF%BC%89ip%E5%9C%B0%E5%9D%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/16/%E8%8E%B7%E5%8F%96docker%E5%AE%B9%E5%99%A8%EF%BC%88container%EF%BC%89ip%E5%9C%B0%E5%9D%80/" class="post-title-link" itemprop="url">获取docker容器（container）ip地址</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-16 14:40:11" itemprop="dateCreated datePublished" datetime="2018-05-16T14:40:11+00:00">2018-05-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="获取docker容器（container）ip地址"><a href="#获取docker容器（container）ip地址" class="headerlink" title="获取docker容器（container）ip地址"></a>获取docker容器（container）ip地址</h1><h2 id="使用命令方式"><a href="#使用命令方式" class="headerlink" title="使用命令方式"></a>使用命令方式</h2><ul>
<li>命令</li>
</ul>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker inspect --format <span class="string">&#x27;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&#x27;</span> &lt;container-ID&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>命令2</li>
</ul>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker inspect &lt;container id&gt;</span><br><span class="line"></span><br><span class="line">sudo docker inspect -f <span class="string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> &lt;container_name_or_id&gt;</span><br></pre></td></tr></table></figure>

<h2 id="进入容器内"><a href="#进入容器内" class="headerlink" title="进入容器内"></a>进入容器内</h2><p>命令：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec -it mynginx /bin/bash</span><br><span class="line">cat /etc/hosts</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-<span class="number">172</span>-<span class="number">31</span>-<span class="number">16</span>-<span class="number">20</span>:~/dotnet$ sudo docker exec -it mynginx /bin/bash</span><br><span class="line">root@<span class="number">70</span>e571d3bcab:/<span class="comment"># cat /etc/hosts</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>       localhost</span><br><span class="line">::<span class="number">1</span>     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::<span class="number">0</span> ip6-localnet</span><br><span class="line">ff00::<span class="number">0</span> ip6-mcastprefix</span><br><span class="line">ff02::<span class="number">1</span> ip6-allnodes</span><br><span class="line">ff02::<span class="number">2</span> ip6-allrouters</span><br><span class="line"><span class="number">172.17</span>.<span class="number">0.4</span>      <span class="number">70</span>e571d3bcab</span><br></pre></td></tr></table></figure>

<h2 id="在-bashrc-中写一个-bash-函数"><a href="#在-bashrc-中写一个-bash-函数" class="headerlink" title="在 ~/.bashrc 中写一个 bash 函数"></a>在 ~/.bashrc 中写一个 bash 函数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>添加如下内容：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function docker_ip() &#123;</span><br><span class="line">    sudo docker inspect --format <span class="string">&#x27;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&#x27;</span> $<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>最后调用函数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker_ip mynginx</span><br></pre></td></tr></table></figure>

<h2 id="所有容器名称及其IP地址"><a href="#所有容器名称及其IP地址" class="headerlink" title="所有容器名称及其IP地址"></a>所有容器名称及其IP地址</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker inspect -f <span class="string">&#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;.NetworkSettings.IPAddress &#125;&#125;&#x27;</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure>

<p>如果使用docker-compose命令将是:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect -f <span class="string">&#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker inspect --format=<span class="string">&#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure>

<p>可能遇到的问题：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-<span class="number">172</span>-<span class="number">31</span>-<span class="number">16</span>-<span class="number">20</span>:~/dotnet$ sudo docker inspect -f <span class="string">&#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;.NetworkSettings.IPAddress &#125;&#125;&#x27;</span> $(docker ps -aq)</span><br><span class="line">Got permission denied while trying to connect to the Docker daemon socket at unix:///var/<span class="keyword">run</span><span class="bash">/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.37/containers/json?all=1: dial unix /var/run/docker.sock: connect: permission denied</span></span><br><span class="line"><span class="string">&quot;docker inspect&quot;</span> requires at least <span class="number">1</span> argument.</span><br><span class="line">See <span class="string">&#x27;docker inspect --help&#x27;</span>.</span><br><span class="line"></span><br><span class="line">Usage:  docker inspect [OPTIONS] NAME|ID [NAME|ID...] [flags]</span><br><span class="line"></span><br><span class="line">Return low-level information on Docker objects</span><br></pre></td></tr></table></figure>

<p>执行以下命令,将当前用户添加 docker 组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -a -G docker <span class="variable">$USER</span></span><br><span class="line">或</span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>

<p>注销，重新登录:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">logout</span></span><br></pre></td></tr></table></figure>

<p>注意：注销并重新登录是必需的，因为除非您的会话关闭，否则组更改不会生效。</p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/sannerlittle/article/details/77063800">https://blog.csdn.net/sannerlittle/article/details/77063800</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/15/Nginx&Docker%E9%83%A8%E7%BD%B2NetCore%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/15/Nginx&Docker%E9%83%A8%E7%BD%B2NetCore%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">Nginx&Docker部署NetCore项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-15 13:48:24" itemprop="dateCreated datePublished" datetime="2018-05-15T13:48:24+00:00">2018-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DotNetCore/" itemprop="url" rel="index"><span itemprop="name">DotNetCore</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Nginx-amp-Docker部署NetCore项目"><a href="#Nginx-amp-Docker部署NetCore项目" class="headerlink" title="Nginx&amp;Docker部署NetCore项目"></a>Nginx&amp;Docker部署NetCore项目</h1><h2 id="Nginx运行在Docker"><a href="#Nginx运行在Docker" class="headerlink" title="Nginx运行在Docker"></a>Nginx运行在Docker</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo docker container <span class="keyword">run</span><span class="bash"> \</span></span><br><span class="line"><span class="bash">  -d \</span></span><br><span class="line"><span class="bash">  -p 127.0.0.2:8080:80 \</span></span><br><span class="line"><span class="bash">  --rm \</span></span><br><span class="line"><span class="bash">  --name mynginx \</span></span><br><span class="line"><span class="bash">  nginx</span></span><br></pre></td></tr></table></figure>

<p>上面命令下载并运行官方的 Nginx image，默认是最新版本（latest）。如果本机安装过以前的版本，请删掉重新安装，因为只有 1.13.9 才开始支持 server push。</p>
<p>上面命令的各个参数含义如下:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-d：在后台运行</span><br><span class="line">-p ：容器的<span class="number">80</span>端口映射到<span class="number">127.0</span>.<span class="number">0.2</span>:<span class="number">8080</span></span><br><span class="line">--rm：容器停止运行后，自动删除容器文件</span><br><span class="line">--name：容器的名字为mynginx</span><br></pre></td></tr></table></figure>

<p>如果没有报错，就可以打开浏览器访问 127.0.0.2:8080 了。正常情况下，显示 Nginx 的欢迎页。</p>
<p>或者用curl显示：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-<span class="number">172</span>-<span class="number">31</span>-<span class="number">16</span>-<span class="number">20</span>:~/dotnet/conf$ curl http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: <span class="number">35</span>em;</span><br><span class="line">        margin: <span class="number">0</span> auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">ubuntu@ip-<span class="number">172</span>-<span class="number">31</span>-<span class="number">16</span>-<span class="number">20</span>:~/dotnet/conf$</span><br></pre></td></tr></table></figure>

<p>然后，把这个容器终止，由于–rm参数的作用，容器文件会自动删除。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker container stop mynginx</span><br></pre></td></tr></table></figure>

<h2 id="拷贝配置"><a href="#拷贝配置" class="headerlink" title="拷贝配置"></a>拷贝配置</h2><p>首先，把容器里面的 Nginx 配置文件拷贝到本地。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker container cp mynginx:/etc/nginx .</span><br></pre></td></tr></table></figure>

<p>上面命令的含义是，把mynginx容器的/etc/nginx拷贝到当前目录。不要漏掉最后那个点。</p>
<p>执行完成后，当前目录应该多出一个nginx子目录。然后，把这个子目录改名为conf。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv nginx conf</span><br></pre></td></tr></table></figure>

<p>容器终止:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker container stop mynginx</span><br></pre></td></tr></table></figure>

<h2 id="映射配置目录"><a href="#映射配置目录" class="headerlink" title="映射配置目录"></a>映射配置目录</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span> docker container run \</span><br><span class="line">  --name mynginx \</span><br><span class="line">  --rm \</span><br><span class="line">  --volume <span class="string">&quot;$PWD/conf&quot;</span>:/etc/nginx \</span><br><span class="line">  -p <span class="number">80</span>:<span class="number">80</span> \</span><br><span class="line">  -d \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure>

<p>–volume “$PWD/conf”:/etc/nginx表示把容器的配置目录/etc/nginx，映射到本地的conf子目录。</p>
<p>查看docker 容器日志：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker logs mynginx</span><br></pre></td></tr></table></figure>

<h2 id="映射证书"><a href="#映射证书" class="headerlink" title="映射证书"></a>映射证书</h2><p>使用Let’s Encrypt生成的证书文件</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span> docker container run \</span><br><span class="line">  --name mynginx \</span><br><span class="line">  --rm \</span><br><span class="line">  --volume <span class="string">&quot;$PWD/conf&quot;</span>:/etc/nginx \</span><br><span class="line">  -v /etc/letsencrypt:/etc/letsencrypt/ \</span><br><span class="line">  -d \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure>

<p>-v : 映射本地/etc/letsencrypt到容器/etc/letsencrypt目录。</p>
<h2 id="HTTPS-配置"><a href="#HTTPS-配置" class="headerlink" title="HTTPS 配置"></a>HTTPS 配置</h2><p>配置<code>conf/conf.d/default.conf</code>文件，具体配置如下：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.shiyx.top;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://www.shiyx.top$request_uri;</span><br><span class="line">        <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">        <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">server_name</span> www.shiyx.top;</span><br><span class="line">        <span class="comment">#$host该变量的值等于请求头中Host的值。如果Host无效时，那么就是处理该请求的server的名称。</span></span><br><span class="line">        <span class="comment">#permanent: 永久性重定向。请求日志中的状态码为301</span></span><br><span class="line">        <span class="comment">#nginx 对文档检测比较严格，所以if ( $host != &#x27;www.csdn.com&#x27; ) 这些代码之间需要有空格隔开，不然会</span></span><br><span class="line">        <span class="comment">#报错：unknown directive “if($host!=”</span></span><br><span class="line">        <span class="attribute">if</span> ($host != <span class="string">&#x27;www.shiyx.top&#x27;</span> )&#123;</span><br><span class="line">                <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> https://www.shiyx.top/<span class="variable">$1</span> <span class="literal">permanent</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/shiyx.top/fullchain.pem;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/shiyx.top/privkey.pem;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#禁止在header中出现服务器版本，防止黑客利用版本漏洞攻击</span></span><br><span class="line">        <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">        <span class="comment"># 设置ssl/tls会话缓存的类型和大小。如果设置了这个参数一般是shared，buildin可能会参数内存碎片，默认是none，</span></span><br><span class="line">        <span class="comment">#和off差不多，停用缓存。如shared:SSL:10m表示我&gt;所有的nginx工作进程共享ssl会话缓存，</span></span><br><span class="line">        <span class="comment">#网介绍说1M可以存放约4000个sessions。</span></span><br><span class="line">        <span class="attribute">ssl_session_cache</span>    shared:SSL:<span class="number">1m</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 客户端可以重用会话缓存中ssl参数的过期时间，内网系统默认5分钟太短了，可以设成30m即30分钟甚至4h。</span></span><br><span class="line">        <span class="attribute">ssl_session_timeout</span>  <span class="number">5m</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">ssl_protocols</span> SSLv3 TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 选择加密套件，不同的浏览器所支持的套件（和顺序）可能会不同。</span></span><br><span class="line">        <span class="comment"># 这里指定的是OpenSSL库能够识别的写法，你可以通过 openssl -v cipher &#x27;RC4:HIGH:!aNULL:!MD5&#x27;</span></span><br><span class="line">        <span class="comment">#（后面是你所指定的套件加密算法） 来看所支持算法。</span></span><br><span class="line">        <span class="attribute">ssl_ciphers</span>  HIGH:!aNULL:!MD5;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置协商加密算法时，优先使用我们服务端的加密套件，而不是客户端浏览器的加密套件。</span></span><br><span class="line">        <span class="attribute">ssl_prefer_server_ciphers</span>  <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查看代理程序的ip</span></span><br><span class="line">        <span class="comment"># sudo docker inspect --format &#x27;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&#x27; &lt;container-ID&gt;</span></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://172.17.0.3:5000;</span><br><span class="line">            <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   Upgrade $http_upgrade;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   Connection keep-alive;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>   Host $http_host;</span><br><span class="line">            <span class="attribute">proxy_cache_bypass</span> $http_upgrade;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ /.well-known</span>&#123;</span><br><span class="line">                <span class="attribute">allow</span> all;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看docker ip地址</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker inspect --format <span class="string">&#x27;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&#x27;</span> &lt;container-ID&gt;</span><br></pre></td></tr></table></figure>

<p>最后，启动一个新的Nginx容器。</p>
<p>** 注意运行目录**</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sudo</span> docker container run \</span><br><span class="line">  --name mynginx \</span><br><span class="line">  --rm \</span><br><span class="line">  --volume <span class="string">&quot;$PWD/conf&quot;</span>:/etc/nginx \</span><br><span class="line">  -v /etc/letsencrypt:/etc/letsencrypt/ \</span><br><span class="line">  -p <span class="number">80</span>:<span class="number">80</span> \</span><br><span class="line">  -p <span class="number">443</span>:<span class="number">443</span> \</span><br><span class="line">  -d \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure>

<p>参考：<br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/02/nginx-docker.html">http://www.ruanyifeng.com/blog/2018/02/nginx-docker.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-2.0&tabs=aspnetcore2x">https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/linux-nginx?view=aspnetcore-2.0&amp;tabs=aspnetcore2x</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/savorboard/p/dotnet-core-publish-nginx.html">http://www.cnblogs.com/savorboard/p/dotnet-core-publish-nginx.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/14/DotNetCore%E4%BD%BF%E7%94%A8Docker%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/14/DotNetCore%E4%BD%BF%E7%94%A8Docker%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">DotNetCore使用Docker部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-14 17:34:11" itemprop="dateCreated datePublished" datetime="2018-05-14T17:34:11+00:00">2018-05-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DotNetCore/" itemprop="url" rel="index"><span itemprop="name">DotNetCore</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="DotNetCore使用Docker部署"><a href="#DotNetCore使用Docker部署" class="headerlink" title="DotNetCore使用Docker部署"></a>DotNetCore使用Docker部署</h1><h2 id="docker安装（ubuntu16-04）"><a href="#docker安装（ubuntu16-04）" class="headerlink" title="docker安装（ubuntu16.04）"></a>docker安装（ubuntu16.04）</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>

<h2 id="拉取microsoft-dotnet镜像"><a href="#拉取microsoft-dotnet镜像" class="headerlink" title="拉取microsoft/dotnet镜像"></a>拉取microsoft/dotnet镜像</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-<span class="number">172</span>-<span class="number">31</span>-<span class="number">16</span>-<span class="number">20</span>:~$ sudo docker pull microsoft/dotnet</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling <span class="keyword">from</span> microsoft/dotnet</span><br><span class="line">cc1a78bfd46b: Pull complete</span><br><span class="line"><span class="number">6861473222</span>a6: Pull complete</span><br><span class="line"><span class="number">7</span>e0b9c3b5ae0: Pull complete</span><br><span class="line"><span class="number">3</span>ec98735f56f: Pull complete</span><br><span class="line"><span class="number">8</span>b3d41e9a6c9: Pull complete</span><br><span class="line"><span class="number">92</span>c2ea8451ce: Pull complete</span><br><span class="line">e321ed356c13: Pull complete</span><br><span class="line">Digest: sha256:ec26f9d34e3e8a85eb3f0d269170e5502bdee7d1ed46ddc1356d9ba6d245e6fa</span><br><span class="line">Status: Downloaded newer image for microsoft/dotnet:latest</span><br></pre></td></tr></table></figure>

<h2 id="运行microsoft-dotnet镜像"><a href="#运行microsoft-dotnet镜像" class="headerlink" title="运行microsoft/dotnet镜像"></a>运行microsoft/dotnet镜像</h2><p>使用<code>docker run &lt;image&gt;</code>可以启动镜像，通过指定参数<code>-it</code>以交互模式（进入容器内部）启动<br><code>--rm</code> 退出时，删除容器。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//启动一个dotnet镜像</span><br><span class="line">$ docker <span class="keyword">run</span><span class="bash"> --rm -it microsoft/dotnet</span></span><br><span class="line"></span><br><span class="line">//创建项目名为docker.Web的.NET Core MVC项目</span><br><span class="line">dotnet new mvc -n docker.web</span><br><span class="line"></span><br><span class="line">//进入docker.web文件夹</span><br><span class="line">cd docker.web</span><br><span class="line"></span><br><span class="line">//启动.NET Core MVC项目</span><br><span class="line">dotnet <span class="keyword">run</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-<span class="number">172</span>-<span class="number">31</span>-<span class="number">16</span>-<span class="number">20</span>:~$ sudo docker <span class="keyword">run</span><span class="bash"> --rm -it microsoft/dotnet</span></span><br><span class="line">root@b2ce07e9f5e5:/<span class="comment"># dotnet new mvc -n docker.web</span></span><br><span class="line">The template <span class="string">&quot;ASP.NET Core Web App (Model-View-Controller)&quot;</span> was created successfully.</span><br><span class="line">This template contains technologies <span class="keyword">from</span> parties other than Microsoft, see https://aka.ms/template-<span class="number">3</span>pn for details.</span><br><span class="line"></span><br><span class="line">Processing post-creation actions...</span><br><span class="line">Running <span class="string">&#x27;dotnet restore&#x27;</span> on docker.web/docker.web.csproj...</span><br><span class="line">  Restoring packages for /docker.web/docker.web.csproj...</span><br><span class="line">  Generating MSBuild file /docker.web/obj/docker.web.csproj.nuget.g.props.</span><br><span class="line">  Generating MSBuild file /docker.web/obj/docker.web.csproj.nuget.g.targets.</span><br><span class="line">  Restore completed in <span class="number">1.69</span> sec for /docker.web/docker.web.csproj.</span><br><span class="line">  Restoring packages for /docker.web/docker.web.csproj...</span><br><span class="line">  Restore completed in <span class="number">338.5</span> ms for /docker.web/docker.web.csproj.</span><br><span class="line"></span><br><span class="line">Restore succeeded.</span><br><span class="line"></span><br><span class="line">root@b2ce07e9f5e5:/<span class="comment"># cd docker.web</span></span><br><span class="line">root@b2ce07e9f5e5:/docker.web<span class="comment"># dotnet run</span></span><br><span class="line">warn: Microsoft.AspNetCore.DataProtection.KeyManagement.XmlKeyManager[<span class="number">35</span>]</span><br><span class="line">      No XML encryptor configured. Key &#123;<span class="number">392</span>f49bb-<span class="number">6372</span>-<span class="number">47</span>a0-a34b-<span class="number">94</span>b82a079812&#125; may be persisted to storage in unencrypted form.</span><br><span class="line">warn: Microsoft.AspNetCore.Server.Kestrel[<span class="number">0</span>]</span><br><span class="line">      Unable to bind to http://localhost:<span class="number">5000</span> on the IPv6 loopback interface: <span class="string">&#x27;Error -99 EADDRNOTAVAIL address not available&#x27;</span>.</span><br><span class="line">Hosting environment: Production</span><br><span class="line">Content root path: /docker.web</span><br><span class="line">Now listening on: http://localhost:<span class="number">5000</span></span><br><span class="line">Application started. Press Ctrl+C to shut down.</span><br></pre></td></tr></table></figure>

<h2 id="挂载源代码"><a href="#挂载源代码" class="headerlink" title="挂载源代码"></a>挂载源代码</h2><h3 id="宿主机安装-NET-Core-SDK"><a href="#宿主机安装-NET-Core-SDK" class="headerlink" title="宿主机安装.NET Core SDK"></a>宿主机安装.NET Core SDK</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget -q packages-microsoft-prod.deb https:&#x2F;&#x2F;packages.microsoft.com&#x2F;config&#x2F;ubuntu&#x2F;16.04&#x2F;packages-microsoft-prod.deb</span><br><span class="line">sudo dpkg -i packages-microsoft-prod.deb</span><br><span class="line">sudo apt-get install apt-transport-https</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install dotnet-sdk-2.1.200</span><br></pre></td></tr></table></figure>

<p>安装完毕后，我们依次执行以下命令创建一个.NET Core MVC项目:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;回到根目录</span><br><span class="line">$ cd $HOME</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;创建demo文件夹</span><br><span class="line">$ mkdir demo</span><br><span class="line">$ cd demo</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;创建项目名为docker.web的.NET Core MVC项目</span><br><span class="line">sudo dotnet new mvc -n docker.web</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;进入docker.web文件夹</span><br><span class="line">cd docker.web</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;启动.NET Core MVC项目</span><br><span class="line">sudo dotnet run</span><br></pre></td></tr></table></figure>

<p><code>sudo lsof -i :5000</code>：查看5000端口信息</p>
<h3 id="挂载宿主机项目到容器中"><a href="#挂载宿主机项目到容器中" class="headerlink" title="挂载宿主机项目到容器中"></a>挂载宿主机项目到容器中</h3><p>在启动Docker镜像时，Docker允许我们通过使用<code>-v</code>参数挂载宿主机的文件到容器的指定目录下。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 命令中的`\`结合`Enter`键构成换行符，允许我们换行输入一个长命令。</span><br><span class="line">$ sudo docker <span class="keyword">run</span><span class="bash"> --rm -it \</span></span><br><span class="line"><span class="bash">-v <span class="variable">$HOME</span>/dotnet/docker.web:/app \</span></span><br><span class="line"><span class="bash">microsoft/dotnet:latest</span></span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-172-31-16-20:~$ sudo docker run --rm -it \</span><br><span class="line">&gt; -v $HOME&#x2F;dotnet&#x2F;docker.web:&#x2F;app \</span><br><span class="line">&gt; microsoft&#x2F;dotnet:latest</span><br><span class="line">root@4e0ae54991c4:&#x2F;# ls</span><br><span class="line">app  boot  etc   lib    media  opt   root  sbin  sys  usr</span><br><span class="line">bin  dev   home  lib64  mnt    proc  run   srv   tmp  var</span><br><span class="line">root@4e0ae54991c4:&#x2F;# cd app</span><br><span class="line">root@4e0ae54991c4:&#x2F;app# ls</span><br><span class="line">Controllers  Startup.cs                    appsettings.json   docker.web.csproj</span><br><span class="line">Models       Views                         bin                obj</span><br><span class="line">Program.cs   appsettings.Development.json  bundleconfig.json  wwwroot</span><br><span class="line">root@4e0ae54991c4:&#x2F;app# dotnet run</span><br><span class="line">warn: Microsoft.AspNetCore.DataProtection.KeyManagement.XmlKeyManager[35]</span><br><span class="line">      No XML encryptor configured. Key &#123;3600e0ea-f9cc-4c43-b75f-58665338c060&#125; may be persisted to storage in unencrypted form.</span><br><span class="line">warn: Microsoft.AspNetCore.Server.Kestrel[0]</span><br><span class="line">      Unable to bind to http:&#x2F;&#x2F;localhost:5000 on the IPv6 loopback interface: &#39;Error -99 EADDRNOTAVAIL address not available&#39;.</span><br><span class="line">Hosting environment: Production</span><br><span class="line">Content root path: &#x2F;app</span><br><span class="line">Now listening on: http:&#x2F;&#x2F;localhost:5000</span><br><span class="line">Application started. Press Ctrl+C to shut down.</span><br></pre></td></tr></table></figure>

<p>上面说到是以共享的形式，而不是容器拥有一份宿主机目录的拷贝，意味着，在宿主机上对目录的更改，会即时反应到容器中。但反过来，容器中对共享目录的更改，不会反应到宿主机上，不然就打破了容器具有的隔离特性。</p>
<h3 id="使用Dockerfile部署"><a href="#使用Dockerfile部署" class="headerlink" title="使用Dockerfile部署"></a>使用Dockerfile部署</h3><p>Dockerfile用来定义你将要在容器中执行的系列操作。我们来创建一个Dockerfile：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;确保进入我们创建的MVC项目目录中去</span><br><span class="line">$ cd $HOME&#x2F;demo&#x2F;HelloDocker.Web</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;使用touch命令创建Dockerfile</span><br><span class="line">$ sudo touch Dockerfile</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;使用vi命令编辑Dockerfile</span><br><span class="line">sudo vim Dockerfile</span><br></pre></td></tr></table></figure>

<p>填入以下内容：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> microsoft/dotnet:latest</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> dotnet restore</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">5000</span></span><br><span class="line"><span class="keyword">ENV</span> ASPNETCORE_URLS http://*:<span class="number">5000</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;dotnet&quot;</span>,<span class="string">&quot;run&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><code>wq</code>:保存退出</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span>：指定容器使用的镜像</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash">：指定工作目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash">：复制当前目录（其中.即代表当前目录）到容器中的/app目录下</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">：命令指定容器中执行的命令</span></span><br><span class="line"><span class="keyword">EXPOSE</span>：指定容器暴露的端口号</span><br><span class="line"><span class="keyword">ENV</span>：指定环境参数，上面用来告诉.NETCore项目在所有网络接口上监听<span class="number">5000</span>端口</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash">：制定容器的入口点</span></span><br></pre></td></tr></table></figure>

<p>使用<code>docker build -t &lt;name&gt; &lt;path&gt;</code>指令打包镜像:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t docker.web .</span><br></pre></td></tr></table></figure>

<p><code>.</code>：表示当前路径</p>
<p>运行结果：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-<span class="number">172</span>-<span class="number">31</span>-<span class="number">16</span>-<span class="number">20</span>:~/dotnet/docker.web$ sudo docker build -t docker.web .</span><br><span class="line">Sending build context to Docker daemon  <span class="number">4.937</span>MB</span><br><span class="line">Step <span class="number">1</span>/<span class="number">7</span> : <span class="keyword">FROM</span> microsoft/dotnet:latest</span><br><span class="line"> ---&gt; <span class="number">2</span>ac9a416f201</span><br><span class="line">Step <span class="number">2</span>/<span class="number">7</span> : <span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line">Removing intermediate container <span class="number">921079</span>b99047</span><br><span class="line"> ---&gt; <span class="number">9449738</span>bc5a1</span><br><span class="line">Step <span class="number">3</span>/<span class="number">7</span> : <span class="keyword">COPY</span><span class="bash"> . /app</span></span><br><span class="line"> ---&gt; b64089162379</span><br><span class="line">Step <span class="number">4</span>/<span class="number">7</span> : <span class="keyword">RUN</span><span class="bash"> dotnet restore</span></span><br><span class="line"> ---&gt; Running in <span class="number">0</span>f13fc033144</span><br><span class="line">  Restore completed in <span class="number">76.09</span> ms for /app/docker.web.csproj.</span><br><span class="line">  Restoring packages for /app/docker.web.csproj...</span><br><span class="line">  Restore completed in <span class="number">499.14</span> ms for /app/docker.web.csproj.</span><br><span class="line">Removing intermediate container <span class="number">0</span>f13fc033144</span><br><span class="line"> ---&gt; <span class="number">31</span>a054861344</span><br><span class="line">Step <span class="number">5</span>/<span class="number">7</span> : <span class="keyword">EXPOSE</span> <span class="number">5000</span></span><br><span class="line"> ---&gt; Running in <span class="number">2</span>a87ea69cb01</span><br><span class="line">Removing intermediate container <span class="number">2</span>a87ea69cb01</span><br><span class="line"> ---&gt; <span class="number">83</span>e3c278ae44</span><br><span class="line">Step <span class="number">6</span>/<span class="number">7</span> : <span class="keyword">ENV</span> ASPNETCORE_URLS http://*:<span class="number">5000</span></span><br><span class="line"> ---&gt; Running in <span class="number">535</span>c7da1ced9</span><br><span class="line">Removing intermediate container <span class="number">535</span>c7da1ced9</span><br><span class="line"> ---&gt; <span class="number">4965</span>bd215b81</span><br><span class="line">Step <span class="number">7</span>/<span class="number">7</span> : <span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;dotnet&quot;</span>,<span class="string">&quot;run&quot;</span>]</span></span><br><span class="line"> ---&gt; Running in d023e6d8160b</span><br><span class="line">Removing intermediate container d023e6d8160b</span><br><span class="line"> ---&gt; eb265d4f49cd</span><br><span class="line">Successfully built eb265d4f49cd</span><br><span class="line">Successfully tagged docker.web:latest</span><br></pre></td></tr></table></figure>

<p>运行新打包的镜像，并通过<code>-p</code>参数映射容器的5000到宿主机的80端口，其中<code>-d</code>参数告诉docker以后台任务形式运行镜像,<code>--rm</code>退出时删除容器,<code>--name</code>指定容器名称。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="keyword">run</span><span class="bash"> --name dockerweb -d --rm -p 80:5000 docker.web</span></span><br></pre></td></tr></table></figure>

<p>通过<code>curl -i http://localhost</code>验证。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ip-172-31-16-20:~$ curl -i http:&#x2F;&#x2F;localhost</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Date: Tue, 15 May 2018 05:43:45 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Server: Kestrel</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;utf-8&quot; &#x2F;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot; &#x2F;&gt;</span><br><span class="line">    &lt;title&gt;Home Page - docker.web&lt;&#x2F;title&gt;</span><br></pre></td></tr></table></figure>

<p>至此，完成dotnetcore项目部署。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/sheng-jie/p/8107877.html#autoid-4-0-0">http://www.cnblogs.com/sheng-jie/p/8107877.html#autoid-4-0-0</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/savorboard/p/dotnetcore-docker.html">http://www.cnblogs.com/savorboard/p/dotnetcore-docker.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/11/Docker%20Compose%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/11/Docker%20Compose%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Docker Compose配置文件详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-11 14:38:31" itemprop="dateCreated datePublished" datetime="2018-05-11T14:38:31+00:00">2018-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker-Compose/" itemprop="url" rel="index"><span itemprop="name">Docker Compose</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker-Compose配置文件详解"><a href="#Docker-Compose配置文件详解" class="headerlink" title="Docker Compose配置文件详解"></a>Docker Compose配置文件详解</h1><p>参考官网：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#service-configuration-reference">https://docs.docker.com/compose/compose-file/#service-configuration-reference</a></p>
<p>Compose文件是一个定义服务， 网络和 卷的YAML文件 。Compose文件的默认路径是。./docker-compose.yml</p>
<p>标准配置文件应该包含 version、services、networks 三大部分，其中最关键的就是 services 和 networks 两个部分。</p>
<p>提示：您可以对此文件使用a .yml或.yaml扩展名。他们都工作。</p>
<h2 id="image"><a href="#image" class="headerlink" title="image"></a>image</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  dotnetcoreapp1:</span><br><span class="line">    image: dotnetcoreapp</span><br></pre></td></tr></table></figure>

<p>在 services 标签下的第二级标签是 dotnetcoreapp1，这个名字是用户自己自定义，它就是服务名称。</p>
<p>image 则是指定服务的镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会尝试拉取这个镜像。</p>
<h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><p>在构建时应用的配置选项</p>
<p>build 可以指定为构建上下文的路径：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  webapp:</span><br><span class="line">    build: ./dir</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  webapp:</span><br><span class="line">    build:</span><br><span class="line">      context: ./dir</span><br><span class="line">      dockerfile: Dockerfile-alternate</span><br><span class="line">      args:</span><br><span class="line">        buildno: <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>如果同时指定build和image，那么会在./dir中生成名为webapp和标记的镜像tag。</p>
<h3 id="context"><a href="#context" class="headerlink" title="context"></a>context</h3><p>可以是包含Dockerfile的目录的路径，也可以是到git存储库的URL。</p>
<p>当提供的值是相对路径时，它被解释为相对于撰写文件的位置。 这个目录也是发送到Docker守护进程的构建上下文。</p>
<p>使用生成的名称构建并标记它，然后使用该镜像。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: ./dir</span><br></pre></td></tr></table></figure>

<h3 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h3><p>dockerfile作为备用，并且需要提供路径。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  dockerfile: Dockerfile-alternate</span><br></pre></td></tr></table></figure>

<h3 id="args"><a href="#args" class="headerlink" title="args"></a>args</h3><p>添加构建参数，这些参数是仅在构建过程中可访问的环境变量。</p>
<p>首先，指定Dockerfile：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> buildno</span><br><span class="line"><span class="keyword">ARG</span> gitcommithash</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;Build number: <span class="variable">$buildno</span>&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;Based on commit: <span class="variable">$gitcommithash</span>&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>然后指定参数。 您可以传递一个映射或一个列表：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  args:</span><br><span class="line">    buildno: <span class="number">1</span></span><br><span class="line">    gitcommithash: cdc3b19</span><br><span class="line"></span><br><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  args:</span><br><span class="line">    - buildno=<span class="number">1</span></span><br><span class="line">    - gitcommithash=cdc3b19</span><br></pre></td></tr></table></figure>

<p>指定构建参数时可以省略该值，在这种情况下，构建时的值是构成运行环境中的值。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">args:</span><br><span class="line">  - buildno</span><br><span class="line">  - gitcommithash</span><br></pre></td></tr></table></figure>

<p>注意：YAML 的布尔值（true, false, yes, no, on, off）必须要使用引号引起来（单引号、双引号均可），否则会当成字符串解析。</p>
<h3 id="cache-from"><a href="#cache-from" class="headerlink" title="cache_from"></a>cache_from</h3><p>v3.2新添加</p>
<p>用于缓存解析的镜像列表</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  cache_from:</span><br><span class="line">    - alpine:latest</span><br><span class="line">    - corp/web_app:<span class="number">3.14</span></span><br></pre></td></tr></table></figure>

<h3 id="labels"><a href="#labels" class="headerlink" title="labels"></a>labels</h3><p>v3.3新添加</p>
<p>使用Docker标签将元数据添加到生成的图像。 您可以使用数组或字典。</p>
<p>建议您使用反向DNS标记来防止您的标签与其他软件使用的标签冲突。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  labels:</span><br><span class="line">    com.example.description: <span class="string">&quot;Accounting webapp&quot;</span></span><br><span class="line">    com.example.department: <span class="string">&quot;Finance&quot;</span></span><br><span class="line">    com.example.label-with-empty-value: <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  labels:</span><br><span class="line">    - <span class="string">&quot;com.example.description=Accounting webapp&quot;</span></span><br><span class="line">    - <span class="string">&quot;com.example.department=Finance&quot;</span></span><br><span class="line">    - <span class="string">&quot;com.example.label-with-empty-value&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="shm-size"><a href="#shm-size" class="headerlink" title="shm_size"></a>shm_size</h3><p>v3.5新添加</p>
<p>为此版本的容器设置/dev/shm分区的大小。 指定为表示字节数的整数值或表示字节值的字符串。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  shm_size: <span class="string">&#x27;2gb&#x27;</span></span><br><span class="line"></span><br><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  shm_size: <span class="number">10000000</span></span><br></pre></td></tr></table></figure>

<h2 id="cap-add-cap-drop"><a href="#cap-add-cap-drop" class="headerlink" title="cap_add, cap_drop"></a>cap_add, cap_drop</h2><p>添加或删除容器功能</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cap_add:</span><br><span class="line">  - ALL</span><br><span class="line"></span><br><span class="line">cap_drop:</span><br><span class="line">  - NET_ADMIN</span><br><span class="line">  - SYS_ADMIN</span><br></pre></td></tr></table></figure>

<h2 id="command"><a href="#command" class="headerlink" title="command"></a>command</h2><p>command 覆盖容器启动后默认执行的命令</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command: bundle exec thin -p <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p>该命令也可以是一个列表，方式类似于dockerfile：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command: [<span class="string">&quot;bundle&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;thin&quot;</span>, <span class="string">&quot;-p&quot;</span>, <span class="string">&quot;3000&quot;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="configs"><a href="#configs" class="headerlink" title="configs"></a>configs</h2><p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/swarm/configs/" title="configs命令">configs命令</a></p>
<p>Grant access to configs on a per-service basis using the per-service configs configuration.</p>
<p>为每个服务配置配置为每个服务授予对配置的访问权限。支持两种不同的语法变体。</p>
<p>注意：配置必须已经存在或在此堆栈文件的顶级配置配置中定义，否则堆栈部署失败。</p>
<h3 id="SHORT-SYNTAX"><a href="#SHORT-SYNTAX" class="headerlink" title="SHORT SYNTAX"></a>SHORT SYNTAX</h3><p>简短的语法变体只能指定配置​​名称</p>
<p>支持v3.3以上</p>
<p>以下示例使用简短语法将redis服务访问权限授予my_config和my_other_config配置。 my_config的值被设置为文件./my_config.txt的内容，my_other_config被定义为外部资源，这意味着它已经在Docker中定义，可以通过运行docker config create命令或通过另一个堆栈部署。如果外部配置不存在，堆栈部署将失败并显示配置未找到错误。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">1</span></span><br><span class="line">    configs:</span><br><span class="line">      - my_config</span><br><span class="line">      - my_other_config</span><br><span class="line">configs:</span><br><span class="line">  my_config:</span><br><span class="line">    file: ./my_config.txt</span><br><span class="line">  my_other_config:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<h3 id="LONG-SYNTAX"><a href="#LONG-SYNTAX" class="headerlink" title="LONG SYNTAX"></a>LONG SYNTAX</h3><p>长的语法提供了在服务的任务容器中如何创建配置的更细粒度。</p>
<p>source：Docker中配置的名称。</p>
<p>target：要在服务的任务容器中安装的文件的路径和名称。如果未指定，则默认为 <code>/&lt;source&gt;</code>。</p>
<p>uid和gid：在服务的任务容器中拥有安装的配置文件的数字UID或GID。如果未指定，则在Linux上均默认为0。 Windows不支持。</p>
<p>mode：安装在服务任务容器内的文件的权限，采用八进制表示法。例如，0444代表可读。缺省值为0444.由于Configs被挂载在临时文件系统中，因此它们不能写入，因此如果设置了可写位，它将被忽略。可执行位可以被设置。如果您不熟悉UNIX文件权限模式，则可能会发现此权限计算器很有用。</p>
<p>以下示例将容器中my_config的名称设置为redis_config，将模式设置为0440（可读组），并将用户和组设置为103. redis服务无法访问my_other_config配置</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">1</span></span><br><span class="line">    configs:</span><br><span class="line">      - source: my_config</span><br><span class="line">        target: /redis_config</span><br><span class="line">        uid: <span class="string">&#x27;103&#x27;</span></span><br><span class="line">        gid: <span class="string">&#x27;103&#x27;</span></span><br><span class="line">        mode: <span class="number">0440</span></span><br><span class="line">configs:</span><br><span class="line">  my_config:</span><br><span class="line">    file: ./my_config.txt</span><br><span class="line">  my_other_config:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<p>您可以授予多个配置的服务访问权限，您可以混合使用长短语法。定义配置并不意味着授予服务访问权限。</p>
<h2 id="container-name"><a href="#container-name" class="headerlink" title="container_name"></a>container_name</h2><p>指定自定义容器名称</p>
<p>由于Docker容器名称必须是唯一的，因此如果您指定了自定义名称，则无法将服务扩展到1个容器之外。 试图这样做会导致错误。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">container_name: my-web-container</span><br></pre></td></tr></table></figure>

<p>注意：当使用（版本3）Compose文件在群集模式下部署堆栈时，忽略此选项。</p>
<h2 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h2><p>指定与部署和运行服务相关的配置。 这只在部署到使用docker stack部署的群集时才生效，并且被docker-compose up和docker-compose run忽略。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">6</span></span><br><span class="line">      update_config:</span><br><span class="line">        parallelism: <span class="number">2</span></span><br><span class="line">        delay: <span class="number">10</span>s</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br></pre></td></tr></table></figure>

<h3 id="ENDPOINT-MODE"><a href="#ENDPOINT-MODE" class="headerlink" title="ENDPOINT_MODE"></a>ENDPOINT_MODE</h3><p>指定连接到群组的外部客户端的服务发现方法。</p>
<p>v3.3独有</p>
<p><code>endpoint_mode：vip</code> - Docker为服务分配一个虚拟IP（VIP），作为客户端到达网络服务的“前端”。 Docker在客户端和可用的工作节点之间为服务路由请求，而客户端不知道有多少节点参与服务或其IP地址或端口。 （这是默认设置。）</p>
<p><code>endpoint_mode：dnsrr</code> - DNS轮询（DNSRR）服务发现不使用单个虚拟IP。 Docker为服务设置DNS条目，使得服务名称的DNS查询返回一个IP地址列表，并且客户端直接连接到其中的一个。 如果您想使用自己的负载平衡器，或者混合Windows和Linux应用程序，则DNS轮询功能非常有用。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.3&quot;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  wordpress:</span><br><span class="line">    image: wordpress</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;8080:80&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      - overlay</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: <span class="number">2</span></span><br><span class="line">      endpoint_mode: vip</span><br><span class="line"></span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql</span><br><span class="line">    volumes:</span><br><span class="line">       - db-data:/var/lib/mysql/data</span><br><span class="line">    networks:</span><br><span class="line">       - overlay</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: <span class="number">2</span></span><br><span class="line">      endpoint_mode: dnsrr</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  db-data:</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  overlay:</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/service_create/">docker service create</a></p>
<h3 id="LABELS"><a href="#LABELS" class="headerlink" title="LABELS"></a>LABELS</h3><p>指定服务的标签。 这些标签仅在服务上设置，而不在服务的任何容器上设置。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: web</span><br><span class="line">    deploy:</span><br><span class="line">      labels:</span><br><span class="line">        com.example.description: <span class="string">&quot;This label will appear on the web service&quot;</span></span><br></pre></td></tr></table></figure>

<p>要在容器上设置标签，请在部署之外使用标签键：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: web</span><br><span class="line">    labels:</span><br><span class="line">      com.example.description: <span class="string">&quot;This label will appear on all containers for the web service&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="MODE"><a href="#MODE" class="headerlink" title="MODE"></a>MODE</h3><p>全局（每个群集节点只有一个容器）或复制（指定数量的容器）。 默认值被复制。 （要了解更多信息，请参阅swarm主题中的复制和全局服务。）</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  worker:</span><br><span class="line">    image: dockersamples/examplevotingapp_worker</span><br><span class="line">    deploy:</span><br><span class="line">      mode: global</span><br></pre></td></tr></table></figure>

<h3 id="PLACEMENT"><a href="#PLACEMENT" class="headerlink" title="PLACEMENT"></a>PLACEMENT</h3><p>指定约束和偏好的位置。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br><span class="line">    deploy:</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.role == manager</span><br><span class="line">          - engine.labels.operatingsystem == ubuntu <span class="number">14.04</span></span><br><span class="line">        preferences:</span><br><span class="line">          - spread: node.labels.zone</span><br></pre></td></tr></table></figure>

<h3 id="REPLICAS"><a href="#REPLICAS" class="headerlink" title="REPLICAS"></a>REPLICAS</h3><p>如果服务被复制（这是默认设置），请指定在任何给定时间应该运行的容器数量。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  worker:</span><br><span class="line">    image: dockersamples/examplevotingapp_worker</span><br><span class="line">    networks:</span><br><span class="line">      - frontend</span><br><span class="line">      - backend</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: <span class="number">6</span></span><br></pre></td></tr></table></figure>

<h3 id="RESOURCES"><a href="#RESOURCES" class="headerlink" title="RESOURCES"></a>RESOURCES</h3><p>配置资源限制。</p>
<p>注意：这会替换版本3之前的Compose文件（cpu_shares，cpu_quota，cpuset，mem_limit，memswap_limit，mem_swappiness）中的非群集模式的旧资源约束选项，如升级2.x版至3.x中所述。</p>
<p>在这个一般的例子中，Redis服务限制使用不超过50M的内存和0.50（50％）的可用处理时间（CPU），并且具有20M的内存和0.25个CPU时间保留（总是可用）。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: <span class="string">&#x27;0.50&#x27;</span></span><br><span class="line">          memory: <span class="number">50</span>M</span><br><span class="line">        reservations:</span><br><span class="line">          cpus: <span class="string">&#x27;0.25&#x27;</span></span><br><span class="line">          memory: <span class="number">20</span>M</span><br></pre></td></tr></table></figure>

<p>这里描述的选项特定于部署密钥和群集模式。 如果要为非群部署设置资源约束，请使用Compose文件格式版本2 CPU，内存和其他资源选项。</p>
<p>** 内存异常（OOME）**<br>如果您的服务或容器尝试使用比系统可用的内存更多的内存，则可能会遇到内存异常（OOME），并且容器或Docker守护程序可能会被内核OOM杀手所杀。 要防止发生这种情况，请确保您的应用程序在具有足够内存的主机上运行，并且请参阅了解耗尽内存的风险。</p>
<h3 id="RESTART-POLICY"><a href="#RESTART-POLICY" class="headerlink" title="RESTART_POLICY"></a>RESTART_POLICY</h3><p>配置是否以及如何在退出时重新启动容器。 取代重新启动。</p>
<p><code>condition</code>:无，失败或任何（默认：任何）。<br><code>delay</code>:在重启尝试之间等待多长时间，指定为持续时间（默认值：0）。<br><code>max_attempts</code>:放弃之前尝试重新启动容器的次数（默认值：永不放弃）。 如果重新启动在配置的窗口内没有成功，则此尝试不计入配置的max_attempts值。 例如，如果max_attempts设置为’2’，并且第一次尝试重新启动失败，则可能会尝试重新启动两次以上。<br><code>window</code>：在决定重新启动是否成功之前等待多久，指定为持续时间（默认值：立即决定）。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br><span class="line">        delay: <span class="number">5</span>s</span><br><span class="line">        max_attempts: <span class="number">3</span></span><br><span class="line">        window: <span class="number">120</span>s</span><br></pre></td></tr></table></figure>

<h3 id="UPDATE-CONFIG"><a href="#UPDATE-CONFIG" class="headerlink" title="UPDATE_CONFIG"></a>UPDATE_CONFIG</h3><p>配置如何更新服务。 用于配置滚动更新。</p>
<p><code>parallelism</code>：一次更新容器的数量。<br><code>delay</code>：更新一组容器之间的等待时间。<br><code>failure_action</code>：更新失败时该怎么做。 继续，回滚或暂停之一（默认：暂停）。<br><code>monitor</code>：每次任务更新后监视失败的时间（ns | us | ms | s | m | h）（默认为0）。<br><code>max_failure_ratio</code>：在更新期间容忍的失败率。<br><code>order</code>：更新期间的操作顺序。 停止优先（旧任务在开始新任务之前停止）或者先启动（首先启动新任务，并且正在运行的任务短暂重叠）（默认停止优先）注意：只支持v3.4及更高版本。</p>
<p>order支持v3.4或更高版本</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.4&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  vote:</span><br><span class="line">    image: dockersamples/examplevotingapp_vote:before</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">2</span></span><br><span class="line">      update_config:</span><br><span class="line">        parallelism: <span class="number">2</span></span><br><span class="line">        delay: <span class="number">10</span>s</span><br><span class="line">        order: stop-first</span><br></pre></td></tr></table></figure>





<h2 id="devices"><a href="#devices" class="headerlink" title="devices"></a>devices</h2><p>设备映射列表。 使用与–device docker客户端创建选项相同的格式。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">devices:</span><br><span class="line">  - <span class="string">&quot;/dev/ttyUSB0:/dev/ttyUSB0&quot;</span></span><br></pre></td></tr></table></figure>

<p>注意：当使用（版本3）Compose文件在群集模式下部署堆栈时，忽略此选项。</p>
<h2 id="depends-on"><a href="#depends-on" class="headerlink" title="depends_on"></a>depends_on</h2><p>服务之间的快速依赖关系，服务依赖关系导致以下行为：</p>
<p><code>docker-compose up</code> 以依赖顺序启动服务。 在以下示例中，db和redis在web之前启动。</p>
<p><code>docker-up up SERVICE</code> 自动包含SERVICE的依赖关系。 在下面的例子中，docker-compose up web也会创建并启动db和redis。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">      - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br></pre></td></tr></table></figure>

<p>使用depends_on时有几件事要注意：</p>
<p>在启动web之前，depends_on不会等待db和redis“准备就绪” - 只有在它们启动之前。 如果您需要等待服务准备就绪，请参阅控制启动顺序以了解有关此问题的更多信息以及解决此问题的策略。</p>
<p>版本3不再支持depends_on的条件形式。</p>
<p>使用版本3撰写文件在群集模式下部署堆栈时，将忽略depends_on选项。</p>
<h2 id="dns"><a href="#dns" class="headerlink" title="dns"></a>dns</h2><p>自定义DNS服务器。 可以是单个值或列表。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dns: <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line">dns:</span><br><span class="line">  - <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line">  - <span class="number">9.9</span>.<span class="number">9.9</span></span><br></pre></td></tr></table></figure>

<h2 id="dns-search"><a href="#dns-search" class="headerlink" title="dns_search"></a>dns_search</h2><p>自定义DNS搜索域。 可以是单个值或列表。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dns_search: example.com</span><br><span class="line">dns_search:</span><br><span class="line">  - dc1.example.com</span><br><span class="line">  - dc2.example.com</span><br></pre></td></tr></table></figure>

<h2 id="tmpfs"><a href="#tmpfs" class="headerlink" title="tmpfs"></a>tmpfs</h2><p>v2.0以上</p>
<p>在容器中装入一个临时文件系统。 可以是单个值或列表。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tmpfs: /<span class="keyword">run</span></span><br><span class="line"><span class="bash">tmpfs:</span></span><br><span class="line">  - /<span class="keyword">run</span></span><br><span class="line"><span class="bash">  - /tmp</span></span><br></pre></td></tr></table></figure>

<p>注意：在使用（版本3-3.5）撰写文件的群集模式下部署堆栈时，忽略此选项。</p>
<p>v3.6以上</p>
<p>在容器中装入一个临时文件系统。 Size参数以字节为单位指定tmpfs安装的大小。 无限制默认。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- type: tmpfs</span><br><span class="line">     target: /app</span><br><span class="line">     tmpfs:</span><br><span class="line">       size: <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<h2 id="entrypoint"><a href="#entrypoint" class="headerlink" title="entrypoint"></a>entrypoint</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">entrypoint</span><span class="bash">: /code/entrypoint.sh</span></span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">entrypoint</span><span class="bash">:</span></span><br><span class="line">    - php</span><br><span class="line">    - -d</span><br><span class="line">    - zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-<span class="number">20100525</span>/xdebug.so</span><br><span class="line">    - -d</span><br><span class="line">    - memory_limit=-<span class="number">1</span></span><br><span class="line">    - vendor/bin/phpunit</span><br></pre></td></tr></table></figure>

<p>注意：设置入口点都会使用ENTRYPOINT Dockerfile指令覆盖服务映像上设置的任何默认入口点，并清除映像上的任何默认命令 - 这意味着如果Dockerfile中存在CMD指令，则它将被忽略。</p>
<h2 id="env-file"><a href="#env-file" class="headerlink" title="env_file"></a>env_file</h2><p>从文件添加环境变量。 可以是单个值或列表。</p>
<p>如果您已经使用<code>docker-compose -f FILE</code>指定了Compose文件，则env_file中的路径与该文件所在的目录相关。</p>
<p>环境部分中声明的环境变量会覆盖这些值 - 即使这些值为空或未定义，也是如此。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">env_file: .<span class="keyword">env</span></span><br><span class="line"></span><br><span class="line">env_file:</span><br><span class="line">  - ./common.<span class="keyword">env</span></span><br><span class="line">  - ./apps/web.<span class="keyword">env</span></span><br><span class="line">  - /opt/secrets.<span class="keyword">env</span></span><br></pre></td></tr></table></figure>

<p>撰写Compose env文件中的每行都是VAR = VAL格式。 以＃开始的行被视为注释并被忽略。 空行也被忽略。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set Rails/Rack environment</span></span><br><span class="line">RACK_ENV=development</span><br></pre></td></tr></table></figure>

<p>注意：如果您的服务指定了构建选项，则在构建期间，环境文件中定义的变量不会自动显示。 使用build的args子选项来定义构建时环境变量。</p>
<p>定义的值并不会始终保持不变，列表中的值按照顺序执行，以最后值为准。</p>
<h2 id="environment"><a href="#environment" class="headerlink" title="environment"></a>environment</h2><p>添加环境变量。 您可以使用数组或字典。</p>
<p> 任何布尔值; true, false, yes no，需要用引号括起来以确保它们不被YML解析器转换为True或False。</p>
 <figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> environment:</span><br><span class="line">  RACK_ENV: development</span><br><span class="line">  SHOW: <span class="string">&#x27;true&#x27;</span></span><br><span class="line">  SESSION_SECRET:</span><br><span class="line"></span><br><span class="line">environment:</span><br><span class="line">  - RACK_ENV=development</span><br><span class="line">  - SHOW=true</span><br><span class="line">  - SESSION_SECRET</span><br></pre></td></tr></table></figure>

<p>注意：如果您的服务指定了构建选项，则在构建过程中定义的变量不会自动显示。 使用build的args子选项来定义构建时环境变量。</p>
<h2 id="expose"><a href="#expose" class="headerlink" title="expose"></a>expose</h2><p>公开端口而不将它们发布到主机 - 它们只能被链接服务访问。 只能指定内部端口。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">expose</span>:</span><br><span class="line"> - <span class="string">&quot;3000&quot;</span></span><br><span class="line"> - <span class="string">&quot;8000&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="external-links"><a href="#external-links" class="headerlink" title="external_links"></a>external_links</h2><p>链接到此Docker-compose.yml之外甚至Compose之外的容器，尤其是提供共享或公共服务的容器。 在指定容器名称和链接别名（CONTAINER：ALIAS）时，external_links遵循类似于旧版选项链接的语义。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">external_links:</span><br><span class="line"> - redis_1</span><br><span class="line"> - project_db_1:mysql</span><br><span class="line"> - project_db_1:postgresql</span><br></pre></td></tr></table></figure>

<h2 id="extra-hosts"><a href="#extra-hosts" class="headerlink" title="extra_hosts"></a>extra_hosts</h2><p>添加主机名映射。 使用与docker客户端–add-host参数相同的值。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">extra_hosts:</span><br><span class="line"> - <span class="string">&quot;somehost:162.242.195.82&quot;</span></span><br><span class="line"> - <span class="string">&quot;otherhost:50.31.209.229&quot;</span></span><br></pre></td></tr></table></figure>

<p>具有ip地址和主机名的条目在容器内的<code>/etc/hosts</code>中为该服务创建，例如：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">162.242</span>.<span class="number">195.82</span>  somehost</span><br><span class="line"><span class="number">50.31</span>.<span class="number">209.229</span>   otherhost</span><br></pre></td></tr></table></figure>

<h2 id="healthcheck"><a href="#healthcheck" class="headerlink" title="healthcheck"></a>healthcheck</h2><p>v2.1以上</p>
<p>配置运行的检查以确定此服务的容器是否“健康”。 查看<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/#usage" title="HEALTHCHECK Dockerfile">HEALTHCHECK Dockerfile</a>指令的文档以获取有关健康检查如何工作的详细信息。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">healthcheck</span><span class="bash">:</span></span><br><span class="line">  test: [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]</span><br><span class="line">  interval: <span class="number">1</span>m30s</span><br><span class="line">  timeout: <span class="number">10</span>s</span><br><span class="line">  retries: <span class="number">3</span></span><br><span class="line">  start_period: <span class="number">40</span>s</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hit the local web app</span></span><br><span class="line">test: [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># As above, but wrapped in /bin/sh. Both forms below are equivalent.</span></span><br><span class="line">test: [<span class="string">&quot;CMD-SHELL&quot;</span>, <span class="string">&quot;curl -f http://localhost || exit 1&quot;</span>]</span><br><span class="line">test: curl -f https://localhost || exit <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>要禁用图像设置的任何默认健康检查，您可以使用disable：true。 这相当于指定测试：[“NONE”]。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">healthcheck</span><span class="bash">:</span></span><br><span class="line">  disable: true</span><br></pre></td></tr></table></figure>

<h2 id="Specifying-durations"><a href="#Specifying-durations" class="headerlink" title="Specifying durations"></a>Specifying durations</h2><p>一些配置选项（如检查的间隔和超时子选项）以如下格式的字符串形式接受持续时间：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.5</span>s</span><br><span class="line"><span class="number">10</span>s</span><br><span class="line"><span class="number">1</span>m30s</span><br><span class="line"><span class="number">2</span>h32m</span><br><span class="line"><span class="number">5</span>h34m56s</span><br></pre></td></tr></table></figure>

<p>支持的单位是us，ms，s，m和h。</p>
<h2 id="isolation"><a href="#isolation" class="headerlink" title="isolation"></a>isolation</h2><p>指定容器的隔离技术。 在Linux上，唯一支持的值是默认值。 在Windows上，可接受的值是默认值，进程和hyperv。 有关详细信息，请参阅Docker Engine文档。</p>
<h2 id="labels-1"><a href="#labels-1" class="headerlink" title="labels"></a>labels</h2><p>使用Docker标签将元数据添加到容器。 您可以使用数组或字典。</p>
<p>建议您使用反向DNS标记来防止您的标签与其他软件使用的标签冲突。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">labels:</span><br><span class="line">  com.example.description: <span class="string">&quot;Accounting webapp&quot;</span></span><br><span class="line">  com.example.department: <span class="string">&quot;Finance&quot;</span></span><br><span class="line">  com.example.label-with-empty-value: <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">labels:</span><br><span class="line">  - <span class="string">&quot;com.example.description=Accounting webapp&quot;</span></span><br><span class="line">  - <span class="string">&quot;com.example.department=Finance&quot;</span></span><br><span class="line">  - <span class="string">&quot;com.example.label-with-empty-value&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="logging"><a href="#logging" class="headerlink" title="logging"></a>logging</h2><p>记录服务的配置。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logging:</span><br><span class="line">  driver: syslog</span><br><span class="line">  options:</span><br><span class="line">    syslog-address: <span class="string">&quot;tcp://192.168.0.42:123&quot;</span></span><br></pre></td></tr></table></figure>

<p>驱动程序名称指定服务容器的日志记录驱动程序，与docker run的–log-driver选项（此处记录）一样。</p>
<p>默认值是json-file。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver: <span class="string">&quot;json-file&quot;</span></span><br><span class="line">driver: <span class="string">&quot;syslog&quot;</span></span><br><span class="line">driver: <span class="string">&quot;none&quot;</span></span><br></pre></td></tr></table></figure>

<p>注意：只有<code>json-file</code>和<code>journald</code>驱动程序才能使日志直接从<code>docker-compose up</code>和<code>docker-compose logs</code>。 使用任何其他驱动程序不会打印任何日志。</p>
<p>使用选项键指定日志记录驱动程序的日志记录选项，就像<code>docker run</code>的–log-opt选项一样。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver: <span class="string">&quot;syslog&quot;</span></span><br><span class="line">options:</span><br><span class="line">  syslog-address: <span class="string">&quot;tcp://192.168.0.42:123&quot;</span></span><br></pre></td></tr></table></figure>

<p>默认驱动程序json-file具有限制存储日志量的选项。 为此，请使用键值对来获得最大存储大小和最大文件数量：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">options:</span><br><span class="line">  max-size: <span class="string">&quot;200k&quot;</span></span><br><span class="line">  max-file: <span class="string">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>

<p>上面显示的示例将存储日志文件，直到它们达到200kB的最大大小，然后旋转它们。 存储的单个日志文件的数量由最大文件值指定。 随着日志增长超出最大限制，旧日志文件将被删除以允许存储新日志。</p>
<p>以下是限制日志存储的示例docker-compose.yml文件：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  some-service:</span><br><span class="line">    image: some-service</span><br><span class="line">    logging:</span><br><span class="line">      driver: <span class="string">&quot;json-file&quot;</span></span><br><span class="line">      options:</span><br><span class="line">        max-size: <span class="string">&quot;200k&quot;</span></span><br><span class="line">        max-file: <span class="string">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="network-mode"><a href="#network-mode" class="headerlink" title="network_mode"></a>network_mode</h2><p>网络模式。 使用与docker客户端相同的值–net参数，以及特殊的表单服务：[服务名称]。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">network_mode: <span class="string">&quot;bridge&quot;</span></span><br><span class="line">network_mode: <span class="string">&quot;host&quot;</span></span><br><span class="line">network_mode: <span class="string">&quot;none&quot;</span></span><br><span class="line">network_mode: <span class="string">&quot;service:[service name]&quot;</span></span><br><span class="line">network_mode: <span class="string">&quot;container:[container name/id]&quot;</span></span><br></pre></td></tr></table></figure>

<p>network_mode：“host”不能与链接混合使用。</p>
<h2 id="networks"><a href="#networks" class="headerlink" title="networks"></a>networks</h2><p>加入网络，引用顶级网络密钥下的条目。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  some-service:</span><br><span class="line">    networks:</span><br><span class="line">     - some-network</span><br><span class="line">     - other-network</span><br></pre></td></tr></table></figure>

<h3 id="ALIASES"><a href="#ALIASES" class="headerlink" title="ALIASES"></a>ALIASES</h3><p>网络上此服务的别名（备用主机名）。 同一网络上的其他容器可以使用服务名称或别名来连接到某个服务的容器。</p>
<p>由于别名是网络范围的，相同的服务可以在不同的网络上具有不同的别名。</p>
<p>注意：网络范围的别名可以由多个容器共享，甚至可以由多个服务共享。 如果是，那么名称解析的确切容器的名称就不能保证。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  some-service:</span><br><span class="line">    networks:</span><br><span class="line">      some-network:</span><br><span class="line">        aliases:</span><br><span class="line">         - alias1</span><br><span class="line">         - alias3</span><br><span class="line">      other-network:</span><br><span class="line">        aliases:</span><br><span class="line">         - alias2</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: ./web</span><br><span class="line">    networks:</span><br><span class="line">      - new</span><br><span class="line"></span><br><span class="line">  worker:</span><br><span class="line">    build: ./worker</span><br><span class="line">    networks:</span><br><span class="line">      - legacy</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: mysql</span><br><span class="line">    networks:</span><br><span class="line">      new:</span><br><span class="line">        aliases:</span><br><span class="line">          - database</span><br><span class="line">      legacy:</span><br><span class="line">        aliases:</span><br><span class="line">          - mysql</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  new:</span><br><span class="line">  legacy:</span><br></pre></td></tr></table></figure>

<h3 id="IPV4-ADDRESS-IPV6-ADDRESS"><a href="#IPV4-ADDRESS-IPV6-ADDRESS" class="headerlink" title="IPV4_ADDRESS, IPV6_ADDRESS"></a>IPV4_ADDRESS, IPV6_ADDRESS</h3><p>加入网络时，为此服务的容器指定一个静态IP地址。</p>
<p>顶级网络部分中的相应网络配置必须具有覆盖每个静态地址的具有子网配置的ipam块。 如果需要IPv6寻址，则必须设置enable_ipv6选项，并且必须使用版本2.x Compose文件，如下所示。</p>
<p>注意：这些选项目前不在群集模式下工作。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2.1&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: busybox</span><br><span class="line">    command: ifconfig</span><br><span class="line">    networks:</span><br><span class="line">      app_net:</span><br><span class="line">        ipv4_address: <span class="number">172.16</span>.<span class="number">238.10</span></span><br><span class="line">        ipv6_address: <span class="number">2001</span>:<span class="number">3984</span>:<span class="number">3989</span>::<span class="number">10</span></span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  app_net:</span><br><span class="line">    driver: bridge</span><br><span class="line">    enable_ipv6: true</span><br><span class="line">    ipam:</span><br><span class="line">      driver: default</span><br><span class="line">      config:</span><br><span class="line">      -</span><br><span class="line">        subnet: <span class="number">172.16</span>.<span class="number">238.0</span>/<span class="number">24</span></span><br><span class="line">      -</span><br><span class="line">        subnet: <span class="number">2001</span>:<span class="number">3984</span>:<span class="number">3989</span>::/<span class="number">64</span></span><br></pre></td></tr></table></figure>

<h2 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pid: <span class="string">&quot;host&quot;</span></span><br></pre></td></tr></table></figure>

<p>将PID模式设置为主机PID模式。 这将打开容器与主机操作系统之间的共享PID地址空间。 使用此标志启动的容器可以访问和操作裸机的名称空间中的其他容器，反之亦然。</p>
<h2 id="ports"><a href="#ports" class="headerlink" title="ports"></a>ports</h2><p>公开端口</p>
<p>注意：端口映射与network_mode：host不兼容</p>
<h3 id="SHORT-SYNTAX-1"><a href="#SHORT-SYNTAX-1" class="headerlink" title="SHORT SYNTAX"></a>SHORT SYNTAX</h3><p>既可以指定两个端口（HOST：CONTAINER），也可以指定容器端口（选择临时主机端口）。</p>
<p>注意：以HOST：CONTAINER格式映射端口时，使用低于60的容器端口时可能会遇到错误结果，因为YAML会将格式为xx：yy的数字解析为基数为60的值。 出于这个原因，我们建议始终明确指定您的端口映射为字符串。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ports:</span><br><span class="line"> - <span class="string">&quot;3000&quot;</span></span><br><span class="line"> - <span class="string">&quot;3000-3005&quot;</span></span><br><span class="line"> - <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line"> - <span class="string">&quot;9090-9091:8080-8081&quot;</span></span><br><span class="line"> - <span class="string">&quot;49100:22&quot;</span></span><br><span class="line"> - <span class="string">&quot;127.0.0.1:8001:8001&quot;</span></span><br><span class="line"> - <span class="string">&quot;127.0.0.1:5000-5010:5000-5010&quot;</span></span><br><span class="line"> - <span class="string">&quot;6060:6060/udp&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="LONG-SYNTAX-1"><a href="#LONG-SYNTAX-1" class="headerlink" title="LONG SYNTAX"></a>LONG SYNTAX</h3><p>长格式语法允许配置不能以简短形式表示的附加字段。</p>
<p>target：容器内的端口<br>published：公开曝光的港口<br>protocol：端口协议（tcp或udp）<br>mode：用于在每个节点上发布主机端口的主机，或用于群集模式端口的入口以进行负载平衡。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ports:</span><br><span class="line">  - target: <span class="number">80</span></span><br><span class="line">    published: <span class="number">8080</span></span><br><span class="line">    protocol: tcp</span><br><span class="line">    mode: host</span><br></pre></td></tr></table></figure>

<p>注意：长语法在v3.2中是新的</p>
<h2 id="secrets"><a href="#secrets" class="headerlink" title="secrets"></a>secrets</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.1&quot;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">1</span></span><br><span class="line">    secrets:</span><br><span class="line">      - my_secret</span><br><span class="line">      - my_other_secret</span><br><span class="line">secrets:</span><br><span class="line">  my_secret:</span><br><span class="line">    file: ./my_secret.txt</span><br><span class="line">  my_other_secret:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.1&quot;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">1</span></span><br><span class="line">    secrets:</span><br><span class="line">      - source: my_secret</span><br><span class="line">        target: redis_secret</span><br><span class="line">        uid: <span class="string">&#x27;103&#x27;</span></span><br><span class="line">        gid: <span class="string">&#x27;103&#x27;</span></span><br><span class="line">        mode: <span class="number">0440</span></span><br><span class="line">secrets:</span><br><span class="line">  my_secret:</span><br><span class="line">    file: ./my_secret.txt</span><br><span class="line">  my_other_secret:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<h2 id="security-opt"><a href="#security-opt" class="headerlink" title="security_opt"></a>security_opt</h2><p>覆盖每个容器的默认标签方案。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">security_opt:</span><br><span class="line">  - <span class="keyword">label</span><span class="bash">:user:USER</span></span><br><span class="line">  - <span class="keyword">label</span><span class="bash">:role:ROLE</span></span><br></pre></td></tr></table></figure>

<h2 id="stop-grace-period"><a href="#stop-grace-period" class="headerlink" title="stop_grace_period"></a>stop_grace_period</h2><p>指定在发送SIGKILL之前，如果试图停止一个容器（如果它没有处理SIGTERM）（或者使用stop_signal指定了任何停止信号），请等待多久。 指定为持续时间。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop_grace_period: <span class="number">1</span>s</span><br><span class="line">stop_grace_period: <span class="number">1</span>m30s</span><br></pre></td></tr></table></figure>

<p>默认情况下，停止在发送SIGKILL之前等待10秒钟容器退出。</p>
<h2 id="stop-signal"><a href="#stop-signal" class="headerlink" title="stop_signal"></a>stop_signal</h2><p>设置一个替代信号来停止容器。 默认停止使用SIGTERM。 使用stop_signal设置替代信号会导致停止发送该信号。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop_signal: SIGUSR1</span><br></pre></td></tr></table></figure>

<h2 id="sysctls"><a href="#sysctls" class="headerlink" title="sysctls"></a>sysctls</h2><p>在容器中设置的内核参数。 您可以使用数组或字典。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sysctls:</span><br><span class="line">  net.core.somaxconn: <span class="number">1024</span></span><br><span class="line">  net.ipv4.tcp_syncookies: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">sysctls:</span><br><span class="line">  - net.core.somaxconn=<span class="number">1024</span></span><br><span class="line">  - net.ipv4.tcp_syncookies=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="ulimits"><a href="#ulimits" class="headerlink" title="ulimits"></a>ulimits</h2><p>覆盖容器的默认限制。 您可以将单个限制指定为整数，也可以将软限制/硬限制指定为映射。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ulimits:</span><br><span class="line">  nproc: <span class="number">65535</span></span><br><span class="line">  nofile:</span><br><span class="line">    soft: <span class="number">20000</span></span><br><span class="line">    hard: <span class="number">40000</span></span><br></pre></td></tr></table></figure>

<h2 id="userns-mode"><a href="#userns-mode" class="headerlink" title="userns_mode"></a>userns_mode</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userns_mode: <span class="string">&quot;host&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果Docker守护程序配置了用户命名空间，则禁用此服务的用户命名空间。</p>
<h2 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a>volumes</h2><p>装载主机路径或命名卷，将其指定为服务的子选项。</p>
<p>您可以将主机路径作为单个服务的定义的一部分进行安装，并且无需在顶级卷密钥中定义它。</p>
<p>但是，如果要跨多个服务重用卷，请在顶级卷密钥中定义一个命名卷。 将命名卷与服务，群集和堆栈文件一起使用。</p>
<p>注意：顶级卷密钥定义了一个命名卷，并从每个服务的卷列表中引用它。 这会替换早期版本的Compose文件格式中的volumes_from。 有关卷的一般信息，请参阅使用卷和卷插件。</p>
<p>此示例显示Web服务正在使用的命名卷（mydata），以及为单个服务（数据库服务卷下的第一个路径）定义的绑定挂载。 数据库服务还使用名为dbdata的命名卷（数据库服务卷下的第二个路径），但使用旧的字符串格式定义它以装载命名卷。 如图所示，命名卷必须列在顶级卷密钥下。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.2&quot;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    volumes:</span><br><span class="line">      - type: <span class="keyword">volume</span></span><br><span class="line"><span class="bash">        <span class="built_in">source</span>: mydata</span></span><br><span class="line">        target: /data</span><br><span class="line">        <span class="keyword">volume</span><span class="bash">:</span></span><br><span class="line">          nocopy: true</span><br><span class="line">      - type: bind</span><br><span class="line">        source: ./static</span><br><span class="line">        target: /opt/app/static</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: postgres:latest</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">&quot;/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock&quot;</span></span><br><span class="line">      - <span class="string">&quot;dbdata:/var/lib/postgresql/data&quot;</span></span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mydata:</span><br><span class="line">  dbdata:</span><br></pre></td></tr></table></figure>

<h3 id="SHORT-SYNTAX-2"><a href="#SHORT-SYNTAX-2" class="headerlink" title="SHORT SYNTAX"></a>SHORT SYNTAX</h3><p>可以选择在主机上（HOST：CONTAINER）或访问模式（HOST：CONTAINER：ro）指定路径。</p>
<p>您可以在主机上挂载相对路径，该路径相对于正在使用的Compose配置文件的目录进行扩展。 相对路径应始终以</p>
<p><code>.</code>或<code>..</code>。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  <span class="comment"># Just specify a path and let the Engine create a volume</span></span><br><span class="line">  - /var/lib/mysql</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Specify an absolute path mapping</span></span><br><span class="line">  - /opt/data:/var/lib/mysql</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Path on the host, relative to the Compose file</span></span><br><span class="line">  - ./cache:/tmp/cache</span><br><span class="line"></span><br><span class="line">  <span class="comment"># User-relative path</span></span><br><span class="line">  - ~/configs:/etc/configs/:ro</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Named volume</span></span><br><span class="line">  - datavolume:/var/lib/mysql</span><br></pre></td></tr></table></figure>

<h3 id="LONG-SYNTAX-2"><a href="#LONG-SYNTAX-2" class="headerlink" title="LONG SYNTAX"></a>LONG SYNTAX</h3><p><code>type</code>：装载类型卷，绑定或tmpfs<br><code>source</code>：装入源，主机上用于绑定装入的路径或顶级卷密钥中定义的卷的名称。 不适用于tmpfs安装。<br><code>target</code>：卷所在的容器中的路径<br><code>read_only</code>：标志将卷设置为只读<br><code>bind</code>：配置额外的绑定选项<br>  <code>propagation</code>：用于绑定的传播模式<br><code>volume</code>：配置额外的volume选项<br>  <code>nocopy</code>：标志，用于在卷创建时禁止从容器复制数据<br><code>tmpfs</code>：配置附加的tmpfs选项<br>  <code>size</code>：tmpfs的大小，以字节为单位</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.2&quot;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    volumes:</span><br><span class="line">      - type: <span class="keyword">volume</span></span><br><span class="line"><span class="bash">        <span class="built_in">source</span>: mydata</span></span><br><span class="line">        target: /data</span><br><span class="line">        <span class="keyword">volume</span><span class="bash">:</span></span><br><span class="line">          nocopy: true</span><br><span class="line">      - type: bind</span><br><span class="line">        source: ./static</span><br><span class="line">        target: /opt/app/static</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  webnet:</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mydata:</span><br></pre></td></tr></table></figure>

<p>Note: The long syntax is new in v3.2</p>
<p>** 服务，群集和堆栈文件的卷**</p>
<p>在使用服务，群集和docker-stack.yml文件时，请记住支持服务的任务（容器）可以部署在群集中的任何节点上，并且每次更新服务时都可能是不同的节点。</p>
<p>在缺少指定源的命名卷的情况下，Docker为支持服务的每个任务创建一个匿名卷。关联的容器被移除后，匿名卷不会保留。</p>
<p>如果您希望数据持久存在，请使用可识别多主机的命名卷和卷驱动程序，以便可以从任何节点访问数据。或者，对该服务设置约束，以便将其任务部署在具有该卷的节点上。</p>
<p>作为一个例子，Docker Labs中votingapp示例的docker-stack.yml文件 定义了一个称为运行数据库的服务。它被配置为一个命名卷来保存群体上的数据， 并且仅限于在节点上运行。这是来自该文件的相关剪辑：db postgres manager</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres:<span class="number">9.4</span></span><br><span class="line">    volumes:</span><br><span class="line">      - db-data:/var/lib/postgresql/data</span><br><span class="line">    networks:</span><br><span class="line">      - backend</span><br><span class="line">    deploy:</span><br><span class="line">      placement:</span><br><span class="line">        constraints: [node.role == manager]</span><br></pre></td></tr></table></figure>

<h2 id="restart"><a href="#restart" class="headerlink" title="restart"></a>restart</h2><p>no是默认的重启策略，在任何情况下都不会重启容器。 总是指定时，容器总是重新启动。 如果退出代码指示出现故障错误，则故障中策略会重新启动容器。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">restart: <span class="string">&quot;no&quot;</span></span><br><span class="line">restart: always</span><br><span class="line">restart: on-failure</span><br><span class="line">restart: unless-stopped</span><br></pre></td></tr></table></figure>

<h2 id="domainname-hostname-ipc-mac-address-privileged-read-only-shm-size-stdin-open-tty-user-working-dir"><a href="#domainname-hostname-ipc-mac-address-privileged-read-only-shm-size-stdin-open-tty-user-working-dir" class="headerlink" title="domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir"></a>domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">user</span>: postgresql</span><br><span class="line">working_dir: /code</span><br><span class="line"></span><br><span class="line">domainname: foo.com</span><br><span class="line">hostname: foo</span><br><span class="line">ipc: host</span><br><span class="line">mac_address: <span class="number">02</span>:<span class="number">42</span>:ac:<span class="number">11</span>:<span class="number">65</span>:<span class="number">43</span></span><br><span class="line"></span><br><span class="line">privileged: true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">read_only: true</span><br><span class="line">shm_size: <span class="number">64</span>M</span><br><span class="line">stdin_open: true</span><br><span class="line">tty: true</span><br></pre></td></tr></table></figure>

<h2 id="Specifying-durations-1"><a href="#Specifying-durations-1" class="headerlink" title="Specifying durations"></a>Specifying durations</h2><p>一些配置选项（如interval和timeout ）以如下格式的字符串形式接受持续时间：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.5</span>s</span><br><span class="line"><span class="number">10</span>s</span><br><span class="line"><span class="number">1</span>m30s</span><br><span class="line"><span class="number">2</span>h32m</span><br><span class="line"><span class="number">5</span>h34m56s</span><br></pre></td></tr></table></figure>

<h2 id="Volume-configuration-reference"><a href="#Volume-configuration-reference" class="headerlink" title="Volume configuration reference"></a>Volume configuration reference</h2><p>虽然可以将文件中的卷声明为服务声明的一部分，但本节允许您创建可在多个服务中重复使用的命名卷（不依赖于volumes_from），并且可以使用docker命令行轻松检索和检查 或API。 有关更多信息，请参阅docker卷子命令文档。</p>
<p>有关卷的一般信息，请参阅使用卷和卷插件。</p>
<p>以下是一个双服务设置的示例，其中数据库的数据目录与另一个服务共享为一个卷，以便可以定期进行备份：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: db</span><br><span class="line">    volumes:</span><br><span class="line">      - data-<span class="keyword">volume</span><span class="bash">:/var/lib/db</span></span><br><span class="line">  backup:</span><br><span class="line">    image: backup-service</span><br><span class="line">    volumes:</span><br><span class="line">      - data-<span class="keyword">volume</span><span class="bash">:/var/lib/backup/data</span></span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  data-<span class="keyword">volume</span><span class="bash">:</span></span><br></pre></td></tr></table></figure>

<p>顶级卷密钥下的条目可以为空，在这种情况下，它使用由引擎配置的默认驱动程序（在大多数情况下，这是本地驱动程序）。 或者，您可以使用以下键配置它：</p>
<h3 id="driver"><a href="#driver" class="headerlink" title="driver"></a>driver</h3><p>指定应该为此卷使用哪个卷驱动程序。 默认为Docker引擎已经配置使用的驱动程序，在大多数情况下它是本地的。 如果驱动程序不可用，则当docker-compose up尝试创建卷时，引擎会返回错误。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver: foobar</span><br></pre></td></tr></table></figure>

<h3 id="driver-opts"><a href="#driver-opts" class="headerlink" title="driver_opts"></a>driver_opts</h3><p>指定一个选项列表作为传递给该卷的驱动程序的键值对。 这些选项是依赖于驱动程序的 - 请查阅驱动程序的文档以获取更多信息。 可选的。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver_opts:</span><br><span class="line">  foo: <span class="string">&quot;bar&quot;</span></span><br><span class="line">  baz: <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="external"><a href="#external" class="headerlink" title="external"></a>external</h3><p>如果设置为true，则指定该卷已在Compose之外创建。 docker-compose up不会尝试创建它，并在它不存在时引发错误。</p>
<p>外部不能与其他卷配置键（驱动程序，driver_opts）一起使用。</p>
<p>在下面的示例中，Compose不是试图创建一个名为[projectname] _data的卷，而是查找一个简单称为data的现有卷，并将其挂载到数据库服务的容器中。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br><span class="line">    volumes:</span><br><span class="line">      - data:/var/lib/postgresql/data</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  data:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<p>external.name在版本3.4文件格式中被弃用，而使用name。</p>
<p>您还可以在Compose文件中单独指定用于引用它的名称来指定卷的名称：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  data:</span><br><span class="line">    external:</span><br><span class="line">      name: actual-name-of-<span class="keyword">volume</span></span><br></pre></td></tr></table></figure>

<p>** 外部卷始终使用Docker堆栈部署来创建**</p>
<p>如果您使用docker stack deploy以swarm模式启动应用程序（而不是docker组合），则创建不存在的外部卷。 在群集模式下，当服务定义时会自动创建一个卷。 由于服务任务在新节点上进行安排，因此swarmkit会在本地节点上创建卷</p>
<h3 id="labels-2"><a href="#labels-2" class="headerlink" title="labels"></a>labels</h3><p>使用Docker标签将元数据添加到容器。 您可以使用数组或字典。</p>
<p>建议您使用反向DNS标记来防止您的标签与其他软件使用的标签冲突。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">labels:</span><br><span class="line">  com.example.description: <span class="string">&quot;Database volume&quot;</span></span><br><span class="line">  com.example.department: <span class="string">&quot;IT/Ops&quot;</span></span><br><span class="line">  com.example.label-with-empty-value: <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">labels:</span><br><span class="line">  - <span class="string">&quot;com.example.description=Database volume&quot;</span></span><br><span class="line">  - <span class="string">&quot;com.example.department=IT/Ops&quot;</span></span><br><span class="line">  - <span class="string">&quot;com.example.label-with-empty-value&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>为此卷设置一个自定义名称。 名称字段可用于引用包含特殊字符的网络。 该名称按原样使用，不会与堆栈名称一起作用。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.4&#x27;</span></span><br><span class="line">volumes:</span><br><span class="line">  data:</span><br><span class="line">    name: my-app-data</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.4&#x27;</span></span><br><span class="line">volumes:</span><br><span class="line">  data:</span><br><span class="line">    external: true</span><br><span class="line">    name: my-app-data</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/11/Power-Shell%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/11/Power-Shell%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">Power Shell命令学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-11 08:58:10" itemprop="dateCreated datePublished" datetime="2018-05-11T08:58:10+00:00">2018-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/11/linux-chmod%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/11/linux-chmod%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">linux chmod命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-11 08:56:22" itemprop="dateCreated datePublished" datetime="2018-05-11T08:56:22+00:00">2018-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">Linux基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>chmod命令用于改变linux系统文件或目录的访问权限。用它控制文件或目录的访问权限。<br>该命令有两种用法:</p>
<p>** 一种是包含字母和操作符表达式的文字设定法；**<br>** 一种是包含数字的数字设定法。**</p>
<p>Linux系统中的每个文件和目录都有访问许可权限，用它来确定谁可以通过何种方式对文件和目录进行访问和操作。</p>
<p>文件或目录的访问权限分为只读，只写和可执行三种。以文件为例，只读权限表示只允许读其内容，而禁止对其做任何的更改操作。可执行权限表示允许将该文件作为一个程序执行。文件被创建时，文件所有者自动拥有对该文件的读、写和可执行权限，以便于对文件的阅读和修改。用户也可根据需要把访问权限设置为需要的任何组合。</p>
<p>有三种不同类型的用户可对文件或目录进行访问：文件所有者，同组用户、其他用户。所有者一般是文件的创建者。所有者可以允许同组用户有权访问文件，还可以将文件的访问权限赋予系统中的其他用户。在这种情况下，系统中每一位用户都能访问该用户拥有的文件或目录。</p>
<p>每一文件或目录的访问权限都有三组，每组用三位表示，分别为文件属主的读、写和执行权限；与属主同组的用户的读、写和执行权限；系统中其他用户的读、写和执行权限。当用ls -l命令显示文件或目录的详细信息时，最左边的一列为文件的访问权限。 例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[toor@localhost cmdtest]$ ls -al</span><br><span class="line">总用量 4</span><br><span class="line">drwxrwxr-x.  2 toor toor   24 5月  11 09:19 .</span><br><span class="line">drwx------. 15 toor toor 4096 5月  11 09:19 ..</span><br><span class="line">-rw-rw-r--.  1 toor toor    0 5月  11 09:19 2018511.log</span><br></pre></td></tr></table></figure>

<p>以2018511.log为例：</p>
<p><code>-rw-rw-r--.  1 toor toor    0 5月  11 09:19 2018511.log</code></p>
<p>第一列共有10个位置，第一个字符指定了文件类型。在通常意义上，一个目录也是一个文件。如果第一个字符是横线，表示是一个非目录的文件。如果是d，表示是一个目录。从第二个字符开始到第十个共9个字符，3个字符一组，分别表示了3组用户对文件或者目录的权限。权限字符用横线代表空许可，r代表只读，w代表写，x代表可执行。</p>
<p>例如：<br><code>-rw-rw-r--</code><br>　　表示2018511.log是一个普通文件；2018511.log的属主有读写权限；与log2012.log属主同组的用户有读写权限；其他用户也只有读权限。</p>
<p>确定了一个文件的访问权限后，用户可以利用Linux系统提供的chmod命令来重新设定不同的访问权限。也可以利用chown命令来更改某个文件或目录的所有者。利用chgrp命令来更改某个文件或目录的用户组。</p>
<p>chmod命令是非常重要的，用于改变文件或目录的访问权限。用户用它控制文件或目录的访问权限。</p>
<h2 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod [-cfvR] [--<span class="built_in">help</span>] [--version] mode file</span><br></pre></td></tr></table></figure>

<h2 id="命令功能"><a href="#命令功能" class="headerlink" title="命令功能"></a>命令功能</h2><p>用于改变文件或目录的访问权限，用它控制文件或目录的访问权限。</p>
<h2 id="命令参数"><a href="#命令参数" class="headerlink" title="命令参数"></a>命令参数</h2><p>** 必要参数：**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-c 当发生改变时，报告处理信息</span><br><span class="line">-f 错误信息不输出</span><br><span class="line">-R 处理指定目录以及其子目录下的所有文件</span><br><span class="line">-v 运行时显示详细处理信息</span><br></pre></td></tr></table></figure>

<p>** 选择参数 **</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--reference=&lt;目录或者文件&gt; 设置成具有指定目录或者文件具有相同的权限</span><br><span class="line">--version 显示版本信息</span><br><span class="line">&lt;权限范围&gt;+&lt;权限设置&gt; 使权限范围内的目录或者文件具有指定的权限</span><br><span class="line">&lt;权限范围&gt;-&lt;权限设置&gt; 删除权限范围的目录或者文件的指定权限</span><br><span class="line">&lt;权限范围&gt;=&lt;权限设置&gt; 设置权限范围内的目录或者文件的权限为指定的值</span><br></pre></td></tr></table></figure>

<p>** 权限范围 **</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u ：目录或者文件的当前的用户</span><br><span class="line">g ：目录或者文件的当前的群组</span><br><span class="line">o ：除了目录或者文件的当前用户或群组之外的用户或者群组</span><br><span class="line">a ：所有的用户及群组</span><br></pre></td></tr></table></figure>

<p>** 权限代号**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r ：读权限，用数字4表示</span><br><span class="line">w ：写权限，用数字2表示</span><br><span class="line">x ：执行权限，用数字1表示</span><br><span class="line">- ：删除权限，用数字0表示</span><br><span class="line">s ：特殊权限</span><br></pre></td></tr></table></figure>

<p>该命令有两种用法。一种是包含字母和操作符表达式的文字设定法；另一种是包含数字的数字设定法。</p>
<p><strong>* 文字设定法 *</strong></p>
<p>格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod ［who］ ［+ | - | =］ ［mode］ 文件名</span><br></pre></td></tr></table></figure>

<p><strong>* 数字设定法 *</strong></p>
<p>格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod ［mode］ 文件名</span><br></pre></td></tr></table></figure>

<p>0表示没有权限，1表示可执行权限，2表示可写权限，4表示可读权限，然后将其相加。所以数字属性的格式应为3个从0到7的八进制数，其顺序是（u）（g）（o）。</p>
<p>例如，如果想让某个文件的属主有“读/写”二种权限，需要把4（可读）+2（可写）＝6（读/写）。</p>
<p>数字与字符对应关系如下：</p>
<p>r=4，w=2，x=1<br>若要rwx属性则4+2+1=7<br>若要rw-属性则4+2=6；<br>若要r-x属性则4+1=5。</p>
<h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><p>** 增加文件所有用户组可执行权限 **</p>
<p>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a+x 2018511.log</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[toor@localhost cmdtest]$ ls -al 2018511.log</span><br><span class="line">-rw-rw-r--. 1 toor toor 0 5月  11 09:19 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$ chmod a+x 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$ ls -al 2018511.log</span><br><span class="line">-rwxrwxr-x. 1 toor toor 0 5月  11 09:19 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$</span><br></pre></td></tr></table></figure>

<p>说明：<br>即设定文件2018511.log的属性为：文件属主（u） 增加执行权限；与文件属主同组用户（g） 增加执行权限；其他用户（o） 增加执行权限。</p>
<p>** 同时修改不同用户权限**</p>
<p>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod ug+w,o-x 2018511.log</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[toor@localhost cmdtest]$ ls -al 2018511.log</span><br><span class="line">-r-xr-xr-x. 1 toor toor 0 5月  11 09:19 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$ chmod ug+w,o-x 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$ ls -al 2018511.log</span><br><span class="line">-rwxrwxr--. 1 toor toor 0 5月  11 09:19 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$</span><br></pre></td></tr></table></figure>

<p>说明：<br>即设定文件text的属性为：文件属主（u） 增加写权限;与文件属主同组用户（g） 增加写权限;其他用户（o） 删除执行权限</p>
<p>** 删除文件权限 **</p>
<p>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod a-x 2018511.log</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[toor@localhost cmdtest]$ ls -al 2018511.log</span><br><span class="line">-rwxrwxr--. 1 toor toor 0 5月  11 09:19 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$ chmod a-x 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$ ls -al 2018511.log</span><br><span class="line">-rw-rw-r--. 1 toor toor 0 5月  11 09:19 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$</span><br></pre></td></tr></table></figure>

<p>说明：<br>删除所有用户的可执行权限</p>
<p>** 使用“=”设置权限**</p>
<p>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u=x 2018511.log</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[toor@localhost cmdtest]$ ls -al 2018511.log</span><br><span class="line">-rw-rw-r--. 1 toor toor 0 5月  11 09:19 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$ chmod u=x 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$ ls -al 2018511.log</span><br><span class="line">---xrw-r--. 1 toor toor 0 5月  11 09:19 2018511.log</span><br><span class="line">[toor@localhost cmdtest]$</span><br></pre></td></tr></table></figure>

<p>说明：<br>文件属主（u）等于执行权限;其它权限不变</p>
<p>** 对一个目录及其子目录所有文件添加权限**</p>
<p>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R u+x test1</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[toor@localhost test1]$ ls -al</span><br><span class="line">总用量 0</span><br><span class="line">drwxrwxr-x. 2 toor toor 36 5月  11 10:46 .</span><br><span class="line">drwxrwxr-x. 3 toor toor 36 5月  11 10:46 ..</span><br><span class="line">-rw-rw-r--. 1 toor toor  0 5月  11 10:46 log1.log</span><br><span class="line">-rw-rw-r--. 1 toor toor  0 5月  11 10:46 log2.log</span><br><span class="line">[toor@localhost test1]$ <span class="built_in">cd</span> ..</span><br><span class="line">[toor@localhost cmdtest]$ chmod -R u+x test1</span><br><span class="line">[toor@localhost cmdtest]$ <span class="built_in">cd</span> test1</span><br><span class="line">[toor@localhost test1]$ ls -al</span><br><span class="line">总用量 0</span><br><span class="line">drwxrwxr-x. 2 toor toor 36 5月  11 10:46 .</span><br><span class="line">drwxrwxr-x. 3 toor toor 36 5月  11 10:46 ..</span><br><span class="line">-rwxrw-r--. 1 toor toor  0 5月  11 10:46 log1.log</span><br><span class="line">-rwxrw-r--. 1 toor toor  0 5月  11 10:46 log2.log</span><br><span class="line">[toor@localhost test1]$</span><br></pre></td></tr></table></figure>

<p>说明：<br>递归地给test1目录下所有文件和子目录的属主分配权限</p>
<p>** 其他实例：**</p>
<p>给file的属主分配读、写、执行(7)的权限，给file的所在组分配读、执行(5)的权限，给其他用户分配执行(1)的权限，命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 751 file</span><br><span class="line">chmod u=rwx,g=rx,o=x file</span><br></pre></td></tr></table></figure>

<p>为所有用户分配读权限，命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 444 file</span><br><span class="line">chmod a-wx,a+r   file</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/peida/archive/2012/11/29/2794010.html">http://www.cnblogs.com/peida/archive/2012/11/29/2794010.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/10/Linux-bash%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/Linux-bash%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">Linux bash学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-10 14:53:18" itemprop="dateCreated datePublished" datetime="2018-05-10T14:53:18+00:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">Linux基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://cn.linux.vbird.org/linux_basic/0320bash.php">http://cn.linux.vbird.org/linux_basic/0320bash.php</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/skywang12345/archive/2013/05/30/3106570.html">https://www.cnblogs.com/skywang12345/archive/2013/05/30/3106570.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/skywang12345/archive/2013/05/31/3107871.html">http://www.cnblogs.com/skywang12345/archive/2013/05/31/3107871.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/10/Linux-ps%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/Linux-ps%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Linux ps命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-10 11:16:26" itemprop="dateCreated datePublished" datetime="2018-05-10T11:16:26+00:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">Linux基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux-ps命令"><a href="#Linux-ps命令" class="headerlink" title="Linux ps命令"></a>Linux ps命令</h1><p>Linux中的ps命令是Process Status的缩写。ps命令用来列出系统中当前运行的那些进程。ps命令列出的是当前那些进程的快照，就是执行ps命令的那个时刻的那些进程，如果想要动态的显示进程信息，就可以使用top命令。</p>
<p>要对进程进行监测和控制，首先必须要了解当前进程的情况，也就是需要查看当前进程，而 ps 命令就是最基本同时也是非常强大的进程查看命令。使用该命令可以确定有哪些进程正在运行和运行的状态、进程是否结束、进程有没有僵死、哪些进程占用了过多的资源等等。总之大部分信息都是可以通过执行该命令得到的。</p>
<p>ps 为我们提供了进程的一次性的查看，它所提供的查看结果并不动态连续的；如果想对进程时间监控，应该用 top 工具。</p>
<p>kill 命令用于杀死进程。</p>
<h2 id="linux上进程有5种状态"><a href="#linux上进程有5种状态" class="headerlink" title="linux上进程有5种状态"></a>linux上进程有5种状态</h2><ol>
<li>运行(正在运行或在运行队列中等待)</li>
<li>中断(休眠中, 受阻, 在等待某个条件的形成或接受到信号)</li>
<li>不可中断(收到信号不唤醒和不可运行, 进程必须等待直到有中断发生)</li>
<li>僵死(进程已终止, 但进程描述符存在, 直到父进程调用wait4()系统调用后释放)</li>
<li>停止(进程收到SIGSTOP, SIGSTP, SIGTIN, SIGTOU信号后停止运行运行)</li>
</ol>
<h2 id="ps工具标识进程的5种状态码"><a href="#ps工具标识进程的5种状态码" class="headerlink" title="ps工具标识进程的5种状态码"></a>ps工具标识进程的5种状态码</h2><p>D 不可中断 uninterruptible sleep (usually IO)<br>R 运行 runnable (on run queue)<br>S 中断 sleeping<br>T 停止 traced or stopped<br>Z 僵死 a defunct (”zombie”) process</p>
<h2 id="ps命令"><a href="#ps命令" class="headerlink" title="ps命令"></a>ps命令</h2><p>** 命令格式：**<br>ps [参数]</p>
<p>** 命令功能：**<br>用来显示当前进程的状态</p>
<p>** 命令参数：**</p>
<p>a  显示所有进程<br>-a 显示同一终端下的所有程序<br>-A 显示所有进程<br>c  显示进程的真实名称<br>-N 反向选择<br>-e 等于“-A”<br>e  显示环境变量<br>f  显示程序间的关系<br>-H 显示树状结构<br>r  显示当前终端的进程<br>T  显示当前终端的所有程序<br>u  指定用户的所有进程<br>-au 显示较详细的资讯<br>-aux 显示所有包含其他使用者的行程<br>-C&lt;命令&gt; 列出指定命令的状况<br>–lines&lt;行数&gt; 每页显示的行数<br>–width&lt;字符数&gt; 每页显示的字符数<br>–help 显示帮助信息<br>–version 显示版本显示</p>
<p>** 使用实例 **</p>
<p><code>ps -A</code>:显示所有进程信息</p>
<p><code>ps -u root</code>:显示指定用户信息</p>
<p><code>ps -ef|grep ssh</code>:ps 与grep 常用组合用法，查找特定进程</p>
<p><code>ps -l</code>:将目前属于您自己这次登入的 PID 与相关信息列示出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]<span class="comment"># ps -l</span></span><br><span class="line">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">4 S     0   2774   2722  0  80   0 - 47498 do_wai pts/0    00:00:00 su</span><br><span class="line">4 S     0   2780   2774  0  80   0 - 29075 do_wai pts/0    00:00:00 bash</span><br><span class="line">0 R     0  23118   2780  0  80   0 - 37235 -      pts/0    00:00:00 ps</span><br></pre></td></tr></table></figure>

<p>** 说明：**</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">F 代表这个程序的旗标 (flag)， 4 代表使用者为 super user</span><br><span class="line">S 代表这个程序的状态 (STAT)，关于各 STAT 的意义将在内文介绍</span><br><span class="line">UID 程序被该 UID 所拥有</span><br><span class="line">PID 就是这个程序的 ID ！</span><br><span class="line">PPID 则是其上级父程序的ID</span><br><span class="line">C CPU 使用的资源百分比</span><br><span class="line">PRI 这个是 Priority (优先执行序) 的缩写，详细后面介绍</span><br><span class="line">NI 这个是 Nice 值，在下一小节我们会持续介绍</span><br><span class="line">ADDR 这个是 kernel <span class="keyword">function</span>，指出该程序在内存的那个部分。如果是个 running的程序，一般就是 <span class="string">&quot;-&quot;</span></span><br><span class="line">SZ 使用掉的内存大小</span><br><span class="line">WCHAN 目前这个程序是否正在运作当中，若为 - 表示正在运作</span><br><span class="line">TTY 登入者的终端机位置</span><br><span class="line">TIME 使用掉的 CPU 时间。</span><br><span class="line">CMD 所下达的指令为何</span><br><span class="line">在预设的情况下， ps 仅会列出与目前所在的 bash shell 有关的 PID 而已，所以， 当我使用 ps -l 的时候，只有三个 PID。</span><br></pre></td></tr></table></figure>

<p><code>ps -axjf</code>:列出类似程序树的程序显示</p>
<p><code>ps aux | egrep &#39;(cron|syslog)&#39;</code>:找出与 cron 与 syslog 这两个服务有关的 PID 号码</p>
<p><code>ps -aux |more</code>:用 | 管道和 more 连接起来分页查看</p>
<p><code>ps -aux &gt; ps001.txt</code>:把所有进程显示出来，并输出到ps001.txt文件</p>
<p><code>ps -o pid,ppid,pgrp,session,tpgid,comm</code>:输出指定字段</p>
<h2 id="ps-ef和ps-aux的区别"><a href="#ps-ef和ps-aux的区别" class="headerlink" title="ps -ef和ps aux的区别"></a>ps -ef和ps aux的区别</h2><p>Linux下显示系统进程的命令ps，最常用的有ps -ef 和ps aux。这两个到底有什么区别呢？两者没太大差别，讨论这个问题，要追溯到Unix系统中的两种风格，System Ｖ风格和BSD 风格，ps aux最初用到Unix Style中，而ps -ef被用在System V Style中，两者输出略有不同。现在的大部分Linux系统都是可以同时使用这两种方式的。</p>
<p>** <code>ps -ef</code>:显示所有进程信息，连同命令行 **</p>
<p>ps -ef 是用标准的格式显示进程的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]<span class="comment"># ps -ef</span></span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 09:40 ?        00:00:03 /usr/lib/systemd/systemd --swi</span><br><span class="line">root          2      0  0 09:40 ?        00:00:00 [kthreadd]</span><br><span class="line">root          3      2  0 09:40 ?        00:00:00 [ksoftirqd/0]</span><br><span class="line">root          5      2  0 09:40 ?        00:00:00 [kworker/0:0H]</span><br><span class="line">root          7      2  0 09:40 ?        00:00:00 [migration/0]</span><br><span class="line">root          8      2  0 09:40 ?        00:00:00 [rcu_bh]</span><br><span class="line">root          9      2  0 09:40 ?        00:00:02 [rcu_sched]</span><br><span class="line">root         10      2  0 09:40 ?        00:00:00 [watchdog/0]</span><br></pre></td></tr></table></figure>

<p>参数详解：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UID    //用户ID、但输出的是用户名</span><br><span class="line">PID    //进程的ID</span><br><span class="line">PPID   //父进程ID</span><br><span class="line">C      //进程占用CPU的百分比</span><br><span class="line">STIME  //进程启动到现在的时间</span><br><span class="line">TTY    //该进程在那个终端上运行，若与终端无关，则显示? 若为pts/0等，则表示由网络连接主机进程。</span><br><span class="line">CMD    //命令的名称和参数</span><br></pre></td></tr></table></figure>

<p>** <code>ps aux</code>:列出目前所有的正在内存当中的程序 ** </p>
<p>ps aux 是用BSD的格式来显示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@localhost Desktop]<span class="comment"># ps -aux</span></span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.4 193720  4236 ?        Ss   09:40   0:03 /usr/lib/syste</span><br><span class="line">root          2  0.0  0.0      0     0 ?        S    09:40   0:00 [kthreadd]</span><br><span class="line">root          3  0.0  0.0      0     0 ?        S    09:40   0:00 [ksoftirqd/0]</span><br><span class="line">root          5  0.0  0.0      0     0 ?        S&lt;   09:40   0:00 [kworker/0:0H]</span><br><span class="line">root          7  0.0  0.0      0     0 ?        S    09:40   0:00 [migration/0]</span><br><span class="line">root          8  0.0  0.0      0     0 ?        S    09:40   0:00 [rcu_bh]</span><br><span class="line">root          9  0.0  0.0      0     0 ?        R    09:40   0:02 [rcu_sched]</span><br><span class="line">root         10  0.0  0.0      0     0 ?        S    09:40   0:00 [watchdog/0]</span><br><span class="line">root         12  0.0  0.0      0     0 ?        S    09:40   0:00 [kdevtmpfs]</span><br></pre></td></tr></table></figure>

<p>同ps -ef 不同的有列有</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USER      //用户名</span><br><span class="line">%CPU      //进程占用的CPU百分比</span><br><span class="line">%MEM      //占用内存的百分比</span><br><span class="line">VSZ       //该进程使用的虚拟內存量（KB）</span><br><span class="line">RSS       //该进程占用的固定內存量（KB）（驻留中页的数量）</span><br><span class="line">STAT      //进程的状态</span><br><span class="line">START     //该进程被触发启动时间</span><br><span class="line">TIME      //该进程实际使用CPU运行的时间</span><br></pre></td></tr></table></figure>

<p>其中STAT状态位常见的状态字符有</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">D      //无法中断的休眠状态（通常 IO 的进程）；</span><br><span class="line">R      //正在运行可中在队列中可过行的；</span><br><span class="line">S      //处于休眠状态；</span><br><span class="line">T      //停止或被追踪；</span><br><span class="line">W      //进入内存交换 （从内核2.6开始无效）；</span><br><span class="line">X      //死掉的进程 （基本很少见）；</span><br><span class="line">Z      //僵尸进程；</span><br><span class="line">&lt;      //优先级高的进程</span><br><span class="line">N      //优先级较低的进程</span><br><span class="line">L      //有些页被锁进内存；</span><br><span class="line">s      //进程的领导者（在它之下有子进程）；</span><br><span class="line">l      //多线程，克隆线程（使用 CLONE_THREAD, 类似 NPTL pthreads）；</span><br><span class="line">+      //位于后台的进程组；</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/peida/archive/2012/12/19/2824418.html">http://www.cnblogs.com/peida/archive/2012/12/19/2824418.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.linuxidc.com/Linux/2016-07/133515.htm">https://www.linuxidc.com/Linux/2016-07/133515.htm</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/10/Linux-grep%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/Linux-grep%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Linux grep命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-10 10:45:46" itemprop="dateCreated datePublished" datetime="2018-05-10T10:45:46+00:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">Linux基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux-grep命令"><a href="#Linux-grep命令" class="headerlink" title="Linux grep命令"></a>Linux grep命令</h1><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>Linux系统中grep命令是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹 配的行打印出来。grep全称是Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。</p>
<h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><p>grep [options]</p>
<h2 id="主要参数"><a href="#主要参数" class="headerlink" title="主要参数"></a>主要参数</h2><p>** [options]主要参数：**</p>
<p>－c：只输出匹配行的计数。<br>－I：不区分大 小写(只适用于单字符)。<br>－h：查询多文件时不显示文件名。<br>－l：查询多文件时只输出包含匹配字符的文件名。<br>－n：显示匹配行及 行号。<br>－s：不显示不存在或无匹配文本的错误信息。<br>－v：显示不包含匹配文本的所有行。</p>
<p>** pattern正则表达式主要参数：**</p>
<p>\： 忽略正则表达式中特殊字符的原有含义。<br>^：匹配正则表达式的开始行。<br>$: 匹配正则表达式的结束行。<br>&lt;：从匹配正则表达 式的行开始。<br>\&gt;：到匹配正则表达式的行结束。<br>[ ]：单个字符，如[A]即A符合要求 。<br>[ - ]：范围，如[A-Z]，即A、B、C一直到Z都符合要求 。<br>。：所有的单个字符。<br>* ：有字符，长度可以为0。</p>
<h2 id="grep命令使用简单实例"><a href="#grep命令使用简单实例" class="headerlink" title="grep命令使用简单实例"></a>grep命令使用简单实例</h2><p><code>ls |grep &#39;1&#39; t*</code><br>:显示所有以t开头的文件中包含‘1’的行</p>
<p><code>grep ‘test’ aa bb cc</code><br>:显示在aa，bb，cc文件中匹配test的行。</p>
<p><code>grep ‘[a-z]\&#123;5\&#125;’ aa</code><br>:显示所有包含每个字符串至少有5个连续小写字符的字符串的行。</p>
<h2 id="grep命令使用复杂实例"><a href="#grep命令使用复杂实例" class="headerlink" title="grep命令使用复杂实例"></a>grep命令使用复杂实例</h2><p>假设您正在’/usr/src/Linux/Doc’目录下搜索带字符 串’magic’的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ grep magic &#x2F;usr&#x2F;src&#x2F;Linux&#x2F;Doc&#x2F;*</span><br><span class="line">sysrq.txt:* How do I enable the magic SysRQ key?</span><br><span class="line">sysrq.txt:* How do I use the magic SysRQ key?</span><br></pre></td></tr></table></figure>

<p>其中文件’sysrp.txt’包含该字符串，讨论的是 SysRQ 的功能。<br>默认情况下，’grep’只搜索当前目录。如果 此目录下有许多子目录，’grep’会以如下形式列出：<br>grep: sound: Is a directory<br>这可能会使’grep’ 的输出难于阅读。这里有两种解决的办法：</p>
<p>明确要求搜索子目录：<code>grep -r</code><br>或忽略子目录：<code>grep -d skip</code></p>
<p>如果有很多 输出时，您可以通过管道将其转到’less’上阅读：<br><code>$ grep magic /usr/src/Linux/Documentation/* | less</code><br>这样，您就可以更方便地阅读。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/end/archive/2012/02/21/2360965.html">http://www.cnblogs.com/end/archive/2012/02/21/2360965.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/10/Linux-shell%E4%B8%AD%E7%9A%84%E7%AB%96%E7%BA%BF%EF%BC%88-%EF%BC%89%E2%80%94%E2%80%94%E7%AE%A1%E9%81%93%E7%AC%A6%E5%8F%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/Linux-shell%E4%B8%AD%E7%9A%84%E7%AB%96%E7%BA%BF%EF%BC%88-%EF%BC%89%E2%80%94%E2%80%94%E7%AE%A1%E9%81%93%E7%AC%A6%E5%8F%B7/" class="post-title-link" itemprop="url">Linux shell中的竖线（|）——管道符号</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-10 10:18:29" itemprop="dateCreated datePublished" datetime="2018-05-10T10:18:29+00:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" itemprop="url" rel="index"><span itemprop="name">Linux基础命令</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux-shell中的竖线（-）——管道符号"><a href="#Linux-shell中的竖线（-）——管道符号" class="headerlink" title="Linux shell中的竖线（|）——管道符号"></a>Linux shell中的竖线（|）——管道符号</h1><p>在Linux系统中管道线是由竖杠（|）隔开的若干个命令组成的序列，在管道线中，每个命令运行时都有一个独立的进程。前一个命令的输出正是下一个命令的输入。而管道线中有一类命令也称作“过滤器”，过滤器首先读取输入，然后将输入以某种简单方式进行变换（相当于过滤），再将处理结果输出，例如grep、tail、sort和wc等命令就称为过滤器。</p>
<p>一个管道线中可以包括多条命令。</p>
<p>用法: <code>command 1 | command 2</code></p>
<p>他的功能是把第一个命令command 1执行的结果作为command 2的输入传给command 2</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -s|sort -nr</span><br></pre></td></tr></table></figure>

<p>-s 是file size，-n是numeric-sort，-r是reverse，反转</p>
<p>该命令列出当前目录中的文档(含size)，并把输出送给sort命令作为输入，sort命令按数字递减的顺序把ls的输出排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -s|sort -n</span><br></pre></td></tr></table></figure>

<p>按从小到大的顺序输出。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_6d09b5750100vley.html">http://blog.sina.com.cn/s/blog_6d09b5750100vley.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kaosini/article/details/6578115">https://blog.csdn.net/kaosini/article/details/6578115</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/09/Docker%E5%9F%BA%E7%A1%80-%E9%95%9C%E5%83%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/09/Docker%E5%9F%BA%E7%A1%80-%E9%95%9C%E5%83%8F/" class="post-title-link" itemprop="url">Docker基础-镜像</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-09 09:00:50" itemprop="dateCreated datePublished" datetime="2018-05-09T09:00:50+00:00">2018-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>** 三大核心概念 **</p>
<p>镜像，容器，仓库</p>
<p><strong>镜像是 Docker 的三大核心概念之一</strong>。Docker 运行容器前需要本地存在对应的镜像，如果本地没有对应的镜像，Docker 会尝试从默认的镜像仓库下载。当然用户也可以通过配置，使用自定义的镜像仓库。<br>本文将介绍镜像的具体操作，包括使用 pull 命令从 Docker Hub 的镜像仓库中拉取(下载)公共镜像；查看本地已有的镜像信息；使用 search 命令搜索镜像；删除镜像标签和镜像文件；创建用户自定义镜像并上传到 Docker Hub 镜像仓库。<br>与镜像相关的操作都被定义在 <strong>docker image</strong> 子命令中，虽然不带 image 的格式依然被兼容，但带上 image 后会让命令更容易理解，也会有更好的自动补全效果。</p>
<h2 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h2><p>本地镜像是运行容器的前提，所以在运行容器前我们需要使用 docker image pull 命令从网络上的镜像仓库把镜像拉取到本地。该命令的格式为：</p>
<p>** docker image pull [OPTIONS] NAME[:TAG|@DIGEST] **</p>
<p>如果只指定了镜像的名称，默认会选择拉取 latest 标签标记的镜像。比如我们要拉取最新的 ubuntu 镜像：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull ubuntu</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509141612.png" alt="1"></p>
<p>该命令实际拉取的是 ubuntu:latest 镜像。从上图中可以看到，docker 的镜像其实被分成了很多的层，每层保存一些特定的文件。上面的命令实际相当于：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull registry.hub.docker.com/ubuntu:latest</span><br></pre></td></tr></table></figure>

<p>即从默认的数据仓库服务器 registry.hub.docker.com 中拉取 ubuntu 仓库中的最新镜像。如果我们感觉从 Docker Hub 上拉取镜像太慢，可选择从其它的数据仓库服务器上拉取，比如 Docker Hub 在国内部署的服务器：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull registry.docker-cn.com/library/ubuntu:latest</span><br></pre></td></tr></table></figure>

<p>镜像下载到本地后就可运行容器了，比如：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> --rm ubuntu <span class="built_in">echo</span> hello docker</span></span><br></pre></td></tr></table></figure>

<p>–rm :退出时，删除容器</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509163105.png" alt="1"></p>
<h2 id="查看镜像信息"><a href="#查看镜像信息" class="headerlink" title="查看镜像信息"></a>查看镜像信息</h2><p> <code>docker image ls</code> 或 <code>docker images</code> 命令可以列出本地存储的镜像<br><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509163307.png" alt="2"></p>
<p>输出的信息中包含的内容有：</p>
<p>REPOSITORY：说明镜像来自哪个仓库，比如 ubuntu 或 registry.docker-cn.com/library/ubuntu。</p>
<p>TAG：镜像的标签信息，比如 14.04 或 latest。</p>
<p>IMAGE ID：标识镜像的 ID 号。</p>
<p>CREATED：创建镜像的时间。</p>
<p>SIZE：镜像大小。</p>
<p>其中镜像的 ID 信息十分重要，它唯一的标识了镜像。</p>
<p>TAG 信息用来标记来自同一个仓库(比如 ubuntu)的不同镜像。例如 ubuntu 仓库中有多个镜像，可以通过 TAG 信息来区</p>
<p>分它们，TAG 13.04、14.04 和 16.04 都代表了不同的发行版本。</p>
<p>使用 <code>docker image tag</code> 命令为本地的镜像添加新的标签还可以方便我们的使用，比如为 ubuntu:latest 镜像添加下面的标签：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image tag ubuntu:latest oldubuntu</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509163748.png" alt="3"></p>
<p>使用<code>docker image inspect</code>命令可以查看镜像详细信息</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect ubuntu:latest</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509164159.png" alt="4"></p>
<p>它输出的是一个 JSON 格式的信息，一般情况下我们会有的放矢的通过 -f 选项取其中的某一部分。比如只获取镜像的 Architecture 信息：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect -f &#123;&#123;<span class="string">&quot;.Architecture&quot;</span>&#125;&#125; ubuntu:latest</span><br></pre></td></tr></table></figure>

<h2 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h2><p>除了直接在 Docker Hub 的官方网站上搜索镜像资源，还可以通 docker search 命令以命令行的方式进行搜索，比如搜索 mysql 镜像：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure>

<p>这个命令的价值有限，因为我们在选择镜像时还是需要慎重的。往往要在 Docker Hub 的官方网站上查看镜像相关的详细信息，然后才会决定是否使用，而 docker search 命令提供的信息过于有限。</p>
<h2 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h2><p> docker image rm 命令传递镜像的标签或 ID，这两种方式略微有些区别。</p>
<h3 id="使用进行的标签删除镜像"><a href="#使用进行的标签删除镜像" class="headerlink" title="使用进行的标签删除镜像"></a>使用进行的标签删除镜像</h3><p>对于被多个标签引用的镜像 ID，删除标签时只是把那个标签删掉了，并不会真正删除镜像文件。</p>
<h3 id="使用镜像-ID-删除镜像"><a href="#使用镜像-ID-删除镜像" class="headerlink" title="使用镜像 ID 删除镜像"></a>使用镜像 ID 删除镜像</h3><p> docker 检测到该镜像 ID 被引用了多次就机智的报错了，并且终止了删除操作。同样如果由其它的镜像引用了该 ID 的镜像， docker 同样会报错并终止删除操作。所以，只有当一个镜像不被多个标签引用，也没其它镜像引用它时，才可以被通过镜像 ID 删除。</p>
<h2 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h2><p>我们可以通过不同的方式创建镜像，比如基于已有容器进行创建和基于 Dockerfile 文件进行创建。</p>
<p>这里只介绍如何通过 <code>docker container commit</code> 命令基于已有容器创建镜像</p>
<p>我们先启动一个以 ubuntu:latest 为镜像的容器，然后在当前目录下创建一个名为 testfile 的文件:</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> -it ubuntu:latest bash</span></span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]<span class="comment"># docker run -it ubuntu:latest bash</span></span><br><span class="line">root@<span class="number">2</span>a45b0b39bf8:/<span class="comment"># touch testfile</span></span><br><span class="line">root@<span class="number">2</span>a45b0b39bf8:/<span class="comment"># ls</span></span><br><span class="line">bin   dev  home  lib64  mnt  proc  <span class="keyword">run</span><span class="bash">   srv  testfile  usr</span></span><br><span class="line">boot  etc  lib   media  opt  root  sbin  sys  tmp       var</span><br><span class="line">root@<span class="number">2</span>a45b0b39bf8:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>在文件创建后退出容器，但要记住该容器的 ID 为： 2a45b0b39bf8 。然后执行下面的命令创建镜像：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container commit -m <span class="string">&quot;add file testfile.&quot;</span> <span class="number">2</span>a45b0b39bf8 testimage</span><br></pre></td></tr></table></figure>

<p>镜像创建成功后，你可以在镜像列表中看到名称为 testimage 的镜像</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p>下面运行一个基于 testimage 的容器，看看 nickfile 是否存在。–rm：退出时自动删除</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> --rm testimage ls</span></span><br></pre></td></tr></table></figure>

<p>在容器中创建的文件 testfile 已经被成功的添加到 testimage 镜像中了。</p>
<h2 id="导入导出镜像"><a href="#导入导出镜像" class="headerlink" title="导入导出镜像"></a>导入导出镜像</h2><p>当碰到没有网络的环境时，如何获取镜像呢？答案是在能够获得镜像的环境中把镜像导出为文件，然后通过 U 盘等设备拷贝到目标环境中，再进行导入。</p>
<h3 id="导出镜像"><a href="#导出镜像" class="headerlink" title="导出镜像"></a>导出镜像</h3><p>通过 <code>docker image save</code> 命令可以把镜像导出为本地文件，比如导出 ubuntu:latest 镜像为 ubuntu1804.tar：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image save -o ubuntu1804.tar ubuntu:latest</span><br></pre></td></tr></table></figure>

<p>一般我们还会再压缩一下，这样最终的文件会小不少：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -czf ubuntu1804.tar.gz ubuntu1804.tar</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180509172150.png" alt="4"></p>
<h3 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a>导入镜像</h3><p>把 ubuntu1804.tar.gz 文件拷贝到目标系统上后先要解压出 ubuntu1804.tar 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xf ubuntu1804.tar.gz</span><br></pre></td></tr></table></figure>

<p>然后通过 docker image load 命令执行镜像的导入操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image load -i ubuntu1804.tar</span><br></pre></td></tr></table></figure>

<p>这样就 OK 了，用 docker image ls 命令看看，是不是已经可以看到 ubuntu:latest 镜像了！</p>
<h2 id="上传镜像"><a href="#上传镜像" class="headerlink" title="上传镜像"></a>上传镜像</h2><p>可以使用 <strong><code>docker image push</code></strong> 命令把镜像上传到镜像仓库服务器，默认是上传到 Docker Hub 的镜像仓库，此时事先需要注册用户并进行登录。上传镜像的命令格式为：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image push NAME[:TAG]</span><br></pre></td></tr></table></figure>

<p>在 Docker Hub 注册账号，并通过 docker login 命令完成了登录操作(需要输入用户名和密码进行验证)。接下来就可把本地的镜像上传到镜像仓库服务器了。在上传前需要给镜像打上合法的标签(用户账号/仓库名称:TAG)，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]# docker image tag --help</span><br><span class="line"></span><br><span class="line">Usage: docker image tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br><span class="line"></span><br><span class="line">Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line"></span><br><span class="line">Options:</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image tag azcli:<span class="number">1.0</span> ljfpower/azcli:latest</span><br></pre></td></tr></table></figure>

<p>最后上传这个标签就行了：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image push ljfpower/azcli:latest</span><br></pre></td></tr></table></figure>

<p>上传后你就可以在 Docker Hub 上看到这个镜像了。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sparkdev/p/8901728.html">https://www.cnblogs.com/sparkdev/p/8901728.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/08/CentOS7-Docker-Jenkins-DotNetCore%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/08/CentOS7-Docker-Jenkins-DotNetCore%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">CentOS7 & Docker & Jenkins & DotNetCore项目配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-08 13:54:33" itemprop="dateCreated datePublished" datetime="2018-05-08T13:54:33+00:00">2018-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jenkins/" itemprop="url" rel="index"><span itemprop="name">Jenkins</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CentOS7-amp-Docker-amp-Jenkins-amp-DotNetCore项目配置"><a href="#CentOS7-amp-Docker-amp-Jenkins-amp-DotNetCore项目配置" class="headerlink" title="CentOS7 &amp; Docker &amp; Jenkins &amp; DotNetCore项目配置"></a>CentOS7 &amp; Docker &amp; Jenkins &amp; DotNetCore项目配置</h1><h2 id="GitHub配置"><a href="#GitHub配置" class="headerlink" title="GitHub配置"></a>GitHub配置</h2><h3 id="SercretText"><a href="#SercretText" class="headerlink" title="SercretText"></a>SercretText</h3><p>注：此处需要一个对项目有写权限的账户</p>
<p>进入SGithub –&gt; Setting –&gt; Developer settings –&gt; Personal access tokens</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508141541.png" alt="1"></p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508141948.png" alt="2"></p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508142138.png" alt="3"></p>
<p>自己先保存此token，如果丢失，之后再也无法找到这个token。</p>
<h2 id="配置GitHub-Plugin"><a href="#配置GitHub-Plugin" class="headerlink" title="配置GitHub Plugin"></a>配置GitHub Plugin</h2><p>系统管理 –&gt; 系统设置 –&gt; GitHub –&gt; GitHub Plugin</p>
<p>配置github用户名，邮箱</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508144549.png" alt="4"></p>
<h2 id="配置Jenkins"><a href="#配置Jenkins" class="headerlink" title="配置Jenkins"></a>配置Jenkins</h2><h3 id="新建任务："><a href="#新建任务：" class="headerlink" title="新建任务："></a>新建任务：</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508145651.png" alt="5"></p>
<h3 id="General-通常"><a href="#General-通常" class="headerlink" title="General(通常)"></a>General(通常)</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508145841.png" alt="6"></p>
<h3 id="源码管理"><a href="#源码管理" class="headerlink" title="源码管理"></a>源码管理</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508145941.png" alt="7"></p>
<p>点击Add：</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508150102.png" alt="8"></p>
<h3 id="构建触发器："><a href="#构建触发器：" class="headerlink" title="构建触发器："></a>构建触发器：</h3><p><code>H/2 * * * *</code></p>
<p>具体参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/brave_insist/article/details/78434877">https://blog.csdn.net/brave_insist/article/details/78434877</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">每15分钟构建一次：H&#x2F;15 * * * *   或*&#x2F;5 * * * *</span><br><span class="line"></span><br><span class="line">每天8点构建一次：0 8 * * *</span><br><span class="line"></span><br><span class="line">每天8点~17点，两小时构建一次：0 8-17&#x2F;2 * * *</span><br><span class="line"></span><br><span class="line">周一到周五，8点~17点，两小时构建一次：0 8-17&#x2F;2 * * 1-5</span><br><span class="line"></span><br><span class="line">每月1号、15号各构建一次，除12月：H H 1,15 1-11 *</span><br><span class="line"></span><br><span class="line">*&#x2F;5 * * * * （每5分钟检查一次源码变化）</span><br><span class="line"></span><br><span class="line">0 2 * * * （每天2:00 必须build一次源码）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">每个部分代表的含义以及取值范围</span><br><span class="line"></span><br><span class="line">分钟，取值范围（0~59）：若其他值不做设定，则表示每个设定的分钟都会构建</span><br><span class="line">如：5 * * * * ，表示每个小时的第5分钟都会构建一次</span><br><span class="line"></span><br><span class="line">小时，取值范围（0~23）：若其他值不做设定，则表示每个设定小时的每分钟都会构建</span><br><span class="line">如：* 5 * * * ，表示在每天5点的时候，一小时内每一分钟都会构建一次</span><br><span class="line"></span><br><span class="line">日期，取值范围（1~31）：若其他值不做设定，则表示每个月的那一天每分钟都会构建一次</span><br><span class="line">如：* * 5 * *，表示在每个月5号的时候，0点开始每分钟构建一次</span><br><span class="line"></span><br><span class="line">月份，取值范围（1~12）：若其他值不做设定，则表示每年的那个月每分钟都会构建一次</span><br><span class="line">如：* * * 5 *，表示在每年的5月份，1号0点开始每分钟构建一次</span><br><span class="line"></span><br><span class="line">星期，取值范围（0 ~ 7）：若其他值不做设定，则表示每周的那一天几每分钟都会构建一次</span><br><span class="line">如：* * * * 5，表示每周五0点开始每分钟构建一次</span><br></pre></td></tr></table></figure>

<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508150645.png" alt="9"></p>
<h3 id="构建环境"><a href="#构建环境" class="headerlink" title="构建环境"></a>构建环境</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508151257.png" alt="10"></p>
<p>点击Add：</p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508152137.png" alt="10"></p>
<p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508152518.png" alt="11"></p>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><p><img src="/img/QQ%E6%88%AA%E5%9B%BE20180508152609.png" alt="12"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 获取短版本号</span></span><br><span class="line"></span><br><span class="line">GITHASH=`git rev-parse --short HEAD`</span><br><span class="line"><span class="built_in">echo</span> ---------------Remove-Orphans------------------</span><br><span class="line">docker-compose -f ./docker-compose.yml -f ./docker-compose.override.yml  -p dotnetcoreapp1 down --rmi <span class="built_in">local</span> --remove-orphans</span><br><span class="line"><span class="built_in">echo</span> ------------------Config-----------------------</span><br><span class="line">docker-compose -f ./docker-compose.ci.build.yml -p dotnetcoreapp1 config</span><br><span class="line"><span class="built_in">echo</span> ------------------Build------------------------</span><br><span class="line">docker-compose -f ./docker-compose.ci.build.yml -p dotnetcoreapp1 up --build</span><br><span class="line"><span class="built_in">echo</span> ---------------Publishing...------------------</span><br><span class="line">docker-compose -f <span class="string">&quot;./docker-compose.yml&quot;</span> -f <span class="string">&quot;./docker-compose.override.yml&quot;</span>  -p dotnetcoreapp1 up -d --build</span><br><span class="line"><span class="built_in">echo</span> ---------------Clear-Images...------------------</span><br><span class="line">docker rmi -f $(docker images -f <span class="string">&quot;dangling=true&quot;</span> -q)</span><br><span class="line"><span class="built_in">echo</span> ---------------Clear-Containers...------------------</span><br><span class="line">docker rm dotnetcoreapp1_ci-build_1</span><br></pre></td></tr></table></figure>

<p>命令说明：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-f, --file FILE 指定使用的 Compose 模板文件，默认为 docker-compose.yml，可以多次指定。</span><br><span class="line"></span><br><span class="line">-p, --project-name NAME 指定项目名称，默认将使用所在目录名称作为项目名。</span><br></pre></td></tr></table></figure>

<p>修改docker-compose.override.yml文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">dotnetcoreapp:</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ASPNETCORE_ENVIRONMENT=Development</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8081:80&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[MvcTest] $ /bin/bash /tmp/jenkins3923627102865574973.sh</span><br><span class="line">---------------Remove-Orphans------------------</span><br><span class="line"></span><br><span class="line">Removing network dotnetcoreapp1_default</span><br><span class="line">------------------Config-----------------------</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  ci-build:</span><br><span class="line">    <span class="built_in">command</span>: /bin/bash -c <span class="string">&quot;dotnet restore ./DotNetCoreApp.sln &amp;&amp; dotnet publish ./DotNetCoreApp.sln</span></span><br><span class="line"><span class="string">      -c Release -o ./obj/Docker/publish&quot;</span></span><br><span class="line">    image: microsoft/aspnetcore-build:1.0-2.0</span><br><span class="line">    volumes:</span><br><span class="line">    - /var/jenkins_home/workspace/MvcTest:/src:rw</span><br><span class="line">    working_dir: /src</span><br><span class="line">version: <span class="string">&#x27;3.0&#x27;</span></span><br><span class="line"></span><br><span class="line">------------------Build------------------------</span><br><span class="line"></span><br><span class="line">Creating network <span class="string">&quot;dotnetcoreapp1_default&quot;</span> with the default driver</span><br><span class="line"></span><br><span class="line">Creating dotnetcoreapp1_ci-build_1 ... </span><br><span class="line"></span><br><span class="line">[1A[2K</span><br><span class="line">Creating dotnetcoreapp1_ci-build_1 ... [32mdone[0m</span><br><span class="line">[1BAttaching to dotnetcoreapp1_ci-build_1</span><br><span class="line">[36mci-build_1  |[0m   Restoring packages <span class="keyword">for</span> /src/DotNetCoreApp/DotNetCoreApp.csproj...</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   Generating MSBuild file /src/DotNetCoreApp/obj/DotNetCoreApp.csproj.nuget.g.props.</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   Generating MSBuild file /src/DotNetCoreApp/obj/DotNetCoreApp.csproj.nuget.g.targets.</span><br><span class="line">[36mci-build_1  |[0m   Restore completed <span class="keyword">in</span> 30.06 sec <span class="keyword">for</span> /src/DotNetCoreApp/DotNetCoreApp.csproj.</span><br><span class="line">[36mci-build_1  |[0m   Restoring packages <span class="keyword">for</span> /src/DotNetCoreApp/DotNetCoreApp.csproj...</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   Restore completed <span class="keyword">in</span> 2.64 sec <span class="keyword">for</span> /src/DotNetCoreApp/DotNetCoreApp.csproj.</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m Microsoft (R) Build Engine version 15.6.84.34536 <span class="keyword">for</span> .NET Core</span><br><span class="line">[36mci-build_1  |[0m Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line">[36mci-build_1  |[0m </span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   Restore completed <span class="keyword">in</span> 97.25 ms <span class="keyword">for</span> /src/DotNetCoreApp/DotNetCoreApp.csproj.</span><br><span class="line">[36mci-build_1  |[0m   Restore completed <span class="keyword">in</span> 24.37 ms <span class="keyword">for</span> /src/DotNetCoreApp/DotNetCoreApp.csproj.</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   DotNetCoreApp -&gt; /src/DotNetCoreApp/bin/Release/netcoreapp2.0/DotNetCoreApp.dll</span><br><span class="line"></span><br><span class="line">[36mci-build_1  |[0m   DotNetCoreApp -&gt; /src/DotNetCoreApp/obj/Docker/publish/</span><br><span class="line"></span><br><span class="line">[36mdotnetcoreapp1_ci-build_1 exited with code 0</span><br><span class="line"></span><br><span class="line">[0m---------------Publishing...------------------</span><br><span class="line"></span><br><span class="line">Building dotnetcoreapp</span><br><span class="line"></span><br><span class="line">Step 1/6 : FROM microsoft/aspnetcore:2.0</span><br><span class="line"> ---&gt; c4ca78cf9dca</span><br><span class="line">Step 2/6 : ARG <span class="built_in">source</span></span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 5ccef217b449</span><br><span class="line">Step 3/6 : WORKDIR /app</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 21ca58736a23</span><br><span class="line">Step 4/6 : EXPOSE 80</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; fa9898960c84</span><br><span class="line">Step 5/6 : COPY <span class="variable">$&#123;source:-obj/Docker/publish&#125;</span> .</span><br><span class="line"></span><br><span class="line"> ---&gt; a7d0c6386eb4</span><br><span class="line">Step 6/6 : ENTRYPOINT [<span class="string">&quot;dotnet&quot;</span>, <span class="string">&quot;DotNetCoreApp.dll&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> dd4cfb6f5cb8</span><br><span class="line"></span><br><span class="line">Removing intermediate container dd4cfb6f5cb8</span><br><span class="line"> ---&gt; d8dea36554b4</span><br><span class="line">Successfully built d8dea36554b4</span><br><span class="line">Successfully tagged dotnetcoreapp:latest</span><br><span class="line">Recreating dotnetcoreapp2_dotnetcoreapp_1 ... </span><br><span class="line"></span><br><span class="line">[1A[2K</span><br><span class="line">Recreating dotnetcoreapp2_dotnetcoreapp_1 ... [32mdone[0m</span><br><span class="line">[1B---------------Clear-Images...------------------</span><br><span class="line"></span><br><span class="line">Deleted: sha256:238c39ae8c13a1d6816361946429024cb46e6911329dad2d714033d2578da618</span><br><span class="line">Deleted: sha256:12dfe61eae3ee68775237340f3e50e19554a653357baec0de52a50d0cff96652</span><br><span class="line">Deleted: sha256:3f6beb8ffd03ee5d3b9fd0e9e5b46074d270cdb707fa07056087194a53be1dd4</span><br><span class="line">---------------Clear-Containers...------------------</span><br><span class="line"></span><br><span class="line">dotnetcoreapp1_ci-build_1</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure>

<p>最后通过浏览器访问<code>http://localhost:8081</code></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/stulzq/p/8627824.html">http://www.cnblogs.com/stulzq/p/8627824.html</a><br><a target="_blank" rel="noopener" href="https://github.com/muyinchen/woker/blob/master/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAJenkins%2BGithub%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83.md">https://github.com/muyinchen/woker/blob/master/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E6%90%AD%E5%BB%BAJenkins%2BGithub%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83.md</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/LongJiangXie/p/7517909.html">http://www.cnblogs.com/LongJiangXie/p/7517909.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/JacZhu/p/6814848.html">http://www.cnblogs.com/JacZhu/p/6814848.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/03/%E5%8D%B8%E8%BD%BDDotNetCore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/03/%E5%8D%B8%E8%BD%BDDotNetCore/" class="post-title-link" itemprop="url">卸载DotNetCore</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-03 16:59:47" itemprop="dateCreated datePublished" datetime="2018-05-03T16:59:47+00:00">2018-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/DotNetCore/" itemprop="url" rel="index"><span itemprop="name">DotNetCore</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="卸载DotNetCore"><a href="#卸载DotNetCore" class="headerlink" title="卸载DotNetCore"></a>卸载DotNetCore</h1><p>查找dotnet命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">which dotnet</span><br></pre></td></tr></table></figure>

<p>查找dotnet相关的rpm包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep dotnet</span><br></pre></td></tr></table></figure>

<p>移除相关包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e dotnet-runtime-deps-2.1.0-preview2-26406-04-2.1.0_preview2_26406_04-1.x86_64</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://syxdevcode.github.com/2018/05/03/Docker%E5%AE%B9%E5%99%A8%E8%BF%9B%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="syxdevcode">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="syxdevcode博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/03/Docker%E5%AE%B9%E5%99%A8%E8%BF%9B%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">Docker容器进入的方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-03 16:37:21" itemprop="dateCreated datePublished" datetime="2018-05-03T16:37:21+00:00">2018-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-25 13:27:24" itemprop="dateModified" datetime="2021-05-25T13:27:24+00:00">2021-05-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker容器进入的方式"><a href="#Docker容器进入的方式" class="headerlink" title="Docker容器进入的方式"></a>Docker容器进入的方式</h1><h2 id="1-使用docker-exec进入Docker容器"><a href="#1-使用docker-exec进入Docker容器" class="headerlink" title="1.使用docker exec进入Docker容器"></a>1.使用docker exec进入Docker容器</h2><p>docker在1.3.X版本之后还提供了一个新的命令exec用于进入容器，这种方式相对更简单一些，下面我们来看一下该命令的使用：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec --help</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost toor]# sudo docker exec --help</span><br><span class="line"></span><br><span class="line">Usage: docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</span><br><span class="line"></span><br><span class="line">Run a command in a running container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -d, --detach               Detached mode: run command in the background</span><br><span class="line">      --detach-keys string   Override the key sequence for detaching a</span><br><span class="line">                             container</span><br><span class="line">  -e, --env list             Set environment variables</span><br><span class="line">  -i, --interactive          Keep STDIN open even if not attached</span><br><span class="line">      --privileged           Give extended privileges to the command</span><br><span class="line">  -t, --tty                  Allocate a pseudo-TTY</span><br><span class="line">  -u, --user string          Username or UID (format:</span><br><span class="line">                             &lt;name|uid&gt;[:&lt;group|gid&gt;])</span><br><span class="line">  -w, --workdir string       Working directory inside the container</span><br><span class="line">[root@localhost toor]#</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost toor]<span class="comment"># docker exec -it a46fa8852e07 /bin/bash</span></span><br><span class="line">root@a46fa8852e07:/<span class="comment"># exit</span></span><br><span class="line">exit</span><br><span class="line">[root@localhost toor]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xhyan/p/6593075.html">https://www.cnblogs.com/xhyan/p/6593075.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/25/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><span class="page-number current">26</span><a class="page-number" href="/page/27/">27</a><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/27/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">syxdevcode</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">420</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">122</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">178</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/syxdevcode" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;syxdevcode" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">syxdevcode</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
