
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Docker Compose配置文件详解 | syxdevcode博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="syxdevcode">
    
    <meta name="description" content="Docker Compose配置文件详解参考官网：https://docs.docker.com/compose/compose-file/#service-configuration-reference
Compose文件是一个定义服务， 网络和 卷的YAML文件 。Compose文件的默认路径是">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="syxdevcode博客" title="syxdevcode博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="syxdevcode博客">syxdevcode博客</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/tags">tags</a></li>
					
						<li><a href="/categories">categories</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:syxdevcode.github.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/05/11/Docker Compose配置文件详解/" title="Docker Compose配置文件详解" itemprop="url">Docker Compose配置文件详解</a>
  </h1>
  <p class="article-author">By
    
      <a href="https://syxdevcode.github.com" title="syxdevcode">syxdevcode</a>
    </p>
  <p class="article-time">
    <time datetime="2018-05-11T14:38:31.000Z" itemprop="datePublished">2018-05-11</time>
    更新日期:<time datetime="2020-09-21T02:07:14.225Z" itemprop="dateModified">2020-09-21</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Compose配置文件详解"><span class="toc-number">1.</span> <span class="toc-text">Docker Compose配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#image"><span class="toc-number">1.1.</span> <span class="toc-text">image</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#build"><span class="toc-number">1.2.</span> <span class="toc-text">build</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#context"><span class="toc-number">1.2.1.</span> <span class="toc-text">context</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile"><span class="toc-number">1.2.2.</span> <span class="toc-text">dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#args"><span class="toc-number">1.2.3.</span> <span class="toc-text">args</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cache-from"><span class="toc-number">1.2.4.</span> <span class="toc-text">cache_from</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#labels"><span class="toc-number">1.2.5.</span> <span class="toc-text">labels</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shm-size"><span class="toc-number">1.2.6.</span> <span class="toc-text">shm_size</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cap-add-cap-drop"><span class="toc-number">1.3.</span> <span class="toc-text">cap_add, cap_drop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#command"><span class="toc-number">1.4.</span> <span class="toc-text">command</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#configs"><span class="toc-number">1.5.</span> <span class="toc-text">configs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SHORT-SYNTAX"><span class="toc-number">1.5.1.</span> <span class="toc-text">SHORT SYNTAX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LONG-SYNTAX"><span class="toc-number">1.5.2.</span> <span class="toc-text">LONG SYNTAX</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#container-name"><span class="toc-number">1.6.</span> <span class="toc-text">container_name</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deploy"><span class="toc-number">1.7.</span> <span class="toc-text">deploy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ENDPOINT-MODE"><span class="toc-number">1.7.1.</span> <span class="toc-text">ENDPOINT_MODE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LABELS"><span class="toc-number">1.7.2.</span> <span class="toc-text">LABELS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MODE"><span class="toc-number">1.7.3.</span> <span class="toc-text">MODE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PLACEMENT"><span class="toc-number">1.7.4.</span> <span class="toc-text">PLACEMENT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#REPLICAS"><span class="toc-number">1.7.5.</span> <span class="toc-text">REPLICAS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RESOURCES"><span class="toc-number">1.7.6.</span> <span class="toc-text">RESOURCES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RESTART-POLICY"><span class="toc-number">1.7.7.</span> <span class="toc-text">RESTART_POLICY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UPDATE-CONFIG"><span class="toc-number">1.7.8.</span> <span class="toc-text">UPDATE_CONFIG</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#devices"><span class="toc-number">1.8.</span> <span class="toc-text">devices</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#depends-on"><span class="toc-number">1.9.</span> <span class="toc-text">depends_on</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dns"><span class="toc-number">1.10.</span> <span class="toc-text">dns</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dns-search"><span class="toc-number">1.11.</span> <span class="toc-text">dns_search</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tmpfs"><span class="toc-number">1.12.</span> <span class="toc-text">tmpfs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#entrypoint"><span class="toc-number">1.13.</span> <span class="toc-text">entrypoint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#env-file"><span class="toc-number">1.14.</span> <span class="toc-text">env_file</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#environment"><span class="toc-number">1.15.</span> <span class="toc-text">environment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#expose"><span class="toc-number">1.16.</span> <span class="toc-text">expose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#external-links"><span class="toc-number">1.17.</span> <span class="toc-text">external_links</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extra-hosts"><span class="toc-number">1.18.</span> <span class="toc-text">extra_hosts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#healthcheck"><span class="toc-number">1.19.</span> <span class="toc-text">healthcheck</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Specifying-durations"><span class="toc-number">1.20.</span> <span class="toc-text">Specifying durations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#isolation"><span class="toc-number">1.21.</span> <span class="toc-text">isolation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#labels-1"><span class="toc-number">1.22.</span> <span class="toc-text">labels</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#logging"><span class="toc-number">1.23.</span> <span class="toc-text">logging</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#network-mode"><span class="toc-number">1.24.</span> <span class="toc-text">network_mode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#networks"><span class="toc-number">1.25.</span> <span class="toc-text">networks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ALIASES"><span class="toc-number">1.25.1.</span> <span class="toc-text">ALIASES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPV4-ADDRESS-IPV6-ADDRESS"><span class="toc-number">1.25.2.</span> <span class="toc-text">IPV4_ADDRESS, IPV6_ADDRESS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pid"><span class="toc-number">1.26.</span> <span class="toc-text">pid</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ports"><span class="toc-number">1.27.</span> <span class="toc-text">ports</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SHORT-SYNTAX-1"><span class="toc-number">1.27.1.</span> <span class="toc-text">SHORT SYNTAX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LONG-SYNTAX-1"><span class="toc-number">1.27.2.</span> <span class="toc-text">LONG SYNTAX</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#secrets"><span class="toc-number">1.28.</span> <span class="toc-text">secrets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#security-opt"><span class="toc-number">1.29.</span> <span class="toc-text">security_opt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stop-grace-period"><span class="toc-number">1.30.</span> <span class="toc-text">stop_grace_period</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stop-signal"><span class="toc-number">1.31.</span> <span class="toc-text">stop_signal</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sysctls"><span class="toc-number">1.32.</span> <span class="toc-text">sysctls</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ulimits"><span class="toc-number">1.33.</span> <span class="toc-text">ulimits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#userns-mode"><span class="toc-number">1.34.</span> <span class="toc-text">userns_mode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#volumes"><span class="toc-number">1.35.</span> <span class="toc-text">volumes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SHORT-SYNTAX-2"><span class="toc-number">1.35.1.</span> <span class="toc-text">SHORT SYNTAX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LONG-SYNTAX-2"><span class="toc-number">1.35.2.</span> <span class="toc-text">LONG SYNTAX</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#restart"><span class="toc-number">1.36.</span> <span class="toc-text">restart</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#domainname-hostname-ipc-mac-address-privileged-read-only-shm-size-stdin-open-tty-user-working-dir"><span class="toc-number">1.37.</span> <span class="toc-text">domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Specifying-durations-1"><span class="toc-number">1.38.</span> <span class="toc-text">Specifying durations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Volume-configuration-reference"><span class="toc-number">1.39.</span> <span class="toc-text">Volume configuration reference</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#driver"><span class="toc-number">1.39.1.</span> <span class="toc-text">driver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#driver-opts"><span class="toc-number">1.39.2.</span> <span class="toc-text">driver_opts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#external"><span class="toc-number">1.39.3.</span> <span class="toc-text">external</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#labels-2"><span class="toc-number">1.39.4.</span> <span class="toc-text">labels</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#name"><span class="toc-number">1.39.5.</span> <span class="toc-text">name</span></a></li></ol></li></ol></li></ol>
		</div>
		
		<h1 id="Docker-Compose配置文件详解"><a href="#Docker-Compose配置文件详解" class="headerlink" title="Docker Compose配置文件详解"></a>Docker Compose配置文件详解</h1><p>参考官网：<a href="https://docs.docker.com/compose/compose-file/#service-configuration-reference" target="_blank" rel="noopener">https://docs.docker.com/compose/compose-file/#service-configuration-reference</a></p>
<p>Compose文件是一个定义服务， 网络和 卷的YAML文件 。Compose文件的默认路径是。./docker-compose.yml</p>
<p>标准配置文件应该包含 version、services、networks 三大部分，其中最关键的就是 services 和 networks 两个部分。</p>
<p>提示：您可以对此文件使用a .yml或.yaml扩展名。他们都工作。</p>
<h2 id="image"><a href="#image" class="headerlink" title="image"></a>image</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  dotnetcoreapp1:</span><br><span class="line">    image: dotnetcoreapp</span><br></pre></td></tr></table></figure>

<p>在 services 标签下的第二级标签是 dotnetcoreapp1，这个名字是用户自己自定义，它就是服务名称。</p>
<p>image 则是指定服务的镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会尝试拉取这个镜像。</p>
<h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><p>在构建时应用的配置选项</p>
<p>build 可以指定为构建上下文的路径：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  webapp:</span><br><span class="line">    build: ./dir</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  webapp:</span><br><span class="line">    build:</span><br><span class="line">      context: ./dir</span><br><span class="line">      dockerfile: Dockerfile-alternate</span><br><span class="line">      args:</span><br><span class="line">        buildno: <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>如果同时指定build和image，那么会在./dir中生成名为webapp和标记的镜像tag。</p>
<h3 id="context"><a href="#context" class="headerlink" title="context"></a>context</h3><p>可以是包含Dockerfile的目录的路径，也可以是到git存储库的URL。</p>
<p>当提供的值是相对路径时，它被解释为相对于撰写文件的位置。 这个目录也是发送到Docker守护进程的构建上下文。</p>
<p>使用生成的名称构建并标记它，然后使用该镜像。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: ./dir</span><br></pre></td></tr></table></figure>

<h3 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h3><p>dockerfile作为备用，并且需要提供路径。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  dockerfile: Dockerfile-alternate</span><br></pre></td></tr></table></figure>

<h3 id="args"><a href="#args" class="headerlink" title="args"></a>args</h3><p>添加构建参数，这些参数是仅在构建过程中可访问的环境变量。</p>
<p>首先，指定Dockerfile：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> buildno</span><br><span class="line"><span class="keyword">ARG</span> gitcommithash</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"Build number: <span class="variable">$buildno</span>"</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"Based on commit: <span class="variable">$gitcommithash</span>"</span></span></span><br></pre></td></tr></table></figure>

<p>然后指定参数。 您可以传递一个映射或一个列表：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  args:</span><br><span class="line">    buildno: <span class="number">1</span></span><br><span class="line">    gitcommithash: cdc3b19</span><br><span class="line"></span><br><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  args:</span><br><span class="line">    - buildno=<span class="number">1</span></span><br><span class="line">    - gitcommithash=cdc3b19</span><br></pre></td></tr></table></figure>

<p>指定构建参数时可以省略该值，在这种情况下，构建时的值是构成运行环境中的值。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">args:</span><br><span class="line">  - buildno</span><br><span class="line">  - gitcommithash</span><br></pre></td></tr></table></figure>

<p>注意：YAML 的布尔值（true, false, yes, no, on, off）必须要使用引号引起来（单引号、双引号均可），否则会当成字符串解析。</p>
<h3 id="cache-from"><a href="#cache-from" class="headerlink" title="cache_from"></a>cache_from</h3><p>v3.2新添加</p>
<p>用于缓存解析的镜像列表</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  cache_from:</span><br><span class="line">    - alpine:latest</span><br><span class="line">    - corp/web_app:<span class="number">3.14</span></span><br></pre></td></tr></table></figure>

<h3 id="labels"><a href="#labels" class="headerlink" title="labels"></a>labels</h3><p>v3.3新添加</p>
<p>使用Docker标签将元数据添加到生成的图像。 您可以使用数组或字典。</p>
<p>建议您使用反向DNS标记来防止您的标签与其他软件使用的标签冲突。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  labels:</span><br><span class="line">    com.example.description: <span class="string">"Accounting webapp"</span></span><br><span class="line">    com.example.department: <span class="string">"Finance"</span></span><br><span class="line">    com.example.<span class="keyword">label</span><span class="bash">-with-empty-value: <span class="string">""</span></span></span><br><span class="line"></span><br><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  labels:</span><br><span class="line">    - <span class="string">"com.example.description=Accounting webapp"</span></span><br><span class="line">    - <span class="string">"com.example.department=Finance"</span></span><br><span class="line">    - <span class="string">"com.example.label-with-empty-value"</span></span><br></pre></td></tr></table></figure>

<h3 id="shm-size"><a href="#shm-size" class="headerlink" title="shm_size"></a>shm_size</h3><p>v3.5新添加</p>
<p>为此版本的容器设置/dev/shm分区的大小。 指定为表示字节数的整数值或表示字节值的字符串。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  shm_size: <span class="string">'2gb'</span></span><br><span class="line"></span><br><span class="line">build:</span><br><span class="line">  context: .</span><br><span class="line">  shm_size: <span class="number">10000000</span></span><br></pre></td></tr></table></figure>

<h2 id="cap-add-cap-drop"><a href="#cap-add-cap-drop" class="headerlink" title="cap_add, cap_drop"></a>cap_add, cap_drop</h2><p>添加或删除容器功能</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cap_add:</span><br><span class="line">  - ALL</span><br><span class="line"></span><br><span class="line">cap_drop:</span><br><span class="line">  - NET_ADMIN</span><br><span class="line">  - SYS_ADMIN</span><br></pre></td></tr></table></figure>

<h2 id="command"><a href="#command" class="headerlink" title="command"></a>command</h2><p>command 覆盖容器启动后默认执行的命令</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command: bundle exec thin -p <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p>该命令也可以是一个列表，方式类似于dockerfile：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command: [<span class="string">"bundle"</span>, <span class="string">"exec"</span>, <span class="string">"thin"</span>, <span class="string">"-p"</span>, <span class="string">"3000"</span>]</span><br></pre></td></tr></table></figure>

<h2 id="configs"><a href="#configs" class="headerlink" title="configs"></a>configs</h2><p><a href="https://docs.docker.com/engine/swarm/configs/" target="_blank" rel="noopener" title="configs命令">configs命令</a></p>
<p>Grant access to configs on a per-service basis using the per-service configs configuration.</p>
<p>为每个服务配置配置为每个服务授予对配置的访问权限。支持两种不同的语法变体。</p>
<p>注意：配置必须已经存在或在此堆栈文件的顶级配置配置中定义，否则堆栈部署失败。</p>
<h3 id="SHORT-SYNTAX"><a href="#SHORT-SYNTAX" class="headerlink" title="SHORT SYNTAX"></a>SHORT SYNTAX</h3><p>简短的语法变体只能指定配置​​名称</p>
<p>支持v3.3以上</p>
<p>以下示例使用简短语法将redis服务访问权限授予my_config和my_other_config配置。 my_config的值被设置为文件./my_config.txt的内容，my_other_config被定义为外部资源，这意味着它已经在Docker中定义，可以通过运行docker config create命令或通过另一个堆栈部署。如果外部配置不存在，堆栈部署将失败并显示配置未找到错误。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.3"</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">1</span></span><br><span class="line">    configs:</span><br><span class="line">      - my_config</span><br><span class="line">      - my_other_config</span><br><span class="line">configs:</span><br><span class="line">  my_config:</span><br><span class="line">    file: ./my_config.txt</span><br><span class="line">  my_other_config:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<h3 id="LONG-SYNTAX"><a href="#LONG-SYNTAX" class="headerlink" title="LONG SYNTAX"></a>LONG SYNTAX</h3><p>长的语法提供了在服务的任务容器中如何创建配置的更细粒度。</p>
<p>source：Docker中配置的名称。</p>
<p>target：要在服务的任务容器中安装的文件的路径和名称。如果未指定，则默认为 <code>/&lt;source&gt;</code>。</p>
<p>uid和gid：在服务的任务容器中拥有安装的配置文件的数字UID或GID。如果未指定，则在Linux上均默认为0。 Windows不支持。</p>
<p>mode：安装在服务任务容器内的文件的权限，采用八进制表示法。例如，0444代表可读。缺省值为0444.由于Configs被挂载在临时文件系统中，因此它们不能写入，因此如果设置了可写位，它将被忽略。可执行位可以被设置。如果您不熟悉UNIX文件权限模式，则可能会发现此权限计算器很有用。</p>
<p>以下示例将容器中my_config的名称设置为redis_config，将模式设置为0440（可读组），并将用户和组设置为103. redis服务无法访问my_other_config配置</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.3"</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">1</span></span><br><span class="line">    configs:</span><br><span class="line">      - source: my_config</span><br><span class="line">        target: /redis_config</span><br><span class="line">        uid: <span class="string">'103'</span></span><br><span class="line">        gid: <span class="string">'103'</span></span><br><span class="line">        mode: <span class="number">0440</span></span><br><span class="line">configs:</span><br><span class="line">  my_config:</span><br><span class="line">    file: ./my_config.txt</span><br><span class="line">  my_other_config:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<p>您可以授予多个配置的服务访问权限，您可以混合使用长短语法。定义配置并不意味着授予服务访问权限。</p>
<h2 id="container-name"><a href="#container-name" class="headerlink" title="container_name"></a>container_name</h2><p>指定自定义容器名称</p>
<p>由于Docker容器名称必须是唯一的，因此如果您指定了自定义名称，则无法将服务扩展到1个容器之外。 试图这样做会导致错误。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">container_name: my-web-container</span><br></pre></td></tr></table></figure>

<p>注意：当使用（版本3）Compose文件在群集模式下部署堆栈时，忽略此选项。</p>
<h2 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h2><p>指定与部署和运行服务相关的配置。 这只在部署到使用docker stack部署的群集时才生效，并且被docker-compose up和docker-compose run忽略。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">6</span></span><br><span class="line">      update_config:</span><br><span class="line">        parallelism: <span class="number">2</span></span><br><span class="line">        delay: <span class="number">10</span>s</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br></pre></td></tr></table></figure>

<h3 id="ENDPOINT-MODE"><a href="#ENDPOINT-MODE" class="headerlink" title="ENDPOINT_MODE"></a>ENDPOINT_MODE</h3><p>指定连接到群组的外部客户端的服务发现方法。</p>
<p>v3.3独有</p>
<p><code>endpoint_mode：vip</code> - Docker为服务分配一个虚拟IP（VIP），作为客户端到达网络服务的“前端”。 Docker在客户端和可用的工作节点之间为服务路由请求，而客户端不知道有多少节点参与服务或其IP地址或端口。 （这是默认设置。）</p>
<p><code>endpoint_mode：dnsrr</code> - DNS轮询（DNSRR）服务发现不使用单个虚拟IP。 Docker为服务设置DNS条目，使得服务名称的DNS查询返回一个IP地址列表，并且客户端直接连接到其中的一个。 如果您想使用自己的负载平衡器，或者混合Windows和Linux应用程序，则DNS轮询功能非常有用。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.3"</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  wordpress:</span><br><span class="line">    image: wordpress</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"8080:80"</span></span><br><span class="line">    networks:</span><br><span class="line">      - overlay</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: <span class="number">2</span></span><br><span class="line">      endpoint_mode: vip</span><br><span class="line"></span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql</span><br><span class="line">    volumes:</span><br><span class="line">       - db-data:/var/lib/mysql/data</span><br><span class="line">    networks:</span><br><span class="line">       - overlay</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: <span class="number">2</span></span><br><span class="line">      endpoint_mode: dnsrr</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  db-data:</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  overlay:</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.docker.com/engine/reference/commandline/service_create/" target="_blank" rel="noopener">docker service create</a></p>
<h3 id="LABELS"><a href="#LABELS" class="headerlink" title="LABELS"></a>LABELS</h3><p>指定服务的标签。 这些标签仅在服务上设置，而不在服务的任何容器上设置。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: web</span><br><span class="line">    deploy:</span><br><span class="line">      labels:</span><br><span class="line">        com.example.description: <span class="string">"This label will appear on the web service"</span></span><br></pre></td></tr></table></figure>

<p>要在容器上设置标签，请在部署之外使用标签键：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: web</span><br><span class="line">    labels:</span><br><span class="line">      com.example.description: <span class="string">"This label will appear on all containers for the web service"</span></span><br></pre></td></tr></table></figure>

<h3 id="MODE"><a href="#MODE" class="headerlink" title="MODE"></a>MODE</h3><p>全局（每个群集节点只有一个容器）或复制（指定数量的容器）。 默认值被复制。 （要了解更多信息，请参阅swarm主题中的复制和全局服务。）</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  worker:</span><br><span class="line">    image: dockersamples/examplevotingapp_worker</span><br><span class="line">    deploy:</span><br><span class="line">      mode: global</span><br></pre></td></tr></table></figure>

<h3 id="PLACEMENT"><a href="#PLACEMENT" class="headerlink" title="PLACEMENT"></a>PLACEMENT</h3><p>指定约束和偏好的位置。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3.3'</span></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br><span class="line">    deploy:</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.role == manager</span><br><span class="line">          - engine.labels.operatingsystem == ubuntu <span class="number">14.04</span></span><br><span class="line">        preferences:</span><br><span class="line">          - spread: node.labels.zone</span><br></pre></td></tr></table></figure>

<h3 id="REPLICAS"><a href="#REPLICAS" class="headerlink" title="REPLICAS"></a>REPLICAS</h3><p>如果服务被复制（这是默认设置），请指定在任何给定时间应该运行的容器数量。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  worker:</span><br><span class="line">    image: dockersamples/examplevotingapp_worker</span><br><span class="line">    networks:</span><br><span class="line">      - frontend</span><br><span class="line">      - backend</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: <span class="number">6</span></span><br></pre></td></tr></table></figure>

<h3 id="RESOURCES"><a href="#RESOURCES" class="headerlink" title="RESOURCES"></a>RESOURCES</h3><p>配置资源限制。</p>
<p>注意：这会替换版本3之前的Compose文件（cpu_shares，cpu_quota，cpuset，mem_limit，memswap_limit，mem_swappiness）中的非群集模式的旧资源约束选项，如升级2.x版至3.x中所述。</p>
<p>在这个一般的例子中，Redis服务限制使用不超过50M的内存和0.50（50％）的可用处理时间（CPU），并且具有20M的内存和0.25个CPU时间保留（总是可用）。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: <span class="string">'0.50'</span></span><br><span class="line">          memory: <span class="number">50</span>M</span><br><span class="line">        reservations:</span><br><span class="line">          cpus: <span class="string">'0.25'</span></span><br><span class="line">          memory: <span class="number">20</span>M</span><br></pre></td></tr></table></figure>

<p>这里描述的选项特定于部署密钥和群集模式。 如果要为非群部署设置资源约束，请使用Compose文件格式版本2 CPU，内存和其他资源选项。</p>
<p>** 内存异常（OOME）**<br>如果您的服务或容器尝试使用比系统可用的内存更多的内存，则可能会遇到内存异常（OOME），并且容器或Docker守护程序可能会被内核OOM杀手所杀。 要防止发生这种情况，请确保您的应用程序在具有足够内存的主机上运行，并且请参阅了解耗尽内存的风险。</p>
<h3 id="RESTART-POLICY"><a href="#RESTART-POLICY" class="headerlink" title="RESTART_POLICY"></a>RESTART_POLICY</h3><p>配置是否以及如何在退出时重新启动容器。 取代重新启动。</p>
<p><code>condition</code>:无，失败或任何（默认：任何）。<br><code>delay</code>:在重启尝试之间等待多长时间，指定为持续时间（默认值：0）。<br><code>max_attempts</code>:放弃之前尝试重新启动容器的次数（默认值：永不放弃）。 如果重新启动在配置的窗口内没有成功，则此尝试不计入配置的max_attempts值。 例如，如果max_attempts设置为’2’，并且第一次尝试重新启动失败，则可能会尝试重新启动两次以上。<br><code>window</code>：在决定重新启动是否成功之前等待多久，指定为持续时间（默认值：立即决定）。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br><span class="line">        delay: <span class="number">5</span>s</span><br><span class="line">        max_attempts: <span class="number">3</span></span><br><span class="line">        window: <span class="number">120</span>s</span><br></pre></td></tr></table></figure>

<h3 id="UPDATE-CONFIG"><a href="#UPDATE-CONFIG" class="headerlink" title="UPDATE_CONFIG"></a>UPDATE_CONFIG</h3><p>配置如何更新服务。 用于配置滚动更新。</p>
<p><code>parallelism</code>：一次更新容器的数量。<br><code>delay</code>：更新一组容器之间的等待时间。<br><code>failure_action</code>：更新失败时该怎么做。 继续，回滚或暂停之一（默认：暂停）。<br><code>monitor</code>：每次任务更新后监视失败的时间（ns | us | ms | s | m | h）（默认为0）。<br><code>max_failure_ratio</code>：在更新期间容忍的失败率。<br><code>order</code>：更新期间的操作顺序。 停止优先（旧任务在开始新任务之前停止）或者先启动（首先启动新任务，并且正在运行的任务短暂重叠）（默认停止优先）注意：只支持v3.4及更高版本。</p>
<p>order支持v3.4或更高版本</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3.4'</span></span><br><span class="line">services:</span><br><span class="line">  vote:</span><br><span class="line">    image: dockersamples/examplevotingapp_vote:before</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">2</span></span><br><span class="line">      update_config:</span><br><span class="line">        parallelism: <span class="number">2</span></span><br><span class="line">        delay: <span class="number">10</span>s</span><br><span class="line">        order: stop-first</span><br></pre></td></tr></table></figure>





<h2 id="devices"><a href="#devices" class="headerlink" title="devices"></a>devices</h2><p>设备映射列表。 使用与–device docker客户端创建选项相同的格式。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">devices:</span><br><span class="line">  - <span class="string">"/dev/ttyUSB0:/dev/ttyUSB0"</span></span><br></pre></td></tr></table></figure>

<p>注意：当使用（版本3）Compose文件在群集模式下部署堆栈时，忽略此选项。</p>
<h2 id="depends-on"><a href="#depends-on" class="headerlink" title="depends_on"></a>depends_on</h2><p>服务之间的快速依赖关系，服务依赖关系导致以下行为：</p>
<p><code>docker-compose up</code> 以依赖顺序启动服务。 在以下示例中，db和redis在web之前启动。</p>
<p><code>docker-up up SERVICE</code> 自动包含SERVICE的依赖关系。 在下面的例子中，docker-compose up web也会创建并启动db和redis。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    depends_on:</span><br><span class="line">      - db</span><br><span class="line">      - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br></pre></td></tr></table></figure>

<p>使用depends_on时有几件事要注意：</p>
<p>在启动web之前，depends_on不会等待db和redis“准备就绪” - 只有在它们启动之前。 如果您需要等待服务准备就绪，请参阅控制启动顺序以了解有关此问题的更多信息以及解决此问题的策略。</p>
<p>版本3不再支持depends_on的条件形式。</p>
<p>使用版本3撰写文件在群集模式下部署堆栈时，将忽略depends_on选项。</p>
<h2 id="dns"><a href="#dns" class="headerlink" title="dns"></a>dns</h2><p>自定义DNS服务器。 可以是单个值或列表。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dns: <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line">dns:</span><br><span class="line">  - <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line">  - <span class="number">9.9</span>.<span class="number">9.9</span></span><br></pre></td></tr></table></figure>

<h2 id="dns-search"><a href="#dns-search" class="headerlink" title="dns_search"></a>dns_search</h2><p>自定义DNS搜索域。 可以是单个值或列表。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dns_search: example.com</span><br><span class="line">dns_search:</span><br><span class="line">  - dc1.example.com</span><br><span class="line">  - dc2.example.com</span><br></pre></td></tr></table></figure>

<h2 id="tmpfs"><a href="#tmpfs" class="headerlink" title="tmpfs"></a>tmpfs</h2><p>v2.0以上</p>
<p>在容器中装入一个临时文件系统。 可以是单个值或列表。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tmpfs: /<span class="keyword">run</span></span><br><span class="line"><span class="bash">tmpfs:</span></span><br><span class="line">  - /<span class="keyword">run</span></span><br><span class="line"><span class="bash">  - /tmp</span></span><br></pre></td></tr></table></figure>

<p>注意：在使用（版本3-3.5）撰写文件的群集模式下部署堆栈时，忽略此选项。</p>
<p>v3.6以上</p>
<p>在容器中装入一个临时文件系统。 Size参数以字节为单位指定tmpfs安装的大小。 无限制默认。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- type: tmpfs</span><br><span class="line">     target: /app</span><br><span class="line">     tmpfs:</span><br><span class="line">       size: <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<h2 id="entrypoint"><a href="#entrypoint" class="headerlink" title="entrypoint"></a>entrypoint</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">entrypoint</span><span class="bash">: /code/entrypoint.sh</span></span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">entrypoint</span><span class="bash">:</span></span><br><span class="line">    - php</span><br><span class="line">    - -d</span><br><span class="line">    - zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-<span class="number">20100525</span>/xdebug.so</span><br><span class="line">    - -d</span><br><span class="line">    - memory_limit=-<span class="number">1</span></span><br><span class="line">    - vendor/bin/phpunit</span><br></pre></td></tr></table></figure>

<p>注意：设置入口点都会使用ENTRYPOINT Dockerfile指令覆盖服务映像上设置的任何默认入口点，并清除映像上的任何默认命令 - 这意味着如果Dockerfile中存在CMD指令，则它将被忽略。</p>
<h2 id="env-file"><a href="#env-file" class="headerlink" title="env_file"></a>env_file</h2><p>从文件添加环境变量。 可以是单个值或列表。</p>
<p>如果您已经使用<code>docker-compose -f FILE</code>指定了Compose文件，则env_file中的路径与该文件所在的目录相关。</p>
<p>环境部分中声明的环境变量会覆盖这些值 - 即使这些值为空或未定义，也是如此。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">env_file: .<span class="keyword">env</span></span><br><span class="line"></span><br><span class="line">env_file:</span><br><span class="line">  - ./common.<span class="keyword">env</span></span><br><span class="line">  - ./apps/web.<span class="keyword">env</span></span><br><span class="line">  - /opt/secrets.<span class="keyword">env</span></span><br></pre></td></tr></table></figure>

<p>撰写Compose env文件中的每行都是VAR = VAL格式。 以＃开始的行被视为注释并被忽略。 空行也被忽略。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set Rails/Rack environment</span></span><br><span class="line">RACK_ENV=development</span><br></pre></td></tr></table></figure>

<p>注意：如果您的服务指定了构建选项，则在构建期间，环境文件中定义的变量不会自动显示。 使用build的args子选项来定义构建时环境变量。</p>
<p>定义的值并不会始终保持不变，列表中的值按照顺序执行，以最后值为准。</p>
<h2 id="environment"><a href="#environment" class="headerlink" title="environment"></a>environment</h2><p>添加环境变量。 您可以使用数组或字典。</p>
<p> 任何布尔值; true, false, yes no，需要用引号括起来以确保它们不被YML解析器转换为True或False。</p>
 <figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> environment:</span><br><span class="line">  RACK_ENV: development</span><br><span class="line">  SHOW: <span class="string">'true'</span></span><br><span class="line">  SESSION_SECRET:</span><br><span class="line"></span><br><span class="line">environment:</span><br><span class="line">  - RACK_ENV=development</span><br><span class="line">  - SHOW=true</span><br><span class="line">  - SESSION_SECRET</span><br></pre></td></tr></table></figure>

<p>注意：如果您的服务指定了构建选项，则在构建过程中定义的变量不会自动显示。 使用build的args子选项来定义构建时环境变量。</p>
<h2 id="expose"><a href="#expose" class="headerlink" title="expose"></a>expose</h2><p>公开端口而不将它们发布到主机 - 它们只能被链接服务访问。 只能指定内部端口。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">expose</span>:</span><br><span class="line"> - <span class="string">"3000"</span></span><br><span class="line"> - <span class="string">"8000"</span></span><br></pre></td></tr></table></figure>

<h2 id="external-links"><a href="#external-links" class="headerlink" title="external_links"></a>external_links</h2><p>链接到此Docker-compose.yml之外甚至Compose之外的容器，尤其是提供共享或公共服务的容器。 在指定容器名称和链接别名（CONTAINER：ALIAS）时，external_links遵循类似于旧版选项链接的语义。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">external_links:</span><br><span class="line"> - redis_1</span><br><span class="line"> - project_db_1:mysql</span><br><span class="line"> - project_db_1:postgresql</span><br></pre></td></tr></table></figure>

<h2 id="extra-hosts"><a href="#extra-hosts" class="headerlink" title="extra_hosts"></a>extra_hosts</h2><p>添加主机名映射。 使用与docker客户端–add-host参数相同的值。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">extra_hosts:</span><br><span class="line"> - <span class="string">"somehost:162.242.195.82"</span></span><br><span class="line"> - <span class="string">"otherhost:50.31.209.229"</span></span><br></pre></td></tr></table></figure>

<p>具有ip地址和主机名的条目在容器内的<code>/etc/hosts</code>中为该服务创建，例如：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">162.242</span>.<span class="number">195.82</span>  somehost</span><br><span class="line"><span class="number">50.31</span>.<span class="number">209.229</span>   otherhost</span><br></pre></td></tr></table></figure>

<h2 id="healthcheck"><a href="#healthcheck" class="headerlink" title="healthcheck"></a>healthcheck</h2><p>v2.1以上</p>
<p>配置运行的检查以确定此服务的容器是否“健康”。 查看<a href="https://docs.docker.com/engine/reference/builder/#usage" target="_blank" rel="noopener" title="HEALTHCHECK Dockerfile">HEALTHCHECK Dockerfile</a>指令的文档以获取有关健康检查如何工作的详细信息。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">healthcheck</span><span class="bash">:</span></span><br><span class="line">  test: [<span class="string">"CMD"</span>, <span class="string">"curl"</span>, <span class="string">"-f"</span>, <span class="string">"http://localhost"</span>]</span><br><span class="line">  interval: <span class="number">1</span>m30s</span><br><span class="line">  timeout: <span class="number">10</span>s</span><br><span class="line">  retries: <span class="number">3</span></span><br><span class="line">  start_period: <span class="number">40</span>s</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hit the local web app</span></span><br><span class="line">test: [<span class="string">"CMD"</span>, <span class="string">"curl"</span>, <span class="string">"-f"</span>, <span class="string">"http://localhost"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># As above, but wrapped in /bin/sh. Both forms below are equivalent.</span></span><br><span class="line">test: [<span class="string">"CMD-SHELL"</span>, <span class="string">"curl -f http://localhost || exit 1"</span>]</span><br><span class="line">test: curl -f https://localhost || exit <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>要禁用图像设置的任何默认健康检查，您可以使用disable：true。 这相当于指定测试：[“NONE”]。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">healthcheck</span><span class="bash">:</span></span><br><span class="line">  disable: true</span><br></pre></td></tr></table></figure>

<h2 id="Specifying-durations"><a href="#Specifying-durations" class="headerlink" title="Specifying durations"></a>Specifying durations</h2><p>一些配置选项（如检查的间隔和超时子选项）以如下格式的字符串形式接受持续时间：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.5</span>s</span><br><span class="line"><span class="number">10</span>s</span><br><span class="line"><span class="number">1</span>m30s</span><br><span class="line"><span class="number">2</span>h32m</span><br><span class="line"><span class="number">5</span>h34m56s</span><br></pre></td></tr></table></figure>

<p>支持的单位是us，ms，s，m和h。</p>
<h2 id="isolation"><a href="#isolation" class="headerlink" title="isolation"></a>isolation</h2><p>指定容器的隔离技术。 在Linux上，唯一支持的值是默认值。 在Windows上，可接受的值是默认值，进程和hyperv。 有关详细信息，请参阅Docker Engine文档。</p>
<h2 id="labels-1"><a href="#labels-1" class="headerlink" title="labels"></a>labels</h2><p>使用Docker标签将元数据添加到容器。 您可以使用数组或字典。</p>
<p>建议您使用反向DNS标记来防止您的标签与其他软件使用的标签冲突。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">labels:</span><br><span class="line">  com.example.description: <span class="string">"Accounting webapp"</span></span><br><span class="line">  com.example.department: <span class="string">"Finance"</span></span><br><span class="line">  com.example.<span class="keyword">label</span><span class="bash">-with-empty-value: <span class="string">""</span></span></span><br><span class="line"></span><br><span class="line">labels:</span><br><span class="line">  - <span class="string">"com.example.description=Accounting webapp"</span></span><br><span class="line">  - <span class="string">"com.example.department=Finance"</span></span><br><span class="line">  - <span class="string">"com.example.label-with-empty-value"</span></span><br></pre></td></tr></table></figure>

<h2 id="logging"><a href="#logging" class="headerlink" title="logging"></a>logging</h2><p>记录服务的配置。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logging:</span><br><span class="line">  driver: syslog</span><br><span class="line">  options:</span><br><span class="line">    syslog-address: <span class="string">"tcp://192.168.0.42:123"</span></span><br></pre></td></tr></table></figure>

<p>驱动程序名称指定服务容器的日志记录驱动程序，与docker run的–log-driver选项（此处记录）一样。</p>
<p>默认值是json-file。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver: <span class="string">"json-file"</span></span><br><span class="line">driver: <span class="string">"syslog"</span></span><br><span class="line">driver: <span class="string">"none"</span></span><br></pre></td></tr></table></figure>

<p>注意：只有<code>json-file</code>和<code>journald</code>驱动程序才能使日志直接从<code>docker-compose up</code>和<code>docker-compose logs</code>。 使用任何其他驱动程序不会打印任何日志。</p>
<p>使用选项键指定日志记录驱动程序的日志记录选项，就像<code>docker run</code>的–log-opt选项一样。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver: <span class="string">"syslog"</span></span><br><span class="line">options:</span><br><span class="line">  syslog-address: <span class="string">"tcp://192.168.0.42:123"</span></span><br></pre></td></tr></table></figure>

<p>默认驱动程序json-file具有限制存储日志量的选项。 为此，请使用键值对来获得最大存储大小和最大文件数量：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">options:</span><br><span class="line">  max-size: <span class="string">"200k"</span></span><br><span class="line">  max-file: <span class="string">"10"</span></span><br></pre></td></tr></table></figure>

<p>上面显示的示例将存储日志文件，直到它们达到200kB的最大大小，然后旋转它们。 存储的单个日志文件的数量由最大文件值指定。 随着日志增长超出最大限制，旧日志文件将被删除以允许存储新日志。</p>
<p>以下是限制日志存储的示例docker-compose.yml文件：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  some-service:</span><br><span class="line">    image: some-service</span><br><span class="line">    logging:</span><br><span class="line">      driver: <span class="string">"json-file"</span></span><br><span class="line">      options:</span><br><span class="line">        max-size: <span class="string">"200k"</span></span><br><span class="line">        max-file: <span class="string">"10"</span></span><br></pre></td></tr></table></figure>

<h2 id="network-mode"><a href="#network-mode" class="headerlink" title="network_mode"></a>network_mode</h2><p>网络模式。 使用与docker客户端相同的值–net参数，以及特殊的表单服务：[服务名称]。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">network_mode: <span class="string">"bridge"</span></span><br><span class="line">network_mode: <span class="string">"host"</span></span><br><span class="line">network_mode: <span class="string">"none"</span></span><br><span class="line">network_mode: <span class="string">"service:[service name]"</span></span><br><span class="line">network_mode: <span class="string">"container:[container name/id]"</span></span><br></pre></td></tr></table></figure>

<p>network_mode：“host”不能与链接混合使用。</p>
<h2 id="networks"><a href="#networks" class="headerlink" title="networks"></a>networks</h2><p>加入网络，引用顶级网络密钥下的条目。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  some-service:</span><br><span class="line">    networks:</span><br><span class="line">     - some-network</span><br><span class="line">     - other-network</span><br></pre></td></tr></table></figure>

<h3 id="ALIASES"><a href="#ALIASES" class="headerlink" title="ALIASES"></a>ALIASES</h3><p>网络上此服务的别名（备用主机名）。 同一网络上的其他容器可以使用服务名称或别名来连接到某个服务的容器。</p>
<p>由于别名是网络范围的，相同的服务可以在不同的网络上具有不同的别名。</p>
<p>注意：网络范围的别名可以由多个容器共享，甚至可以由多个服务共享。 如果是，那么名称解析的确切容器的名称就不能保证。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">services:</span><br><span class="line">  some-service:</span><br><span class="line">    networks:</span><br><span class="line">      some-network:</span><br><span class="line">        aliases:</span><br><span class="line">         - alias1</span><br><span class="line">         - alias3</span><br><span class="line">      other-network:</span><br><span class="line">        aliases:</span><br><span class="line">         - alias2</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'2'</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: ./web</span><br><span class="line">    networks:</span><br><span class="line">      - new</span><br><span class="line"></span><br><span class="line">  worker:</span><br><span class="line">    build: ./worker</span><br><span class="line">    networks:</span><br><span class="line">      - legacy</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: mysql</span><br><span class="line">    networks:</span><br><span class="line">      new:</span><br><span class="line">        aliases:</span><br><span class="line">          - database</span><br><span class="line">      legacy:</span><br><span class="line">        aliases:</span><br><span class="line">          - mysql</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  new:</span><br><span class="line">  legacy:</span><br></pre></td></tr></table></figure>

<h3 id="IPV4-ADDRESS-IPV6-ADDRESS"><a href="#IPV4-ADDRESS-IPV6-ADDRESS" class="headerlink" title="IPV4_ADDRESS, IPV6_ADDRESS"></a>IPV4_ADDRESS, IPV6_ADDRESS</h3><p>加入网络时，为此服务的容器指定一个静态IP地址。</p>
<p>顶级网络部分中的相应网络配置必须具有覆盖每个静态地址的具有子网配置的ipam块。 如果需要IPv6寻址，则必须设置enable_ipv6选项，并且必须使用版本2.x Compose文件，如下所示。</p>
<p>注意：这些选项目前不在群集模式下工作。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'2.1'</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: busybox</span><br><span class="line">    command: ifconfig</span><br><span class="line">    networks:</span><br><span class="line">      app_net:</span><br><span class="line">        ipv4_address: <span class="number">172.16</span>.<span class="number">238.10</span></span><br><span class="line">        ipv6_address: <span class="number">2001</span>:<span class="number">3984</span>:<span class="number">3989</span>::<span class="number">10</span></span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  app_net:</span><br><span class="line">    driver: bridge</span><br><span class="line">    enable_ipv6: true</span><br><span class="line">    ipam:</span><br><span class="line">      driver: default</span><br><span class="line">      config:</span><br><span class="line">      -</span><br><span class="line">        subnet: <span class="number">172.16</span>.<span class="number">238.0</span>/<span class="number">24</span></span><br><span class="line">      -</span><br><span class="line">        subnet: <span class="number">2001</span>:<span class="number">3984</span>:<span class="number">3989</span>::/<span class="number">64</span></span><br></pre></td></tr></table></figure>

<h2 id="pid"><a href="#pid" class="headerlink" title="pid"></a>pid</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pid: <span class="string">"host"</span></span><br></pre></td></tr></table></figure>

<p>将PID模式设置为主机PID模式。 这将打开容器与主机操作系统之间的共享PID地址空间。 使用此标志启动的容器可以访问和操作裸机的名称空间中的其他容器，反之亦然。</p>
<h2 id="ports"><a href="#ports" class="headerlink" title="ports"></a>ports</h2><p>公开端口</p>
<p>注意：端口映射与network_mode：host不兼容</p>
<h3 id="SHORT-SYNTAX-1"><a href="#SHORT-SYNTAX-1" class="headerlink" title="SHORT SYNTAX"></a>SHORT SYNTAX</h3><p>既可以指定两个端口（HOST：CONTAINER），也可以指定容器端口（选择临时主机端口）。</p>
<p>注意：以HOST：CONTAINER格式映射端口时，使用低于60的容器端口时可能会遇到错误结果，因为YAML会将格式为xx：yy的数字解析为基数为60的值。 出于这个原因，我们建议始终明确指定您的端口映射为字符串。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ports:</span><br><span class="line"> - <span class="string">"3000"</span></span><br><span class="line"> - <span class="string">"3000-3005"</span></span><br><span class="line"> - <span class="string">"8000:8000"</span></span><br><span class="line"> - <span class="string">"9090-9091:8080-8081"</span></span><br><span class="line"> - <span class="string">"49100:22"</span></span><br><span class="line"> - <span class="string">"127.0.0.1:8001:8001"</span></span><br><span class="line"> - <span class="string">"127.0.0.1:5000-5010:5000-5010"</span></span><br><span class="line"> - <span class="string">"6060:6060/udp"</span></span><br></pre></td></tr></table></figure>

<h3 id="LONG-SYNTAX-1"><a href="#LONG-SYNTAX-1" class="headerlink" title="LONG SYNTAX"></a>LONG SYNTAX</h3><p>长格式语法允许配置不能以简短形式表示的附加字段。</p>
<p>target：容器内的端口<br>published：公开曝光的港口<br>protocol：端口协议（tcp或udp）<br>mode：用于在每个节点上发布主机端口的主机，或用于群集模式端口的入口以进行负载平衡。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ports:</span><br><span class="line">  - target: <span class="number">80</span></span><br><span class="line">    published: <span class="number">8080</span></span><br><span class="line">    protocol: tcp</span><br><span class="line">    mode: host</span><br></pre></td></tr></table></figure>

<p>注意：长语法在v3.2中是新的</p>
<h2 id="secrets"><a href="#secrets" class="headerlink" title="secrets"></a>secrets</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.1"</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">1</span></span><br><span class="line">    secrets:</span><br><span class="line">      - my_secret</span><br><span class="line">      - my_other_secret</span><br><span class="line">secrets:</span><br><span class="line">  my_secret:</span><br><span class="line">    file: ./my_secret.txt</span><br><span class="line">  my_other_secret:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.1"</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:latest</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: <span class="number">1</span></span><br><span class="line">    secrets:</span><br><span class="line">      - source: my_secret</span><br><span class="line">        target: redis_secret</span><br><span class="line">        uid: <span class="string">'103'</span></span><br><span class="line">        gid: <span class="string">'103'</span></span><br><span class="line">        mode: <span class="number">0440</span></span><br><span class="line">secrets:</span><br><span class="line">  my_secret:</span><br><span class="line">    file: ./my_secret.txt</span><br><span class="line">  my_other_secret:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<h2 id="security-opt"><a href="#security-opt" class="headerlink" title="security_opt"></a>security_opt</h2><p>覆盖每个容器的默认标签方案。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">security_opt:</span><br><span class="line">  - <span class="keyword">label</span><span class="bash">:user:USER</span></span><br><span class="line">  - <span class="keyword">label</span><span class="bash">:role:ROLE</span></span><br></pre></td></tr></table></figure>

<h2 id="stop-grace-period"><a href="#stop-grace-period" class="headerlink" title="stop_grace_period"></a>stop_grace_period</h2><p>指定在发送SIGKILL之前，如果试图停止一个容器（如果它没有处理SIGTERM）（或者使用stop_signal指定了任何停止信号），请等待多久。 指定为持续时间。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop_grace_period: <span class="number">1</span>s</span><br><span class="line">stop_grace_period: <span class="number">1</span>m30s</span><br></pre></td></tr></table></figure>

<p>默认情况下，停止在发送SIGKILL之前等待10秒钟容器退出。</p>
<h2 id="stop-signal"><a href="#stop-signal" class="headerlink" title="stop_signal"></a>stop_signal</h2><p>设置一个替代信号来停止容器。 默认停止使用SIGTERM。 使用stop_signal设置替代信号会导致停止发送该信号。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop_signal: SIGUSR1</span><br></pre></td></tr></table></figure>

<h2 id="sysctls"><a href="#sysctls" class="headerlink" title="sysctls"></a>sysctls</h2><p>在容器中设置的内核参数。 您可以使用数组或字典。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sysctls:</span><br><span class="line">  net.core.somaxconn: <span class="number">1024</span></span><br><span class="line">  net.ipv4.tcp_syncookies: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">sysctls:</span><br><span class="line">  - net.core.somaxconn=<span class="number">1024</span></span><br><span class="line">  - net.ipv4.tcp_syncookies=<span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="ulimits"><a href="#ulimits" class="headerlink" title="ulimits"></a>ulimits</h2><p>覆盖容器的默认限制。 您可以将单个限制指定为整数，也可以将软限制/硬限制指定为映射。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ulimits:</span><br><span class="line">  nproc: <span class="number">65535</span></span><br><span class="line">  nofile:</span><br><span class="line">    soft: <span class="number">20000</span></span><br><span class="line">    hard: <span class="number">40000</span></span><br></pre></td></tr></table></figure>

<h2 id="userns-mode"><a href="#userns-mode" class="headerlink" title="userns_mode"></a>userns_mode</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userns_mode: <span class="string">"host"</span></span><br></pre></td></tr></table></figure>

<p>如果Docker守护程序配置了用户命名空间，则禁用此服务的用户命名空间。</p>
<h2 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a>volumes</h2><p>装载主机路径或命名卷，将其指定为服务的子选项。</p>
<p>您可以将主机路径作为单个服务的定义的一部分进行安装，并且无需在顶级卷密钥中定义它。</p>
<p>但是，如果要跨多个服务重用卷，请在顶级卷密钥中定义一个命名卷。 将命名卷与服务，群集和堆栈文件一起使用。</p>
<p>注意：顶级卷密钥定义了一个命名卷，并从每个服务的卷列表中引用它。 这会替换早期版本的Compose文件格式中的volumes_from。 有关卷的一般信息，请参阅使用卷和卷插件。</p>
<p>此示例显示Web服务正在使用的命名卷（mydata），以及为单个服务（数据库服务卷下的第一个路径）定义的绑定挂载。 数据库服务还使用名为dbdata的命名卷（数据库服务卷下的第二个路径），但使用旧的字符串格式定义它以装载命名卷。 如图所示，命名卷必须列在顶级卷密钥下。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.2"</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    volumes:</span><br><span class="line">      - type: <span class="keyword">volume</span></span><br><span class="line"><span class="bash">        <span class="built_in">source</span>: mydata</span></span><br><span class="line">        target: /data</span><br><span class="line">        <span class="keyword">volume</span><span class="bash">:</span></span><br><span class="line">          nocopy: true</span><br><span class="line">      - type: bind</span><br><span class="line">        source: ./static</span><br><span class="line">        target: /opt/app/static</span><br><span class="line"></span><br><span class="line">  db:</span><br><span class="line">    image: postgres:latest</span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">"/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock"</span></span><br><span class="line">      - <span class="string">"dbdata:/var/lib/postgresql/data"</span></span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mydata:</span><br><span class="line">  dbdata:</span><br></pre></td></tr></table></figure>

<h3 id="SHORT-SYNTAX-2"><a href="#SHORT-SYNTAX-2" class="headerlink" title="SHORT SYNTAX"></a>SHORT SYNTAX</h3><p>可以选择在主机上（HOST：CONTAINER）或访问模式（HOST：CONTAINER：ro）指定路径。</p>
<p>您可以在主机上挂载相对路径，该路径相对于正在使用的Compose配置文件的目录进行扩展。 相对路径应始终以</p>
<p><code>.</code>或<code>..</code>。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  <span class="comment"># Just specify a path and let the Engine create a volume</span></span><br><span class="line">  - /var/lib/mysql</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Specify an absolute path mapping</span></span><br><span class="line">  - /opt/data:/var/lib/mysql</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Path on the host, relative to the Compose file</span></span><br><span class="line">  - ./cache:/tmp/cache</span><br><span class="line"></span><br><span class="line">  <span class="comment"># User-relative path</span></span><br><span class="line">  - ~/configs:/etc/configs/:ro</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Named volume</span></span><br><span class="line">  - datavolume:/var/lib/mysql</span><br></pre></td></tr></table></figure>

<h3 id="LONG-SYNTAX-2"><a href="#LONG-SYNTAX-2" class="headerlink" title="LONG SYNTAX"></a>LONG SYNTAX</h3><p><code>type</code>：装载类型卷，绑定或tmpfs<br><code>source</code>：装入源，主机上用于绑定装入的路径或顶级卷密钥中定义的卷的名称。 不适用于tmpfs安装。<br><code>target</code>：卷所在的容器中的路径<br><code>read_only</code>：标志将卷设置为只读<br><code>bind</code>：配置额外的绑定选项<br>  <code>propagation</code>：用于绑定的传播模式<br><code>volume</code>：配置额外的volume选项<br>  <code>nocopy</code>：标志，用于在卷创建时禁止从容器复制数据<br><code>tmpfs</code>：配置附加的tmpfs选项<br>  <code>size</code>：tmpfs的大小，以字节为单位</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.2"</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"80:80"</span></span><br><span class="line">    volumes:</span><br><span class="line">      - type: <span class="keyword">volume</span></span><br><span class="line"><span class="bash">        <span class="built_in">source</span>: mydata</span></span><br><span class="line">        target: /data</span><br><span class="line">        <span class="keyword">volume</span><span class="bash">:</span></span><br><span class="line">          nocopy: true</span><br><span class="line">      - type: bind</span><br><span class="line">        source: ./static</span><br><span class="line">        target: /opt/app/static</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  webnet:</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mydata:</span><br></pre></td></tr></table></figure>

<p>Note: The long syntax is new in v3.2</p>
<p>** 服务，群集和堆栈文件的卷**</p>
<p>在使用服务，群集和docker-stack.yml文件时，请记住支持服务的任务（容器）可以部署在群集中的任何节点上，并且每次更新服务时都可能是不同的节点。</p>
<p>在缺少指定源的命名卷的情况下，Docker为支持服务的每个任务创建一个匿名卷。关联的容器被移除后，匿名卷不会保留。</p>
<p>如果您希望数据持久存在，请使用可识别多主机的命名卷和卷驱动程序，以便可以从任何节点访问数据。或者，对该服务设置约束，以便将其任务部署在具有该卷的节点上。</p>
<p>作为一个例子，Docker Labs中votingapp示例的docker-stack.yml文件 定义了一个称为运行数据库的服务。它被配置为一个命名卷来保存群体上的数据， 并且仅限于在节点上运行。这是来自该文件的相关剪辑：db postgres manager</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres:<span class="number">9.4</span></span><br><span class="line">    volumes:</span><br><span class="line">      - db-data:/var/lib/postgresql/data</span><br><span class="line">    networks:</span><br><span class="line">      - backend</span><br><span class="line">    deploy:</span><br><span class="line">      placement:</span><br><span class="line">        constraints: [node.role == manager]</span><br></pre></td></tr></table></figure>

<h2 id="restart"><a href="#restart" class="headerlink" title="restart"></a>restart</h2><p>no是默认的重启策略，在任何情况下都不会重启容器。 总是指定时，容器总是重新启动。 如果退出代码指示出现故障错误，则故障中策略会重新启动容器。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">restart: <span class="string">"no"</span></span><br><span class="line">restart: always</span><br><span class="line">restart: on-failure</span><br><span class="line">restart: unless-stopped</span><br></pre></td></tr></table></figure>

<h2 id="domainname-hostname-ipc-mac-address-privileged-read-only-shm-size-stdin-open-tty-user-working-dir"><a href="#domainname-hostname-ipc-mac-address-privileged-read-only-shm-size-stdin-open-tty-user-working-dir" class="headerlink" title="domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir"></a>domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">user</span>: postgresql</span><br><span class="line">working_dir: /code</span><br><span class="line"></span><br><span class="line">domainname: foo.com</span><br><span class="line">hostname: foo</span><br><span class="line">ipc: host</span><br><span class="line">mac_address: <span class="number">02</span>:<span class="number">42</span>:ac:<span class="number">11</span>:<span class="number">65</span>:<span class="number">43</span></span><br><span class="line"></span><br><span class="line">privileged: true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">read_only: true</span><br><span class="line">shm_size: <span class="number">64</span>M</span><br><span class="line">stdin_open: true</span><br><span class="line">tty: true</span><br></pre></td></tr></table></figure>

<h2 id="Specifying-durations-1"><a href="#Specifying-durations-1" class="headerlink" title="Specifying durations"></a>Specifying durations</h2><p>一些配置选项（如interval和timeout ）以如下格式的字符串形式接受持续时间：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.5</span>s</span><br><span class="line"><span class="number">10</span>s</span><br><span class="line"><span class="number">1</span>m30s</span><br><span class="line"><span class="number">2</span>h32m</span><br><span class="line"><span class="number">5</span>h34m56s</span><br></pre></td></tr></table></figure>

<h2 id="Volume-configuration-reference"><a href="#Volume-configuration-reference" class="headerlink" title="Volume configuration reference"></a>Volume configuration reference</h2><p>虽然可以将文件中的卷声明为服务声明的一部分，但本节允许您创建可在多个服务中重复使用的命名卷（不依赖于volumes_from），并且可以使用docker命令行轻松检索和检查 或API。 有关更多信息，请参阅docker卷子命令文档。</p>
<p>有关卷的一般信息，请参阅使用卷和卷插件。</p>
<p>以下是一个双服务设置的示例，其中数据库的数据目录与另一个服务共享为一个卷，以便可以定期进行备份：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3"</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: db</span><br><span class="line">    volumes:</span><br><span class="line">      - data-<span class="keyword">volume</span><span class="bash">:/var/lib/db</span></span><br><span class="line">  backup:</span><br><span class="line">    image: backup-service</span><br><span class="line">    volumes:</span><br><span class="line">      - data-<span class="keyword">volume</span><span class="bash">:/var/lib/backup/data</span></span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  data-<span class="keyword">volume</span><span class="bash">:</span></span><br></pre></td></tr></table></figure>

<p>顶级卷密钥下的条目可以为空，在这种情况下，它使用由引擎配置的默认驱动程序（在大多数情况下，这是本地驱动程序）。 或者，您可以使用以下键配置它：</p>
<h3 id="driver"><a href="#driver" class="headerlink" title="driver"></a>driver</h3><p>指定应该为此卷使用哪个卷驱动程序。 默认为Docker引擎已经配置使用的驱动程序，在大多数情况下它是本地的。 如果驱动程序不可用，则当docker-compose up尝试创建卷时，引擎会返回错误。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver: foobar</span><br></pre></td></tr></table></figure>

<h3 id="driver-opts"><a href="#driver-opts" class="headerlink" title="driver_opts"></a>driver_opts</h3><p>指定一个选项列表作为传递给该卷的驱动程序的键值对。 这些选项是依赖于驱动程序的 - 请查阅驱动程序的文档以获取更多信息。 可选的。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver_opts:</span><br><span class="line">  foo: <span class="string">"bar"</span></span><br><span class="line">  baz: <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="external"><a href="#external" class="headerlink" title="external"></a>external</h3><p>如果设置为true，则指定该卷已在Compose之外创建。 docker-compose up不会尝试创建它，并在它不存在时引发错误。</p>
<p>外部不能与其他卷配置键（驱动程序，driver_opts）一起使用。</p>
<p>在下面的示例中，Compose不是试图创建一个名为[projectname] _data的卷，而是查找一个简单称为data的现有卷，并将其挂载到数据库服务的容器中。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'2'</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br><span class="line">    volumes:</span><br><span class="line">      - data:/var/lib/postgresql/data</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  data:</span><br><span class="line">    external: true</span><br></pre></td></tr></table></figure>

<p>external.name在版本3.4文件格式中被弃用，而使用name。</p>
<p>您还可以在Compose文件中单独指定用于引用它的名称来指定卷的名称：</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">volumes:</span><br><span class="line">  data:</span><br><span class="line">    external:</span><br><span class="line">      name: actual-name-of-<span class="keyword">volume</span></span><br></pre></td></tr></table></figure>

<p>** 外部卷始终使用Docker堆栈部署来创建**</p>
<p>如果您使用docker stack deploy以swarm模式启动应用程序（而不是docker组合），则创建不存在的外部卷。 在群集模式下，当服务定义时会自动创建一个卷。 由于服务任务在新节点上进行安排，因此swarmkit会在本地节点上创建卷</p>
<h3 id="labels-2"><a href="#labels-2" class="headerlink" title="labels"></a>labels</h3><p>使用Docker标签将元数据添加到容器。 您可以使用数组或字典。</p>
<p>建议您使用反向DNS标记来防止您的标签与其他软件使用的标签冲突。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">labels:</span><br><span class="line">  com.example.description: <span class="string">"Database volume"</span></span><br><span class="line">  com.example.department: <span class="string">"IT/Ops"</span></span><br><span class="line">  com.example.<span class="keyword">label</span><span class="bash">-with-empty-value: <span class="string">""</span></span></span><br><span class="line"></span><br><span class="line">labels:</span><br><span class="line">  - <span class="string">"com.example.description=Database volume"</span></span><br><span class="line">  - <span class="string">"com.example.department=IT/Ops"</span></span><br><span class="line">  - <span class="string">"com.example.label-with-empty-value"</span></span><br></pre></td></tr></table></figure>

<h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>为此卷设置一个自定义名称。 名称字段可用于引用包含特殊字符的网络。 该名称按原样使用，不会与堆栈名称一起作用。</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3.4'</span></span><br><span class="line">volumes:</span><br><span class="line">  data:</span><br><span class="line">    name: my-app-data</span><br></pre></td></tr></table></figure>

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3.4'</span></span><br><span class="line">volumes:</span><br><span class="line">  data:</span><br><span class="line">    external: true</span><br><span class="line">    name: my-app-data</span><br></pre></td></tr></table></figure>  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/Docker/">Docker</a><a href="/tags/Docker-Compose/">Docker Compose</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Docker-Compose/">Docker Compose</a>
</div>



<div class="article-share" id="share">

  <div data-url="https://syxdevcode.github.com/2018/05/11/Docker%20Compose%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/" data-title="Docker Compose配置文件详解 | syxdevcode博客" data-tsina="" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/05/14/DotNetCore使用Docker部署/" title="DotNetCore使用Docker部署">
  <strong>PREVIOUS:</strong><br/>
  <span>
  DotNetCore使用Docker部署</span>
</a>
</div>


<div class="next">
<a href="/2018/05/11/Power-Shell命令学习/"  title="Power Shell命令学习">
 <strong>NEXT:</strong><br/> 
 <span>Power Shell命令学习
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Compose配置文件详解"><span class="toc-number">1.</span> <span class="toc-text">Docker Compose配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#image"><span class="toc-number">1.1.</span> <span class="toc-text">image</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#build"><span class="toc-number">1.2.</span> <span class="toc-text">build</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#context"><span class="toc-number">1.2.1.</span> <span class="toc-text">context</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile"><span class="toc-number">1.2.2.</span> <span class="toc-text">dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#args"><span class="toc-number">1.2.3.</span> <span class="toc-text">args</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cache-from"><span class="toc-number">1.2.4.</span> <span class="toc-text">cache_from</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#labels"><span class="toc-number">1.2.5.</span> <span class="toc-text">labels</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shm-size"><span class="toc-number">1.2.6.</span> <span class="toc-text">shm_size</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cap-add-cap-drop"><span class="toc-number">1.3.</span> <span class="toc-text">cap_add, cap_drop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#command"><span class="toc-number">1.4.</span> <span class="toc-text">command</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#configs"><span class="toc-number">1.5.</span> <span class="toc-text">configs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SHORT-SYNTAX"><span class="toc-number">1.5.1.</span> <span class="toc-text">SHORT SYNTAX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LONG-SYNTAX"><span class="toc-number">1.5.2.</span> <span class="toc-text">LONG SYNTAX</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#container-name"><span class="toc-number">1.6.</span> <span class="toc-text">container_name</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deploy"><span class="toc-number">1.7.</span> <span class="toc-text">deploy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ENDPOINT-MODE"><span class="toc-number">1.7.1.</span> <span class="toc-text">ENDPOINT_MODE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LABELS"><span class="toc-number">1.7.2.</span> <span class="toc-text">LABELS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MODE"><span class="toc-number">1.7.3.</span> <span class="toc-text">MODE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PLACEMENT"><span class="toc-number">1.7.4.</span> <span class="toc-text">PLACEMENT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#REPLICAS"><span class="toc-number">1.7.5.</span> <span class="toc-text">REPLICAS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RESOURCES"><span class="toc-number">1.7.6.</span> <span class="toc-text">RESOURCES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RESTART-POLICY"><span class="toc-number">1.7.7.</span> <span class="toc-text">RESTART_POLICY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UPDATE-CONFIG"><span class="toc-number">1.7.8.</span> <span class="toc-text">UPDATE_CONFIG</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#devices"><span class="toc-number">1.8.</span> <span class="toc-text">devices</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#depends-on"><span class="toc-number">1.9.</span> <span class="toc-text">depends_on</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dns"><span class="toc-number">1.10.</span> <span class="toc-text">dns</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dns-search"><span class="toc-number">1.11.</span> <span class="toc-text">dns_search</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tmpfs"><span class="toc-number">1.12.</span> <span class="toc-text">tmpfs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#entrypoint"><span class="toc-number">1.13.</span> <span class="toc-text">entrypoint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#env-file"><span class="toc-number">1.14.</span> <span class="toc-text">env_file</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#environment"><span class="toc-number">1.15.</span> <span class="toc-text">environment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#expose"><span class="toc-number">1.16.</span> <span class="toc-text">expose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#external-links"><span class="toc-number">1.17.</span> <span class="toc-text">external_links</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extra-hosts"><span class="toc-number">1.18.</span> <span class="toc-text">extra_hosts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#healthcheck"><span class="toc-number">1.19.</span> <span class="toc-text">healthcheck</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Specifying-durations"><span class="toc-number">1.20.</span> <span class="toc-text">Specifying durations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#isolation"><span class="toc-number">1.21.</span> <span class="toc-text">isolation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#labels-1"><span class="toc-number">1.22.</span> <span class="toc-text">labels</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#logging"><span class="toc-number">1.23.</span> <span class="toc-text">logging</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#network-mode"><span class="toc-number">1.24.</span> <span class="toc-text">network_mode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#networks"><span class="toc-number">1.25.</span> <span class="toc-text">networks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ALIASES"><span class="toc-number">1.25.1.</span> <span class="toc-text">ALIASES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPV4-ADDRESS-IPV6-ADDRESS"><span class="toc-number">1.25.2.</span> <span class="toc-text">IPV4_ADDRESS, IPV6_ADDRESS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pid"><span class="toc-number">1.26.</span> <span class="toc-text">pid</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ports"><span class="toc-number">1.27.</span> <span class="toc-text">ports</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SHORT-SYNTAX-1"><span class="toc-number">1.27.1.</span> <span class="toc-text">SHORT SYNTAX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LONG-SYNTAX-1"><span class="toc-number">1.27.2.</span> <span class="toc-text">LONG SYNTAX</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#secrets"><span class="toc-number">1.28.</span> <span class="toc-text">secrets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#security-opt"><span class="toc-number">1.29.</span> <span class="toc-text">security_opt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stop-grace-period"><span class="toc-number">1.30.</span> <span class="toc-text">stop_grace_period</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stop-signal"><span class="toc-number">1.31.</span> <span class="toc-text">stop_signal</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sysctls"><span class="toc-number">1.32.</span> <span class="toc-text">sysctls</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ulimits"><span class="toc-number">1.33.</span> <span class="toc-text">ulimits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#userns-mode"><span class="toc-number">1.34.</span> <span class="toc-text">userns_mode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#volumes"><span class="toc-number">1.35.</span> <span class="toc-text">volumes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SHORT-SYNTAX-2"><span class="toc-number">1.35.1.</span> <span class="toc-text">SHORT SYNTAX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LONG-SYNTAX-2"><span class="toc-number">1.35.2.</span> <span class="toc-text">LONG SYNTAX</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#restart"><span class="toc-number">1.36.</span> <span class="toc-text">restart</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#domainname-hostname-ipc-mac-address-privileged-read-only-shm-size-stdin-open-tty-user-working-dir"><span class="toc-number">1.37.</span> <span class="toc-text">domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Specifying-durations-1"><span class="toc-number">1.38.</span> <span class="toc-text">Specifying durations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Volume-configuration-reference"><span class="toc-number">1.39.</span> <span class="toc-text">Volume configuration reference</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#driver"><span class="toc-number">1.39.1.</span> <span class="toc-text">driver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#driver-opts"><span class="toc-number">1.39.2.</span> <span class="toc-text">driver_opts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#external"><span class="toc-number">1.39.3.</span> <span class="toc-text">external</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#labels-2"><span class="toc-number">1.39.4.</span> <span class="toc-text">labels</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#name"><span class="toc-number">1.39.5.</span> <span class="toc-text">name</span></a></li></ol></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Net-Standard/" title=".Net Standard">.Net Standard<sup>2</sup></a></li>
		
			<li><a href="/categories/net异步与并行/" title=".net异步与并行">.net异步与并行<sup>10</sup></a></li>
		
			<li><a href="/categories/ABP/" title="ABP">ABP<sup>27</sup></a></li>
		
			<li><a href="/categories/ASP-NET-IIS请求处理管道/" title="ASP.NET/IIS请求处理管道">ASP.NET/IIS请求处理管道<sup>2</sup></a></li>
		
			<li><a href="/categories/ApplicationPoolIdentify/" title="ApplicationPoolIdentify">ApplicationPoolIdentify<sup>1</sup></a></li>
		
			<li><a href="/categories/CSharp基础/" title="CSharp基础">CSharp基础<sup>11</sup></a></li>
		
			<li><a href="/categories/CentOS7/" title="CentOS7">CentOS7<sup>11</sup></a></li>
		
			<li><a href="/categories/Chrome/" title="Chrome">Chrome<sup>1</sup></a></li>
		
			<li><a href="/categories/CodeDOM/" title="CodeDOM">CodeDOM<sup>3</sup></a></li>
		
			<li><a href="/categories/Consul/" title="Consul">Consul<sup>3</sup></a></li>
		
			<li><a href="/categories/Crontab/" title="Crontab">Crontab<sup>1</sup></a></li>
		
			<li><a href="/categories/Docker/" title="Docker">Docker<sup>7</sup></a></li>
		
			<li><a href="/categories/Docker-Compose/" title="Docker Compose">Docker Compose<sup>3</sup></a></li>
		
			<li><a href="/categories/DotNetCore/" title="DotNetCore">DotNetCore<sup>4</sup></a></li>
		
			<li><a href="/categories/DotNet面试题解析/" title="DotNet面试题解析">DotNet面试题解析<sup>8</sup></a></li>
		
			<li><a href="/categories/EasyNetQ/" title="EasyNetQ">EasyNetQ<sup>1</sup></a></li>
		
			<li><a href="/categories/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>1</sup></a></li>
		
			<li><a href="/categories/Emit-反射发出/" title="Emit(反射发出)">Emit(反射发出)<sup>6</sup></a></li>
		
			<li><a href="/categories/Expression-Tree/" title="Expression Tree">Expression Tree<sup>2</sup></a></li>
		
			<li><a href="/categories/Git/" title="Git">Git<sup>2</sup></a></li>
		
			<li><a href="/categories/HostService/" title="HostService">HostService<sup>1</sup></a></li>
		
			<li><a href="/categories/IDEA/" title="IDEA">IDEA<sup>2</sup></a></li>
		
			<li><a href="/categories/Java/" title="Java">Java<sup>5</sup></a></li>
		
			<li><a href="/categories/JavaScript-JQuery/" title="JavaScript/JQuery">JavaScript/JQuery<sup>1</sup></a></li>
		
			<li><a href="/categories/Jenkins/" title="Jenkins">Jenkins<sup>2</sup></a></li>
		
			<li><a href="/categories/Jexus/" title="Jexus">Jexus<sup>1</sup></a></li>
		
			<li><a href="/categories/Json-Net/" title="Json.Net">Json.Net<sup>1</sup></a></li>
		
			<li><a href="/categories/LINQ/" title="LINQ">LINQ<sup>3</sup></a></li>
		
			<li><a href="/categories/Let’s-Encrypt/" title="Let’s Encrypt">Let’s Encrypt<sup>1</sup></a></li>
		
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>5</sup></a></li>
		
			<li><a href="/categories/Linux-LVM/" title="Linux LVM">Linux LVM<sup>1</sup></a></li>
		
			<li><a href="/categories/Linux-磁盘/" title="Linux 磁盘">Linux 磁盘<sup>1</sup></a></li>
		
			<li><a href="/categories/Linux基础命令/" title="Linux基础命令">Linux基础命令<sup>22</sup></a></li>
		
			<li><a href="/categories/Linux服务/" title="Linux服务">Linux服务<sup>3</sup></a></li>
		
			<li><a href="/categories/MSIL指令/" title="MSIL指令">MSIL指令<sup>2</sup></a></li>
		
			<li><a href="/categories/MVC-Web-API/" title="MVC/Web API">MVC/Web API<sup>2</sup></a></li>
		
			<li><a href="/categories/MariaDB/" title="MariaDB">MariaDB<sup>1</sup></a></li>
		
			<li><a href="/categories/MarkDown/" title="MarkDown">MarkDown<sup>1</sup></a></li>
		
			<li><a href="/categories/MinIo/" title="MinIo">MinIo<sup>1</sup></a></li>
		
			<li><a href="/categories/MongoDB/" title="MongoDB">MongoDB<sup>3</sup></a></li>
		
			<li><a href="/categories/Moq/" title="Moq">Moq<sup>1</sup></a></li>
		
			<li><a href="/categories/MySql/" title="MySql">MySql<sup>9</sup></a></li>
		
			<li><a href="/categories/Naudio/" title="Naudio">Naudio<sup>2</sup></a></li>
		
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>2</sup></a></li>
		
			<li><a href="/categories/Nodejs/" title="Nodejs">Nodejs<sup>3</sup></a></li>
		
			<li><a href="/categories/OAuth2-0/" title="OAuth2.0">OAuth2.0<sup>2</sup></a></li>
		
			<li><a href="/categories/Ocelot/" title="Ocelot">Ocelot<sup>1</sup></a></li>
		
			<li><a href="/categories/Openssl/" title="Openssl">Openssl<sup>2</sup></a></li>
		
			<li><a href="/categories/PAM/" title="PAM">PAM<sup>1</sup></a></li>
		
			<li><a href="/categories/Polly/" title="Polly">Polly<sup>2</sup></a></li>
		
			<li><a href="/categories/PostGresqlSql/" title="PostGresqlSql">PostGresqlSql<sup>1</sup></a></li>
		
			<li><a href="/categories/Python/" title="Python">Python<sup>1</sup></a></li>
		
			<li><a href="/categories/RESTful/" title="RESTful">RESTful<sup>2</sup></a></li>
		
			<li><a href="/categories/RabbitMQ/" title="RabbitMQ">RabbitMQ<sup>2</sup></a></li>
		
			<li><a href="/categories/Redis/" title="Redis">Redis<sup>8</sup></a></li>
		
			<li><a href="/categories/Resharper/" title="Resharper">Resharper<sup>1</sup></a></li>
		
			<li><a href="/categories/SSH/" title="SSH">SSH<sup>1</sup></a></li>
		
			<li><a href="/categories/SSL-TLS/" title="SSL/TLS">SSL/TLS<sup>2</sup></a></li>
		
			<li><a href="/categories/Shell脚本/" title="Shell脚本">Shell脚本<sup>1</sup></a></li>
		
			<li><a href="/categories/Skywalking/" title="Skywalking">Skywalking<sup>1</sup></a></li>
		
			<li><a href="/categories/Sql/" title="Sql">Sql<sup>5</sup></a></li>
		
			<li><a href="/categories/TCP协议/" title="TCP协议">TCP协议<sup>2</sup></a></li>
		
			<li><a href="/categories/TDD/" title="TDD">TDD<sup>1</sup></a></li>
		
			<li><a href="/categories/TPL-DataFlow/" title="TPL DataFlow">TPL DataFlow<sup>2</sup></a></li>
		
			<li><a href="/categories/Tomcat/" title="Tomcat">Tomcat<sup>4</sup></a></li>
		
			<li><a href="/categories/WCF时间类型序列化/" title="WCF时间类型序列化">WCF时间类型序列化<sup>1</sup></a></li>
		
			<li><a href="/categories/WSL/" title="WSL">WSL<sup>1</sup></a></li>
		
			<li><a href="/categories/WebForm/" title="WebForm">WebForm<sup>2</sup></a></li>
		
			<li><a href="/categories/WinDbg/" title="WinDbg">WinDbg<sup>1</sup></a></li>
		
			<li><a href="/categories/WinSCP/" title="WinSCP">WinSCP<sup>1</sup></a></li>
		
			<li><a href="/categories/Windows系统/" title="Windows系统">Windows系统<sup>1</sup></a></li>
		
			<li><a href="/categories/ab/" title="ab">ab<sup>1</sup></a></li>
		
			<li><a href="/categories/hexo/" title="hexo">hexo<sup>2</sup></a></li>
		
			<li><a href="/categories/shadowsocks/" title="shadowsocks">shadowsocks<sup>1</sup></a></li>
		
			<li><a href="/categories/supervisor/" title="supervisor">supervisor<sup>2</sup></a></li>
		
			<li><a href="/categories/zookeeper/" title="zookeeper">zookeeper<sup>1</sup></a></li>
		
			<li><a href="/categories/内存泄漏/" title="内存泄漏">内存泄漏<sup>1</sup></a></li>
		
			<li><a href="/categories/分布式/" title="分布式">分布式<sup>1</sup></a></li>
		
			<li><a href="/categories/分布式事务/" title="分布式事务">分布式事务<sup>1</sup></a></li>
		
			<li><a href="/categories/单词收录/" title="单词收录">单词收录<sup>14</sup></a></li>
		
			<li><a href="/categories/反射/" title="反射">反射<sup>4</sup></a></li>
		
			<li><a href="/categories/委托与事件/" title="委托与事件">委托与事件<sup>4</sup></a></li>
		
			<li><a href="/categories/工具/" title="工具">工具<sup>1</sup></a></li>
		
			<li><a href="/categories/并发模型/" title="并发模型">并发模型<sup>1</sup></a></li>
		
			<li><a href="/categories/插件/" title="插件">插件<sup>1</sup></a></li>
		
			<li><a href="/categories/时间-时间戳转换/" title="时间/时间戳转换">时间/时间戳转换<sup>1</sup></a></li>
		
			<li><a href="/categories/消息队列/" title="消息队列">消息队列<sup>1</sup></a></li>
		
			<li><a href="/categories/硬盘/" title="硬盘">硬盘<sup>1</sup></a></li>
		
			<li><a href="/categories/程序集/" title="程序集">程序集<sup>2</sup></a></li>
		
			<li><a href="/categories/算法/" title="算法">算法<sup>3</sup></a></li>
		
			<li><a href="/categories/线性表/" title="线性表">线性表<sup>1</sup></a></li>
		
			<li><a href="/categories/线程池/" title="线程池">线程池<sup>1</sup></a></li>
		
			<li><a href="/categories/缓存/" title="缓存">缓存<sup>3</sup></a></li>
		
			<li><a href="/categories/计算机基础/" title="计算机基础">计算机基础<sup>3</sup></a></li>
		
			<li><a href="/categories/认证与授权/" title="认证与授权">认证与授权<sup>1</sup></a></li>
		
			<li><a href="/categories/设计模式/" title="设计模式">设计模式<sup>3</sup></a></li>
		
			<li><a href="/categories/链表/" title="链表">链表<sup>2</sup></a></li>
		
			<li><a href="/categories/集合与泛型/" title="集合与泛型">集合与泛型<sup>4</sup></a></li>
		
			<li><a href="/categories/音频-视频/" title="音频/视频">音频/视频<sup>1</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist" style="clear:both;">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Net-Standard/" title=".Net Standard">.Net Standard<sup>2</sup></a></li>
		
			<li><a href="/tags/net异步与并行/" title=".net异步与并行">.net异步与并行<sup>12</sup></a></li>
		
			<li><a href="/tags/ABP/" title="ABP">ABP<sup>27</sup></a></li>
		
			<li><a href="/tags/ASP-NET-IIS请求处理管道/" title="ASP.NET/IIS请求处理管道">ASP.NET/IIS请求处理管道<sup>7</sup></a></li>
		
			<li><a href="/tags/AWS/" title="AWS">AWS<sup>7</sup></a></li>
		
			<li><a href="/tags/ApplicationPoolIdentify/" title="ApplicationPoolIdentify">ApplicationPoolIdentify<sup>1</sup></a></li>
		
			<li><a href="/tags/CSharp/" title="CSharp">CSharp<sup>102</sup></a></li>
		
			<li><a href="/tags/CSharp基础/" title="CSharp基础">CSharp基础<sup>45</sup></a></li>
		
			<li><a href="/tags/CentOS7/" title="CentOS7">CentOS7<sup>80</sup></a></li>
		
			<li><a href="/tags/Chrome/" title="Chrome">Chrome<sup>1</sup></a></li>
		
			<li><a href="/tags/CodeDOM/" title="CodeDOM">CodeDOM<sup>3</sup></a></li>
		
			<li><a href="/tags/Consul/" title="Consul">Consul<sup>4</sup></a></li>
		
			<li><a href="/tags/Crontab/" title="Crontab">Crontab<sup>1</sup></a></li>
		
			<li><a href="/tags/Docker/" title="Docker">Docker<sup>23</sup></a></li>
		
			<li><a href="/tags/Docker-Compose/" title="Docker Compose">Docker Compose<sup>5</sup></a></li>
		
			<li><a href="/tags/DotNet/" title="DotNet">DotNet<sup>106</sup></a></li>
		
			<li><a href="/tags/DotNetCore/" title="DotNetCore">DotNetCore<sup>17</sup></a></li>
		
			<li><a href="/tags/DotNet面试题解析/" title="DotNet面试题解析">DotNet面试题解析<sup>10</sup></a></li>
		
			<li><a href="/tags/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>2</sup></a></li>
		
			<li><a href="/tags/Emit-反射发出/" title="Emit(反射发出)">Emit(反射发出)<sup>8</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
<div style="display: none;" id="rocket-to-top">
  <div style="opacity: 0; display: block;" class="level-2"></div>
  <div class="level-3"></div>
</div>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		<a href="https://github.com/syxdevcode" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/syxdevcode/pacman" target="_blank" title="Pacman">Pacman</a> © 2020 
		
		<a href="https://syxdevcode.github.com" target="_blank" title="syxdevcode">syxdevcode</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>

<script type="text/javascript">
  $(document).ready(function () {
    $('.navbar').click(function () {
      $('header nav').toggleClass('shownav');
    });
    var myWidth = 0;
    function getSize() {
      if (typeof (window.innerWidth) == 'number') {
        myWidth = window.innerWidth;
      } else if (document.documentElement && document.documentElement.clientWidth) {
        myWidth = document.documentElement.clientWidth;
      };
    };
    var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
    $(window).resize(function () {
      getSize();
      if (myWidth >= 1024) {
        $('header nav').removeClass('shownav');
      } else {
        m.removeClass('moveMain');
        a.css('display', 'block').removeClass('fadeOut');
        o.css('display', 'none');
      
          $('#toc.toc-aside').css('display', 'none');
        
    }
    });
    c.click(function () {
      a.addClass('fadeOut').css('display', 'none');
      o.css('display', 'block').addClass('fadeIn');
      m.addClass('moveMain');
    });
    o.click(function () {
      o.css('display', 'none').removeClass('beforeFadeIn');
      a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
      m.removeClass('moveMain');
    });
    $(window).scroll(function () {
      o.css("top", Math.max(80, 260 - $(this).scrollTop()));
    });
  });
  //判断访问终端
  var browser = {
    versions: function () {
      var u = navigator.userAgent,
        app = navigator.appVersion;
      return {
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1,//火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Adr') > -1, //android终端
        iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
        iPad: u.indexOf('iPad') > -1, //是否iPad
        webApp: u.indexOf('Safari') == -1, //是否web应该程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') > -1, //是否微信 （2015-01-22新增）
        qq: u.match(/\sQQ/i) == " qq" //是否QQ
      };
    }(),
    language: (navigator.browserLanguage || navigator.language).toLowerCase()
  }
</script>

<script type="text/javascript">
  $(document).ready(function () {
    var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t = $('#toc'),
      h = $('article h2')
    ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o = $('.openaside'),
      c = $('.closeaside');
    if (ai.length > 0) {
      ai.wrap('<div class="video-container" />');
    };
    if (ae.length > 0) {
      ae.wrap('<div class="video-container" />');
    };
    if (ah.length == 0) {
      t.css('display', 'none');
    } else {
      c.click(function () {
        ta.css('display', 'block').addClass('fadeIn');
      });
      o.click(function () {
        ta.css('display', 'none');
      });
      $(window).scroll(function () {
        ta.css("top", Math.max(140, 320 - $(this).scrollTop()));
      });
    };
  });
</script>


<script type="text/javascript">
  $(document).ready(function () {
    var $this = $('.share'),
      //url = $this.attr('data-url'),
      url = window.location.href,
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
    var html = [
      '<a href="#" class="overlay" id="qrcode"></a>',
      '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://mobile.qq.com/qrcode?url=' + encodedUrl + '"/></div>',
      '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
      '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
      '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
      '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
      '<a href="http://service.weibo.com/share/share.php?title=' + title + '&url=' + encodedUrl + '&ralateUid=' + tsina + '&searchPic=true&style=number' + '" class="article-share-weibo" target="_blank" title="Weibo"></a>',
      '<span title="Share to"></span>'
    ].join('');
    $this.append(html);
    viewqrCode();
    $('.article-share-qrcode').click(viewqrCode()
    );

  });
  function viewqrCode() {
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function () {
      $('.qrcode strong').text(' ');
    });
  }
</script>
<script type="text/javascript">  
  //判断是否移动端 
  if (!browser.versions.mobile) {
    $(function () {
      var c, a = $("#rocket-to-top"), e = ($(document).scrollTop(), !0);
      $(window).scroll(function () {
        var b = $(document).scrollTop(); 0 == b ? "0px 0px" == a.css("background-position") ? a.fadeOut("slow") : e && (e = !1, $(".level-2").css("opacity", 1), a.delay(100).animate({ marginTop: "-1000px" }, "normal", function () { a.css({ "margin-top": "-125px", display: "none" }), e = !0 })) : a.fadeIn("slow")
      }), a.hover(function () { $(".level-2").stop(!0).animate({ opacity: 1 }) }, function () { $(".level-2").stop(!0).animate({ opacity: 0 }) }), $(".level-3").click(function () { function b() { var b = a.css("background-position"); if ("none" == a.css("display") || 0 == e) return clearInterval(c), a.css("background-position", "0px 0px"), void 0; switch (b) { case "0px 0px": a.css("background-position", "-298px 0px"); break; case "-298px 0px": a.css("background-position", "-447px 0px"); break; case "-447px 0px": a.css("background-position", "-596px 0px"); break; case "-596px 0px": a.css("background-position", "-745px 0px"); break; case "-745px 0px": a.css("background-position", "-298px 0px") } } e && (c = setInterval(b, 50), $("html,body").animate({ scrollTop: 0 }, "slow")) })
    });
  }
</script>





  </body>
</html>
